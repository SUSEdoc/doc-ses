<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SES 7 | Administration and Operations Guide | Authentication with cephx</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Authentication with cephx | SES 7"/>
<meta name="description" content="To identify clients and protect against man-in-the-middle attacks, Ceph provides its cephx authentication system. Clients in this context are either …"/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7"/>
<meta name="book-title" content="Administration and Operations Guide"/>
<meta name="chapter-title" content="Chapter 30. Authentication with cephx"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Authentication with cephx | SES 7"/>
<meta property="og:description" content="To identify clients and protect against man-in-the-middle attacks, Ceph provides its cephx authentication system. Clients in this context are either …"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Authentication with cephx | SES 7"/>
<meta name="twitter:description" content="To identify clients and protect against man-in-the-middle attacks, Ceph provides its cephx authentication system. Clients in this context are either …"/>
<link rel="prev" href="cha-mgr-modules.html" title="Chapter 29. Ceph Manager modules"/><link rel="next" href="bk02apa.html" title="Appendix A. Ceph maintenance updates based on upstream 'Octopus' point releases"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration and Operations Guide</a><span> / </span><a class="crumb" href="part-cluster-configuration.html">Configuring a Cluster</a><span> / </span><a class="crumb" href="cha-storage-cephx.html">Authentication with cephx</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration and Operations Guide</div><ol><li><a href="preface-admin.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="part-dashboard.html" class="has-children "><span class="title-number">I </span><span class="title-name">Ceph Dashboard</span></a><ol><li><a href="dashboard-about.html" class=" "><span class="title-number">1 </span><span class="title-name">About the Ceph Dashboard</span></a></li><li><a href="dashboard-webui-general.html" class=" "><span class="title-number">2 </span><span class="title-name">Dashboard's Web user interface</span></a></li><li><a href="dashboard-user-mgmt.html" class=" "><span class="title-number">3 </span><span class="title-name">Manage Ceph Dashboard users and roles</span></a></li><li><a href="dashboard-cluster.html" class=" "><span class="title-number">4 </span><span class="title-name">View cluster internals</span></a></li><li><a href="dashboard-pools.html" class=" "><span class="title-number">5 </span><span class="title-name">Manage pools</span></a></li><li><a href="dashboard-rbds.html" class=" "><span class="title-number">6 </span><span class="title-name">Manage RADOS Block Device</span></a></li><li><a href="dash-webui-nfs.html" class=" "><span class="title-number">7 </span><span class="title-name">Manage NFS Ganesha</span></a></li><li><a href="dashboard-mds.html" class=" "><span class="title-number">8 </span><span class="title-name">Manage CephFS</span></a></li><li><a href="dashboard-ogw.html" class=" "><span class="title-number">9 </span><span class="title-name">Manage the Object Gateway</span></a></li><li><a href="dashboard-initial-configuration.html" class=" "><span class="title-number">10 </span><span class="title-name">Manual configuration</span></a></li><li><a href="dashboard-user-roles.html" class=" "><span class="title-number">11 </span><span class="title-name">Manage users and roles on the command line</span></a></li></ol></li><li><a href="part-cluster-operation.html" class="has-children "><span class="title-number">II </span><span class="title-name">Cluster Operation</span></a><ol><li><a href="ceph-monitor.html" class=" "><span class="title-number">12 </span><span class="title-name">Determine the cluster state</span></a></li><li><a href="storage-salt-cluster.html" class=" "><span class="title-number">13 </span><span class="title-name">Operational tasks</span></a></li><li><a href="cha-ceph-operating.html" class=" "><span class="title-number">14 </span><span class="title-name">Operation of Ceph services</span></a></li><li><a href="cha-deployment-backup.html" class=" "><span class="title-number">15 </span><span class="title-name">Backup and restore</span></a></li><li><a href="monitoring-alerting.html" class=" "><span class="title-number">16 </span><span class="title-name">Monitoring and alerting</span></a></li></ol></li><li><a href="part-storing-data.html" class="has-children "><span class="title-number">III </span><span class="title-name">Storing Data in a Cluster</span></a><ol><li><a href="cha-storage-datamgm.html" class=" "><span class="title-number">17 </span><span class="title-name">Stored data management</span></a></li><li><a href="ceph-pools.html" class=" "><span class="title-number">18 </span><span class="title-name">Manage storage pools</span></a></li><li><a href="cha-ceph-erasure.html" class=" "><span class="title-number">19 </span><span class="title-name">Erasure coded pools</span></a></li><li><a href="ceph-rbd.html" class=" "><span class="title-number">20 </span><span class="title-name">RADOS Block Device</span></a></li></ol></li><li><a href="part-accessing-data.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Accessing Cluster Data</span></a><ol><li><a href="cha-ceph-gw.html" class=" "><span class="title-number">21 </span><span class="title-name">Ceph Object Gateway</span></a></li><li><a href="cha-ceph-iscsi.html" class=" "><span class="title-number">22 </span><span class="title-name">Ceph iSCSI gateway</span></a></li><li><a href="cha-ceph-cephfs.html" class=" "><span class="title-number">23 </span><span class="title-name">Clustered file system</span></a></li><li><a href="cha-ses-cifs.html" class=" "><span class="title-number">24 </span><span class="title-name">Export Ceph data via Samba</span></a></li><li><a href="cha-ceph-nfsganesha.html" class=" "><span class="title-number">25 </span><span class="title-name">NFS Ganesha</span></a></li></ol></li><li><a href="part-integration-virt.html" class="has-children "><span class="title-number">V </span><span class="title-name">Integration with Virtualization Tools</span></a><ol><li><a href="cha-ceph-libvirt.html" class=" "><span class="title-number">26 </span><span class="title-name"><code class="systemitem">libvirt</code> and Ceph</span></a></li><li><a href="cha-ceph-kvm.html" class=" "><span class="title-number">27 </span><span class="title-name">Ceph as a back-end for QEMU KVM instance</span></a></li></ol></li><li class="active"><a href="part-cluster-configuration.html" class="has-children you-are-here"><span class="title-number">VI </span><span class="title-name">Configuring a Cluster</span></a><ol><li><a href="cha-ceph-configuration.html" class=" "><span class="title-number">28 </span><span class="title-name">Ceph cluster configuration</span></a></li><li><a href="cha-mgr-modules.html" class=" "><span class="title-number">29 </span><span class="title-name">Ceph Manager modules</span></a></li><li><a href="cha-storage-cephx.html" class=" you-are-here"><span class="title-number">30 </span><span class="title-name">Authentication with <code class="systemitem">cephx</code></span></a></li></ol></li><li><a href="bk02apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Octopus' point releases</span></a></li><li><a href="bk02go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-storage-cephx" data-id-title="Authentication with cephx"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">30 </span><span class="title-name">Authentication with <code class="systemitem">cephx</code></span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  To identify clients and protect against man-in-the-middle attacks, Ceph
  provides its <code class="systemitem">cephx</code> authentication system. <span class="emphasis"><em>Clients</em></span> in
  this context are either human users—such as the admin user—or
  Ceph-related services/daemons, for example OSDs, monitors, or Object Gateways.
 </p><div id="id-1.4.8.4.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
   The <code class="systemitem">cephx</code> protocol does not address data encryption in transport, such as
   TLS/SSL.
  </p></div><section class="sect1" id="storage-cephx-arch" data-id-title="Authentication architecture"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.1 </span><span class="title-name">Authentication architecture</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-arch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">cephx</code> uses shared secret keys for authentication, meaning both the client
   and Ceph Monitors have a copy of the client’s secret key. The authentication
   protocol enables both parties to prove to each other that they have a copy
   of the key without actually revealing it. This provides mutual
   authentication, which means the cluster is sure the user possesses the
   secret key, and the user is sure that the cluster has a copy of the secret
   key as well.
  </p><p>
   A key scalability feature of Ceph is to avoid a centralized interface to
   the Ceph object store. This means that Ceph clients can interact with
   OSDs directly. To protect data, Ceph provides its <code class="systemitem">cephx</code> authentication
   system, which authenticates Ceph clients.
  </p><p>
   Each monitor can authenticate clients and distribute keys, so there is no
   single point of failure or bottleneck when using <code class="systemitem">cephx</code>. The monitor
   returns an authentication data structure that contains a session key for use
   in obtaining Ceph services. This session key is itself encrypted with the
   client’s permanent secret key, so that only the client can request services
   from the Ceph monitors. The client then uses the session key to request
   its desired services from the monitor, and the monitor provides the client
   with a ticket that will authenticate the client to the OSDs that actually
   handle data. Ceph monitors and OSDs share a secret, so the client can use
   the ticket provided by the monitor with any OSD or metadata server in the
   cluster. <code class="systemitem">cephx</code> tickets expire, so an attacker cannot use an expired ticket
   or session key obtained wrongfully.
  </p><p>
   To use <code class="systemitem">cephx</code>, an administrator must setup clients/users first. In the
   following diagram, the
   <code class="systemitem">client.admin</code> user invokes
   <code class="command">ceph auth get-or-create-key</code> from the command line to
   generate a user name and secret key. Ceph’s <code class="command">auth</code>
   subsystem generates the user name and key, stores a copy with the monitor(s)
   and transmits the user’s secret back to the
   <code class="systemitem">client.admin</code> user. This means that
   the client and the monitor share a secret key.
  </p><div class="figure" id="id-1.4.8.4.5.6"><div class="figure-contents"><div class="mediaobject"><a href="images/cephx_keyring.png"><img src="images/cephx_keyring.png" width="70%" alt="Basic cephx authentication" title="Basic cephx authentication"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 30.1: </span><span class="title-name">Basic <code class="systemitem">cephx</code> authentication </span></span><a title="Permalink" class="permalink" href="cha-storage-cephx.html#id-1.4.8.4.5.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div><p>
   To authenticate with the monitor, the client passes the user name to the
   monitor. The monitor generates a session key and encrypts it with the secret
   key associated with the user name and transmits the encrypted ticket back to
   the client. The client then decrypts the data with the shared secret key to
   retrieve the session key. The session key identifies the user for the
   current session. The client then requests a ticket related to the user,
   which is signed by the session key. The monitor generates a ticket, encrypts
   it with the user’s secret key and transmits it back to the client. The
   client decrypts the ticket and uses it to sign requests to OSDs and metadata
   servers throughout the cluster.
  </p><div class="figure" id="id-1.4.8.4.5.8"><div class="figure-contents"><div class="mediaobject"><a href="images/cephx_keyring2.png"><img src="images/cephx_keyring2.png" width="70%" alt="cephx authentication" title="cephx authentication"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 30.2: </span><span class="title-name"><code class="systemitem">cephx</code> authentication </span></span><a title="Permalink" class="permalink" href="cha-storage-cephx.html#id-1.4.8.4.5.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div><p>
   The <code class="systemitem">cephx</code> protocol authenticates ongoing communications between the client
   machine and the Ceph servers. Each message sent between a client and a
   server after the initial authentication is signed using a ticket that the
   monitors, OSDs, and metadata servers can verify with their shared secret.
  </p><div class="figure" id="id-1.4.8.4.5.10"><div class="figure-contents"><div class="mediaobject"><a href="images/cephx_keyring3.png"><img src="images/cephx_keyring3.png" width="70%" alt="cephx authentication - MDS and OSD" title="cephx authentication - MDS and OSD"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 30.3: </span><span class="title-name"><code class="systemitem">cephx</code> authentication - MDS and OSD </span></span><a title="Permalink" class="permalink" href="cha-storage-cephx.html#id-1.4.8.4.5.10">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div><div id="id-1.4.8.4.5.11" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
    The protection offered by this authentication is between the Ceph client
    and the Ceph cluster hosts. The authentication is not extended beyond the
    Ceph client. If the user accesses the Ceph client from a remote host,
    Ceph authentication is not applied to the connection between the user’s
    host and the client host.
   </p></div></section><section class="sect1" id="storage-cephx-keymgmt" data-id-title="Key management"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.2 </span><span class="title-name">Key management</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes Ceph client users and their authentication and
   authorization with the Ceph storage cluster. <span class="emphasis"><em>Users</em></span>
   are either individuals or system actors such as applications, which use
   Ceph clients to interact with the Ceph storage cluster daemons.
  </p><p>
   When Ceph runs with authentication and authorization enabled (enabled by
   default), you must specify a user name and a keyring containing the secret
   key of the specified user (usually via the command line). If you do not
   specify a user name, Ceph will use
   <code class="systemitem">client.admin</code> as the default user
   name. If you do not specify a keyring, Ceph will look for a keyring via
   the keyring setting in the Ceph configuration file. For example, if you
   execute the <code class="command">ceph health</code> command without specifying a user
   name or keyring, Ceph interprets the command like this:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph -n client.admin --keyring=/etc/ceph/ceph.client.admin.keyring health</pre></div><p>
   Alternatively, you may use the <code class="literal">CEPH_ARGS</code> environment
   variable to avoid re-entering the user name and secret.
  </p><section class="sect2" id="storage-cephx-keymgmt-backgrnd" data-id-title="Background information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">30.2.1 </span><span class="title-name">Background information</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-backgrnd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Regardless of the type of Ceph client (for example, block device, object
    storage, file system, native API), Ceph stores all data as objects within
    <span class="emphasis"><em>pools</em></span>. Ceph users need to have access to pools in
    order to read and write data. Additionally, Ceph users must have execute
    permissions to use Ceph's administrative commands. The following concepts
    will help you understand Ceph user management.
   </p><section class="sect3" id="cephx-user" data-id-title="User"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.1.1 </span><span class="title-name">User</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-user">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A user is either an individual or a system actor such as an application.
     Creating users allows you to control who (or what) can access your Ceph
     storage cluster, its pools, and the data within pools.
    </p><p>
     Ceph uses <span class="emphasis"><em>types</em></span> of users. For the purposes of user
     management, the type will always be <code class="literal">client</code>. Ceph
     identifies users in period (.) delimited form, consisting of the user type
     and the user ID. For example, <code class="literal">TYPE.ID</code>,
     <code class="literal">client.admin</code>, or <code class="literal">client.user1</code>. The
     reason for user typing is that Ceph monitors, OSDs, and metadata servers
     also use the cephx protocol, but they are not clients. Distinguishing the
     user type helps to distinguish between client users and other users,
     streamlining access control, user monitoring, and traceability.
    </p><p>
     Sometimes Ceph’s user type may seem confusing, because the Ceph
     command line allows you to specify a user with or without the type,
     depending upon your command line usage. If you specify
     <code class="option">--user</code> or <code class="option">--id</code>, you can omit the type.
     So <code class="literal">client.user1</code> can be entered simply as
     <code class="literal">user1</code>. If you specify <code class="option">--name</code> or
     <code class="option">-n</code>, you must specify the type and name, such as
     <code class="literal">client.user1</code>. We recommend using the type and name as a
     best practice wherever possible.
    </p><div id="id-1.4.8.4.6.6.3.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      A Ceph storage cluster user is not the same as a Ceph object storage
      user or a Ceph file system user. The Ceph Object Gateway uses a Ceph storage
      cluster user to communicate between the gateway daemon and the storage
      cluster, but the gateway has its own user management functionality for
      end users. The Ceph file system uses POSIX semantics. The user space
      associated with it is not the same as a Ceph storage cluster user.
     </p></div></section><section class="sect3" id="authorization-capabilities-cephx" data-id-title="Authorization and capabilities"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.1.2 </span><span class="title-name">Authorization and capabilities</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#authorization-capabilities-cephx">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Ceph uses the term 'capabilities' (caps) to describe authorizing an
     authenticated user to exercise the functionality of the monitors, OSDs,
     and metadata servers. Capabilities can also restrict access to data within
     a pool or pool namespace. A Ceph administrative user sets a user's
     capabilities when creating or updating a user.
    </p><p>
     Capability syntax follows the form:
    </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">daemon-type</em> 'allow <em class="replaceable">capability</em>' [...]</pre></div><p>
     Following is a list of capabilities for each service type:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.8.4.6.6.4.6.1"><span class="term">Monitor capabilities</span></dt><dd><p>
        include <code class="literal">r</code>, <code class="literal">w</code>,
        <code class="literal">x</code> and <code class="literal">allow profile
        <em class="replaceable">cap</em></code>.
       </p><div class="verbatim-wrap"><pre class="screen">mon 'allow rwx'
mon 'allow profile osd'</pre></div></dd><dt id="id-1.4.8.4.6.6.4.6.2"><span class="term">OSD capabilities</span></dt><dd><p>
        include <code class="literal">r</code>, <code class="literal">w</code>,
        <code class="literal">x</code>, <code class="literal">class-read</code>,
        <code class="literal">class-write</code> and <code class="literal">profile osd</code>.
        Additionally, OSD capabilities also allow for pool and namespace
        settings.
       </p><div class="verbatim-wrap"><pre class="screen">osd 'allow <em class="replaceable">capability</em>' [pool=<em class="replaceable">poolname</em>] [namespace=<em class="replaceable">namespace-name</em>]</pre></div></dd><dt id="id-1.4.8.4.6.6.4.6.3"><span class="term">MDS capability</span></dt><dd><p>
        simply requires <code class="literal">allow</code>, or blank.
       </p><div class="verbatim-wrap"><pre class="screen">mds 'allow'</pre></div></dd></dl></div><p>
     The following entries describe each capability:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.8.4.6.6.4.8.1"><span class="term">allow</span></dt><dd><p>
        Precedes access settings for a daemon. Implies <code class="literal">rw</code>
        for MDS only.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.2"><span class="term">r</span></dt><dd><p>
        Gives the user read access. Required with monitors to retrieve the
        CRUSH map.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.3"><span class="term">w</span></dt><dd><p>
        Gives the user write access to objects.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.4"><span class="term">x</span></dt><dd><p>
        Gives the user the capability to call class methods (both read and
        write) and to conduct <code class="literal">auth</code> operations on monitors.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.5"><span class="term">class-read</span></dt><dd><p>
        Gives the user the capability to call class read methods. Subset of
        <code class="literal">x</code>.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.6"><span class="term">class-write</span></dt><dd><p>
        Gives the user the capability to call class write methods. Subset of
        <code class="literal">x</code>.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.7"><span class="term">*</span></dt><dd><p>
        Gives the user read, write, and execute permissions for a particular
        daemon/pool, and the ability to execute admin commands.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.8"><span class="term">profile osd</span></dt><dd><p>
        Gives a user permissions to connect as an OSD to other OSDs or
        monitors. Conferred on OSDs to enable OSDs to handle replication
        heartbeat traffic and status reporting.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.9"><span class="term">profile mds</span></dt><dd><p>
        Gives a user permissions to connect as an MDS to other MDSs or
        monitors.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.10"><span class="term">profile bootstrap-osd</span></dt><dd><p>
        Gives a user permissions to bootstrap an OSD. Delegated to deployment
        tools so that they have permissions to add keys when bootstrapping an
        OSD.
       </p></dd><dt id="id-1.4.8.4.6.6.4.8.11"><span class="term">profile bootstrap-mds</span></dt><dd><p>
        Gives a user permissions to bootstrap a metadata server. Delegated to
        deployment tools so they have permissions to add keys when
        bootstrapping a metadata server.
       </p></dd></dl></div></section><section class="sect3" id="cephx-pools" data-id-title="Pools"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.1.3 </span><span class="title-name">Pools</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-pools">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A pool is a logical partition where users store data. In Ceph
     deployments, it is common to create a pool as a logical partition for
     similar types of data. For example, when deploying Ceph as a back-end
     for OpenStack, a typical deployment would have pools for volumes, images,
     backups and virtual machines, and users such as
     <code class="systemitem">client.glance</code> or
     <code class="systemitem">client.cinder</code>.
    </p></section></section><section class="sect2" id="storage-cephx-keymgmt-usermgmt" data-id-title="Managing users"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">30.2.2 </span><span class="title-name">Managing users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-usermgmt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    User management functionality provides Ceph cluster administrators with
    the ability to create, update, and delete users directly in the Ceph
    cluster.
   </p><p>
    When you create or delete users in the Ceph cluster, you may need to
    distribute keys to clients so that they can be added to keyrings. See
    <a class="xref" href="cha-storage-cephx.html#storage-cephx-keymgmt-keyringmgmt" title="30.2.3. Managing keyrings">Section 30.2.3, “Managing keyrings”</a> for details.
   </p><section class="sect3" id="cephx-listing-users" data-id-title="Listing users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.1 </span><span class="title-name">Listing users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-listing-users">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To list the users in your cluster, execute the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth list</pre></div><p>
     Ceph will list all users in your cluster. For example, in a cluster with
     two nodes, <code class="command">ceph auth list</code> output looks similar to this:
    </p><div class="verbatim-wrap"><pre class="screen">installed auth entries:

osd.0
        key: AQCvCbtToC6MDhAATtuT70Sl+DymPCfDSsyV4w==
        caps: [mon] allow profile osd
        caps: [osd] allow *
osd.1
        key: AQC4CbtTCFJBChAAVq5spj0ff4eHZICxIOVZeA==
        caps: [mon] allow profile osd
        caps: [osd] allow *
client.admin
        key: AQBHCbtT6APDHhAA5W00cBchwkQjh3dkKsyPjw==
        caps: [mds] allow
        caps: [mon] allow *
        caps: [osd] allow *
client.bootstrap-mds
        key: AQBICbtTOK9uGBAAdbe5zcIGHZL3T/u2g6EBww==
        caps: [mon] allow profile bootstrap-mds
client.bootstrap-osd
        key: AQBHCbtT4GxqORAADE5u7RkpCN/oo4e5W0uBtw==
        caps: [mon] allow profile bootstrap-osd</pre></div><div id="id-1.4.8.4.6.7.4.6" data-id-title="TYPE.ID notation" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: TYPE.ID notation</div><p>
      Note that the <code class="literal">TYPE.ID</code> notation for users applies such
      that <code class="literal">osd.0</code> specifies a user of type
      <code class="literal">osd</code> and its ID is <code class="literal">0</code>.
      <code class="literal">client.admin</code> is a user of type
      <code class="literal">client</code> and its ID is <code class="literal">admin</code>. Note
      also that each entry has a <code class="literal">key:
      <em class="replaceable">value</em></code> entry, and one or more
      <code class="literal">caps:</code> entries.
     </p><p>
      You may use the <code class="option">-o <em class="replaceable">filename</em></code>
      option with <code class="command">ceph auth list</code> to save the output to a
      file.
     </p></div></section><section class="sect3" id="cephx-information-users" data-id-title="Getting information about users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.2 </span><span class="title-name">Getting information about users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-information-users">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To retrieve a specific user, key, and capabilities, execute the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get <em class="replaceable">TYPE.ID</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get client.admin
exported keyring for client.admin
[client.admin]
	key = AQA19uZUqIwkHxAAFuUwvq0eJD4S173oFRxe0g==
	caps mds = "allow"
	caps mon = "allow *"
 caps osd = "allow *"</pre></div><p>
     Developers may also execute the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth export <em class="replaceable">TYPE.ID</em></pre></div><p>
     The <code class="command">auth export</code> command is identical to <code class="command">auth
     get</code>, but also prints the internal authentication ID.
    </p></section><section class="sect3" id="storage-cephx-keymgmt-usermgmt-useradd" data-id-title="Adding users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.3 </span><span class="title-name">Adding users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-usermgmt-useradd">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Adding a user creates a user name (<code class="literal">TYPE.ID</code>), a secret
     key, and any capabilities included in the command you use to create the
     user.
    </p><p>
     A user's key enables the user to authenticate with the Ceph storage
     cluster. The user's capabilities authorize the user to read, write, or
     execute on Ceph monitors (mon), Ceph OSDs (osd), or Ceph metadata
     servers (mds).
    </p><p>
     There are a few commands available to add a user:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.8.4.6.7.6.5.1"><span class="term"><code class="command">ceph auth add</code></span></dt><dd><p>
        This command is the canonical way to add a user. It will create the
        user, generate a key, and add any specified capabilities.
       </p></dd><dt id="id-1.4.8.4.6.7.6.5.2"><span class="term"><code class="command">ceph auth get-or-create</code></span></dt><dd><p>
        This command is often the most convenient way to create a user, because
        it returns a keyfile format with the user name (in brackets) and the
        key. If the user already exists, this command simply returns the user
        name and key in the keyfile format. You may use the <code class="option">-o
        <em class="replaceable">filename</em></code> option to save the output
        to a file.
       </p></dd><dt id="id-1.4.8.4.6.7.6.5.3"><span class="term"><code class="command">ceph auth get-or-create-key</code></span></dt><dd><p>
        This command is a convenient way to create a user and return the user's
        key (only). This is useful for clients that need the key only (for
        example <code class="systemitem">libvirt</code>). If the user already exists, this command simply
        returns the key. You may use the <code class="option">-o
        <em class="replaceable">filename</em></code> option to save the output
        to a file.
       </p></dd></dl></div><p>
     When creating client users, you may create a user with no capabilities. A
     user with no capabilities can authenticate but nothing more. Such client
     cannot retrieve the cluster map from the monitor. However, you can create
     a user with no capabilities if you want to defer adding capabilities later
     using the <code class="command">ceph auth caps</code> command.
    </p><p>
     A typical user has at least read capabilities on the Ceph monitor and
     read and write capabilities on Ceph OSDs. Additionally, a user's OSD
     permissions are often restricted to accessing a particular pool.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth add client.john mon 'allow r' osd \
 'allow rw pool=liverpool'
<code class="prompt user">cephuser@adm &gt; </code>ceph auth get-or-create client.paul mon 'allow r' osd \
 'allow rw pool=liverpool'
<code class="prompt user">cephuser@adm &gt; </code>ceph auth get-or-create client.george mon 'allow r' osd \
 'allow rw pool=liverpool' -o george.keyring
<code class="prompt user">cephuser@adm &gt; </code>ceph auth get-or-create-key client.ringo mon 'allow r' osd \
 'allow rw pool=liverpool' -o ringo.key</pre></div><div id="id-1.4.8.4.6.7.6.9" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      If you provide a user with capabilities to OSDs, but you <span class="emphasis"><em>do
      not</em></span> restrict access to particular pools, the user will have
      access to <span class="emphasis"><em>all</em></span> pools in the cluster.
     </p></div></section><section class="sect3" id="cephx-modifying-user-capabilities" data-id-title="Modifying user capabilities"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.4 </span><span class="title-name">Modifying user capabilities</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-modifying-user-capabilities">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">ceph auth caps</code> command allows you to specify a user
     and change the user's capabilities. Setting new capabilities will
     overwrite current ones. To view current capabilities run <code class="command">ceph
     auth get
     <em class="replaceable">USERTYPE</em>.<em class="replaceable">USERID</em></code>.
     To add capabilities, you also need to specify the existing capabilities
     when using the following form:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth caps <em class="replaceable">USERTYPE</em>.<em class="replaceable">USERID</em> <em class="replaceable">daemon</em> 'allow [r|w|x|*|...] \
     [pool=<em class="replaceable">pool-name</em>] [namespace=<em class="replaceable">namespace-name</em>]' [<em class="replaceable">daemon</em> 'allow [r|w|x|*|...] \
     [pool=<em class="replaceable">pool-name</em>] [namespace=<em class="replaceable">namespace-name</em>]']</pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get client.john
<code class="prompt user">cephuser@adm &gt; </code>ceph auth caps client.john mon 'allow r' osd 'allow rw pool=prague'
<code class="prompt user">cephuser@adm &gt; </code>ceph auth caps client.paul mon 'allow rw' osd 'allow r pool=prague'
<code class="prompt user">cephuser@adm &gt; </code>ceph auth caps client.brian-manager mon 'allow *' osd 'allow *'</pre></div><p>
     To remove a capability, you may reset the capability. If you want the user
     to have no access to a particular daemon that was previously set, specify
     an empty string:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth caps client.ringo mon ' ' osd ' '</pre></div></section><section class="sect3" id="cephx-deleting-users" data-id-title="Deleting users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.5 </span><span class="title-name">Deleting users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-deleting-users">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To delete a user, use <code class="command">ceph auth del</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth del <em class="replaceable">TYPE</em>.<em class="replaceable">ID</em></pre></div><p>
     where <em class="replaceable">TYPE</em> is one of <code class="literal">client</code>,
     <code class="literal">osd</code>, <code class="literal">mon</code>, or <code class="literal">mds</code>,
     and <em class="replaceable">ID</em> is the user name or ID of the daemon.
    </p><p>
     If you created users with permissions strictly for a pool that no longer
     exists, you should consider deleting those users too.
    </p></section><section class="sect3" id="cephx-printing-users-key" data-id-title="Printing a users key"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.6 </span><span class="title-name">Printing a user's key</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-printing-users-key">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To print a user’s authentication key to standard output, execute the
     following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth print-key <em class="replaceable">TYPE</em>.<em class="replaceable">ID</em></pre></div><p>
     where <em class="replaceable">TYPE</em> is one of <code class="literal">client</code>,
     <code class="literal">osd</code>, <code class="literal">mon</code>, or <code class="literal">mds</code>,
     and <em class="replaceable">ID</em> is the user name or ID of the daemon.
    </p><p>
     Printing a user's key is useful when you need to populate client software
     with a user's key (such as <code class="systemitem">libvirt</code>), as in the following example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mount -t ceph host:/ mount_point \
-o name=client.user,secret=`ceph auth print-key client.user`</pre></div></section><section class="sect3" id="storage-cephx-keymgmt-usermgmt-userimp" data-id-title="Importing users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.2.7 </span><span class="title-name">Importing users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-usermgmt-userimp">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To import one or more users, use <code class="command">ceph auth import</code> and
     specify a keyring:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth import -i /etc/ceph/ceph.keyring</pre></div><div id="id-1.4.8.4.6.7.10.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The Ceph storage cluster will add new users, their keys and their
      capabilities and will update existing users, their keys and their
      capabilities.
     </p></div></section></section><section class="sect2" id="storage-cephx-keymgmt-keyringmgmt" data-id-title="Managing keyrings"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">30.2.3 </span><span class="title-name">Managing keyrings</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-keyringmgmt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you access Ceph via a Ceph client, the client will look for a
    local keyring. Ceph presets the keyring setting with the following four
    keyring names by default so you do not need to set them in your Ceph
    configuration file unless you want to override the defaults:
   </p><div class="verbatim-wrap"><pre class="screen">/etc/ceph/<em class="replaceable">cluster</em>.<em class="replaceable">name</em>.keyring
/etc/ceph/<em class="replaceable">cluster</em>.keyring
/etc/ceph/keyring
/etc/ceph/keyring.bin</pre></div><p>
    The <em class="replaceable">cluster</em> metavariable is your Ceph cluster
    name as defined by the name of the Ceph configuration file.
    <code class="filename">ceph.conf</code> means that the cluster name is
    <code class="literal">ceph</code>, thus <code class="literal">ceph.keyring</code>. The
    <em class="replaceable">name</em> metavariable is the user type and user ID,
    for example <code class="literal">client.admin</code>, thus
    <code class="literal">ceph.client.admin.keyring</code>.
   </p><p>
    After you create a user (for example
    <code class="systemitem">client.ringo</code>), you must get the
    key and add it to a keyring on a Ceph client so that the user can access
    the Ceph storage cluster.
   </p><p>
    <a class="xref" href="cha-storage-cephx.html#storage-cephx-keymgmt" title="30.2. Key management">Section 30.2, “Key management”</a> details how to list, get, add,
    modify and delete users directly in the Ceph storage cluster. However,
    Ceph also provides the <code class="command">ceph-authtool</code> utility to allow
    you to manage keyrings from a Ceph client.
   </p><section class="sect3" id="creating-keyring" data-id-title="Creating a keyring"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.3.1 </span><span class="title-name">Creating a keyring</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#creating-keyring">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When you use the procedures in <a class="xref" href="cha-storage-cephx.html#storage-cephx-keymgmt" title="30.2. Key management">Section 30.2, “Key management”</a> to
     create users, you need to provide user keys to the Ceph client(s) so
     that the client can retrieve the key for the specified user and
     authenticate with the Ceph storage cluster. Ceph clients access
     keyrings to look up a user name and retrieve the user's key:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool --create-keyring /path/to/keyring</pre></div><p>
     When creating a keyring with multiple users, we recommend using the
     cluster name (for example <em class="replaceable">cluster</em>.keyring) for
     the keyring file name and saving it in the <code class="filename">/etc/ceph</code>
     directory so that the keyring configuration default setting will pick up
     the file name without requiring you to specify it in the local copy of
     your Ceph configuration file. For example, create
     <code class="filename">ceph.keyring</code> by executing the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool -C /etc/ceph/ceph.keyring</pre></div><p>
     When creating a keyring with a single user, we recommend using the cluster
     name, the user type and the user name and saving it in the
     <code class="filename">/etc/ceph</code> directory. For example,
     <code class="filename">ceph.client.admin.keyring</code> for the
     <code class="systemitem">client.admin</code> user.
    </p></section><section class="sect3" id="cephx-adding-user-keyring" data-id-title="Adding a user to a keyring"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.3.2 </span><span class="title-name">Adding a user to a keyring</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-adding-user-keyring">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When you add a user to the Ceph storage cluster (see
     <a class="xref" href="cha-storage-cephx.html#storage-cephx-keymgmt-usermgmt-useradd" title="30.2.2.3. Adding users">Section 30.2.2.3, “Adding users”</a>), you can
     retrieve the user, key and capabilities, and save the user to a keyring.
    </p><p>
     If you only want to use one user per keyring, the <code class="command">ceph auth
     get</code> command with the <code class="option">-o</code> option will save the
     output in the keyring file format. For example, to create a keyring for
     the <code class="systemitem">client.admin</code> user, execute
     the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get client.admin -o /etc/ceph/ceph.client.admin.keyring</pre></div><p>
     When you want to import users to a keyring, you can use
     <code class="command">ceph-authtool</code> to specify the destination keyring and
     the source keyring:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool /etc/ceph/ceph.keyring \
  --import-keyring /etc/ceph/ceph.client.admin.keyring</pre></div><div id="id-1.4.8.4.6.8.8.7" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      If your keyring is compromised, delete your key from the
      <code class="filename">/etc/ceph</code> directory and re-create a new key using
      the same instructions from <a class="xref" href="cha-storage-cephx.html#creating-keyring" title="30.2.3.1. Creating a keyring">Section 30.2.3.1, “Creating a keyring”</a>.
     </p></div></section><section class="sect3" id="cephx-creating-user" data-id-title="Creating a user"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.3.3 </span><span class="title-name">Creating a user</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-creating-user">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Ceph provides the <code class="command">ceph auth add</code> command to create a
     user directly in the Ceph storage cluster. However, you can also create
     a user, keys and capabilities directly on a Ceph client keyring. Then,
     you can import the user to the Ceph storage cluster:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool -n client.ringo --cap osd 'allow rwx' \
  --cap mon 'allow rwx' /etc/ceph/ceph.keyring</pre></div><p>
     You can also create a keyring and add a new user to the keyring
     simultaneously:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool -C /etc/ceph/ceph.keyring -n client.ringo \
  --cap osd 'allow rwx' --cap mon 'allow rwx' --gen-key</pre></div><p>
     In the previous scenarios, the new user
     <code class="systemitem">client.ringo</code> is only in the
     keyring. To add the new user to the Ceph storage cluster, you must still
     add the new user to the cluster:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth add client.ringo -i /etc/ceph/ceph.keyring</pre></div></section><section class="sect3" id="cephx-modifying-users" data-id-title="Modifying users"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">30.2.3.4 </span><span class="title-name">Modifying users</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#cephx-modifying-users">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To modify the capabilities of a user record in a keyring, specify the
     keyring and the user followed by the capabilities:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-authtool /etc/ceph/ceph.keyring -n client.ringo \
  --cap osd 'allow rwx' --cap mon 'allow rwx'</pre></div><p>
     To update the modified user within the Ceph cluster environment, you
     must import the changes from the keyring to the user entry in the Ceph
     cluster:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth import -i /etc/ceph/ceph.keyring</pre></div><p>
     See <a class="xref" href="cha-storage-cephx.html#storage-cephx-keymgmt-usermgmt-userimp" title="30.2.2.7. Importing users">Section 30.2.2.7, “Importing users”</a> for details
     on updating a Ceph storage cluster user from a keyring.
    </p></section></section><section class="sect2" id="storage-cephx-keymgmt-cmdline" data-id-title="Commandline usage"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">30.2.4 </span><span class="title-name">Commandline usage</span></span> <a title="Permalink" class="permalink" href="cha-storage-cephx.html#storage-cephx-keymgmt-cmdline">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_cephx.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">ceph</code> command supports the following options related
    to the user name and secret manipulation:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.8.4.6.9.3.1"><span class="term"><code class="option">--id</code> or <code class="option">--user</code></span></dt><dd><p>
       Ceph identifies users with a type and an ID
       (<em class="replaceable">TYPE</em>.<em class="replaceable">ID</em>, such as
       <code class="systemitem">client.admin</code> or
       <code class="systemitem">client.user1</code>). The
       <code class="option">id</code>, <code class="option">name</code> and <code class="option">-n</code>
       options enable you to specify the ID portion of the user name (for
       example <code class="systemitem">admin</code> or
       <code class="systemitem">user1</code>). You can specify the
       user with the --id and omit the type. For example, to specify user
       client.foo enter the following:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph --id foo --keyring /path/to/keyring health
<code class="prompt user">cephuser@adm &gt; </code>ceph --user foo --keyring /path/to/keyring health</pre></div></dd><dt id="id-1.4.8.4.6.9.3.2"><span class="term"><code class="option">--name</code> or <code class="option">-n</code></span></dt><dd><p>
       Ceph identifies users with a type and an ID
       (<em class="replaceable">TYPE</em>.<em class="replaceable">ID</em>, such as
       <code class="systemitem">client.admin</code> or
       <code class="systemitem">client.user1</code>). The
       <code class="option">--name</code> and <code class="option">-n</code> options enable you to
       specify the fully qualified user name. You must specify the user type
       (typically <code class="literal">client</code>) with the user ID:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph --name client.foo --keyring /path/to/keyring health
<code class="prompt user">cephuser@adm &gt; </code>ceph -n client.foo --keyring /path/to/keyring health</pre></div></dd><dt id="id-1.4.8.4.6.9.3.3"><span class="term"><code class="option">--keyring</code></span></dt><dd><p>
       The path to the keyring containing one or more user name and secret. The
       <code class="option">--secret</code> option provides the same functionality, but it
       does not work with Object Gateway, which uses <code class="option">--secret</code> for
       another purpose. You may retrieve a keyring with <code class="command">ceph auth
       get-or-create</code> and store it locally. This is a preferred
       approach, because you can switch user names without switching the
       keyring path:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd map --id foo --keyring /path/to/keyring mypool/myimage</pre></div></dd></dl></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-mgr-modules.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 29 </span>Ceph Manager modules</span></a> </div><div><a class="pagination-link next" href="bk02apa.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Appendix A </span>Ceph maintenance updates based on upstream 'Octopus' point releases</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-storage-cephx.html#storage-cephx-arch"><span class="title-number">30.1 </span><span class="title-name">Authentication architecture</span></a></span></li><li><span class="sect1"><a href="cha-storage-cephx.html#storage-cephx-keymgmt"><span class="title-number">30.2 </span><span class="title-name">Key management</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>