<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SES 7 | Administration and Operations Guide | Backup and restore</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Backup and restore | SES 7"/>
<meta name="description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7"/>
<meta name="book-title" content="Administration and Operations Guide"/>
<meta name="chapter-title" content="Chapter 15. Backup and restore"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Backup and restore | SES 7"/>
<meta property="og:description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Backup and restore | SES 7"/>
<meta name="twitter:description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<link rel="prev" href="cha-ceph-operating.html" title="Chapter 14. Operation of Ceph services"/><link rel="next" href="monitoring-alerting.html" title="Chapter 16. Monitoring and alerting"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration and Operations Guide</a><span> / </span><a class="crumb" href="part-cluster-operation.html">Cluster Operation</a><span> / </span><a class="crumb" href="cha-deployment-backup.html">Backup and restore</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration and Operations Guide</div><ol><li><a href="preface-admin.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="part-dashboard.html" class="has-children "><span class="title-number">I </span><span class="title-name">Ceph Dashboard</span></a><ol><li><a href="dashboard-about.html" class=" "><span class="title-number">1 </span><span class="title-name">About the Ceph Dashboard</span></a></li><li><a href="dashboard-webui-general.html" class=" "><span class="title-number">2 </span><span class="title-name">Dashboard's Web user interface</span></a></li><li><a href="dashboard-user-mgmt.html" class=" "><span class="title-number">3 </span><span class="title-name">Manage Ceph Dashboard users and roles</span></a></li><li><a href="dashboard-cluster.html" class=" "><span class="title-number">4 </span><span class="title-name">View cluster internals</span></a></li><li><a href="dashboard-pools.html" class=" "><span class="title-number">5 </span><span class="title-name">Manage pools</span></a></li><li><a href="dashboard-rbds.html" class=" "><span class="title-number">6 </span><span class="title-name">Manage RADOS Block Device</span></a></li><li><a href="dash-webui-nfs.html" class=" "><span class="title-number">7 </span><span class="title-name">Manage NFS Ganesha</span></a></li><li><a href="dashboard-mds.html" class=" "><span class="title-number">8 </span><span class="title-name">Manage CephFS</span></a></li><li><a href="dashboard-ogw.html" class=" "><span class="title-number">9 </span><span class="title-name">Manage the Object Gateway</span></a></li><li><a href="dashboard-initial-configuration.html" class=" "><span class="title-number">10 </span><span class="title-name">Manual configuration</span></a></li><li><a href="dashboard-user-roles.html" class=" "><span class="title-number">11 </span><span class="title-name">Manage users and roles on the command line</span></a></li></ol></li><li class="active"><a href="part-cluster-operation.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Cluster Operation</span></a><ol><li><a href="ceph-monitor.html" class=" "><span class="title-number">12 </span><span class="title-name">Determine the cluster state</span></a></li><li><a href="storage-salt-cluster.html" class=" "><span class="title-number">13 </span><span class="title-name">Operational tasks</span></a></li><li><a href="cha-ceph-operating.html" class=" "><span class="title-number">14 </span><span class="title-name">Operation of Ceph services</span></a></li><li><a href="cha-deployment-backup.html" class=" you-are-here"><span class="title-number">15 </span><span class="title-name">Backup and restore</span></a></li><li><a href="monitoring-alerting.html" class=" "><span class="title-number">16 </span><span class="title-name">Monitoring and alerting</span></a></li></ol></li><li><a href="part-storing-data.html" class="has-children "><span class="title-number">III </span><span class="title-name">Storing Data in a Cluster</span></a><ol><li><a href="cha-storage-datamgm.html" class=" "><span class="title-number">17 </span><span class="title-name">Stored data management</span></a></li><li><a href="ceph-pools.html" class=" "><span class="title-number">18 </span><span class="title-name">Manage storage pools</span></a></li><li><a href="cha-ceph-erasure.html" class=" "><span class="title-number">19 </span><span class="title-name">Erasure coded pools</span></a></li><li><a href="ceph-rbd.html" class=" "><span class="title-number">20 </span><span class="title-name">RADOS Block Device</span></a></li></ol></li><li><a href="part-accessing-data.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Accessing Cluster Data</span></a><ol><li><a href="cha-ceph-gw.html" class=" "><span class="title-number">21 </span><span class="title-name">Ceph Object Gateway</span></a></li><li><a href="cha-ceph-iscsi.html" class=" "><span class="title-number">22 </span><span class="title-name">Ceph iSCSI gateway</span></a></li><li><a href="cha-ceph-cephfs.html" class=" "><span class="title-number">23 </span><span class="title-name">Clustered file system</span></a></li><li><a href="cha-ses-cifs.html" class=" "><span class="title-number">24 </span><span class="title-name">Export Ceph data via Samba</span></a></li><li><a href="cha-ceph-nfsganesha.html" class=" "><span class="title-number">25 </span><span class="title-name">NFS Ganesha</span></a></li></ol></li><li><a href="part-integration-virt.html" class="has-children "><span class="title-number">V </span><span class="title-name">Integration with Virtualization Tools</span></a><ol><li><a href="cha-ceph-libvirt.html" class=" "><span class="title-number">26 </span><span class="title-name"><code class="systemitem">libvirt</code> and Ceph</span></a></li><li><a href="cha-ceph-kvm.html" class=" "><span class="title-number">27 </span><span class="title-name">Ceph as a back-end for QEMU KVM instance</span></a></li></ol></li><li><a href="part-cluster-configuration.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Configuring a Cluster</span></a><ol><li><a href="cha-ceph-configuration.html" class=" "><span class="title-number">28 </span><span class="title-name">Ceph cluster configuration</span></a></li><li><a href="cha-mgr-modules.html" class=" "><span class="title-number">29 </span><span class="title-name">Ceph Manager modules</span></a></li><li><a href="cha-storage-cephx.html" class=" "><span class="title-number">30 </span><span class="title-name">Authentication with <code class="systemitem">cephx</code></span></a></li></ol></li><li><a href="bk02apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Octopus' point releases</span></a></li><li><a href="bk02go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-deployment-backup" data-id-title="Backup and restore"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">15 </span><span class="title-name">Backup and restore</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter explains which parts of the Ceph cluster you should back up in
  order to be able to restore its functionality.
 </p><section class="sect1" id="backrest-ceph" data-id-title="Back Up Cluster Configuration and Data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.1 </span><span class="title-name">Back Up Cluster Configuration and Data</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backrest-ceph">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="backrest-ceph-cephsalt" data-id-title="Back up ceph-salt configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.1 </span><span class="title-name">Back up <code class="systemitem">ceph-salt</code> configuration</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backrest-ceph-cephsalt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Export the cluster configuration. Find more information in
    <span class="intraxref">Book “Deployment Guide”, Chapter 7 “Deploying the bootstrap cluster using <code class="systemitem">ceph-salt</code>”, Section 7.2.14 “Exporting cluster configurations”</span>.
   </p></section><section class="sect2" id="backup-ceph" data-id-title="Back up Ceph configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.2 </span><span class="title-name">Back up Ceph configuration</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backup-ceph">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Back up the <code class="filename">/etc/ceph</code> directory. It contains crucial
    cluster configuration. For example, you will need a backup of
    <code class="filename">/etc/ceph</code> when you need to replace the Admin Node.
   </p></section><section class="sect2" id="sec-deployment-backup-salt" data-id-title="Back up Salt configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.3 </span><span class="title-name">Back up Salt configuration</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#sec-deployment-backup-salt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You need to back up the <code class="filename">/etc/salt/</code> directory. It
    contains the Salt configuration files, for example the Salt Master key and
    accepted client keys.
   </p><p>
    The Salt files are not strictly required for backing up the Admin Node, but
    make redeploying the Salt cluster easier. If there is no backup of these
    files, the Salt minions need to be registered again at the new Admin Node.
   </p><div id="id-1.4.4.5.4.4.4" data-id-title="Security of the Salt Master Private Key" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Security of the Salt Master Private Key</div><p>
     Make sure that the backup of the Salt Master private key is stored in a safe
     location. The Salt Master key can be used to manipulate all cluster nodes.
    </p></div></section><section class="sect2" id="backup-config-files" data-id-title="Back up custom configurations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.4 </span><span class="title-name">Back up custom configurations</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backup-config-files">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Prometheus data and customization.
     </p></li><li class="listitem"><p>
      Grafana customization.
     </p></li><li class="listitem"><p>
      Manual changes to the iSCSI configuration.
     </p></li><li class="listitem"><p>
      Ceph keys.
     </p></li><li class="listitem"><p>
      CRUSH Map and CRUSH rules. Save the decompiled CRUSH Map including
      CRUSH rules into <code class="filename">crushmap-backup.txt</code> by running the
      following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd getcrushmap | crushtool -d - -o crushmap-backup.txt</pre></div></li><li class="listitem"><p>
      Samba Gateway configuration. If you are using a single gateway, backup
      <code class="filename">/etc/samba/smb.conf</code>. If you are using an HA setup,
      also back up the CTDB and Pacemaker configuration files. Refer to
      <a class="xref" href="cha-ses-cifs.html" title="Chapter 24. Export Ceph data via Samba">Chapter 24, <em>Export Ceph data via Samba</em></a> for details on what configuration is used
      by Samba Gateways.
     </p></li><li class="listitem"><p>
      NFS Ganesha configuration. Only needed when using an HA setup. Refer to
      <a class="xref" href="cha-ceph-nfsganesha.html" title="Chapter 25. NFS Ganesha">Chapter 25, <em>NFS Ganesha</em></a> for details on what configuration
      is used by NFS Ganesha.
     </p></li></ul></div></section></section><section class="sect1" id="restore-ceph" data-id-title="Restoring a Ceph node"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.2 </span><span class="title-name">Restoring a Ceph node</span></span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#restore-ceph">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_ds_backup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The procedure to recover a node from backup is to reinstall the node,
   replace its configuration files, and then re-orchestrate the cluster so that
   the replacement node is re-added.
  </p><p>
   If you need to redeploy the Admin Node, refer to
   <a class="xref" href="storage-salt-cluster.html#moving-saltmaster" title="13.5. Moving the Salt Master to a new node">Section 13.5, “Moving the Salt Master to a new node”</a>.
  </p><p>
   For minions, it is usually easier to simply rebuild and redeploy.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Re-install the node. Find more information in
     <span class="intraxref">Book “Deployment Guide”, Chapter 5 “Installing and configuring SUSE Linux Enterprise Server”</span>
    </p></li><li class="listitem"><p>
     Install Salt Find more information in <span class="intraxref">Book “Deployment Guide”, Chapter 6 “Deploying Salt”</span>
    </p></li><li class="listitem"><p>
     After restoring the <code class="filename">/etc/salt</code> directory from a
     backup, enable and restart applicable Salt services, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code><code class="command">systemctl</code> enable salt-master
<code class="prompt user">root@master # </code><code class="command">systemctl</code> start salt-master
<code class="prompt user">root@master # </code><code class="command">systemctl</code> enable salt-minion
<code class="prompt user">root@master # </code><code class="command">systemctl</code> start salt-minion</pre></div></li><li class="listitem"><p>
     Remove the public master key for the old Salt Master node from all the
     minions.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code><code class="command">rm</code> /etc/salt/pki/minion/minion_master.pub
<code class="prompt user">root@master # </code><code class="command">systemctl</code> restart salt-minion</pre></div></li><li class="listitem"><p>
     Restore anything that was local to the Admin Node.
    </p></li><li class="listitem"><p>
     Import the cluster configuration from the previously exported JSON file.
     Refer to <span class="intraxref">Book “Deployment Guide”, Chapter 7 “Deploying the bootstrap cluster using <code class="systemitem">ceph-salt</code>”, Section 7.2.14 “Exporting cluster configurations”</span> for more
     details.
    </p></li><li class="listitem"><p>
     Apply the imported cluster configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>ceph-salt apply</pre></div></li></ol></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-ceph-operating.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 14 </span>Operation of Ceph services</span></a> </div><div><a class="pagination-link next" href="monitoring-alerting.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 16 </span>Monitoring and alerting</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-deployment-backup.html#backrest-ceph"><span class="title-number">15.1 </span><span class="title-name">Back Up Cluster Configuration and Data</span></a></span></li><li><span class="sect1"><a href="cha-deployment-backup.html#restore-ceph"><span class="title-number">15.2 </span><span class="title-name">Restoring a Ceph node</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2023</span></div></div></footer></body></html>