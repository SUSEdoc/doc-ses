<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SES 7 | Troubleshooting Guide | Troubleshooting Object Gateway</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Troubleshooting Object Gateway | SES 7"/>
<meta name="description" content="The most basic health check to test a running Object Gateway process is to simply point your browser or client at the Object Gateway endpoint. This s…"/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7"/>
<meta name="book-title" content="Troubleshooting Guide"/>
<meta name="chapter-title" content="Chapter 11. Troubleshooting Object Gateway"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Troubleshooting Object Gateway | SES 7"/>
<meta property="og:description" content="The most basic health check to test a running Object Gateway process is to simply point your browser or client at the Object Gateway endpoint. This s…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Troubleshooting Object Gateway | SES 7"/>
<meta name="twitter:description" content="The most basic health check to test a running Object Gateway process is to simply point your browser or client at the Object Gateway endpoint. This s…"/>
<link rel="prev" href="bp-troubleshooting-dashboard.html" title="Chapter 10. Troubleshooting the Ceph Dashboard"/><link rel="next" href="bp-troubleshooting-cephfs.html" title="Chapter 12. Troubleshooting CephFS"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Troubleshooting Guide</a><span> / </span><a class="crumb" href="bp-troubleshooting-objectgateway.html">Troubleshooting Object Gateway</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Troubleshooting Guide</div><ol><li><a href="preface-troubleshooting.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="report-software.html" class=" "><span class="title-number">1 </span><span class="title-name">Reporting software problems</span></a></li><li><a href="bp-troubleshooting-logging.html" class=" "><span class="title-number">2 </span><span class="title-name">Troubleshooting logging and debugging</span></a></li><li><a href="bp-troubleshooting-cephadm.html" class=" "><span class="title-number">3 </span><span class="title-name">Troubleshooting cephadm</span></a></li><li><a href="bp-troubleshooting-osds.html" class=" "><span class="title-number">4 </span><span class="title-name">Troubleshooting OSDs</span></a></li><li><a href="bp-troubleshooting-pgs.html" class=" "><span class="title-number">5 </span><span class="title-name">Troubleshooting placement groups (PGs)</span></a></li><li><a href="bp-troubleshooting-monitors.html" class=" "><span class="title-number">6 </span><span class="title-name">Troubleshooting Ceph Monitors and Ceph Managers</span></a></li><li><a href="bp-troubleshooting-networking.html" class=" "><span class="title-number">7 </span><span class="title-name">Troubleshooting networking</span></a></li><li><a href="bp-troubleshooting-nfs.html" class=" "><span class="title-number">8 </span><span class="title-name">Troubleshooting NFS Ganesha</span></a></li><li><a href="bp-troubleshooting-status.html" class=" "><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span></a></li><li><a href="bp-troubleshooting-dashboard.html" class=" "><span class="title-number">10 </span><span class="title-name">Troubleshooting the Ceph Dashboard</span></a></li><li><a href="bp-troubleshooting-objectgateway.html" class=" you-are-here"><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></a></li><li><a href="bp-troubleshooting-cephfs.html" class=" "><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span></a></li><li><a href="storage-tips.html" class=" "><span class="title-number">13 </span><span class="title-name">Hints and tips</span></a></li><li><a href="storage-faqs.html" class=" "><span class="title-number">14 </span><span class="title-name">Frequently asked questions</span></a></li><li><a href="bk03apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Octopus' point releases</span></a></li><li><a href="bk03go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="bp-troubleshooting-objectgateway" data-id-title="Troubleshooting Object Gateway"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="troubleshooting-gateway-healthcheck" data-id-title="Running a basic health check"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.1 </span><span class="title-name">Running a basic health check</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-healthcheck">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most basic health check to test a running Object Gateway process is to simply
   point your browser or client at the Object Gateway endpoint. This should return an
   empty bucket results for the anonymous user:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>curl -I</pre></div><p>
   If the result returns a 405 status, this indicates
   <code class="literal">MethodNotAllowed</code>. The output will result in a
   <code class="literal">NoSuchBucket</code> XML file. If the result returns a 404
   status, this means the Object Gateway DNS name is misconfigured or the requests were
   not made at an endpoint resolving to Object Gateway DNS name.
  </p></section><section class="sect1" id="troubleshooting-gateway-notrunning" data-id-title="Identifying gateway issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.2 </span><span class="title-name">Identifying gateway issues</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-notrunning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the gateway is not running, usually restartinng the gateway (automatic
   under <code class="systemitem">systemd</code>) should restore the service. This can be achieved via:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon restart <em class="replaceable">rgw-daemon-name</em></pre></div><p>
   For increasing the log level under the
   <code class="literal">client.<em class="replaceable">RGW_NAME</em></code> section, the
   Object Gateway configurable can be increased from 1 (default) up to 20 (very
   verbose). For the messages sent to the cluster itself the messenger debug
   levels can be raised (off by default). This is controlled via <code class="option">debug
   ms</code>. Usually a level of 1 is sufficient to gather enough
   information. For injecting arguments in a running process:
  </p><div id="id-1.5.13.4.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    This is a temporary change.
   </p></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-daemon <em class="replaceable">CLIENT_RGW_NAME</em> config set debug_rgw 20</pre></div><p>
   For persistent changes, or a non-running process, it is best to set these
   lines in the <code class="filename">ceph.conf</code> file under the
   <code class="literal">client.<em class="replaceable">rgw-name</em></code> section or,
   alternatively, using the Ceph CLI. In this case, the debug levels are
   extremely verbose, so it is best to do this only to capture error logs for a
   short time. To set the logs using the Ceph CLI, run:
  </p><div class="verbatim-wrap"><pre class="screen">   <code class="prompt user">cephuser@adm &gt; </code>ceph config set <em class="replaceable">CLIENT_RGW_NAME</em> debug_rgw 20</pre></div></section><section class="sect1" id="troubleshooting-gateway-crashed-rrgw" data-id-title="Diagnosing crashed Object Gateway process"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.3 </span><span class="title-name">Diagnosing crashed Object Gateway process</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-crashed-rrgw">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the Object Gateway process dies, you will normally see a connection refused at the
   client. In that situation, restarting Object Gateway will restore the service.
  </p><p>
   To diagnose the cause of the crash, check the log in
   <code class="filename">/var/log/ceph</code> or the core file (if one was generated).
  </p></section><section class="sect1" id="troubleshooting-gateway-blocked" data-id-title="Identifying blocked Object Gateway requests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.4 </span><span class="title-name">Identifying blocked Object Gateway requests</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-blocked">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If some (or all) Object Gateway requests appear to be blocked, you can get some
   insight into the internal state of the Object Gateway daemon via its admin socket. By
   default, there will be a socket configured to reside in
   <code class="filename">/var/run/ceph</code>, and the daemon can be queried with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon /var/run/ceph/client.<em class="replaceable">rgw-name</em> help
  help                list available commands
  objecter_requests   show in-progress osd requests
  perfcounters_dump   dump perfcounters value
  perfcounters_schema dump perfcounters schema
  version             get protocol version</pre></div><p>
   Of particular interest:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon /var/run/ceph/client.rgw objecter_requests
...</pre></div><p>
   This will dump information about current in-progress requests with the
   RADOS cluster. This allows you to identify if any requests are blocked by
   a non-responsive OSD. For example, one might see:
  </p><div class="verbatim-wrap"><pre class="screen">{ "ops": [
      { "tid": 1858,
        "pg": "2.d2041a48",
        "osd": 1,
        "last_sent": "2012-03-08 14:56:37.949872",
        "attempts": 1,
        "object_id": "fatty_25647_object1857",
        "object_locator": "@2",
        "snapid": "head",
        "snap_context": "0=[]",
        "mtime": "2012-03-08 14:56:37.949813",
        "osd_ops": [
              "write 0~4096"]},
      { "tid": 1873,
        "pg": "2.695e9f8e",
        "osd": 1,
        "last_sent": "2012-03-08 14:56:37.970615",
        "attempts": 1,
        "object_id": "fatty_25647_object1872",
        "object_locator": "@2",
        "snapid": "head",
        "snap_context": "0=[]",
        "mtime": "2012-03-08 14:56:37.970555",
        "osd_ops": [
              "write 0~4096"]}],
"linger_ops": [],
"pool_ops": [],
"pool_stat_ops": [],
"statfs_ops": []}</pre></div><p>
   In this dump, two requests are in progress. The <code class="literal">last_sent</code>
   field is the time the RADOS request was sent. If this is a while ago, it
   suggests that the OSD is not responding. For example, for request 1858, you
   could check the OSD status with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg map 2.d2041a48
osdmap e9 pg 2.d2041a48 (2.0) -&gt; up [1,0] acting [1,0]</pre></div><p>
   This tells you to look at <code class="literal">osd.1</code>, the primary copy for
   this PG:
  </p><div class="verbatim-wrap"><pre class="screen">  ceph daemon osd.1 ops
  { "num_ops": 651,
   "ops": [
         { "description": "osd_op(client.4124.0:1858 fatty_25647_object1857 [write 0~4096] 2.d2041a48)",
           "received_at": "1331247573.344650",
           "age": "25.606449",
           "flag_point": "waiting for sub ops",
           "client_info": { "client": "client.4124",
               "tid": 1858}},
  ...</pre></div><p>
   The <code class="literal">flag_point</code> field indicates that the OSD is currently
   waiting for replicas to respond, in this case <code class="literal">osd.0</code>.
  </p></section><section class="sect1" id="large-omap-issues" data-id-title="Large OMAP issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.5 </span><span class="title-name">Large OMAP issues</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#large-omap-issues">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you receive a cluster warning for a large OMAP issue, it means that an
   object has exceeded one of the OSD deep scrub large OMAP object thresholds,
   usually set to 200,000 keys and 1 GiB of storage. The relevant pool or PG
   involved can be found by grepping for <span class="emphasis"><em>large OMAP
   object</em></span>, as mentioned in the warning message. Depending on the
   pool and the object key involved it might indicate one of the following:
  </p><section class="sect2" id="resharding-issues" data-id-title="Resharding issues"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.1 </span><span class="title-name">Resharding issues</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#resharding-issues">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the large OMAP object name happens to be in the
    <code class="literal"><em class="replaceable">zone</em>.rgw.buckets.index</code> pool,
    this means that a bucket has more than 200,000 keys. Dynamic resharding is
    set on by default in single site clusters which would automatically have
    resharded the bucket. For multi-site clusters, however, this is not
    supported and would have to be manually done
    <span class="intraxref">Book “Administration and Operations Guide”, Chapter 21 “Ceph Object Gateway”, Section 21.10.1 “Bucket index resharding”</span>. Looking at the bucket statistics
    reveals the total object count and the number of shards. This is helpful to
    understand if the bucket has already been resharded, in which case the
    warning is just because the deep scrub happened to run before the reshard
    process and would be cleared in the next deep scrub.
   </p></section><section class="sect2" id="usage-statistics" data-id-title="Reading usage statistics"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.2 </span><span class="title-name">Reading usage statistics</span></span> <a title="Permalink" class="permalink" href="bp-troubleshooting-objectgateway.html#usage-statistics">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Usage statistics are also stored as OMAP keys in the
    <code class="literal"><em class="replaceable">zone</em>.rgw.log</code> pool. However,
    these are not automatically trimmed, therefore a manual trimming of usage
    statistics would have to be done. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>radosgw-admin usage trim [--uid=<em class="replaceable">user-id</em>] --start-date=2019-01-01 --end-date=2019-03-03</pre></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="bp-troubleshooting-dashboard.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 10 </span>Troubleshooting the Ceph Dashboard</span></a> </div><div><a class="pagination-link next" href="bp-troubleshooting-cephfs.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 12 </span>Troubleshooting CephFS</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-healthcheck"><span class="title-number">11.1 </span><span class="title-name">Running a basic health check</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-notrunning"><span class="title-number">11.2 </span><span class="title-name">Identifying gateway issues</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-crashed-rrgw"><span class="title-number">11.3 </span><span class="title-name">Diagnosing crashed Object Gateway process</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-objectgateway.html#troubleshooting-gateway-blocked"><span class="title-number">11.4 </span><span class="title-name">Identifying blocked Object Gateway requests</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-objectgateway.html#large-omap-issues"><span class="title-number">11.5 </span><span class="title-name">Large OMAP issues</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2023</span></div></div></footer></body></html>