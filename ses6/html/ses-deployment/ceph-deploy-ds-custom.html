<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>Customizing the Default Configuration | Deployment Guide | SUSE Enterprise Storage 6</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Customizing the Default Configuration | SES 6"/>
<meta name="description" content="You can change the default cluster configuration generated in Stage 2 (refer to DeepSea Stages Description). For example, you may need to change network settin…"/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="6"/>
<meta name="book-title" content="Deployment Guide"/>
<meta name="chapter-title" content="Chapter 7. Customizing the Default Configuration"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new/choose"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="asettle"/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Customizing the Default Configuration | SES 6"/>
<meta property="og:description" content="You can change the default cluster configuration generated in Stage 2 (refer to DeepSea Stages Description). For example, you may need to change network settin…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Customizing the Default Configuration | SES 6"/>
<meta name="twitter:description" content="You can change the default cluster configuration generated in Stage 2 (refer to DeepSea Stages Description). For example, you may need to change network settin…"/>
<link rel="prev" href="cha-ceph-upgrade.html" title="Chapter 6. Upgrading from Previous Releases"/><link rel="next" href="additional-software.html" title="Part III. Installation of Additional Services"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Deployment Guide</a><span> / </span><a class="crumb" href="ses-deployment.html">Cluster Deployment and Upgrade</a><span> / </span><a class="crumb" href="ceph-deploy-ds-custom.html">Customizing the Default Configuration</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Deployment Guide</div><ol><li><a href="bk02pr01.html" class=" "><span class="title-number"> </span><span class="title-name">About This Guide</span></a></li><li><a href="part-ses.html" class="has-children "><span class="title-number">I </span><span class="title-name">SUSE Enterprise Storage</span></a><ol><li><a href="cha-storage-about.html" class=" "><span class="title-number">1 </span><span class="title-name">SUSE Enterprise Storage 6 and Ceph</span></a></li><li><a href="storage-bp-hwreq.html" class=" "><span class="title-number">2 </span><span class="title-name">Hardware Requirements and Recommendations</span></a></li><li><a href="cha-admin-ha.html" class=" "><span class="title-number">3 </span><span class="title-name">Admin Node HA Setup</span></a></li><li><a href="bk02pt01ch04.html" class=" "><span class="title-number">4 </span><span class="title-name">User Privileges and Command Prompts</span></a></li></ol></li><li class="active"><a href="ses-deployment.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Cluster Deployment and Upgrade</span></a><ol><li><a href="ceph-install-saltstack.html" class=" "><span class="title-number">5 </span><span class="title-name">Deploying with DeepSea/Salt</span></a></li><li><a href="cha-ceph-upgrade.html" class=" "><span class="title-number">6 </span><span class="title-name">Upgrading from Previous Releases</span></a></li><li><a href="ceph-deploy-ds-custom.html" class=" you-are-here"><span class="title-number">7 </span><span class="title-name">Customizing the Default Configuration</span></a></li></ol></li><li><a href="additional-software.html" class="has-children "><span class="title-number">III </span><span class="title-name">Installation of Additional Services</span></a><ol><li><a href="cha-ceph-as-intro.html" class=" "><span class="title-number">8 </span><span class="title-name">Installation of Services to Access your Data</span></a></li><li><a href="cha-ceph-additional-software-installation.html" class=" "><span class="title-number">9 </span><span class="title-name">Ceph Object Gateway</span></a></li><li><a href="cha-ceph-as-iscsi.html" class=" "><span class="title-number">10 </span><span class="title-name">Installation of iSCSI Gateway</span></a></li><li><a href="cha-ceph-as-cephfs.html" class=" "><span class="title-number">11 </span><span class="title-name">Installation of CephFS</span></a></li><li><a href="cha-as-ganesha.html" class=" "><span class="title-number">12 </span><span class="title-name">Installation of NFS Ganesha</span></a></li></ol></li><li><a href="containerized-ses-on-caasp.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Cluster Deployment on Top of SUSE CaaS Platform 4 (Technology Preview)</span></a><ol><li><a href="cha-container-kubernetes.html" class=" "><span class="title-number">13 </span><span class="title-name">SUSE Enterprise Storage 6 on Top of SUSE CaaS Platform 4 Kubernetes Cluster</span></a></li></ol></li><li><a href="bk02apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph Maintenance Updates Based on Upstream 'Nautilus' Point Releases</span></a></li><li><a href="bk02go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="ap-deploy-docupdate.html" class=" "><span class="title-number">B </span><span class="title-name">Documentation Updates</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="ceph-deploy-ds-custom" data-id-title="Customizing the Default Configuration"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">6</span></div><div><h2 class="title"><span class="title-number">7 </span><span class="title-name">Customizing the Default Configuration</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#">#</a></h2></div></div></div><p>
  You can change the default cluster configuration generated in Stage 2 (refer
  to <a class="xref" href="ceph-install-saltstack.html#deepsea-stage-description" title="DeepSea Stages Description">DeepSea Stages Description</a>). For example, you may need to
  change network settings, or software that is installed on the Admin Node by
  default. You can perform the former by modifying the pillar updated after
  Stage 2, while the latter is usually done by creating a custom
  <code class="literal">sls</code> file and adding it to the pillar. Details are
  described in following sections.
 </p><section class="sect1" id="using-customized-files" data-id-title="Using Customized Configuration Files"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">7.1 </span><span class="title-name">Using Customized Configuration Files</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#using-customized-files">#</a></h2></div></div></div><p>
   This section lists several tasks that require adding/changing your own
   <code class="literal">sls</code> files. Such a procedure is typically used when you
   need to change the default deployment process.
  </p><div id="id-1.4.4.4.4.3" data-id-title="Prefix Custom .sls Files" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><h6>Tip: Prefix Custom .sls Files</h6><p>
    Your custom .sls files belong to the same subdirectory as DeepSea's .sls
    files. To prevent overwriting your .sls files with the possibly newly added
    ones from the DeepSea package, prefix their name with the
    <code class="filename">custom-</code> string.
   </p></div><section class="sect2" id="id-1.4.4.4.4.4" data-id-title="Disabling a Deployment Step"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.1.1 </span><span class="title-name">Disabling a Deployment Step</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.4">#</a></h3></div></div></div><p>
    If you address a specific task outside of the DeepSea deployment process
    and therefore need to skip it, create a 'no-operation' file following this
    example:
   </p><div class="procedure" id="disable-time-sync" data-id-title="Disabling Time Synchronization"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="title-number">Procedure 7.1: </span><span class="title-name">Disabling Time Synchronization </span><a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#disable-time-sync">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/time/disabled.sls</code> with the
      following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">disable time setting:
test.nop</pre></div></li><li class="step"><p>
      Edit <code class="filename">/srv/pillar/ceph/stack/global.yml</code>, add the
      following line, and save it:
     </p><div class="verbatim-wrap"><pre class="screen">time_init: disabled</pre></div></li><li class="step"><p>
      Verify by refreshing the pillar and running the step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> saltutil.pillar_refresh
<code class="prompt user">root@master # </code>salt 'admin.ceph' state.apply ceph.time
admin.ceph:
  Name: disable time setting - Function: test.nop - Result: Clean

Summary for admin.ceph
------------
Succeeded: 1
Failed:    0
------------
Total states run:     1</pre></div><div id="id-1.4.4.4.4.4.3.4.3" data-id-title="Unique ID" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note: Unique ID</h6><p>
       The task ID 'disable time setting' may be any message unique within an
       <code class="literal">sls</code> file. Prevent ID collisions by specifying unique
       descriptions.
      </p></div></li></ol></div></div></section><section class="sect2" id="deepsea-replacing-step" data-id-title="Replacing a Deployment Step"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.1.2 </span><span class="title-name">Replacing a Deployment Step</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#deepsea-replacing-step">#</a></h3></div></div></div><p>
    If you need to replace the default behavior of a specific step with a
    custom one, create a custom <code class="literal">sls</code> file with replacement
    content.
   </p><p>
    By default <code class="filename">/srv/salt/ceph/pool/default.sls</code> creates an
    rbd image called 'demo'. In our example, we do not want this image to be
    created, but we need two images: 'archive1' and 'archive2'.
   </p><div class="procedure" id="id-1.4.4.4.4.5.4" data-id-title="Replacing the demo rbd Image with Two Custom rbd Images"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="title-number">Procedure 7.2: </span><span class="title-name">Replacing the <span class="emphasis"><em>demo</em></span> rbd Image with Two Custom rbd Images </span><a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.5.4">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/pool/custom.sls</code> with the
      following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">wait:
  module.run:
    - name: wait.out
    - kwargs:
        'status': "HEALTH_ERR"<span class="callout" id="co-deepsea-replace-wait">1</span>
    - fire_event: True

archive1:
  cmd.run:
    - name: "rbd -p rbd create archive1 --size=1024"<span class="callout" id="co-deepsea-replace-rbd">2</span>
    - unless: "rbd -p rbd ls | grep -q archive1$"
    - fire_event: True

archive2:
  cmd.run:
    - name: "rbd -p rbd create archive2 --size=768"
    - unless: "rbd -p rbd ls | grep -q archive2$"
    - fire_event: True</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-deepsea-replace-wait"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The <span class="bold"><strong>wait</strong></span> module will pause until the
        Ceph cluster does not have a status of <code class="literal">HEALTH_ERR</code>.
        In fresh installations, a Ceph cluster may have this status until a
        sufficient number of OSDs become available and the creation of pools
        has completed.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-deepsea-replace-rbd"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The <code class="command">rbd</code> command is not idempotent. If the same
        creation command is re-run after the image exists, the Salt state
        will fail. The <span class="bold"><strong>unless</strong></span> statement
        prevents this.
       </p></td></tr></table></div></li><li class="step"><p>
      To call the newly created custom file instead of the default, you need to
      edit <code class="filename">/srv/pillar/ceph/stack/ceph/cluster.yml</code>, add
      the following line, and save it:
     </p><div class="verbatim-wrap"><pre class="screen">pool_init: custom</pre></div></li><li class="step"><p>
      Verify by refreshing the pillar and running the step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> saltutil.pillar_refresh
<code class="prompt user">root@master # </code>salt 'admin.ceph' state.apply ceph.pool</pre></div></li></ol></div></div><div id="id-1.4.4.4.4.5.5" data-id-title="Authorization" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note: Authorization</h6><p>
     The creation of pools or images requires sufficient authorization. The
     <code class="literal">admin.ceph</code> minion has an admin keyring.
    </p></div><div id="id-1.4.4.4.4.5.6" data-id-title="Alternative Way" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><h6>Tip: Alternative Way</h6><p>
     Another option is to change the variable in
     <code class="filename">/srv/pillar/ceph/stack/ceph/roles/master.yml</code> instead.
     Using this file will reduce the clutter of pillar data for other minions.
    </p></div></section><section class="sect2" id="id-1.4.4.4.4.6" data-id-title="Modifying a Deployment Step"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.1.3 </span><span class="title-name">Modifying a Deployment Step</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.6">#</a></h3></div></div></div><p>
    Sometimes you may need a specific step to do some additional tasks. We do
    not recommend modifying the related state file as it may complicate a
    future upgrade. Instead, create a separate file to carry out the additional
    tasks identical to what was described in
    <a class="xref" href="ceph-deploy-ds-custom.html#deepsea-replacing-step" title="7.1.2. Replacing a Deployment Step">Section 7.1.2, “Replacing a Deployment Step”</a>.
   </p><p>
    Name the new <code class="literal">sls</code> file descriptively. For example, if you
    need to create two rbd images in addition to the demo image, name the file
    <code class="filename">archive.sls</code>.
   </p><div class="procedure" id="id-1.4.4.4.4.6.4" data-id-title="Creating Two Additional rbd Images"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="title-number">Procedure 7.3: </span><span class="title-name">Creating Two Additional rbd Images </span><a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.6.4">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/pool/custom.sls</code> with the
      following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">include:
 - .archive
 - .default</pre></div><div id="id-1.4.4.4.4.6.4.2.3" data-id-title="Include Precedence" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><h6>Tip: Include Precedence</h6><p>
       In this example, Salt will create the <span class="emphasis"><em>archive</em></span>
       images and then create the <span class="emphasis"><em>demo</em></span> image. The order
       does not matter in this example. To change the order, reverse the lines
       after the <code class="literal">include:</code> directive.
      </p><p>
       You can add the include line directly to
       <code class="filename">archive.sls</code> and all the images will get created as
       well. However, regardless of where the include line is placed, Salt
       processes the steps in the included file first. Although this behavior
       can be overridden with <span class="emphasis"><em>requires</em></span> and
       <span class="emphasis"><em>order</em></span> statements, a separate file that includes the
       others guarantees the order and reduces the chances of confusion.
      </p></div></li><li class="step"><p>
      Edit <code class="filename">/srv/pillar/ceph/stack/ceph/cluster.yml</code>, add
      the following line, and save it:
     </p><div class="verbatim-wrap"><pre class="screen">pool_init: custom</pre></div></li><li class="step"><p>
      Verify by refreshing the pillar and running the step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> saltutil.pillar_refresh
<code class="prompt user">root@master # </code>salt 'admin.ceph' state.apply ceph.pool</pre></div></li></ol></div></div></section><section class="sect2" id="id-1.4.4.4.4.7" data-id-title="Modifying a Deployment Stage"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.1.4 </span><span class="title-name">Modifying a Deployment Stage</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.7">#</a></h3></div></div></div><p>
    If you need to add a completely separate deployment step, create three new
    files—an <code class="literal">sls</code> file that performs the command, an
    orchestration file, and a custom file which aligns the new step with the
    original deployment steps.
   </p><p>
    For example, if you need to run <code class="command">logrotate</code> on all minions
    as part of the preparation stage:
   </p><p>
    First create an <code class="literal">sls</code> file and include the
    <code class="command">logrotate</code> command.
   </p><div class="procedure" id="id-1.4.4.4.4.7.5" data-id-title="Running logrotate on all Salt minions"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="title-number">Procedure 7.4: </span><span class="title-name">Running <code class="command">logrotate</code> on all Salt minions </span><a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#id-1.4.4.4.4.7.5">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create a directory such as <code class="filename">/srv/salt/ceph/logrotate</code>.
     </p></li><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/logrotate/init.sls</code> with the
      following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">rotate logs:
  cmd.run:
    - name: "/usr/sbin/logrotate /etc/logrotate.conf"</pre></div></li><li class="step"><p>
      Verify that the command works on a minion:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt 'admin.ceph' state.apply ceph.logrotate</pre></div></li></ol></div></div><p>
    Because the orchestration file needs to run before all other preparation
    steps, add it to the <span class="emphasis"><em>Prep</em></span> stage 0:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/stage/prep/logrotate.sls</code> with
      the following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">logrotate:
  salt.state:
    - tgt: '*'
    - sls: ceph.logrotate</pre></div></li><li class="step"><p>
      Verify that the orchestration file works:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run state.orch ceph.stage.prep.logrotate</pre></div></li></ol></div></div><p>
    The last file is the custom one which includes the additional step with the
    original steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create <code class="filename">/srv/salt/ceph/stage/prep/custom.sls</code> with the
      following content and save it:
     </p><div class="verbatim-wrap"><pre class="screen">include:
  - .logrotate
  - .master
  - .minion</pre></div></li><li class="step"><p>
      Override the default behavior. Edit
      <code class="filename">/srv/pillar/ceph/stack/global.yml</code>, add the following
      line, and save the file:
     </p><div class="verbatim-wrap"><pre class="screen">stage_prep: custom</pre></div></li><li class="step"><p>
      Verify that Stage 0 works:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run state.orch ceph.stage.0</pre></div></li></ol></div></div><div id="id-1.4.4.4.4.7.10" data-id-title="Why global.yml?" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note: Why <code class="filename">global.yml</code>?</h6><p>
     The <code class="filename">global.yml</code> file is chosen over the
     <code class="filename">cluster.yml</code> because during the
     <span class="emphasis"><em>prep</em></span> stage, no minion belongs to the Ceph cluster
     and has no access to any settings in <code class="filename">cluster.yml</code>.
    </p></div></section><section class="sect2" id="ds-disable-reboots" data-id-title="Updates and Reboots during Stage 0"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.1.5 </span><span class="title-name">Updates and Reboots during Stage 0</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#ds-disable-reboots">#</a></h3></div></div></div><p>
    During stage 0 (refer to <a class="xref" href="ceph-install-saltstack.html#deepsea-stage-description" title="DeepSea Stages Description">DeepSea Stages Description</a> for
    more information on DeepSea stages), the Salt master and Salt minions may
    optionally reboot because newly updated packages, for example
    <span class="package">kernel</span>, require rebooting the system.
   </p><p>
    The default behavior is to install available new updates and
    <span class="emphasis"><em>not</em></span> reboot the nodes even in case of kernel updates.
   </p><p>
    You can change the default update/reboot behavior of DeepSea stage 0 by
    adding/changing the <code class="option">stage_prep_master</code> and
    <code class="option">stage_prep_minion</code> options in the
    <code class="filename">/srv/pillar/ceph/stack/global.yml</code> file.
    <code class="option">stage_prep_master</code> sets the behavior of the Salt master, and
    <code class="option">stage_prep_minion</code> sets the behavior of all minions. All
    available parameters are:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.4.4.4.8.5.1"><span class="term">default</span></dt><dd><p>
       Install updates without rebooting.
      </p></dd><dt id="id-1.4.4.4.4.8.5.2"><span class="term">default-update-reboot</span></dt><dd><p>
       Install updates and reboot after updating.
      </p></dd><dt id="id-1.4.4.4.4.8.5.3"><span class="term">default-no-update-reboot</span></dt><dd><p>
       Reboot without installing updates.
      </p></dd><dt id="id-1.4.4.4.4.8.5.4"><span class="term">default-no-update-no-reboot</span></dt><dd><p>
       Do not install updates or reboot.
      </p></dd></dl></div><p>
    For example, to prevent the cluster nodes from installing updates and
    rebooting, edit <code class="filename">/srv/pillar/ceph/stack/global.yml</code> and
    add the following lines:
   </p><div class="verbatim-wrap"><pre class="screen">stage_prep_master: default-no-update-no-reboot
stage_prep_minion: default-no-update-no-reboot</pre></div><div id="id-1.4.4.4.4.8.8" data-id-title="Values and Corresponding Files" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><h6>Tip: Values and Corresponding Files</h6><p>
     The values of <code class="option">stage_prep_master</code> correspond to file names
     located in <code class="filename">/srv/salt/ceph/stage/0/master</code>, while
     values of <code class="option">stage_prep_minion</code> correspond to files in
     <code class="filename">/srv/salt/ceph/stage/0/minion</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>ls -l /srv/salt/ceph/stage/0/master
default-no-update-no-reboot.sls
default-no-update-reboot.sls
default-update-reboot.sls
[...]

<code class="prompt user">root@master # </code>ls -l /srv/salt/ceph/stage/0/minion
default-no-update-no-reboot.sls
default-no-update-reboot.sls
default-update-reboot.sls
[...]</pre></div></div></section></section><section class="sect1" id="discovered-configuration-modification" data-id-title="Modifying Discovered Configuration"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">7.2 </span><span class="title-name">Modifying Discovered Configuration</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#discovered-configuration-modification">#</a></h2></div></div></div><p>
   After you completed Stage 2, you may want to change the discovered
   configuration. To view the current settings, run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> pillar.items</pre></div><p>
   The output of the default configuration for a single minion is usually
   similar to the following:
  </p><div class="verbatim-wrap"><pre class="screen">----------
    available_roles:
        - admin
        - mon
        - storage
        - mds
        - igw
        - rgw
        - client-cephfs
        - client-radosgw
        - client-iscsi
        - mds-nfs
        - rgw-nfs
        - master
    cluster:
        ceph
    cluster_network:
        172.16.22.0/24
    fsid:
        e08ec63c-8268-3f04-bcdb-614921e94342
    master_minion:
        admin.ceph
    mon_host:
        - 172.16.21.13
        - 172.16.21.11
        - 172.16.21.12
    mon_initial_members:
        - mon3
        - mon1
        - mon2
    public_address:
        172.16.21.11
    public_network:
        172.16.21.0/24
    roles:
        - admin
        - mon
        - mds
    time_server:
        admin.ceph
    time_service:
        ntp</pre></div><p>
   The above mentioned settings are distributed across several configuration
   files. The directory structure with these files is defined in the
   <code class="filename">/srv/pillar/ceph/stack/stack.cfg</code> directory. The
   following files usually describe your cluster:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="filename">/srv/pillar/ceph/stack/global.yml</code> - the file affects
     all minions in the Salt cluster.
    </p></li><li class="listitem"><p>
     <code class="filename">/srv/pillar/ceph/stack/<em class="replaceable">ceph</em>/cluster.yml</code>
     - the file affects all minions in the Ceph cluster called
     <code class="literal">ceph</code>.
    </p></li><li class="listitem"><p>
     <code class="filename">/srv/pillar/ceph/stack/<em class="replaceable">ceph</em>/roles/<em class="replaceable">role</em>.yml</code>
     - affects all minions that are assigned the specific role in the
     <code class="literal">ceph</code> cluster.
    </p></li><li class="listitem"><p>
     <code class="filename">/srv/pillar/ceph/stack/<em class="replaceable">ceph</em>/minions/<em class="replaceable">MINION_ID</em>/yml</code>
     - affects the individual minion.
    </p></li></ul></div><div id="id-1.4.4.4.5.8" data-id-title="Overwriting Directories with Default Values" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note: Overwriting Directories with Default Values</h6><p>
    There is a parallel directory tree that stores the default configuration
    setup in <code class="filename">/srv/pillar/ceph/stack/default</code>. Do not change
    values here, as they are overwritten.
   </p></div><p>
   The typical procedure for changing the collected configuration is the
   following:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Find the location of the configuration item you need to change. For
     example, if you need to change cluster related setting such as cluster
     network, edit the file
     <code class="filename">/srv/pillar/ceph/stack/ceph/cluster.yml</code>.
    </p></li><li class="step"><p>
     Save the file.
    </p></li><li class="step"><p>
     Verify the changes by running:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> saltutil.pillar_refresh</pre></div><p>
     and then
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt <em class="replaceable">target</em> pillar.items</pre></div></li></ol></div></div><section class="sect2" id="ds-modify-ipv6" data-id-title="Enabling IPv6 for Ceph Cluster Deployment"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">7.2.1 </span><span class="title-name">Enabling IPv6 for Ceph Cluster Deployment</span> <a title="Permalink" class="permalink" href="ceph-deploy-ds-custom.html#ds-modify-ipv6">#</a></h3></div></div></div><p>
    Since IPv4 network addressing is prevalent, you need to enable IPv6 as a
    customization. DeepSea has no auto-discovery of IPv6 addressing.
   </p><p>
    To configure IPv6, set the <code class="option">public_network</code> and
    <code class="option">cluster_network</code> variables in the
    <code class="filename">/srv/pillar/ceph/stack/global.yml</code> file to valid IPv6
    subnets. For example:
   </p><div class="verbatim-wrap"><pre class="screen">public_network: fd00:10::/64
cluster_network: fd00:11::/64</pre></div><p>
    Then run DeepSea stage 2 and verify that the network information matches
    the setting. Stage 3 will generate the <code class="filename">ceph.conf</code> with
    the necessary flags.
   </p><div id="id-1.4.4.4.5.11.6" data-id-title="No Support for Dual Stack" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><h6>Important: No Support for Dual Stack</h6><p>
     Ceph does not support dual stack—running Ceph simultaneously on
     IPv4 and IPv6 is not possible. DeepSea validation will reject a mismatch
     between <code class="option">public_network</code> and
     <code class="option">cluster_network</code> or within either variable. The following
     example will fail the validation.
    </p><div class="verbatim-wrap"><pre class="screen">public_network: "192.168.10.0/24 fd00:10::/64"</pre></div></div><div id="id-1.4.4.4.5.11.7" data-id-title="Avoid Using fe80::/10 link-local Addresses" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><h6>Tip: Avoid Using <code class="literal">fe80::/10 link-local</code> Addresses</h6><p>
     Avoid using <code class="literal">fe80::/10 link-local</code> addresses. All network
     interfaces have an assigned <code class="literal">fe80</code> address and require an
     interface qualifier for proper routing. Either assign IPv6 addresses
     allocated to your site or consider using <code class="literal">fd00::/8</code>.
     These are part of ULA and not globally routable.
    </p></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-ceph-upgrade.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 6 </span>Upgrading from Previous Releases</span></a> </div><div><a class="pagination-link next" href="additional-software.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Part III </span>Installation of Additional Services</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="ceph-deploy-ds-custom.html#using-customized-files"><span class="title-number">7.1 </span><span class="title-name">Using Customized Configuration Files</span></a></span></li><li><span class="sect1"><a href="ceph-deploy-ds-custom.html#discovered-configuration-modification"><span class="title-number">7.2 </span><span class="title-name">Modifying Discovered Configuration</span></a></span></li></ul></div><div class="side-title">Give feedback</div><ul class="feedback" id="_give-feedback"><li><a id="_feedback-reportbug" href="#" rel="nofollow" target="_blank">Report an issue</a></li><li><a id="_feedback-editurl" href="https://github.com/SUSE/doc-ses/edit/maintenance/ses6/xml/deployment_ds_custom.xml" rel="nofollow" target="_blank">Edit source document</a></li></ul><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>