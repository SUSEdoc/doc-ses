<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>Backing Up Cluster Configuration and Data | Administration Guide | SUSE Enterprise Storage 6</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Backing Up Cluster Configuration and Data | SES 6"/>
<meta name="description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="6"/>
<meta name="book-title" content="Administration Guide"/>
<meta name="chapter-title" content="Chapter 3. Backing Up Cluster Configuration and Data"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new/choose"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="asettle"/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Backing Up Cluster Configuration and Data | SES 6"/>
<meta property="og:description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Backing Up Cluster Configuration and Data | SES 6"/>
<meta name="twitter:description" content="This chapter explains which parts of the Ceph cluster you should back up in order to be able to restore its functionality."/>
<link rel="prev" href="storage-salt-cluster.html" title="Chapter 2. Salt Cluster Administration"/><link rel="next" href="part-dashboard.html" title="Part II. Ceph Dashboard"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration Guide</a><span> / </span><a class="crumb" href="part-cluster-managment.html">Cluster Management</a><span> / </span><a class="crumb" href="cha-deployment-backup.html">Backing Up Cluster Configuration and Data</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration Guide</div><ol><li><a href="bk01pr01.html" class=" "><span class="title-number"> </span><span class="title-name">About This Guide</span></a></li><li class="active"><a href="part-cluster-managment.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">Cluster Management</span></a><ol><li><a href="bk01pt01ch01.html" class=" "><span class="title-number">1 </span><span class="title-name">User Privileges and Command Prompts</span></a></li><li><a href="storage-salt-cluster.html" class=" "><span class="title-number">2 </span><span class="title-name">Salt Cluster Administration</span></a></li><li><a href="cha-deployment-backup.html" class=" you-are-here"><span class="title-number">3 </span><span class="title-name">Backing Up Cluster Configuration and Data</span></a></li></ol></li><li><a href="part-dashboard.html" class="has-children "><span class="title-number">II </span><span class="title-name">Ceph Dashboard</span></a><ol><li><a href="dashboard-about.html" class=" "><span class="title-number">4 </span><span class="title-name">About Ceph Dashboard</span></a></li><li><a href="dashboard-webui-general.html" class=" "><span class="title-number">5 </span><span class="title-name">Dashboard's Web User Interface</span></a></li><li><a href="dashboard-user-mgmt.html" class=" "><span class="title-number">6 </span><span class="title-name">Managing Dashboard Users and Roles</span></a></li><li><a href="dashboard-cluster.html" class=" "><span class="title-number">7 </span><span class="title-name">Viewing Cluster Internals</span></a></li><li><a href="dashboard-pools.html" class=" "><span class="title-number">8 </span><span class="title-name">Managing Pools</span></a></li><li><a href="dashboard-rbds.html" class=" "><span class="title-number">9 </span><span class="title-name">Managing RADOS Block Devices</span></a></li><li><a href="dash-webui-nfs.html" class=" "><span class="title-number">10 </span><span class="title-name">Managing NFS Ganesha</span></a></li><li><a href="dashboard-mds.html" class=" "><span class="title-number">11 </span><span class="title-name">Managing Ceph File Systems</span></a></li><li><a href="dashboard-ogw.html" class=" "><span class="title-number">12 </span><span class="title-name">Managing Object Gateways</span></a></li><li><a href="dashboard-initial-configuration.html" class=" "><span class="title-number">13 </span><span class="title-name">Manual Configuration</span></a></li><li><a href="dashboard-user-roles.html" class=" "><span class="title-number">14 </span><span class="title-name">Managing Users and Roles on the Command Line</span></a></li></ol></li><li><a href="part-operate.html" class="has-children "><span class="title-number">III </span><span class="title-name">Operating a Cluster</span></a><ol><li><a href="cha-ceph-operating.html" class=" "><span class="title-number">15 </span><span class="title-name">Introduction</span></a></li><li><a href="ceph-operating-services.html" class=" "><span class="title-number">16 </span><span class="title-name">Operating Ceph Services</span></a></li><li><a href="ceph-monitor.html" class=" "><span class="title-number">17 </span><span class="title-name">Determining Cluster State</span></a></li><li><a href="monitoring-alerting.html" class=" "><span class="title-number">18 </span><span class="title-name">Monitoring and Alerting</span></a></li><li><a href="cha-storage-cephx.html" class=" "><span class="title-number">19 </span><span class="title-name">Authentication with <code class="systemitem">cephx</code></span></a></li><li><a href="cha-storage-datamgm.html" class=" "><span class="title-number">20 </span><span class="title-name">Stored Data Management</span></a></li><li><a href="cha-mgr-modules.html" class=" "><span class="title-number">21 </span><span class="title-name">Ceph Manager Modules</span></a></li><li><a href="ceph-pools.html" class=" "><span class="title-number">22 </span><span class="title-name">Managing Storage Pools</span></a></li><li><a href="ceph-rbd.html" class=" "><span class="title-number">23 </span><span class="title-name">RADOS Block Device</span></a></li><li><a href="cha-ceph-erasure.html" class=" "><span class="title-number">24 </span><span class="title-name">Erasure Coded Pools</span></a></li><li><a href="cha-ceph-configuration.html" class=" "><span class="title-number">25 </span><span class="title-name">Ceph Cluster Configuration</span></a></li></ol></li><li><a href="part-dataccess.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Accessing Cluster Data</span></a><ol><li><a href="cha-ceph-gw.html" class=" "><span class="title-number">26 </span><span class="title-name">Ceph Object Gateway</span></a></li><li><a href="cha-ceph-iscsi.html" class=" "><span class="title-number">27 </span><span class="title-name">Ceph iSCSI Gateway</span></a></li><li><a href="cha-ceph-cephfs.html" class=" "><span class="title-number">28 </span><span class="title-name">Clustered File System</span></a></li><li><a href="cha-ses-cifs.html" class=" "><span class="title-number">29 </span><span class="title-name">Exporting Ceph Data via Samba</span></a></li><li><a href="cha-ceph-nfsganesha.html" class=" "><span class="title-number">30 </span><span class="title-name">NFS Ganesha: Export Ceph Data via NFS</span></a></li></ol></li><li><a href="part-virt.html" class="has-children "><span class="title-number">V </span><span class="title-name">Integration with Virtualization Tools</span></a><ol><li><a href="cha-ceph-libvirt.html" class=" "><span class="title-number">31 </span><span class="title-name">Using <code class="systemitem">libvirt</code> with Ceph</span></a></li><li><a href="cha-ceph-kvm.html" class=" "><span class="title-number">32 </span><span class="title-name">Ceph as a Back-end for QEMU KVM Instance</span></a></li></ol></li><li><a href="part-troubleshooting.html" class="has-children "><span class="title-number">VI </span><span class="title-name">FAQs, Tips and Troubleshooting</span></a><ol><li><a href="storage-tips.html" class=" "><span class="title-number">33 </span><span class="title-name">Hints and Tips</span></a></li><li><a href="storage-faqs.html" class=" "><span class="title-number">34 </span><span class="title-name">Frequently Asked Questions</span></a></li><li><a href="storage-troubleshooting.html" class=" "><span class="title-number">35 </span><span class="title-name">Troubleshooting</span></a></li></ol></li><li><a href="app-stage1-custom.html" class=" "><span class="title-number">A </span><span class="title-name">DeepSea Stage 1 Custom Example</span></a></li><li><a href="bk01apb.html" class=" "><span class="title-number">B </span><span class="title-name">Ceph Maintenance Updates Based on Upstream 'Nautilus' Point Releases</span></a></li><li><a href="bk01go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="ap-adm-docupdate.html" class=" "><span class="title-number">C </span><span class="title-name">Documentation Updates</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-deployment-backup" data-id-title="Backing Up Cluster Configuration and Data"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">6</span></div><div><h2 class="title"><span class="title-number">3 </span><span class="title-name">Backing Up Cluster Configuration and Data</span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#">#</a></h2></div></div></div><p>
  This chapter explains which parts of the Ceph cluster you should back up in
  order to be able to restore its functionality.
 </p><section class="sect1" id="backup-ceph" data-id-title="Back Up Ceph Configuration"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">3.1 </span><span class="title-name">Back Up Ceph Configuration</span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backup-ceph">#</a></h2></div></div></div><p>
   Back up the <code class="filename">/etc/ceph</code> directory. It contains crucial
   cluster configuration. You will need the backup of
   <code class="filename">/etc/ceph</code> for example when you need to replace the
   Admin Node.
  </p></section><section class="sect1" id="sec-deployment-backup-salt" data-id-title="Back Up Salt Configuration"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">3.2 </span><span class="title-name">Back Up Salt Configuration</span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#sec-deployment-backup-salt">#</a></h2></div></div></div><p>
   You need to back up the <code class="filename">/etc/salt/</code> directory. It
   contains the Salt configuration files, for example the Salt master key and
   accepted client keys.
  </p><p>
   The Salt files are not strictly required for backing up the Admin Node, but
   make redeploying the Salt cluster easier. If there is no backup of these
   files, the Salt minions need to be registered again at the new Admin Node.
  </p><div id="id-1.3.3.4.5.4" data-id-title="Security of the Salt Master Private Key" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note: Security of the Salt Master Private Key</h6><p>
    Make sure that the backup of the Salt master private key is stored in a safe
    location. The Salt master key can be used to manipulate all cluster nodes.
   </p></div><p>
   After restoring the <code class="filename">/etc/salt</code> directory from a backup,
   restart the Salt services:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code><code class="command">systemctl</code> restart salt-master
<code class="prompt user">root@master # </code><code class="command">systemctl</code> restart salt-minion</pre></div></section><section class="sect1" id="sec-deployment-backup-deepsea" data-id-title="Back Up DeepSea Configuration"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">3.3 </span><span class="title-name">Back Up DeepSea Configuration</span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#sec-deployment-backup-deepsea">#</a></h2></div></div></div><p>
   All files required by DeepSea are stored in
   <code class="filename">/srv/pillar/</code>, <code class="filename">/srv/salt/</code> and
   <code class="filename">/etc/salt/master.d</code>.
  </p><p>
   If you need to redeploy the Admin Node, install the DeepSea package on the new
   node and move the backed up data back into the directories. DeepSea can
   then be used again without any further changes being required. Before using
   DeepSea again, make sure that all Salt minions are correctly registered
   on the Admin Node.
  </p></section><section class="sect1" id="backup-config-files" data-id-title="Back Up Custom Configurations"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">3.4 </span><span class="title-name">Back Up Custom Configurations</span> <a title="Permalink" class="permalink" href="cha-deployment-backup.html#backup-config-files">#</a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Prometheus data and customization.
    </p></li><li class="listitem"><p>
     Grafana customization.
    </p></li><li class="listitem"><p>
     Verify that you have a record of existing openATTIC users so that you can
     create new accounts for these users in the Ceph Dashboard.
    </p></li><li class="listitem"><p>
     Manual changes to <code class="filename">ceph.conf</code> outside of DeepSea.
    </p></li><li class="listitem"><p>
     Manual changes to the iSCSI configuration outside of DeepSea.
    </p></li><li class="listitem"><p>
     Ceph keys.
    </p></li><li class="listitem"><p>
     CRUSH Map and CRUSH rules. Save the decompiled CRUSH Map including CRUSH
     rules into <code class="filename">crushmap-backup.txt</code> by running the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephadm@adm &gt; </code>ceph osd getcrushmap | crushtool -d - -o crushmap-backup.txt</pre></div></li><li class="listitem"><p>
     Samba Gateway configuration. If you are using a single gateway, backup
     <code class="filename">/etc/samba/smb.conf</code>. If you are using HA setup,
     backup also CTDB and Pacemaker configuration files. Refer to
     <a class="xref" href="cha-ses-cifs.html" title="Chapter 29. Exporting Ceph Data via Samba">Chapter 29, <em>Exporting Ceph Data via Samba</em></a> for details on what configuration is used
     by Samba Gateways.
    </p></li><li class="listitem"><p>
     NFS Ganesha configuration. Only needed when using HA setup. Refer to
     <a class="xref" href="cha-ceph-nfsganesha.html" title="Chapter 30. NFS Ganesha: Export Ceph Data via NFS">Chapter 30, <em>NFS Ganesha: Export Ceph Data via NFS</em></a> for details on what configuration is
     used by NFS Ganesha.
    </p></li></ul></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="storage-salt-cluster.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 2 </span>Salt Cluster Administration</span></a> </div><div><a class="pagination-link next" href="part-dashboard.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Part II </span>Ceph Dashboard</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-deployment-backup.html#backup-ceph"><span class="title-number">3.1 </span><span class="title-name">Back Up Ceph Configuration</span></a></span></li><li><span class="sect1"><a href="cha-deployment-backup.html#sec-deployment-backup-salt"><span class="title-number">3.2 </span><span class="title-name">Back Up Salt Configuration</span></a></span></li><li><span class="sect1"><a href="cha-deployment-backup.html#sec-deployment-backup-deepsea"><span class="title-number">3.3 </span><span class="title-name">Back Up DeepSea Configuration</span></a></span></li><li><span class="sect1"><a href="cha-deployment-backup.html#backup-config-files"><span class="title-number">3.4 </span><span class="title-name">Back Up Custom Configurations</span></a></span></li></ul></div><div class="side-title">Give feedback</div><ul class="feedback" id="_give-feedback"><li><a id="_feedback-reportbug" href="#" rel="nofollow" target="_blank">Report an issue</a></li><li><a id="_feedback-editurl" href="https://github.com/SUSE/doc-ses/edit/maintenance/ses6/xml/admin_ds_backup.xml" rel="nofollow" target="_blank">Edit source document</a></li></ul><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>