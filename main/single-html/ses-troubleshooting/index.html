<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SES 7.1 | Troubleshooting Guide</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Troubleshooting Guide | SES 7.1"/>
<meta name="description" content="This guide takes you through various common problems when running SUSE Enterprise Storage 7.1 and other related issues to relevant components such as…"/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7.1"/>
<meta name="book-title" content="Troubleshooting Guide"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Troubleshooting Guide | SES 7.1"/>
<meta property="og:description" content="This guide takes you through various common problems when running SUSE Enterprise Storage 7.1 and other related issues to relevant components such as…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Troubleshooting Guide | SES 7.1"/>
<meta name="twitter:description" content="This guide takes you through various common problems when running SUSE Enterprise Storage 7.1 and other related issues to relevant components such as…"/>

<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-ses/edit/main/xml/book_storage_troubleshooting.xml"/></head><body class="draft single normal offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="#book-storage-troubleshooting">Troubleshooting Guide</a></div></div><main id="_content"><nav class="side-toc placebo" id="_side-toc-overall"> </nav><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="book" id="book-storage-troubleshooting" data-id-title="Troubleshooting Guide"><div class="titlepage"><div><div class="big-version-info"><span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7.1</span></div><div class="title-container"><h1 class="title">Troubleshooting Guide</h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/book_storage_troubleshooting.xml" title="Edit source document"> </a></div></div><div class="authorgroup"><div><span class="imprint-label">Authors: </span><span class="firstname">Tomáš</span> <span class="surname">Bažant</span>, <span class="firstname">Alexandra</span> <span class="surname">Settle</span>, and <span class="firstname">Liam</span> <span class="surname">Proven</span></div></div><div class="date"><span class="imprint-label">Publication Date: </span>21 Apr 2023</div></div></div><div class="toc"><ul><li><span class="preface"><a href="#preface-troubleshooting"><span class="title-name">About this guide</span></a></span><ul><li><span class="sect1"><a href="#id-1.5.2.5"><span class="title-name">Available documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.5.2.6"><span class="title-name">Improving the documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.5.2.7"><span class="title-name">Documentation conventions</span></a></span></li><li><span class="sect1"><a href="#id-1.5.2.8"><span class="title-name">Support</span></a></span></li><li><span class="sect1"><a href="#id-1.5.2.9"><span class="title-name">Ceph contributors</span></a></span></li><li><span class="sect1"><a href="#id-1.5.2.10"><span class="title-name">Commands and command prompts used in this guide</span></a></span></li></ul></li><li><span class="chapter"><a href="#report-software"><span class="title-number">1 </span><span class="title-name">Reporting software problems</span></a></span></li><li><span class="chapter"><a href="#bp-troubleshooting-logging"><span class="title-number">2 </span><span class="title-name">Troubleshooting logging and debugging</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-runtime"><span class="title-number">2.1 </span><span class="title-name">Accessing configuration settings at runtime</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-boottime"><span class="title-number">2.2 </span><span class="title-name">Activating Ceph debugging at boot time</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-accelerating"><span class="title-number">2.3 </span><span class="title-name">Accelerating log rotation</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-memory-util"><span class="title-number">2.4 </span><span class="title-name">Monitoring memory utilization</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-system-log"><span class="title-number">2.5 </span><span class="title-name">Enable system, log, and debug settings</span></a></span></li><li><span class="sect1"><a href="#logging-kernelrbd-cephfs-clients"><span class="title-number">2.6 </span><span class="title-name">Logging kernel RBD and CephFS clients</span></a></span></li><li><span class="sect1"><a href="#logging-service-daemons-events"><span class="title-number">2.7 </span><span class="title-name">Per-service and per-daemon events</span></a></span></li><li><span class="sect1"><a href="#troubleshooting-gdb-core-dump"><span class="title-number">2.8 </span><span class="title-name">Debugging a crashing process running in a container</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-cephadm"><span class="title-number">3 </span><span class="title-name">Troubleshooting cephadm</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-pause-disable"><span class="title-number">3.1 </span><span class="title-name">Pausing or disabling cephadm</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-check-logs"><span class="title-number">3.2 </span><span class="title-name">Checking cephadm logs</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-logs"><span class="title-number">3.3 </span><span class="title-name">Accessing Ceph daemon logs</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-systemctl"><span class="title-number">3.4 </span><span class="title-name">Collecting <code class="literal">systemd</code> status</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-configured-container-images"><span class="title-number">3.5 </span><span class="title-name">Listing configured container images</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-downloaded-container-images"><span class="title-number">3.6 </span><span class="title-name">Listing all downloaded container images</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cephadm-manual"><span class="title-number">3.7 </span><span class="title-name">Running containers manually</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cidr-error"><span class="title-number">3.8 </span><span class="title-name">Failing to infer CIDR network error</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-admin-socket"><span class="title-number">3.9 </span><span class="title-name">Accessing the admin socket</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-manual-deploy-mgr"><span class="title-number">3.10 </span><span class="title-name">Deploying a Ceph Manager manually</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-ptfs"><span class="title-number">3.11 </span><span class="title-name">Distributing a program temporary fix (PTF)</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-adding-hosts"><span class="title-number">3.12 </span><span class="title-name">Failure When Adding Hosts with cephadm</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-unmanaged-daemons"><span class="title-number">3.13 </span><span class="title-name">Disabling automatic deployment of daemons</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-osds"><span class="title-number">4 </span><span class="title-name">Troubleshooting OSDs</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-osd-data"><span class="title-number">4.1 </span><span class="title-name">Obtain OSD data</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-rebalancing"><span class="title-number">4.2 </span><span class="title-name">Stopping without rebalancing</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-not-running"><span class="title-number">4.3 </span><span class="title-name">OSDs not running</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-osd-slow"><span class="title-number">4.4 </span><span class="title-name">Unresponsive or slow OSDs</span></a></span></li><li><span class="sect1"><a href="#storage-bp-recover-osdweight"><span class="title-number">4.5 </span><span class="title-name">OSD weight is 0</span></a></span></li><li><span class="sect1"><a href="#storage-bp-recover-osddown"><span class="title-number">4.6 </span><span class="title-name">OSD is down</span></a></span></li><li><span class="sect1"><a href="#storage-bp-performance-slowosd"><span class="title-number">4.7 </span><span class="title-name">Finding slow OSDs</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-flapping-osds"><span class="title-number">4.8 </span><span class="title-name">Flapping OSDs</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-pgs"><span class="title-number">5 </span><span class="title-name">Troubleshooting placement groups (PGs)</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-identify-pg"><span class="title-number">5.1 </span><span class="title-name">Identifying troubled placement groups</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-pg-clean"><span class="title-number">5.2 </span><span class="title-name">Placement groups never get clean</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-stuck-pgs"><span class="title-number">5.3 </span><span class="title-name">Stuck placement groups</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-pgs-down"><span class="title-number">5.4 </span><span class="title-name">Peering failure of placement groups</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-unfound-objects"><span class="title-number">5.5 </span><span class="title-name">Failing unfound objects</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-homeless-pgs"><span class="title-number">5.6 </span><span class="title-name">Identifying homeless placement groups</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-osds-data"><span class="title-number">5.7 </span><span class="title-name">Only a few OSDs receive data</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-cant-write"><span class="title-number">5.8 </span><span class="title-name">Unable to write data</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-pgs-inconsistent"><span class="title-number">5.9 </span><span class="title-name">Identifying inconsistent placement groups</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-erasure-codes"><span class="title-number">5.10 </span><span class="title-name">Identifying inactive erasure coded PGs</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-monitors"><span class="title-number">6 </span><span class="title-name">Troubleshooting Ceph Monitors and Ceph Managers</span></a></span><ul><li><span class="sect1"><a href="#mons-initial-troubleshooting"><span class="title-number">6.1 </span><span class="title-name">Initial troubleshooting</span></a></span></li><li><span class="sect1"><a href="#mons-admin-socket"><span class="title-number">6.2 </span><span class="title-name">Using the monitor's admin socket</span></a></span></li><li><span class="sect1"><a href="#mons-understanding-mons-status"><span class="title-number">6.3 </span><span class="title-name">Understanding <code class="literal">mons_status</code></span></a></span></li><li><span class="sect1"><a href="#mons-restoring-quorum"><span class="title-number">6.4 </span><span class="title-name">Restoring the MONs quorum</span></a></span></li><li><span class="sect1"><a href="#mons-common-issues"><span class="title-number">6.5 </span><span class="title-name">Most common monitor issues</span></a></span></li><li><span class="sect1"><a href="#mons-store-failures"><span class="title-number">6.6 </span><span class="title-name">Monitor store failures</span></a></span></li><li><span class="sect1"><a href="#next-steps"><span class="title-number">6.7 </span><span class="title-name">Next steps</span></a></span></li><li><span class="sect1"><a href="#deploy-mgr-manually"><span class="title-number">6.8 </span><span class="title-name">Manually deploying a MGR daemon</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-networking"><span class="title-number">7 </span><span class="title-name">Troubleshooting networking</span></a></span><ul><li><span class="sect1"><a href="#troubleshooting-network-issues"><span class="title-number">7.1 </span><span class="title-name">Identifying OSD networking issues</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-nfs"><span class="title-number">8 </span><span class="title-name">Troubleshooting NFS Ganesha</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-debug-logging"><span class="title-number">8.1 </span><span class="title-name">Debugging NFS Ganesha logs</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-default-port"><span class="title-number">8.2 </span><span class="title-name">Changing the default port</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-status"><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span></a></span></li><li><span class="chapter"><a href="#bp-troubleshooting-dashboard"><span class="title-number">10 </span><span class="title-name">Troubleshooting the Ceph Dashboard</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-locate-dashboard"><span class="title-number">10.1 </span><span class="title-name">Locating the Ceph Dashboard</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-access-dashboard"><span class="title-number">10.2 </span><span class="title-name">Accessing the Ceph Dashboard</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-login-dashboard"><span class="title-number">10.3 </span><span class="title-name">Troubleshooting logging into the Ceph Dashboard</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-features-dashboard"><span class="title-number">10.4 </span><span class="title-name">Determining if a Ceph Dashboard feature is not working</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-logging-dashboard"><span class="title-number">10.5 </span><span class="title-name">Ceph Dashboard logs</span></a></span></li><li><span class="sect1"><a href="#troubleshooting-dashboard-sslcert-exception"><span class="title-number">10.6 </span><span class="title-name">Adding exceptions for self-signed SSL certificates in the Ceph Dashboard</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-objectgateway"><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></a></span><ul><li><span class="sect1"><a href="#troubleshooting-gateway-healthcheck"><span class="title-number">11.1 </span><span class="title-name">Running a basic health check</span></a></span></li><li><span class="sect1"><a href="#troubleshooting-gateway-notrunning"><span class="title-number">11.2 </span><span class="title-name">Identifying gateway issues</span></a></span></li><li><span class="sect1"><a href="#troubleshooting-gateway-crashed-rrgw"><span class="title-number">11.3 </span><span class="title-name">Diagnosing crashed Object Gateway process</span></a></span></li><li><span class="sect1"><a href="#troubleshooting-gateway-blocked"><span class="title-number">11.4 </span><span class="title-name">Identifying blocked Object Gateway requests</span></a></span></li><li><span class="sect1"><a href="#large-omap-issues"><span class="title-number">11.5 </span><span class="title-name">Large OMAP issues</span></a></span></li></ul></li><li><span class="chapter"><a href="#bp-troubleshooting-cephfs"><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span></a></span><ul><li><span class="sect1"><a href="#bp-troubleshooting-slow-ops"><span class="title-number">12.1 </span><span class="title-name">Slow or stuck operations</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-rados-health"><span class="title-number">12.2 </span><span class="title-name">Checking RADOS health</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-mds"><span class="title-number">12.3 </span><span class="title-name">MDS</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-kernelmount-debugging"><span class="title-number">12.4 </span><span class="title-name">Kernel mount debugging</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-disconnected-remounted-fs"><span class="title-number">12.5 </span><span class="title-name">Disconnecting and remounting the file system</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-mounting"><span class="title-number">12.6 </span><span class="title-name">Mounting</span></a></span></li><li><span class="sect1"><a href="#bp-troubleshooting-old-clients-mount"><span class="title-number">12.7 </span><span class="title-name">Mounting CephFS using old kernel clients</span></a></span></li></ul></li><li><span class="chapter"><a href="#storage-tips"><span class="title-number">13 </span><span class="title-name">Hints and tips</span></a></span><ul><li><span class="sect1"><a href="#tips-orphaned-volumes"><span class="title-number">13.1 </span><span class="title-name">Identifying orphaned volumes</span></a></span></li><li><span class="sect1"><a href="#tips-scrubbing"><span class="title-number">13.2 </span><span class="title-name">Adjusting scrubbing</span></a></span></li><li><span class="sect1"><a href="#tips-stopping-osd-without-rebalancing"><span class="title-number">13.3 </span><span class="title-name">Stopping OSDs without rebalancing</span></a></span></li><li><span class="sect1"><a href="#storage-bp-cluster-mntc-unbalanced"><span class="title-number">13.4 </span><span class="title-name">Checking for unbalanced data writing</span></a></span></li><li><span class="sect1"><a href="#storage-bp-srv-maint-fds-inc"><span class="title-number">13.5 </span><span class="title-name">Increasing file descriptors</span></a></span></li><li><span class="sect1"><a href="#storage-admin-integration"><span class="title-number">13.6 </span><span class="title-name">Integration with virtualization software</span></a></span></li><li><span class="sect1"><a href="#storage-bp-net-firewall"><span class="title-number">13.7 </span><span class="title-name">Firewall settings for Ceph</span></a></span></li><li><span class="sect1"><a href="#storage-bp-network-test"><span class="title-number">13.8 </span><span class="title-name">Testing network performance</span></a></span></li><li><span class="sect1"><a href="#bp-flash-led-lights"><span class="title-number">13.9 </span><span class="title-name">Locating physical disks using LED lights</span></a></span></li><li><span class="sect1"><a href="#storage-bp-cluster-mntc-rados-striping"><span class="title-number">13.10 </span><span class="title-name">Sending large objects with <code class="command">rados</code> fails with full OSD</span></a></span></li><li><span class="sect1"><a href="#storage-bp-recover-toomanypgs"><span class="title-number">13.11 </span><span class="title-name">Managing the 'Too Many PGs per OSD' status message</span></a></span></li><li><span class="sect1"><a href="#storage-bp-recover-stuckinactive"><span class="title-number">13.12 </span><span class="title-name">Managing the '<span class="emphasis"><em>nn</em></span> pg stuck inactive' status message</span></a></span></li><li><span class="sect1"><a href="#storage-bp-recover-clockskew"><span class="title-number">13.13 </span><span class="title-name">Fixing clock skew warnings</span></a></span></li><li><span class="sect1"><a href="#storage-bp-performance-net-issues"><span class="title-number">13.14 </span><span class="title-name">Determining poor cluster performance caused by network problems</span></a></span></li><li><span class="sect1"><a href="#trouble-jobcache"><span class="title-number">13.15 </span><span class="title-name">Managing <code class="filename">/var</code> running out of space</span></a></span></li></ul></li><li><span class="chapter"><a href="#storage-faqs"><span class="title-number">14 </span><span class="title-name">Frequently asked questions</span></a></span><ul><li><span class="sect1"><a href="#storage-bp-tuneups-pg-num"><span class="title-number">14.1 </span><span class="title-name">How does the number of placement groups affect the cluster performance?</span></a></span></li><li><span class="sect1"><a href="#storage-bp-tuneups-mix-ssd"><span class="title-number">14.2 </span><span class="title-name">Can I use SSDs and hard disks on the same cluster?</span></a></span></li><li><span class="sect1"><a href="#storage-bp-tuneups-ssd-tradeoffs"><span class="title-number">14.3 </span><span class="title-name">What are the trade-offs of ssing a journal on SSD?</span></a></span></li><li><span class="sect1"><a href="#storage-bp-monitoring-diskfails"><span class="title-number">14.4 </span><span class="title-name">What happens when a disk fails?</span></a></span></li><li><span class="sect1"><a href="#storage-bp-monitoring-journalfails"><span class="title-number">14.5 </span><span class="title-name">What happens when a journal disk fails?</span></a></span></li></ul></li><li><span class="appendix"><a href="#id-1.5.17"><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Pacific' point releases</span></a></span></li><li><span class="glossary"><a href="#id-1.5.18"><span class="title-name">Glossary</span></a></span></li></ul></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><ul><li><span class="figure"><a href="#dashboard-invalid-credentials"><span class="number">10.1 </span><span class="name">Failed to execute login</span></a></span></li></ul></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><ul><li><span class="table"><a href="#id-1.5.4.12.3.7"><span class="number">2.1 </span><span class="name">Ceph subsystems</span></a></span></li><li><span class="table"><a href="#id-1.5.14.9.6"><span class="number">12.1 </span><span class="name">Ceph features</span></a></span></li><li><span class="table"><a href="#id-1.5.14.9.12"><span class="number">12.2 </span><span class="name">CRUSH profiles</span></a></span></li></ul></div><div><div xml:lang="en" class="legalnotice" id="id-1.5.1.6"><p>
  Copyright © 2020–2023

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Except where otherwise noted, this document is licensed under Creative Commons Attribution-ShareAlike 4.0 International
  (CC-BY-SA 4.0): <a class="link" href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" target="_blank">https://creativecommons.org/licenses/by-sa/4.0/legalcode</a>.
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="http://www.suse.com/company/legal/" target="_blank">http://www.suse.com/company/legal/</a>. All
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention to
  detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be
  held liable for possible errors or the consequences thereof.
 </p></div></div><section xml:lang="en" class="preface" id="preface-troubleshooting" data-id-title="About this guide"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">About this guide</span></span> <a title="Permalink" class="permalink" href="#preface-troubleshooting">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/preface_troubleshooting.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This guide takes you through various common problems when running
  SUSE Enterprise Storage 7.1 and other related issues to relevant components
  such as Ceph or Object Gateway.
 </p><p>
 SUSE Enterprise Storage 7.1 is an extension to SUSE Linux Enterprise Server 15 SP3. It combines the
 capabilities of the Ceph
 (<a class="link" href="http://ceph.com/" target="_blank">http://ceph.com/</a>)
 storage project with the enterprise engineering and support of SUSE.
 SUSE Enterprise Storage 7.1 provides IT organizations with the ability to
 deploy a distributed storage architecture that can support a number of use
 cases using commodity hardware platforms.
</p><section xml:lang="en" class="sect1" id="id-1.5.2.5" data-id-title="Available documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Available documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_available_doc.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.5.2.5.3" data-id-title="Online documentation and latest updates" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Online documentation and latest updates</div><p>
   Documentation for our products is available at
   <a class="link" href="https://documentation.suse.com" target="_blank">https://documentation.suse.com</a>,
   where you can also find the latest updates, and browse or download the
   documentation in various formats. The latest documentation updates can be
   found in the English language version.
  </p></div><p>
  In addition, the product documentation is available in your installed system
  under <code class="filename">/usr/share/doc/manual</code>. It is included in an RPM
  package named
  <span class="package">ses-manual_<em class="replaceable">LANG_CODE</em></span>. Install
  it if it is not already on your system, for example:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper install ses-manual_en</pre></div><p>
  The following documentation is available for this product:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.2.5.7.1"><span class="term"><a class="link" href="https://documentation.suse.com/ses/html/ses-all/book-storage-deployment.html" target="_blank"><em class="citetitle">Deployment Guide</em></a></span></dt><dd><p>
     This guide focuses on deploying a basic Ceph cluster, and how to deploy
     additional services. It also cover the steps for upgrading to
     SUSE Enterprise Storage 7.1 from the previous product version.
    </p></dd><dt id="id-1.5.2.5.7.2"><span class="term"><a class="link" href="https://documentation.suse.com/ses/html/ses-all/book-storage-admin.html" target="_blank"><em class="citetitle">Administration and Operations Guide</em></a></span></dt><dd><p>
     This guide focuses on routine tasks that you as an administrator need to
     take care of after the basic Ceph cluster has been deployed (day 2
     operations). It also describes all the supported ways to access data
     stored in a Ceph cluster.
    </p></dd><dt id="id-1.5.2.5.7.3"><span class="term"><a class="link" href="https://documentation.suse.com/ses/html/ses-all/book-storage-security.html" target="_blank"><em class="citetitle">Security Hardening Guide</em></a></span></dt><dd><p>
     This guide focuses on how to ensure your cluster is secure.
    </p></dd><dt id="id-1.5.2.5.7.4"><span class="term"><a class="link" href="https://documentation.suse.com/ses/html/ses-all/book-storage-troubleshooting.html" target="_blank"><em class="citetitle">Troubleshooting Guide</em></a></span></dt><dd><p>
     This guide takes you through various common problems when running
     SUSE Enterprise Storage 7.1 and other related issues to relevant
     components such as Ceph or Object Gateway.
    </p></dd><dt id="id-1.5.2.5.7.5"><span class="term"><a class="link" href="https://documentation.suse.com/ses/html/ses-all/book-storage-windows.html" target="_blank"><em class="citetitle">SUSE Enterprise Storage for Windows Guide</em></a></span></dt><dd><p>
     This guide describes the integration, installation, and configuration of
     Microsoft Windows environments and SUSE Enterprise Storage using the Windows Driver.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.5.2.6" data-id-title="Improving the documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Improving the documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_feedback.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Your feedback and contributions to this documentation are welcome.
  The following channels for giving feedback are available:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.2.6.4.1"><span class="term">Service requests and support</span></dt><dd><p>
     For services and support options available for your product, see
     <a class="link" href="http://www.suse.com/support/" target="_blank">http://www.suse.com/support/</a>.
    </p><p>
     To open a service request, you need a SUSE subscription registered at
     SUSE Customer Center.
     Go to <a class="link" href="https://scc.suse.com/support/requests" target="_blank">https://scc.suse.com/support/requests</a>, log
     in, and click <span class="guimenu">Create New</span>.
    </p></dd><dt id="id-1.5.2.6.4.2"><span class="term">Bug reports</span></dt><dd><p>
     Report issues with the documentation at <a class="link" href="https://bugzilla.suse.com/" target="_blank">https://bugzilla.suse.com/</a>.
     A Bugzilla account is required.
    </p><p>
     To simplify this process, you can use the <span class="guimenu">Report
     Documentation Bug</span> links next to headlines in the HTML
     version of this document. These preselect the right product and
     category in Bugzilla and add a link to the current section.
     You can start typing your bug report right away.
    </p></dd><dt id="id-1.5.2.6.4.3"><span class="term">Contributions</span></dt><dd><p>
     To contribute to this documentation, use the <span class="guimenu">Edit Source</span>
     links next to headlines in the HTML version of this document. They
     take you to the source code on GitHub, where you can open a pull request.
     A GitHub account is required.
    </p><div id="id-1.5.2.6.4.3.2.2" data-id-title="Edit Source only available for English" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <span class="guimenu">Edit Source</span> only available for English</div><p>
      The <span class="guimenu">Edit Source</span> links are only available for the
      English version of each document. For all other languages, use the
      <span class="guimenu">Report Documentation Bug</span> links instead.
     </p></div><p>
     For more information about the documentation environment used for this
     documentation, see the repository's README at
     <a class="link" href="https://github.com/SUSE/doc-ses" target="_blank">https://github.com/SUSE/doc-ses</a>.
    </p></dd><dt id="id-1.5.2.6.4.4"><span class="term">Mail</span></dt><dd><p>
     You can also report errors and send feedback concerning the
     documentation to &lt;<a class="email" href="mailto:doc-team@suse.com">doc-team@suse.com</a>&gt;. Include the
     document title, the product version, and the publication date of the
     document. Additionally, include the relevant section number and title (or
     provide the URL) and provide a concise description of the problem.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.5.2.7" data-id-title="Documentation conventions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Documentation conventions</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.7">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_convention.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following notices and typographic conventions are used in this
  document:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <code class="filename">/etc/passwd</code>: Directory names and file names
   </p></li><li class="listitem"><p>
    <em class="replaceable">PLACEHOLDER</em>: Replace
    <em class="replaceable">PLACEHOLDER</em> with the actual value
   </p></li><li class="listitem"><p>
    <code class="envar">PATH</code>: An environment variable
   </p></li><li class="listitem"><p>
    <code class="command">ls</code>, <code class="option">--help</code>: Commands, options, and
    parameters
   </p></li><li class="listitem"><p>
    <code class="systemitem">user</code>: The name of user or group
   </p></li><li class="listitem"><p>
    <span class="package">package_name</span>: The name of a software package
   </p></li><li class="listitem"><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>: A key to press or a key combination. Keys
    are shown in uppercase as on a keyboard.
   </p></li><li class="listitem"><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span> › <span class="guimenu">Save
    As</span>: menu items, buttons
   </p></li><li class="listitem"><p><strong class="arch-arrow-start">AMD/Intel</strong>
    This paragraph is only relevant for the AMD64/Intel 64 architectures. The
    arrows mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"> </strong></p><p><strong class="arch-arrow-start">IBM Z, POWER</strong>
    This paragraph is only relevant for the architectures
    <code class="literal">IBM Z</code> and <code class="literal">POWER</code>. The arrows
    mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"> </strong></p></li><li class="listitem"><p>
    <em class="citetitle">Chapter 1, <span class="quote">“<span class="quote">Example chapter</span>”</span></em>:
    A cross-reference to another chapter in this guide.
   </p></li><li class="listitem"><p>
    Commands that must be run with <code class="systemitem">root</code> privileges. Often you can also
    prefix these commands with the <code class="command">sudo</code> command to run them
    as non-privileged user.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">command</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands that can be run by non-privileged users.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code></pre></div></li><li class="listitem"><p>
    Notices
   </p><div id="id-1.5.2.7.4.13.2" data-id-title="Warning notice" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Warning notice</div><p>
     Vital information you must be aware of before proceeding. Warns you about
     security issues, potential loss of data, damage to hardware, or physical
     hazards.
    </p></div><div id="id-1.5.2.7.4.13.3" data-id-title="Important notice" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Important notice</div><p>
     Important information you should be aware of before proceeding.
    </p></div><div id="id-1.5.2.7.4.13.4" data-id-title="Note notice" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Note notice</div><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.5.2.7.4.13.5" data-id-title="Tip notice" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Tip notice</div><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li><li class="listitem"><p>
    Compact Notices
   </p><div id="id-1.5.2.7.4.14.2" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.5.2.7.4.14.3" class="admonition tip compact"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li></ul></div></section><section xml:lang="en" class="sect1" id="id-1.5.2.8" data-id-title="Support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Support</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.8">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Find the support statement for SUSE Enterprise Storage and general information about
  technology previews below.
  For details about the product lifecycle, see
  <a class="link" href="https://www.suse.com/lifecycle" target="_blank">https://www.suse.com/lifecycle</a>.
 </p><p>
  If you are entitled to support, find details on how to collect information
  for a support ticket at
  <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html</a>.
 </p><section class="sect2" id="id-1.5.2.8.5" data-id-title="Support statement for SUSE Enterprise Storage"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Support statement for SUSE Enterprise Storage</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.8.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To receive support, you need an appropriate subscription with SUSE.
   To view the specific support offerings available to you, go to
   <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a> and select your product.
  </p><p>
   The support levels are defined as follows:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.2.8.5.4.1"><span class="term">L1</span></dt><dd><p>
      Problem determination, which means technical support designed to provide
      compatibility information, usage support, ongoing maintenance,
      information gathering and basic troubleshooting using available
      documentation.
     </p></dd><dt id="id-1.5.2.8.5.4.2"><span class="term">L2</span></dt><dd><p>
      Problem isolation, which means technical support designed to analyze
      data, reproduce customer problems, isolate problem area and provide a
      resolution for problems not resolved by Level 1 or prepare for
      Level 3.
     </p></dd><dt id="id-1.5.2.8.5.4.3"><span class="term">L3</span></dt><dd><p>
      Problem resolution, which means technical support designed to resolve
      problems by engaging engineering to resolve product defects which have
      been identified by Level 2 Support.
     </p></dd></dl></div><p>
   For contracted customers and partners, SUSE Enterprise Storage is delivered with L3
   support for all packages, except for the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews.
    </p></li><li class="listitem"><p>
     Sound, graphics, fonts, and artwork.
    </p></li><li class="listitem"><p>
     Packages that require an additional customer contract.
    </p></li><li class="listitem"><p>
     Some packages shipped as part of the module <span class="emphasis"><em>Workstation
     Extension</em></span> are L2-supported only.
    </p></li><li class="listitem"><p>
     Packages with names ending in <span class="package">-devel</span> (containing header
     files and similar developer resources) will only be supported together
     with their main packages.
    </p></li></ul></div><p>
   SUSE will only support the usage of original packages.
   That is, packages that are unchanged and not recompiled.
  </p></section><section class="sect2" id="id-1.5.2.8.6" data-id-title="Technology previews"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Technology previews</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.8.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Technology previews are packages, stacks, or features delivered by SUSE
   to provide glimpses into upcoming innovations.
   Technology previews are included for your convenience to give you a chance
   to test new technologies within your environment.
   We would appreciate your feedback!
   If you test a technology preview, please contact your SUSE representative
   and let them know about your experience and use cases.
   Your input is helpful for future development.
  </p><p>
   Technology previews have the following limitations:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews are still in development.
     Therefore, they may be functionally incomplete, unstable, or in other ways
     <span class="emphasis"><em>not</em></span> suitable for production use.
    </p></li><li class="listitem"><p>
     Technology previews are <span class="emphasis"><em>not</em></span> supported.
    </p></li><li class="listitem"><p>
     Technology previews may only be available for specific hardware
     architectures.
    </p></li><li class="listitem"><p>
     Details and functionality of technology previews are subject to change.
     As a result, upgrading to subsequent releases of a technology preview may
     be impossible and require a fresh installation.
    </p></li><li class="listitem"><p>
     SUSE may discover that a preview does not meet customer or market needs,
     or does not comply with enterprise standards.
     Technology previews can be removed from a product at any time.
     SUSE does not commit to providing a supported version of such
     technologies in the future.
    </p></li></ul></div><p>
   For an overview of technology previews shipped with your product, see the
   release notes at <a class="link" href="https://www.suse.com/releasenotes/x86_64/SUSE-Enterprise-Storage/7.1" target="_blank">https://www.suse.com/releasenotes/x86_64/SUSE-Enterprise-Storage/7.1</a>.
  </p></section></section><section class="sect1" id="id-1.5.2.9" data-id-title="Ceph contributors"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">Ceph contributors</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.9">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_contributors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The Ceph project and its documentation is a result of the work of hundreds
  of contributors and organizations. See
  <a class="link" href="https://ceph.com/contributors/" target="_blank">https://ceph.com/contributors/</a> for more details.
 </p></section><section class="sect1" id="id-1.5.2.10" data-id-title="Commands and command prompts used in this guide"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Commands and command prompts used in this guide</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  As a Ceph cluster administrator, you will be configuring and adjusting the
  cluster behavior by running specific commands. There are several types of
  commands you will need:
 </p><section class="sect2" id="id-1.5.2.10.4" data-id-title="Salt-related commands"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Salt-related commands</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   These commands help you to deploy Ceph cluster nodes, run commands on
   several (or all) cluster nodes at the same time, or assist you when adding
   or removing cluster nodes. The most frequently used commands are
   <code class="command">ceph-salt</code> and <code class="command">ceph-salt config</code>. You
   need to run Salt commands on the Salt Master node as <code class="systemitem">root</code>. These
   commands are introduced with the following prompt:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>ceph-salt config ls</pre></div></section><section class="sect2" id="id-1.5.2.10.5" data-id-title="Ceph related commands"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Ceph related commands</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   These are lower-level commands to configure and fine tune all aspects of the
   cluster and its gateways on the command line, for example
   <code class="command">ceph</code>, <code class="command">cephadm</code>, <code class="command">rbd</code>,
   or <code class="command">radosgw-admin</code>.
  </p><p>
   To run Ceph related commands, you need to have read access to a Ceph
   key. The key's capabilities then define your privileges within the Ceph
   environment. One option is to run Ceph commands as <code class="systemitem">root</code> (or via
   <code class="command">sudo</code>) and use the unrestricted default keyring
   'ceph.client.admin.key'.
  </p><p>
   The safer and recommended option is to create a more restrictive individual
   key for each administrator user and put it in a directory where the users
   can read it, for example:
  </p><div class="verbatim-wrap"><pre class="screen">~/.ceph/ceph.client.<em class="replaceable">USERNAME</em>.keyring</pre></div><div id="id-1.5.2.10.5.6" data-id-title="Path to Ceph keys" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Path to Ceph keys</div><p>
    To use a custom admin user and keyring, you need to specify the user name
    and path to the key each time you run the <code class="command">ceph</code> command
    using the <code class="option">-n client.<em class="replaceable">USER_NAME</em></code>
    and <code class="option">--keyring <em class="replaceable">PATH/TO/KEYRING</em></code>
    options.
   </p><p>
    To avoid this, include these options in the <code class="varname">CEPH_ARGS</code>
    variable in the individual users' <code class="filename">~/.bashrc</code> files.
   </p></div><p>
   Although you can run Ceph-related commands on any cluster node, we
   recommend running them on the Admin Node. This documentation uses the <code class="systemitem">cephuser</code>
   user to run the commands, therefore they are introduced with the following
   prompt:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth list</pre></div><div id="id-1.5.2.10.5.11" data-id-title="Commands for specific nodes" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Commands for specific nodes</div><p>
    If the documentation instructs you to run a command on a cluster node with
    a specific role, it will be addressed by the prompt. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@mon &gt; </code></pre></div></div><section class="sect3" id="id-1.5.2.10.5.12" data-id-title="Running ceph-volume"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.2.1 </span><span class="title-name">Running <code class="command">ceph-volume</code></span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10.5.12">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Starting with SUSE Enterprise Storage 7, Ceph services are running containerized.
    If you need to run <code class="command">ceph-volume</code> on an OSD node, you need
    to prepend it with the <code class="command">cephadm</code> command, for example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm ceph-volume simple scan</pre></div></section></section><section class="sect2" id="id-1.5.2.10.6" data-id-title="General Linux commands"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">General Linux commands</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Linux commands not related to Ceph, such as <code class="command">mount</code>,
   <code class="command">cat</code>, or <code class="command">openssl</code>, are introduced either
   with the <code class="prompt user">cephuser@adm &gt; </code> or <code class="prompt root"># </code> prompts, depending on which
   privileges the related command requires.
  </p></section><section class="sect2" id="id-1.5.2.10.7" data-id-title="Additional information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">Additional information</span></span> <a title="Permalink" class="permalink" href="#id-1.5.2.10.7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/common_intro_prompts.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information on Ceph key management, refer to
   <span class="intraxref">Book “Administration and Operations Guide”, Chapter 30 “Authentication with <code class="systemitem">cephx</code>”, Section 30.2 “Key management”</span>.
  </p></section></section></section><section class="chapter" id="report-software" data-id-title="Reporting software problems"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Reporting software problems</span></span> <a title="Permalink" class="permalink" href="#report-software">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_report.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  If you come across a problem when running SUSE Enterprise Storage 7.1
  related to some of its components, such as Ceph or Object Gateway, report the
  problem to SUSE Technical Support. The recommended way is with the
  <code class="command">supportconfig</code> utility.
 </p><div id="id-1.5.3.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
   Because <code class="command">supportconfig</code> is modular software, make sure that
   the <code class="systemitem">supportutils-plugin-ses</code> package is installed.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rpm -q supportutils-plugin-ses</pre></div><p>
   If it is missing on the Ceph server, install it with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper ref &amp;&amp; zypper in supportutils-plugin-ses</pre></div><p>
   <code class="literal">supportutils-plugin-ses</code> will try to capture as much
   useful information as it can about both the Ceph cluster as a whole, and
   about the host on which it is running. Some information, including the
   Ceph daemon's status, <code class="command">podman</code> image information,
   <code class="command">rpm</code> verification and some relevant configuration data
   will be saved to the <code class="filename">plugin-ses.txt</code> file inside the
   <code class="filename">supportconfig</code> <code class="command">tar</code> archive. A lot
   more information, including overall cluster status, logs, and diagnostic
   data for each currently running Ceph daemon will be saved to files in the
   Ceph subdirectory inside the supportconfig tar archive.
  </p></div><p>
  When <code class="command">supportconfig</code> is run on an Admin Node, it will be able to
  capture the overall status of the entire cluster. For example, <code class="command">ceph
  status</code> and <code class="command">ceph health</code>. If the
  <code class="filename">ceph.conf</code> file and admin keyring are not present, it
  will not be able to capture overall cluster status, but still capture
  diagnostic data for each currently running Ceph daemon.
 </p><p>
  In general, when using <code class="command">supportconfig</code>, you will want to run
  it on an admin node (to ensure the overall cluster status is captured), as
  well as on any other nodes that are experiencing problems, to ensure it
  captures diagnostic data for anything and everything that may be relevant.
 </p><p>
  Although you can use <code class="command">supportconfig</code> on the command line, we
  recommend using the related YaST module. Find more information about
  <code class="command">supportconfig</code> in
  <a class="link" href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html#sec-admsupport-supportconfig" target="_blank">https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html#sec-admsupport-supportconfig</a>.
 </p></section><section class="chapter" id="bp-troubleshooting-logging" data-id-title="Troubleshooting logging and debugging"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Troubleshooting logging and debugging</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-logging">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Typically, when you add debugging to your Ceph configuration, you do so at
  runtime. You can also add Ceph debug logging to your Ceph configuration
  file if you are encountering issues when starting your cluster. You may view
  Ceph log files under <code class="filename">/var/log/ceph</code> (the default
  location).
 </p><div id="id-1.5.4.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
   When debug output slows down your system, the latency can hide race
   conditions.
  </p></div><p>
  Logging is resource intensive. If you are encountering a problem in a
  specific area of your cluster, enable logging for that area of the cluster.
  For example, if your OSDs are running fine, but your metadata servers are
  not, you should start by enabling debug logging for the specific metadata
  server instance(s) giving you trouble. Enable logging for each subsystem as
  needed.
 </p><div id="id-1.5.4.6" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
   Verbose logging can generate over 1GB of data per hour. If your OS disk
   reaches its capacity, the node will stop working.
  </p></div><p>
  If you enable or increase the rate of Ceph logging, ensure that you have
  sufficient disk space on your OS disk. See
  <a class="xref" href="#bp-troubleshooting-accelerating" title="2.3. Accelerating log rotation">Section 2.3, “Accelerating log rotation”</a> for details on rotating log
  files. When your system is running well, remove unnecessary debugging
  settings to ensure your cluster runs optimally. Logging debug output messages
  is relatively slow, and a waste of resources when operating your cluster. See
  <a class="xref" href="#bp-troubleshooting-system-log" title="2.5. Enable system, log, and debug settings">Section 2.5, “Enable system, log, and debug settings”</a> for details on available
  settings.
 </p><section class="sect1" id="bp-troubleshooting-runtime" data-id-title="Accessing configuration settings at runtime"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">Accessing configuration settings at runtime</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-runtime">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you would like to see the configuration settings at runtime, you must log
   in to a host with a running daemon and execute the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm enter --name osd.<em class="replaceable">ID</em> -- ceph daemon osd.<em class="replaceable">ID</em> config show | less</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm enter --name osd.0 -- ceph daemon osd.0 config show | less</pre></div><p>
   To activate Ceph’s debugging output (i.e., <code class="literal">dout()</code>) at
   runtime, use the <code class="command">ceph tell</code> command to inject arguments
   into the runtime configuration:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell {daemon-type}.{daemon id or *} config set {name} {value}</pre></div><p>
   Replace <code class="option">{daemon-type}</code> with one of osd, mon or mds. You may
   apply the runtime setting to all daemons of a particular type with
   <code class="literal">*</code>, or specify a specific daemon’s ID. For example, to
   increase debug logging for a ceph-osd daemon named <code class="literal">osd.0</code>,
   execute the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell osd.0 config set debug_osd 0/5</pre></div><p>
   The <code class="command">ceph tell</code> command goes through the monitors. If you
   cannot bind to the monitor, you can make the change by logging into the
   daemon host using ceph daemon. For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm enter --name osd.0 -- ceph daemon osd.0 config set debug_osd 0/5</pre></div><p>
   See <a class="xref" href="#bp-troubleshooting-system-log" title="2.5. Enable system, log, and debug settings">Section 2.5, “Enable system, log, and debug settings”</a> for details on available
   settings.
  </p></section><section class="sect1" id="bp-troubleshooting-boottime" data-id-title="Activating Ceph debugging at boot time"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">Activating Ceph debugging at boot time</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-boottime">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To activate Ceph’s debugging output (i.e., <code class="literal">dout()</code>) at
   boot time, you must add settings to your Ceph configuration file. Subsystems
   common to each daemon may be set under <code class="literal">[global]</code> in your
   configuration file. Subsystems for particular daemons are set under the
   daemon section in your configuration file (e.g., <code class="literal">[mon]</code>,
   <code class="literal">[osd]</code>, <code class="literal">[mds]</code>). For example:
  </p><div class="verbatim-wrap"><pre class="screen">  [global]
          debug ms = 1/5

  [mon]
          debug mon = 20
          debug paxos = 1/5
          debug auth = 2

  [osd]
          debug osd = 1/5
          debug filestore = 1/5
          debug journal = 1
          debug monc = 5/20

  [mds]
          debug mds = 1
          debug mds balancer = 1</pre></div><p>
   See <a class="xref" href="#bp-troubleshooting-system-log" title="2.5. Enable system, log, and debug settings">Section 2.5, “Enable system, log, and debug settings”</a> for details.
  </p></section><section class="sect1" id="bp-troubleshooting-accelerating" data-id-title="Accelerating log rotation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">Accelerating log rotation</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-accelerating">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If your OS disk is relatively full, you can accelerate log rotation by
   modifying the Ceph log rotation file at
   <code class="filename">etc/logrotate.d/ceph</code>. Add a size setting after the
   rotation frequency to accelerate log rotation (via cronjob) if your logs
   exceed the size setting. For example, the default setting looks like this:
  </p><div class="verbatim-wrap"><pre class="screen">  rotate 7
  weekly
  compress
  sharedscripts</pre></div><p>
   Modify it by adding a size setting:
  </p><div class="verbatim-wrap"><pre class="screen">  rotate 7
  weekly
  size 500M
  compress
  sharedscripts</pre></div><p>
   Then, start the crontab editor for your user space:
  </p><div class="verbatim-wrap"><pre class="screen">crontab -e</pre></div><p>
   Finally, add an entry to check the <code class="filename">etc/logrotate.d/ceph</code>
   file:
  </p><div class="verbatim-wrap"><pre class="screen">30 * * * * /usr/sbin/logrotate /etc/logrotate.d/ceph &gt;/dev/null 2&gt;&lt;&amp;1</pre></div><p>
   The preceding example checks the <code class="filename">etc/logrotate.d/ceph</code>
   file every 30 minutes.
  </p></section><section class="sect1" id="bp-troubleshooting-memory-util" data-id-title="Monitoring memory utilization"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.4 </span><span class="title-name">Monitoring memory utilization</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-memory-util">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To monitor the memory utilization of the Ceph processes, pay attention to
   the <code class="command">top</code> command's VIRT or the output of <code class="command">ps -u
   ceph -l</code> in the <code class="literal">VSZ</code> column. While some
   fluctuation of memory utilization over time is normal, it should not
   constantly increase and this will help you pinpoint the problematic process
   if facing low- or out-of-memory concerns.
  </p></section><section class="sect1" id="bp-troubleshooting-system-log" data-id-title="Enable system, log, and debug settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.5 </span><span class="title-name">Enable system, log, and debug settings</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-system-log">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In most cases, you will enable debug logging output via subsystems.
  </p><section class="sect2" id="troubleshooting-ceph-subsystems" data-id-title="Enabling Ceph subsystems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.1 </span><span class="title-name">Enabling Ceph subsystems</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-ceph-subsystems">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Each subsystem has a logging level for its output logs, and for its logs
    in-memory. You may set different values for each of these subsystems by
    setting a log file level and a memory level for debug logging. Ceph’s
    logging levels operate on a scale of 1 to 20, where 1 is terse and 20 is
    verbose 1. In general, the logs in-memory are not sent to the output log
    unless:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      a fatal signal is raised or
     </p></li><li class="listitem"><p>
      an <code class="literal">assert</code> in source code is triggered or
     </p></li><li class="listitem"><p>
      upon request.
     </p></li></ul></div><p>
    A debug logging setting can take a single value for the log level and the
    memory level, which sets them both as the same value. For example, if you
    specify debug ms = 5, Ceph will treat it as a log level and a memory level
    of 5. You may also specify them separately. The first setting is the log
    level, and the second setting is the memory level. You must separate them
    with a forward slash (/). For example, if you want to set the ms
    subsystem’s debug logging level to 1 and its memory level to 5, you would
    specify it as debug ms = 1/5. For example:
   </p><div class="verbatim-wrap"><pre class="screen">debug {subsystem} = {log-level}/{memory-level}
#for example
debug mds balancer = 1/20</pre></div><p>
    The following table provides a list of Ceph subsystems and their default
    log and memory levels. Once you complete your logging efforts, restore the
    subsystems to their default level or to a level suitable for normal
    operations.
   </p><div class="table" id="id-1.5.4.12.3.7" data-id-title="Ceph subsystems"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 2.1: </span><span class="title-name">Ceph subsystems </span></span><a title="Permalink" class="permalink" href="#id-1.5.4.12.3.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     Subsystem
    </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     Log Level
    </th><th style="border-bottom: 1px solid ; ">
     Memory Level
    </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">default</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">lockdep</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">context</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">crush</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds balancer</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds locker</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds log</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds log expire</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mds migrator</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">buffer</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">timer</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">filer</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">striper</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">objector</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rados</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rbd</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rbd mirror</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rbd replay</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">journaler</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">objectcacher</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">client</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">osd</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">optracker</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">optracker</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">objclass</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">filestore</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     3
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">journal</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     3
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">ms</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mon</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">monc</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     10
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">paxos</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">tp</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">auth</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">crypto</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">finisher</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">reserver</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">heartbeatmap</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">perfcounter</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rgw</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rgw sync</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">civetweb</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     10
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">javaclient</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">asok</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">throttle</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     1
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">refs</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     0
    </td><td style="border-bottom: 1px solid ; ">
     0
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">compressor</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">bluestore</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">bluefs</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">bdev</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     3
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">kstore</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">rocksdb</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     4
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">leveldb</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     4
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">memdb</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     4
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">fuse</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mgr</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">mgrc</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">dpdk</code>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
     1
    </td><td style="border-bottom: 1px solid ; ">
     5
    </td></tr><tr><td style="border-right: 1px solid ; "><code class="literal">eventtrace</code>
       </td><td style="border-right: 1px solid ; ">
     1
    </td><td>
     5
    </td></tr></tbody></table></div></div></section><section class="sect2" id="troubleshooting-logging-settings" data-id-title="Logging settings"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.2 </span><span class="title-name">Logging settings</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-logging-settings">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Logging and debugging settings are not required in a Ceph configuration
    file, but you may override default settings as needed. Ceph supports the
    following settings:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.4.12.4.3.1"><span class="term"><code class="literal">log file</code></span></dt><dd><p>
       Description: The location of the logging file for your cluster.
      </p><p>
       Type: String
      </p><p>
       Required: No
      </p><p>
       Default: <code class="filename">/var/log/ceph/$cluster-$name.log</code>
      </p></dd><dt id="id-1.5.4.12.4.3.2"><span class="term"><code class="literal">log max new</code></span></dt><dd><p>
       Description: The maximum number of new log files.
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 1000
      </p></dd><dt id="id-1.5.4.12.4.3.3"><span class="term"><code class="literal">log max recent</code></span></dt><dd><p>
       Description: The maximum number of recent events to include in a log
       file.
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 10000
      </p></dd><dt id="id-1.5.4.12.4.3.4"><span class="term"><code class="literal">log to stderr</code></span></dt><dd><p>
       Description: Determines if logging messages should appear in
       <code class="literal">stderr</code>.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">true</code>
      </p></dd><dt id="id-1.5.4.12.4.3.5"><span class="term"><code class="literal">err to stderr</code></span></dt><dd><p>
       Description: Determines if error messages should appear in
       <code class="literal">stderr</code>.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">true</code>
      </p></dd><dt id="id-1.5.4.12.4.3.6"><span class="term"><code class="literal">log to syslog</code></span></dt><dd><p>
       Description: Determines if logging messages should appear in
       <code class="literal">syslog</code>.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.4.3.7"><span class="term"><code class="literal">err to syslog</code></span></dt><dd><p>
       Description: Determines if error messages should appear in
       <code class="literal">syslog</code>.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.4.3.8"><span class="term"><code class="literal">log flush on exit</code></span></dt><dd><p>
       Description: Determines if Ceph should flush the log files after exit.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">true</code>
      </p></dd><dt id="id-1.5.4.12.4.3.9"><span class="term"><code class="literal">clog to monitors</code></span></dt><dd><p>
       Description: Determines if <code class="literal">clog</code> messages should be
       sent to monitors.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">true</code>
      </p></dd><dt id="id-1.5.4.12.4.3.10"><span class="term"><code class="literal">clog to syslog</code></span></dt><dd><p>
       Description: Determines if <code class="literal">clog</code> messages should be
       sent to syslog.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.4.3.11"><span class="term"><code class="literal">mon cluster log to syslog</code></span></dt><dd><p>
       Description: Determines if the cluster log messages should be output to
       the syslog.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.4.3.12"><span class="term"><code class="literal">mon cluster log file</code></span></dt><dd><p>
       Description: The locations of the cluster’s log files. There are two
       channels in Ceph: <code class="literal">cluster</code> and
       <code class="literal">audit</code>. This option represents a mapping from channels
       to log files, where the log entries of that channel are sent to. The
       default entry is a fallback mapping for channels not explicitly
       specified. So, the following default setting will send cluster log to
       <code class="literal">$cluster.log</code>, and send audit log to
       <code class="literal">$cluster.audit.log</code>, where <code class="literal">$cluster</code>
       will be replaced with the actual cluster name.
      </p><p>
       Type: String
      </p><p>
       Required: No
      </p><p>
       Default:
       <code class="filename">default=/var/log/ceph/$cluster.$channel.log,cluster=/var/log/ceph/$cluster.log</code>
      </p></dd></dl></div></section><section class="sect2" id="troubleshooting-osd" data-id-title="OSD"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.3 </span><span class="title-name">OSD</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-osd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.4.12.5.2.1"><span class="term"><code class="literal">osd debug drop ping probability</code></span></dt><dd><p>
       Description: ?
      </p><p>
       Type: Double
      </p><p>
       Required: No
      </p><p>
       Default: 0
      </p></dd><dt id="id-1.5.4.12.5.2.2"><span class="term"><code class="literal">osd debug drop ping duration</code></span></dt><dd><p>
       Description:
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 0
      </p></dd><dt id="id-1.5.4.12.5.2.3"><span class="term"><code class="literal">osd debug drop pg create probability</code></span></dt><dd><p>
       Description:
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 0
      </p></dd><dt id="id-1.5.4.12.5.2.4"><span class="term"><code class="literal">osd debug drop pg create duration</code></span></dt><dd><p>
       Description: ?
      </p><p>
       Type: Double
      </p><p>
       Required: No
      </p><p>
       Default: 1
      </p></dd><dt id="id-1.5.4.12.5.2.5"><span class="term"><code class="literal">osd min pg log entries</code></span></dt><dd><p>
       Description: The minimum number of log entries for placement groups.
      </p><p>
       Type: 32-bit Unsigned Integer
      </p><p>
       Required: No
      </p><p>
       Default: 250
      </p></dd><dt id="id-1.5.4.12.5.2.6"><span class="term"><code class="literal">osd op log threshold</code></span></dt><dd><p>
       Description: How many op log messages to show up in one pass.
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 5
      </p></dd></dl></div></section><section class="sect2" id="troubleshooting-filestore" data-id-title="Filestore"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.4 </span><span class="title-name">Filestore</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-filestore">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.4.12.6.2.1"><span class="term"><code class="literal">filestore debug omap check</code></span></dt><dd><p>
       Description: Debugging check on synchronization. This is an expensive
       operation.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd></dl></div></section><section class="sect2" id="troubleshooting-mds" data-id-title="MDS"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.5 </span><span class="title-name">MDS</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-mds">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.4.12.7.2.1"><span class="term"><code class="literal">mds debug scatterstat</code></span></dt><dd><p>
       Description: Ceph will assert that various recursive stat invariants
       are true (for developers only).
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.7.2.2"><span class="term"><code class="literal">mds debug frag</code></span></dt><dd><p>
       Description: Ceph will verify directory fragmentation invariants when
       convenient (developers only).
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.7.2.3"><span class="term"><code class="literal">mds debug auth pins</code></span></dt><dd><p>
       Description: The debug auth pin invariants (for developers only).
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.7.2.4"><span class="term"><code class="literal">mds debug subtrees</code></span></dt><dd><p>
       Description: The debug subtree invariants (for developers only).
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd></dl></div></section><section class="sect2" id="troubleshooting-rados-gateway" data-id-title="RADOS gateway (RGW)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.6 </span><span class="title-name">RADOS gateway (RGW)</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-rados-gateway">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.4.12.8.2.1"><span class="term"><code class="literal">rgw log nonexistent bucket</code></span></dt><dd><p>
       Description: Should we log a non-existent buckets?
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.8.2.2"><span class="term"><code class="literal">rgw log object name</code></span></dt><dd><p>
       Description: Should an object’s name be logged. // man date to see
       codes (a subset are supported)
      </p><p>
       Type: String
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">%Y-%m-%d-%H-%i-%n</code>
      </p></dd><dt id="id-1.5.4.12.8.2.3"><span class="term"><code class="literal">rgw log object name utc</code></span></dt><dd><p>
       Description: Object log name contains UTC?
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.8.2.4"><span class="term"><code class="literal">rgw enable ops log</code></span></dt><dd><p>
       Description: Enables logging of every RGW operation.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">true</code>
      </p></dd><dt id="id-1.5.4.12.8.2.5"><span class="term"><code class="literal">rgw enable usage log</code></span></dt><dd><p>
       Description: Enable logging of RGW’s bandwidth usage.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd><dt id="id-1.5.4.12.8.2.6"><span class="term"><code class="literal">rgw usage log flush threshold</code></span></dt><dd><p>
       Description: Threshold to flush pending log data.
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 1024
      </p></dd><dt id="id-1.5.4.12.8.2.7"><span class="term"><code class="literal">rgw usage log tick interval</code></span></dt><dd><p>
       Description: Flush pending log data every s seconds.
      </p><p>
       Type: Integer
      </p><p>
       Required: No
      </p><p>
       Default: 30
      </p></dd><dt id="id-1.5.4.12.8.2.8"><span class="term"><code class="literal">rgw intent log object name</code></span></dt><dd><p>
       Description:
      </p><p>
       Type: String
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">%Y-%m-%d-%i-%n</code>
      </p></dd><dt id="id-1.5.4.12.8.2.9"><span class="term"><code class="literal">rgw intent log object name utc</code></span></dt><dd><p>
       Description: Include a UTC timestamp in the intent log object name.
      </p><p>
       Type: Boolean
      </p><p>
       Required: No
      </p><p>
       Default: <code class="literal">false</code>
      </p></dd></dl></div></section></section><section class="sect1" id="logging-kernelrbd-cephfs-clients" data-id-title="Logging kernel RBD and CephFS clients"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.6 </span><span class="title-name">Logging kernel RBD and CephFS clients</span></span> <a title="Permalink" class="permalink" href="#logging-kernelrbd-cephfs-clients">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The RBD and CephFS kernel clients provide means to enable runtime logging
   that allow low-level debugging. However, the performance penalty may be
   high, which is why dynamic debugging is turned off by default. Also,
   analysing these logs requires comparing them with the kernel source code.
  </p><p>
   For example, to see the debug messages related with CephFS snapshot
   handling, you could try the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "file fs/ceph/snap.c +pf" &gt; /sys/kernel/debug/dynamic_debug/control</pre></div><p>
   The kernel logs would now include any debug messages in file
   <code class="filename">fs/ceph/snap.c</code>. In order to disable dynamic debugging:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "file fs/ceph/snap.c -p" &gt; /sys/kernel/debug/dynamic_debug/control</pre></div></section><section class="sect1" id="logging-service-daemons-events" data-id-title="Per-service and per-daemon events"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.7 </span><span class="title-name">Per-service and per-daemon events</span></span> <a title="Permalink" class="permalink" href="#logging-service-daemons-events">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In order to simplify debugging failed daemon deployments, cephadm stores
   events on a per-service and per-daemon basis. To view the list of events for
   a specific <span class="emphasis"><em>service</em></span>, run the following example command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch ls --service_name=<em class="replaceable">alertmanager</em> --format yaml
  service_type: alertmanager
  service_name: alertmanager
  placement:
    hosts:
    - unknown_host
[...]
  events:
  - 2021-02-01T08:58:02.741162 service:alertmanager [INFO] "service was created"
  - 2021-02-01T12:09:25.264584 service:alertmanager [ERROR] "Failed to apply: \
   Cannot place &lt;AlertManagerSpec for service_name=alertmanager&gt; on \
   unknown_host: Unknown hosts"'</pre></div><p>
   As opposed to a specific service, to view the list of events for a specific
   <span class="emphasis"><em>daemon</em></span>, for example, run the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch ceph --service-type <em class="replaceable">mds</em> \
 --daemon-id=<em class="replaceable">hostname.ppdhsz</em> --format yaml
  daemon_type: mds
  daemon_id: cephfs.hostname.ppdhsz
  hostname: hostname
[...]
  events:
  - 2021-02-01T08:59:43.845866 daemon:mds.cephfs.hostname.ppdhsz [INFO] \
   "Reconfigured mds.cephfs.hostname.ppdhsz on host 'hostname'"</pre></div></section><section class="sect1" id="troubleshooting-gdb-core-dump" data-id-title="Debugging a crashing process running in a container"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.8 </span><span class="title-name">Debugging a crashing process running in a container</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-gdb-core-dump">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_logging.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When a process is crashing, it is useful to find out the reason why it is
   crashing. If the <code class="systemitem">systemd-coredump</code>
   service is active, a dump of the memory of the crashing process—also
   referred to as <span class="emphasis"><em>core dump</em></span>—is created. It is then
   possible to attach the <code class="command">gdb</code> debugger to the dump and
   inspect the cause of the crash.
  </p><p>
   The following procedure illustrates attaching the <code class="command">gdb</code>
   debugger to a crashing OSD process. Run the commands in this example on the
   host where the crashing process is running.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Verify that the <code class="systemitem">systemd-coredump</code>
     service is started and start it if needed:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start systemd-coredump.socket</pre></div><p>
     Core dump files will be located under the
     <code class="filename">/var/lib/systemd/coredump</code> directory. In this example,
     the core dump file to be inspected is
    </p><div class="verbatim-wrap"><pre class="screen">/var/lib/systemd/coredump/core.ceph-osd.167.055db41886e04e5e9822dcb5ad3c2aab.48529.1657718534000000.zst</pre></div></li><li class="step"><p>
     Verify that the <code class="command">strings</code> and <code class="command">unzstd</code>
     commands are installed. If not, install them by running the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install binutils unzstd</pre></div></li><li class="step"><p>
     Identify the name of the container with the crashing process:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> unzstd /var/lib/systemd/coredump/core.ceph-osd.167.055db41886e04e5e9822dcb5ad3c2aab.48529.1657718534000000.zst
<code class="prompt user">&gt; </code>strings -a /var/lib/systemd/coredump/core.ceph-osd.167.055db41886e04e5e9822dcb5ad3c2aab.48529.1657718534000000 | grep CONTAINER_IMAGE
CONTAINER_IMAGE=registry.suse.de/devel/storage/7.0/pacific/containers/ses/7.1/ceph/ceph@sha256:5d99dbf24e01ebd5319549d4db372113892c57f2d53fbb0363e0781a8c1c09e6</pre></div></li><li class="step"><p>
     Run the identified container:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> podman run -it -v /var/lib/systemd/coredump:/mnt/coredump \
 registry.suse.de/devel/storage/7.0/pacific/containers/ses/7.1/ceph/ceph@sha256:5d99dbf24e01ebd5319549d4db372113892c57f2d53fbb0363e0781a8c1c09e6</pre></div></li><li class="step"><p>
     Add a repository for packages with debugging information and install them
     together with the <span class="package">gdb</span> package:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper ar http://download.nue.suse.com/ibs/SUSE/Products/Storage/7.1/x86_64/product_debug/ debug
<code class="prompt user">&gt; </code><code class="command">sudo</code> zypper ref
<code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install gdb ceph-base-debuginfo ceph-debugsource ceph-common-debuginfo</pre></div></li><li class="step"><p>
     Attach <code class="systemitem">gdb</code> to the unpacked core dump:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cd /mnt/coredump
<code class="prompt user">&gt; </code>gdb /usr/bin/ceph-osd \
 core.ceph-osd.167.055db41886e04e5e9822dcb5ad3c2aab.48529.165771853400000</pre></div></li></ol></div></div></section></section><section class="chapter" id="bp-troubleshooting-cephadm" data-id-title="Troubleshooting cephadm"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Troubleshooting cephadm</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  As cephadm deploys daemons as containers, troubleshooting daemons is
  slightly different. Here are a few tools and commands to help investigating
  issues.
 </p><section class="sect1" id="bp-troubleshooting-cephadm-pause-disable" data-id-title="Pausing or disabling cephadm"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.1 </span><span class="title-name">Pausing or disabling cephadm</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-pause-disable">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If something goes wrong and cephadm is behaving in a way you do not like,
   you can pause most background activity by executing the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch pause</pre></div><p>
   This will stop any changes, but cephadm will still periodically check
   hosts to refresh its inventory of daemons and devices. You can disable
   cephadm completely with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch set backend ''
<code class="prompt user">cephuser@adm &gt; </code>ceph mgr module disable cephadm</pre></div><p>
   This disables all of the <code class="command">ceph orch ...</code> CLI commands but
   the previously deployed daemon containers will continue to exist and start
   as they did before.
  </p></section><section class="sect1" id="bp-troubleshooting-cephadm-check-logs" data-id-title="Checking cephadm logs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.2 </span><span class="title-name">Checking cephadm logs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-check-logs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can monitor the cephadm log in real time:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph -W cephadm</pre></div><p>
   To view the last few messages, execute:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph log last cephadm</pre></div></section><section class="sect1" id="bp-troubleshooting-cephadm-logs" data-id-title="Accessing Ceph daemon logs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.3 </span><span class="title-name">Accessing Ceph daemon logs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-logs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   SUSE Enterprise Storage 7.1 supports Ceph logging via systemd-journald.
   To access the logs of Ceph daemons in SUSE Enterprise Storage 7.1,
   follow the instructions below.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Use the <code class="command">ceph orch ps</code> command (or <code class="command">ceph orch ps
     <em class="replaceable">node_name</em></code> or <code class="command">ceph orch ps
     --daemon-type <em class="replaceable">daemon_type</em></code>) to find
     the cephadm name of the daemon where the host is running.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch ps --daemon-type <em class="replaceable">DAEMON_TYPE_NAME</em></pre></div><p>
     For example, if you want to view the logs for Prometheus, run the
     following command to find the name of the daemon:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch ps --daemon-type prometheus
NAME               HOST    STATUS         REFRESHED  AGE  VERSION  IMAGE NAME                                                   IMAGE ID      CONTAINER ID
prometheus.main    main    running (65m)  7m ago     2h   2.32.1   registry.suse.com/ses/7.1/ceph/prometheus-server:2.32.1  e77db6e75e78  7b11062150ab</pre></div><p>
     In this example, <code class="literal">prometheus.main</code> is the name and the
     host is <code class="literal">main</code>.
    </p></li><li class="step"><p>
     To view the daemon's logs, execute the following on the host where the
     daemon is running:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm logs --name <em class="replaceable">DAEMON_NAME</em></pre></div><p>
     For example, to view the Prometheus logs from above:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm logs --name prometheus.main</pre></div></li></ol></div></div></section><section class="sect1" id="bp-troubleshooting-cephadm-systemctl" data-id-title="Collecting systemd status"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.4 </span><span class="title-name">Collecting <code class="literal">systemd</code> status</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-systemctl">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To print the state of a <code class="literal">systemd</code> unit, run:
  </p><div class="verbatim-wrap"><pre class="screen">systemctl status "ceph-$(cephadm shell ceph fsid)@<em class="replaceable">service name</em>.service";</pre></div><p>
   To fetch all state of all daemons of a given host, run:
  </p><div class="verbatim-wrap"><pre class="screen">  fsid="$(cephadm shell ceph fsid)"
  for name in $(cephadm ls | jq -r '.[].name') ; do
    systemctl status "ceph-$fsid@$name.service" &gt; $name;
  done</pre></div></section><section class="sect1" id="bp-troubleshooting-cephadm-configured-container-images" data-id-title="Listing configured container images"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.5 </span><span class="title-name">Listing configured container images</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-configured-container-images">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   cephadm has a set of container images configured by default.
  </p><p>
   To get the value of the configured default container:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config get mgr mgr/cephadm/<em class="replaceable">OPTION_NAME</em></pre></div><p>
   Where <em class="replaceable">OPTION_NAME</em> is any of the following names:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     container_image_base
    </p></li><li class="listitem"><p>
     container_image_prometheus
    </p></li><li class="listitem"><p>
     container_image_node_exporter
    </p></li><li class="listitem"><p>
     container_image_alertmanager
    </p></li><li class="listitem"><p>
     container_image_grafana
    </p></li><li class="listitem"><p>
     container_image_haproxy
    </p></li><li class="listitem"><p>
     container_image_keepalived
    </p></li></ul></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config get mgr mgr/cephadm/container_image_base \
 registry.suse.com/ses/7.1/ceph/ceph</pre></div><div id="id-1.5.5.8.9" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    <code class="literal">mgr/cephadm/container_image_base</code> is the default Ceph
    container image used by all services except the monitoring stack and the ingress stack.
   </p></div></section><section class="sect1" id="bp-troubleshooting-cephadm-downloaded-container-images" data-id-title="Listing all downloaded container images"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.6 </span><span class="title-name">Listing all downloaded container images</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-downloaded-container-images">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To list all container images that are downloaded on a host:
  </p><div id="id-1.5.5.9.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    <code class="literal">Image</code> may also be called <code class="literal">ImageID</code>.
   </p></div><div class="verbatim-wrap"><pre class="screen">  podman ps -a --format json | jq '.[].Image'
  "docker.io/library/centos:8"
  "registry.opensuse.org/opensuse/leap:15.2"</pre></div></section><section class="sect1" id="bp-troubleshooting-cephadm-manual" data-id-title="Running containers manually"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.7 </span><span class="title-name">Running containers manually</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephadm-manual">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   cephadm writes small wrappers that run a containers. Refer to
   <code class="filename">/var/lib/ceph/<em class="replaceable">cluster-fsid</em>/<em class="replaceable">service-name</em>/unit.run</code>
   for the container execution command.
  </p><section class="sect2" id="bp-troubleshooting-ssh-errors" data-id-title="Assessing SSH errors"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.7.1 </span><span class="title-name">Assessing SSH errors</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-ssh-errors">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you receive the following error:
   </p><div class="verbatim-wrap"><pre class="screen">xxxxxx.gateway_bootstrap.HostNotFound: -F /tmp/cephadm-conf-kbqvkrkw root@10.10.1.2
raise OrchestratorError('Failed to connect to %s (%s).  Check that the host is reachable and accepts  connections using the cephadm SSH key' % (host, addr)) from
orchestrator._interface.OrchestratorError: Failed to connect to 10.10.1.2 (10.10.1.2).  Check that the host is reachable and accepts connections using the cephadm SSH key</pre></div><p>
    You can verify the issue by trialing a few different options.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Ensure cephadm has an SSH identity key:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cephadm shell -- ceph config-key get mgr/cephadm/ssh_identity_key &gt; key
INFO:cephadm:Inferring fsid f8edc08a-7f17-11ea-8707-000c2915dd98
INFO:cephadm:Using recent ceph image docker.io/ceph/ceph:v15 obtained 'mgr/cephadm/ssh_identity_key'
<code class="prompt user">root@master # </code>chmod 0600 key</pre></div><p>
      If this fails, cephadm does not have a key. Fix this by running the
      following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cephadm shell -- ceph cephadm generate-ssh-key</pre></div><p>
      Or:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cat key | cephadm shell -- ceph cephadm set-ssk-key -i -</pre></div></li><li class="listitem"><p>
      Ensure that the SSH config is correct:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cephadm shell -- ceph cephadm get-ssh-config &gt; config</pre></div></li><li class="listitem"><p>
      Verify the connection to the host:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>ssh -F config -i key root@mon1</pre></div></li></ul></div></section><section class="sect2" id="bp-troubleshooting-verify-pubkey" data-id-title="Verifying public key is in authorized_keys"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.7.2 </span><span class="title-name">Verifying public key is in <code class="filename">authorized_keys</code></span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-verify-pubkey">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To verify that the public key is in the
    <code class="filename">authorized_keys</code> file, run the following commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cephadm shell -- ceph config-key get mgr/cephadm/ssh_identity_pub &gt; key.pub
<code class="prompt user">root@master # </code>grep "`cat key.pub`"  /root/.ssh/authorized_keys</pre></div></section></section><section class="sect1" id="bp-troubleshooting-cidr-error" data-id-title="Failing to infer CIDR network error"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.8 </span><span class="title-name">Failing to infer CIDR network error</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cidr-error">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you see one of the following errors:
  </p><div class="verbatim-wrap"><pre class="screen">ERROR: Failed to infer CIDR network for mon ip ***; pass --skip-mon-network to configure it later</pre></div><p>
   or
  </p><div class="verbatim-wrap"><pre class="screen">Must set public_network config option or specify a CIDR network, ceph addrvec, or plain IP</pre></div><p>
   You need to specify a subnet for Ceph Monitors:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mon public_network <em class="replaceable">MON_NETWORK</em></pre></div></section><section class="sect1" id="bp-troubleshooting-admin-socket" data-id-title="Accessing the admin socket"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.9 </span><span class="title-name">Accessing the admin socket</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-admin-socket">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Each Ceph daemon provides an admin socket that bypasses the MONs. To
   access the admin socket, enter the daemon container on the host:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>cephadm enter --name <em class="replaceable">daemon-name</em>
<code class="prompt user">root@master # </code>ceph --admin-daemon /var/run/ceph/ceph-<em class="replaceable">daemon-name</em>.asok config show</pre></div></section><section class="sect1" id="bp-troubleshooting-manual-deploy-mgr" data-id-title="Deploying a Ceph Manager manually"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.10 </span><span class="title-name">Deploying a Ceph Manager manually</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-manual-deploy-mgr">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the following steps to deploy a new Ceph Manager on a host.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Disable the cephadm scheduler, in order to prevent cephadm from
     removing the new Ceph Manager:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/pause true</pre></div></li><li class="step"><p>
     Create the auth entry:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth create <em class="replaceable">DAEMON_NAME</em> mon "profile mgr" osd "allow *" mds "allow *"</pre></div><p>
     If you already have an auth entry, you can get the entry with the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get <em class="replaceable">DAEMON_NAME</em> mon "profile mgr" osd "allow *" mds "allow *"</pre></div></li><li class="step"><p>
     Generate the <code class="filename">ceph.conf</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config generate-minimal-conf</pre></div></li><li class="step"><p>
     Get the container image:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config get "<em class="replaceable">DAEMON_NAME</em>" container_image</pre></div></li><li class="step"><p>
     Create the config json:
    </p><div class="verbatim-wrap"><pre class="screen">cat config-json.json
{
"config": "# minimal ceph.conf for 8255263a-a97e-4934-822c-00bfe029b28f\n[global]\n\tfsid = 8255263a-a97e-4934-822c-00bfe029b28f\n\tmon_host = [v2:192.168.178.28:40483/0,v1:192.168.178.28:40484/0]\n",
"keyring": "[mgr.hostname.smfvfd]\n\tkey = AQDSb0ZfJqfDNxAAhgAVuH8Wg0yaRUAHwXdTQA==\n"
}</pre></div></li><li class="step"><p>
     Deploy the daemon:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm --image <em class="replaceable">container-image</em> deploy --fsid <em class="replaceable">fsid</em> --name <em class="replaceable">DAEMON_NAME</em> --config-json config-json.json --tcp-ports 42483</pre></div></li></ol></div></div></section><section class="sect1" id="bp-troubleshooting-ptfs" data-id-title="Distributing a program temporary fix (PTF)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.11 </span><span class="title-name">Distributing a program temporary fix (PTF)</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-ptfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Occasionally, in order to fix a given issue, SUSE will provide a set of
   packages known as a Program Temporary Fix (PTF). Such a PTF is fully
   supported by SUSE until the Maintenance Update (MU) containing a permanent
   fix has been released via the regular update repositories. Customers running
   PTF fixes will be notified through the related Service Request when a
   permanent patch for a PTF has been released.
  </p><p>
   PTFs are published on the <code class="literal">registry.suse.com</code> server
   through a path similar to:
  </p><div class="verbatim-wrap"><pre class="screen">registry.suse.com/ptf/<em class="replaceable">PTF_NUMBER</em>/ses/7.1/ceph/ceph:PTF-<em class="replaceable">PTF_NUMBER</em></pre></div><p>
   The following steps describe how to deploy PTF images on an existing Ceph
   cluster:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Note the <em class="replaceable">PTF_NUMBER</em> used in the L3 PTF process.
    </p></li><li class="step"><p>
     Determine the Ceph Monitor key that corresponds to the relevant service:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth ls | grep <em class="replaceable">DAEMON_TYPE</em></pre></div></li><li class="step"><p>
     Receive the PTF:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman pull \
registry.suse.com/ptf/<em class="replaceable">PTF_NUMBER</em>/ses/7.1/ceph/ceph:PTF-<em class="replaceable">PTF_NUMBER</em></pre></div></li><li class="step"><p>
     Verify that the PTF is listed:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman image ls</pre></div></li><li class="step"><p>
     Set the PTF image for the relevant service, for example, iSCSI:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set <em class="replaceable">client.iscsi</em> container_image \
registry.suse.com/ptf/<em class="replaceable">PTF_NUMBER</em>/ses/7.1/ceph/ceph:PTF-<em class="replaceable">PTF_NUMBER</em></pre></div></li><li class="step"><p>
     Remove the specific iSCSI daemon that is causing problems, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon rm iscsi.igw.sesblade16.zkomeh</pre></div></li><li class="step"><p>
     The removed daemon will be deployed automatically using the PTF.
    </p></li></ol></div></div><div id="id-1.5.5.14.7" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
    If you plan to run the <code class="command">ceph-salt update</code> command after
    applying a PTF (as described in <span class="intraxref">Book “Administration and Operations Guide”, Chapter 13 “Operational tasks”, Section 13.6.4 “Running the update”</span>),
    it will not affect the manual changes made by the temporary fix.
   </p><p>
    Conversely, running the <code class="command">ceph orch upgrade</code> command (see
    <span class="intraxref">Book “Administration and Operations Guide”, Chapter 13 “Operational tasks”, Section 13.7.1 “Starting the update”</span>) will upgrade
    daemons manually deployed by the PTF.
   </p></div></section><section class="sect1" id="bp-troubleshooting-adding-hosts" data-id-title="Failure When Adding Hosts with cephadm"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.12 </span><span class="title-name">Failure When Adding Hosts with cephadm</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-adding-hosts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When cephadm fails to add a new cluster host—no matter whether by
   means of <code class="systemitem">ceph-salt</code> (see <span class="intraxref">Book “Deployment Guide”, Chapter 7 “Deploying the bootstrap cluster using <code class="systemitem">ceph-salt</code>”, Section 7.2.2 “Adding Salt Minions”</span>)
   or manually using the <code class="command">ceph orch host add</code>
   command—you can diagnose the reason for failure. The failure message
   has the following pattern:
  </p><div class="verbatim-wrap"><pre class="screen">Failed to connect to <em class="replaceable">HOSTNAME</em> (<em class="replaceable">FQDN</em>).</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add node5.example.com
Failed to connect to node5 (node5.example.com).</pre></div><p>
   If the message includes a fully qualified domain name (FQDN,
   <code class="literal">node5.example com</code> in our example) as the
   <em class="replaceable">HOSTNAME</em>, try adding the host using its FQDN:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add node5.example.com</pre></div><p>
   If the message includes a short host name (<code class="literal">node5</code> in our
   example) as the <em class="replaceable">HOSTNAME</em>, try adding the host
   using both its short name and FQDN:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add node5 node5.example.com</pre></div><p>
   If either of the previous two commands succeed, <code class="systemitem">ceph-salt</code> is probably
   causing the problem. Otherwise, try adding the host using its short host
   name and IP address:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add node5 192.168.2.102</pre></div><p>
   If this succeeds, the cluster does not have proper name resolution. Refer to
   <span class="intraxref">Book “Deployment Guide”, Chapter 5 “Installing and configuring SUSE Linux Enterprise Server”</span> for more details.
  </p><div id="id-1.5.5.15.13" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    For more information about resolving full and bare host names via DNS,
    refer to
    <a class="link" href="https://docs.ceph.com/en/octopus/cephadm/concepts/" target="_blank">https://docs.ceph.com/en/octopus/cephadm/concepts/</a>.
   </p></div></section><section class="sect1" id="bp-troubleshooting-unmanaged-daemons" data-id-title="Disabling automatic deployment of daemons"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.13 </span><span class="title-name">Disabling automatic deployment of daemons</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-unmanaged-daemons">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephadm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default, Ceph daemons are automatically deployed to new hosts after you
   add these hosts to the placement specification and apply it (refer to
   <span class="intraxref">Book “Deployment Guide”, Chapter 8 “Deploying the remaining core services using cephadm”</span> for more details).
  </p><p>
   If you need to disable the automated deployment of Ceph daemons, add
   <code class="literal">unmanaged: true</code> to its specification file and apply it,
   for example:
  </p><div class="verbatim-wrap"><pre class="screen">cat mgr.yaml
service_type: mgr
unmanaged: true
placement:
  label: mgr
[...]

<code class="prompt user">cephuser@adm &gt; </code>ceph orch apply -i mgr.yaml</pre></div><p>
   After applying this specification, cephadm will no longer deploy any new
   daemons on hosts that match the placement specification.
  </p><p>
   To manually deploy a daemon on a new host, run:
  </p><div class="verbatim-wrap"><pre class="screen">ceph orch daemon add <em class="replaceable">DAEMON_TYPE</em> --placement=<em class="replaceable">PLACEMENT_SPEC</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon add mgr --placement=ses-node3</pre></div><p>
   To manually remove a daemon, run:
  </p><div class="verbatim-wrap"><pre class="screen">ceph orch daemon rm <em class="replaceable">DAEMON_NAME</em> [--force]</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon rm mgr.ses-node3.xietsy</pre></div></section></section><section class="chapter" id="bp-troubleshooting-osds" data-id-title="Troubleshooting OSDs"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Troubleshooting OSDs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-osds">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Before troubleshooting your OSDs, check your monitors and network first. If
  you execute <code class="command">ceph health</code> or <code class="command">ceph -s</code> on
  the command line and Ceph returns a health status, it means that the
  monitors have a quorum. If you do not have a monitor quorum or if there are
  errors with the monitor status, see
  <a class="xref" href="#bp-troubleshooting-monitors" title="Chapter 6. Troubleshooting Ceph Monitors and Ceph Managers">Chapter 6, <em>Troubleshooting Ceph Monitors and Ceph Managers</em></a>. Check your networks to ensure
  they are running properly, because networks may have a significant impact on
  OSD operation and performance.
 </p><section class="sect1" id="bp-troubleshooting-osd-data" data-id-title="Obtain OSD data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Obtain OSD data</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-osd-data">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To begin troubleshooting the OSDs, obtain any information including the
   information collected from <span class="intraxref">Book “Administration and Operations Guide”, Chapter 12 “Determine the cluster state”, Section 12.9 “Monitoring OSDs and placement groups”</span>.
  </p><section class="sect2" id="troubleshooting-ceph-logs" data-id-title="Finding Ceph logs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.1 </span><span class="title-name">Finding Ceph logs</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-ceph-logs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you have not changed the default path, you can find Ceph log files at
    <code class="filename">/var/log/ceph</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ls /var/log/ceph</pre></div><p>
    If you do not get enough detail, change your logging level. See
    <a class="xref" href="#bp-troubleshooting-logging" title="Chapter 2. Troubleshooting logging and debugging">Chapter 2, <em>Troubleshooting logging and debugging</em></a> for more information.
   </p></section><section class="sect2" id="troubleshooting-admin-socket" data-id-title="Using the admin socket tool"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.2 </span><span class="title-name">Using the admin socket tool</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-admin-socket">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the admin socket tool to retrieve runtime information. For details,
    list the sockets for your Ceph processes:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ls /var/run/ceph</pre></div><p>
    Execute the following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon <em class="replaceable">DAEMON-NAME</em> help</pre></div><p>
    Alternatively, specify a <code class="literal">SOCKET-FILE</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon <em class="replaceable">SOCKET-FILE</em> help</pre></div><p>
    The admin socket, among other things, allows you to:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      List your configuration at runtime
     </p></li><li class="listitem"><p>
      Dump historic operations
     </p></li><li class="listitem"><p>
      Dump the operation priority queue state
     </p></li><li class="listitem"><p>
      Dump operations in flight
     </p></li><li class="listitem"><p>
      Dump perfcounters
     </p></li></ul></div></section><section class="sect2" id="troubleshooting-display-freespace" data-id-title="Displaying freespace"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.3 </span><span class="title-name">Displaying freespace</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-display-freespace">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Filesystem issues may arise. To display your file system’s free space,
    execute <code class="command">df</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>df -h</pre></div><p>
    Execute <code class="command">df --help</code> for additional usage.
   </p></section><section class="sect2" id="troubleshooting-admin-statistics" data-id-title="Identifying I/O statistics"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.4 </span><span class="title-name">Identifying I/O statistics</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-admin-statistics">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use iostat to identify I/O-related issues.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>iostat -x</pre></div></section><section class="sect2" id="troubleshooting-admin-diagnostic" data-id-title="Retrieving diagnostic messages"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.5 </span><span class="title-name">Retrieving diagnostic messages</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-admin-diagnostic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To retrieve diagnostic messages, use <code class="command">dmesg</code> with
    <code class="option">less</code>, <code class="option">more</code>, <code class="option">grep</code> or
    <code class="option">tail</code>. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>dmesg | grep scsi</pre></div></section></section><section class="sect1" id="bp-troubleshooting-rebalancing" data-id-title="Stopping without rebalancing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Stopping without rebalancing</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-rebalancing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Periodically you may need to perform maintenance on a subset of your cluster
   or resolve a problem that affects a failure domain. If you do not want CRUSH
   to automatically rebalance the cluster as you stop OSDs for maintenance, set
   the cluster to <code class="option">noout</code> first:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set noout</pre></div><p>
   Once the cluster is set to <code class="option">noout</code>, you can begin stopping
   the OSDs within the failure domain that requires maintenance work:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon stop osd.<em class="replaceable">ID</em></pre></div><div id="id-1.5.6.5.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    Placement groups within the OSDs you stop will become degraded while you
    are addressing issues with within the failure domain.
   </p></div><p>
   Once you have completed your maintenance, restart the OSDs:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon start osd.<em class="replaceable">ID</em></pre></div><p>
   Finally, unset the cluster from <code class="option">noout</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd unset noout</pre></div></section><section class="sect1" id="bp-troubleshooting-not-running" data-id-title="OSDs not running"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.3 </span><span class="title-name">OSDs not running</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-not-running">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Under normal circumstances, restarting the <code class="literal">ceph-osd</code>
   daemon will allow it to rejoin the cluster and recover. If this is not true,
   continue on to the next section.
  </p><section class="sect2" id="troubleshooting-osd-start" data-id-title="An OSD will not start"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.1 </span><span class="title-name">An OSD will not start</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-osd-start">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If an OSD will not start when you start your cluster and you are unable to
    determine the reason, we recommend generating a supportconfig and open a
    support ticket. For more information, see
    <a class="link" href="https://scc.suse.com/docs/help#submit-support-case" target="_blank"><em class="citetitle">How
    do I submit a support case?</em></a>
   </p></section><section class="sect2" id="troubleshooting-osd-fail" data-id-title="Failing OSD"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.2 </span><span class="title-name">Failing OSD</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-osd-fail">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When a <code class="literal">ceph-osd</code> process dies, the monitor learns about
    the failure from surviving <code class="literal">ceph-osd</code> daemons and reports
    it via the <code class="command">ceph health</code> command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health
HEALTH_WARN 1/3 in osds are down</pre></div><p>
    A warning displays whenever there are <code class="literal">ceph-osd</code> processes
    that are marked <code class="option">in</code> and <code class="option">down</code>. Identify
    which <code class="literal">ceph-osd</code>s are down with:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
HEALTH_WARN 1/3 in osds are down
osd.0 is down since epoch 23, last address 192.168.106.220:6800/11080</pre></div><p>
    If there is a disk failure or other fault preventing
    <code class="literal">ceph-osd</code> from functioning or restarting, an error
    message should be present in its log file. You can monitor the cephadm
    log in real time with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph -W cephadm</pre></div><p>
    You can view the last few messages with:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph log last cephadm</pre></div><p>
    If the daemon stopped because of a heartbeat failure, the underlying kernel
    file system may be unresponsive. Check <code class="command">dmesg</code> output for
    disk or other kernel errors.
   </p></section><section class="sect2" id="troubleshooting-osd-space" data-id-title="Preventing write action to OSD"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.3 </span><span class="title-name">Preventing write action to OSD</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-osd-space">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Ceph prevents writing to a full OSD so that you do not lose data. In an
    operational cluster, you should receive a warning when your cluster is
    getting near its full ratio. The <code class="literal">mon osd full ratio</code>
    defaults to 0.95, or 95% of capacity before it stops clients from writing
    data. The <code class="literal">mon osd backfillfull ratio</code> defaults to 0.90,
    or 90% of capacity when it blocks backfills from starting. The OSD nearfull
    ratio defaults to 0.85, or 85% of capacity when it generates a health
    warning. Change this using the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-nearfull-ratio &lt;float[0.0-1.0]&gt;</pre></div><p>
    Full cluster issues usually arise when testing how Ceph handles an OSD
    failure on a small cluster. When one node has a high percentage of the
    cluster’s data, the cluster can easily eclipse its nearfull and full
    ratio immediately. If you are testing how Ceph reacts to OSD failures on
    a small cluster, you should leave ample free disk space and consider
    temporarily lowering the OSD <code class="option">full ratio</code>, OSD
    <code class="option">backfillfull</code> ratio and OSD <code class="option">nearfull</code> ratio
    using these commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-nearfull-ratio &lt;float[0.0-1.0]&gt;
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-full-ratio &lt;float[0.0-1.0]&gt;
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-backfillfull-ratio &lt;float[0.0-1.0]&gt;</pre></div><p>
    Full <code class="literal">ceph-osds</code> will be reported by <code class="command">ceph
    health</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health
  HEALTH_WARN 1 nearfull osd(s)</pre></div><p>
    Or:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
  HEALTH_ERR 1 full osd(s); 1 backfillfull osd(s); 1 nearfull osd(s)
  osd.3 is full at 97%
  osd.4 is backfill full at 91%
  osd.2 is near full at 87%</pre></div><p>
    We recommend adding new <code class="literal">ceph-osds</code> to deal with a full
    cluster, allowing the cluster to redistribute data to the newly available
    storage. If you cannot start an OSD because it is full, you may delete some
    data by deleting some placement group directories in the full OSD.
   </p><div id="id-1.5.6.6.5.11" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     If you choose to delete a placement group directory on a full OSD, do not
     delete the same placement group directory on another full OSD, or you may
     loose data. You must maintain at least one copy of your data on at least
     one OSD.
    </p></div></section></section><section class="sect1" id="bp-troubleshooting-osd-slow" data-id-title="Unresponsive or slow OSDs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.4 </span><span class="title-name">Unresponsive or slow OSDs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-osd-slow">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A commonly recurring issue involves slow or unresponsive OSDs. Ensure that
   you have eliminated other troubleshooting possibilities before delving into
   OSD performance issues. For example, ensure that your network(s) is working
   properly and your OSDs are running. Check to see if OSDs are throttling
   recovery traffic.
  </p><section class="sect2" id="troubleshooting-bad-sector" data-id-title="Identifying bad sectors and fragmented disks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.1 </span><span class="title-name">Identifying bad sectors and fragmented disks</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-bad-sector">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Check your disks for bad sectors and fragmentation. This can cause total
    throughput to drop substantially.
   </p></section><section class="sect2" id="troubleshooting-monitor-osd" data-id-title="Co-resident monitors and OSDs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.2 </span><span class="title-name">Co-resident monitors and OSDs</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-monitor-osd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Monitors are generally light-weight processes but often perform fsync().
    This can interfere with other workloads, particularly if monitors run on
    the same drive as the OSDs. Additionally, if you run monitors on the same
    host as the OSDs, you may incur performance issues related to:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Running an older kernel (pre-3.0)
     </p></li><li class="listitem"><p>
      Running a kernel with no syncfs(2) syscall.
     </p></li></ul></div><p>
    In these cases, multiple OSDs running on the same host can drag each other
    down by doing lots of commits. That often leads to the bursty writes.
   </p></section><section class="sect2" id="troubleshooting-coresident-process" data-id-title="Co-resident processes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.3 </span><span class="title-name">Co-resident processes</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-coresident-process">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Spinning up co-resident processes such as a cloud-based solution, virtual
    machines and other applications that write data to Ceph while operating
    on the same hardware as OSDs can introduce significant OSD latency. We
    recommend optimizing a host for use with Ceph and using other hosts for
    other processes. The practice of separating Ceph operations from other
    applications may help improve performance and may streamline
    troubleshooting and maintenance.
   </p></section><section class="sect2" id="troubleshooting-log-levels" data-id-title="Logging levels"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.4 </span><span class="title-name">Logging levels</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-log-levels">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you turned logging levels up to track an issue and then forgot to turn
    logging levels back down, the OSD may be putting a lot of logs onto the
    disk. If you intend to keep logging levels high, you may consider mounting
    a drive to the default path for logging. For example,
    <code class="filename">/var/log/ceph/$cluster-$name.log</code>.
   </p></section><section class="sect2" id="troubleshooting-recovery" data-id-title="Recovery throttling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.5 </span><span class="title-name">Recovery throttling</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-recovery">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Depending upon your configuration, Ceph may reduce recovery rates to
    maintain performance or it may increase recovery rates to the point that
    recovery impacts OSD performance. Check to see if the OSD is recovering.
   </p></section><section class="sect2" id="troubleshooting-kernel-version" data-id-title="Kernel version"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.6 </span><span class="title-name">Kernel version</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-kernel-version">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Check the kernel version you are running. Older kernels may not receive new
    backports that Ceph depends upon for better performance.
   </p></section><section class="sect2" id="troubleshooting-kernal-issues" data-id-title="Kernel issues with syncfs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.7 </span><span class="title-name">Kernel issues with syncfs</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-kernal-issues">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Try running one OSD per host to see if performance improves. Old kernels
    might not have a recent enough version of glibc to support
    <code class="command">syncfs(2)</code>.
   </p></section><section class="sect2" id="troubleshooting-filesystem-issues" data-id-title="Filesystem issues"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.8 </span><span class="title-name">Filesystem issues</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-filesystem-issues">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Currently, we recommend deploying clusters with XFS.
   </p></section><section class="sect2" id="troubleshooting-ram" data-id-title="Insufficient RAM"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.9 </span><span class="title-name">Insufficient RAM</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-ram">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    We recommend 1.5 GB of RAM per TB of raw OSD capacity for each Object
    Storage Node. You may notice that during normal operations, the OSD only
    uses a fraction of that amount. Unused RAM makes it tempting to use the
    excess RAM for co-resident applications, VMs and so forth. However, when
    OSDs go into recovery mode, their memory utilization spikes. If there is no
    RAM available, the OSD performance will slow considerably.
   </p></section><section class="sect2" id="troubleshooting-requests" data-id-title="Complaining about old or slow requests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.10 </span><span class="title-name">Complaining about old or slow requests</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-requests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If a <code class="literal">ceph-osd</code> daemon is slow to respond to a request,
    log messages will generate complaining about requests that are taking too
    long. The warning threshold defaults to 30 seconds, and is configurable via
    the <code class="option">osd op complaint time</code> option. When this happens, the
    cluster log receives messages. Legacy versions of Ceph complain about old
    requests:
   </p><div class="verbatim-wrap"><pre class="screen">osd.0 192.168.106.220:6800/18813 312 : [WRN] old request \
  osd_op(client.5099.0:790 fatty_26485_object789 [write 0~4096] 2.5e54f643) \
  v4 received at 2012-03-06 15:42:56.054801 currently waiting for sub ops</pre></div><p>
    Newer versions of Ceph complain about <code class="literal">slow requests</code>:
   </p><div class="verbatim-wrap"><pre class="screen">{date} {osd.num} [WRN] 1 slow requests, 1 included below; oldest blocked for &gt; 30.005692 secs
{date} {osd.num}  [WRN] slow request 30.005692 seconds old, received at \
{date-time}: osd_op(client.4240.0:8 benchmark_data_ceph-1_39426_object7 \
[write 0~4194304] 0.69848840) v4 currently waiting for subops from [610]</pre></div><p>
    Possible causes include:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      A bad drive (check <code class="command">dmesg</code> output)
     </p></li><li class="listitem"><p>
      A bug in the kernel file system (check <code class="command">dmesg</code> output)
     </p></li><li class="listitem"><p>
      An overloaded cluster (check system load, iostat, etc.)
     </p></li><li class="listitem"><p>
      A bug in the <code class="literal">ceph-osd</code> daemon.
     </p></li></ul></div><p>
    Possible solutions:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Remove VMs from Ceph hosts
     </p></li><li class="listitem"><p>
      Upgrade kernel
     </p></li><li class="listitem"><p>
      Upgrade Ceph
     </p></li><li class="listitem"><p>
      Restart OSDs
     </p></li></ul></div></section><section class="sect2" id="troubleshooting-slow-requests" data-id-title="Debugging slow requests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.11 </span><span class="title-name">Debugging slow requests</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-slow-requests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you run <code class="command">ceph daemon osd.&lt;id&gt; dump_historic_ops</code> or
    <code class="command">ceph daemon osd.&lt;id&gt; dump_ops_in_flight</code>, you see a
    set of operations and a list of events each operation went through. These
    are briefly described below.
   </p><p>
    Events from the Messenger layer:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.6.7.13.4.1"><span class="term"><code class="literal">header_read</code></span></dt><dd><p>
       When the messenger first started reading the message off the wire.
      </p></dd><dt id="id-1.5.6.7.13.4.2"><span class="term"><code class="literal">throttled</code></span></dt><dd><p>
       When the messenger tried to acquire memory throttle space to read the
       message into memory.
      </p></dd><dt id="id-1.5.6.7.13.4.3"><span class="term"><code class="literal">all_read</code></span></dt><dd><p>
       When the messenger finished reading the message off the wire.
      </p></dd><dt id="id-1.5.6.7.13.4.4"><span class="term"><code class="literal">dispatched</code></span></dt><dd><p>
       When the messenger gave the message to the OSD.
      </p></dd><dt id="id-1.5.6.7.13.4.5"><span class="term"><code class="literal">initiated</code></span></dt><dd><p>
       This is identical to <code class="literal">header_read</code>. The existence of
       both is a historical oddity.
      </p></dd></dl></div><p>
    Events from the OSD as it prepares operations:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.6.7.13.6.1"><span class="term"><code class="literal">queued_for_pg</code></span></dt><dd><p>
       The op has been put into the queue for processing by its PG.
      </p></dd><dt id="id-1.5.6.7.13.6.2"><span class="term"><code class="literal">reached_pg</code></span></dt><dd><p>
       The PG has started doing the op.
      </p></dd><dt id="id-1.5.6.7.13.6.3"><span class="term"><code class="literal">waiting for \*</code></span></dt><dd><p>
       The op is waiting for some other work to complete before it can proceed
       (e.g. a new OSDMap; for its object target to scrub; for the PG to finish
       peering; all as specified in the message).
      </p></dd><dt id="id-1.5.6.7.13.6.4"><span class="term"><code class="literal">started</code></span></dt><dd><p>
       The op has been accepted as something the OSD should do and is now being
       performed.
      </p></dd><dt id="id-1.5.6.7.13.6.5"><span class="term"><code class="literal">waiting for subops from</code></span></dt><dd><p>
       The op has been sent to replica OSDs.
      </p></dd></dl></div><p>
    Events from the FileStore:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.6.7.13.8.1"><span class="term"><code class="literal">commit_queued_for_journal_write:</code></span></dt><dd><p>
       The op has been given to the FileStore.
      </p></dd><dt id="id-1.5.6.7.13.8.2"><span class="term"><code class="literal">write_thread_in_journal_buffer</code></span></dt><dd><p>
       The op is in the journal’s buffer and waiting to be persisted (as the
       next disk write).
      </p></dd><dt id="id-1.5.6.7.13.8.3"><span class="term"><code class="literal">journaled_completion_queued</code></span></dt><dd><p>
       The op was journaled to disk and its callback queued for invocation.
      </p></dd></dl></div><p>
    Events from the OSD after stuff has been given to local disk:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.6.7.13.10.1"><span class="term"><code class="literal">op_commit</code></span></dt><dd><p>
       The op has been committed by the primary OSD.
      </p></dd><dt id="id-1.5.6.7.13.10.2"><span class="term"><code class="literal">op_applied</code></span></dt><dd><p>
       The op has been <code class="literal">write()’en</code> to the backing FS on the
       primary.
      </p></dd><dt id="id-1.5.6.7.13.10.3"><span class="term"><code class="literal">sub_op_applied: op_applied</code></span></dt><dd><p>
       For a replica’s “subop”.
      </p></dd><dt id="id-1.5.6.7.13.10.4"><span class="term"><code class="literal">sub_op_committed: op_commit</code></span></dt><dd><p>
       For a replica’s sub-op (only for EC pools).
      </p></dd><dt id="id-1.5.6.7.13.10.5"><span class="term"><code class="literal">sub_op_commit_rec/sub_op_apply_rec from &lt;X&gt;</code></span></dt><dd><p>
       The primary marks this when it hears about the above, but for a
       particular replica (i.e. &lt;X&gt;).
      </p></dd><dt id="id-1.5.6.7.13.10.6"><span class="term"><code class="literal">commit_sent</code></span></dt><dd><p>
       We sent a reply back to the client (or primary OSD, for sub ops).
      </p></dd></dl></div><p>
    Many of these events are seemingly redundant, but cross important
    boundaries in the internal code (such as passing data across locks into new
    threads).
   </p></section></section><section class="sect1" id="storage-bp-recover-osdweight" data-id-title="OSD weight is 0"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.5 </span><span class="title-name">OSD weight is 0</span></span> <a title="Permalink" class="permalink" href="#storage-bp-recover-osdweight">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When OSD starts, it is assigned a weight. The higher the weight, the bigger
   the chance that the cluster writes data to the OSD. The weight is either
   specified in a cluster CRUSH Map, or calculated by the OSDs' start-up
   script.
  </p></section><section class="sect1" id="storage-bp-recover-osddown" data-id-title="OSD is down"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.6 </span><span class="title-name">OSD is down</span></span> <a title="Permalink" class="permalink" href="#storage-bp-recover-osddown">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   OSD daemon is either running, or stopped/down. There are 3 general reasons
   why an OSD is down:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Hard disk failure.
    </p></li><li class="listitem"><p>
     The OSD crashed.
    </p></li><li class="listitem"><p>
     The server crashed.
    </p></li></ul></div><p>
   You can see the detailed status of OSDs by running
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd tree
# id  weight  type name up/down reweight
 -1    0.02998  root default
 -2    0.009995   host doc-ceph1
 0     0.009995      osd.0 up  1
 -3    0.009995   host doc-ceph2
 1     0.009995      osd.1 up  1
 -4    0.009995   host doc-ceph3
 2     0.009995      osd.2 down</pre></div><p>
   The example listing shows that the <code class="literal">osd.2</code> is down. Then
   you may check if the disk where the OSD is located is mounted:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsblk -f
NAME                                                                                                  FSTYPE      LABEL UUID                                   FSAVAIL FSUSE% MOUNTPOINT
vda
├─vda1
├─vda2                                                                                                vfat        EFI   7BDD-40C3                                18.8M     6% /boot/efi
└─vda3                                                                                                ext4        ROOT  144d3eec-c193-4793-b6a9-1ac295259f4b     36.7G     5% /
vdb                                                                                                   LVM2_member       Fj8nlY-Dnmm-8Y0w-tJrO-8rAe-SUTH-lA2Ux2
└─ceph--6dc6f71f--ff02--4316--b145--c7804d5fb2f4-osd--block--2cb16f65--c87d--405d--a913--4e4ea6037ca1
vdc                                                                                                   LVM2_member       0101m1-mc83-K8ce-j4Dv-yxUO-5KPj-6FpuSu
└─ceph--1082eac0--4478--48cf--b8ab--4d3a62ca1c27-osd--data--185c9dd6--ce28--4b98--a9b6--9d5b1f444a4f
vdd                                                                                                   LVM2_member       wqE8sC-w5mx-J9t1-FoM1-vIRC-0xxq-5FPyuL
└─ceph--9e71d81a--e394--49b7--bef9--b639083be779-osd--data--eb94f8e6--af6d--4ef6--911b--7f44f7484c85</pre></div><p>
   You can track the reason why the OSD is down by inspecting its log file. See
   <a class="xref" href="#troubleshooting-osd-fail" title="4.3.2. Failing OSD">Section 4.3.2, “Failing OSD”</a> for instructions on how to source
   the log files. After you find and fix the reason why the OSD is not running,
   start it with the following command. To identify the unique FSID of the
   cluster, run <code class="command">ceph fsid</code>. To identify the Object Gateway daemon
   name, run <code class="command">ceph orch ps ---hostname
   <em class="replaceable">HOSTNAME</em></code>.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl start ceph-<em class="replaceable">FSID</em>@<em class="replaceable">osd.2</em></pre></div><p>
   Do not forget to replace <code class="literal">2</code> with the actual number of your
   stopped OSD.
  </p></section><section class="sect1" id="storage-bp-performance-slowosd" data-id-title="Finding slow OSDs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.7 </span><span class="title-name">Finding slow OSDs</span></span> <a title="Permalink" class="permalink" href="#storage-bp-performance-slowosd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When tuning the cluster performance, it is very important to identify slow
   storage/OSDs within the cluster. The reason is that if the data is written
   to the slow(est) disk, the complete write operation slows down as it always
   waits until it is finished on all the related disks.
  </p><p>
   It is not trivial to locate the storage bottleneck. You need to examine each
   and every OSD to find out the ones slowing down the write process. To do a
   benchmark on a single OSD, run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="command">ceph tell</code> osd.<em class="replaceable">OSD_ID_NUMBER</em> bench</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell osd.0 bench
 { "bytes_written": 1073741824,
   "blocksize": 4194304,
   "bytes_per_sec": "19377779.000000"}</pre></div><p>
   Then you need to run this command on each OSD and compare the
   <code class="literal">bytes_per_sec</code> value to get the slow(est) OSDs.
  </p></section><section class="sect1" id="bp-troubleshooting-flapping-osds" data-id-title="Flapping OSDs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.8 </span><span class="title-name">Flapping OSDs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-flapping-osds">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_osds.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   We recommend using both a public (front-end) network and a cluster
   (back-end) network so that you can better meet the capacity requirements of
   object replication. Another advantage is that you can run a cluster network
   such that it is not connected to the internet, thereby preventing some
   denial of service attacks. When OSDs peer and check heartbeats, they use the
   cluster (back-end) network when it’s available.
  </p><p>
   However, if the cluster (back-end) network fails or develops significant
   latency while the public (front-end) network operates optimally, OSDs
   currently do not handle this situation well. What happens is that OSDs mark
   each other down on the monitor, while marking themselves up. This is called
   <span class="emphasis"><em>flapping</em></span>.
  </p><p>
   If something is causing OSDs to flap (repeatedly getting marked down and
   then up again), you can force the monitors to stop the flapping with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set noup      # prevent OSDs from getting marked up
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set nodown    # prevent OSDs from getting marked down</pre></div><p>
   These flags are recorded in the osdmap structure:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd dump | grep flags
flags no-up,no-down</pre></div><p>
   You can clear the flags with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd unset noup
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset nodown</pre></div><p>
   Two other flags are supported, <code class="option">noin</code> and
   <code class="option">noout</code>, which prevent booting OSDs from being marked in
   (allocated data) or protect OSDs from eventually being marked out
   (regardless of what the current value for <code class="command">mon osd down
   out</code> interval is).
  </p><div id="id-1.5.6.11.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    <code class="option">noup</code>, <code class="option">noout</code>, and <code class="option">nodown</code>
    are temporary in the sense that once the flags are cleared, the action they
    were blocking should occur shortly after. The <code class="option">noin</code> flag,
    on the other hand, prevents OSDs from being marked <code class="option">in</code> on
    boot, and any daemons that started while the flag was set will remain that
    way.
   </p></div></section></section><section class="chapter" id="bp-troubleshooting-pgs" data-id-title="Troubleshooting placement groups (PGs)"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">Troubleshooting placement groups (PGs)</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-pgs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="bp-troubleshooting-identify-pg" data-id-title="Identifying troubled placement groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">Identifying troubled placement groups</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-identify-pg">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   As previously noted, a placement group is not necessarily problematic
   because its state is not <code class="literal">active+clean</code>. Generally,
   Ceph's ability to self-repair may not be working when placement groups get
   stuck. The stuck states include:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <span class="bold"><strong>Unclean</strong></span>: Placement groups contain objects
     that are not replicated the required number of times. They should be
     recovering.
    </p></li><li class="listitem"><p>
     <span class="bold"><strong>Inactive</strong></span>: Placement groups cannot process
     reads or writes because they are waiting for an OSD with the most
     up-to-date data to come back up.
    </p></li><li class="listitem"><p>
     <span class="bold"><strong>Stale</strong></span>: Placement groups are in an unknown
     state, because the OSDs that host them have not reported to MONs in a
     while (configured by the <code class="option">mon osd report timeout</code> option).
    </p></li></ul></div><p>
   To identify stuck placement groups, run the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg dump_stuck [unclean|inactive|stale|undersized|degraded]</pre></div></section><section class="sect1" id="bp-troubleshooting-pg-clean" data-id-title="Placement groups never get clean"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">Placement groups never get clean</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-pg-clean">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When you create a cluster and your cluster remains in
   <code class="literal">active</code>, <code class="literal">active+remapped</code>, or
   <code class="literal">active+degraded</code> status and never achieves an
   <code class="literal">active+clean</code> status, you likely have a problem with the
   configuration. As a general rule, you should run your cluster with more than
   one OSD and a pool size greater than 1 object replica.
  </p><section class="sect2" id="troubleshooting-one-node" data-id-title="Experimenting with a one node cluster"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.1 </span><span class="title-name">Experimenting with a one node cluster</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-one-node">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Ceph no longer provides documentation for operating on a single node.
    Mounting client kernel modules on a single node containing a Ceph daemon
    can cause a deadlock due to issues with the Linux kernel itself (unless you
    use VMs for the clients). However, we recommend experimenting with Ceph
    in a 1-node configuration regardless of the limitations.
   </p><p>
    If you are trying to create a cluster on a single node, change the default
    of the <code class="literal">osd crush chooseleaf</code> type setting from 1 (meaning
    <code class="literal">host</code> or <code class="literal">node</code>) to 0 (meaning
    <code class="literal">osd</code>) in your Ceph configuration file before you create
    your monitors and OSDs. This tells Ceph that an OSD can peer with another
    OSD on the same host. If you are trying to set up a 1-node cluster and
    <code class="literal">osd crush chooseleaf</code> type is greater than 0, Ceph
    tries to pair the PGs of one OSD with the PGs of another OSD on another
    node, chassis, rack, row, or even datacenter depending on the setting.
   </p><div id="id-1.5.7.4.3.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     Do not mount kernel clients directly on the same node as your Ceph
     Storage Cluster, because kernel conflicts can arise. However, you can
     mount kernel clients within virtual machines (VMs) on a single node.
    </p></div><p>
    If you are creating OSDs using a single disk, you must create directories
    for the data manually first. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-deploy osd create --data {disk} {host}</pre></div></section><section class="sect2" id="troubleshooting-few-osd-replica" data-id-title="Fewer OSDs than replicas"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.2 </span><span class="title-name">Fewer OSDs than replicas</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-few-osd-replica">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you have brought up two OSDs to an up and in state, but you still do not
    see <code class="literal">active+clean</code> placement groups, you may have an
    <code class="literal">osd pool default size</code> set to greater than 2. There are a
    few ways to address this situation. If you want to operate your cluster in
    an <code class="literal">active+degraded</code> state with two replicas, you can set
    the <code class="literal">osd pool default min size</code> to 2 so that you can write
    objects in an <code class="literal">active+degraded</code> state. You may also set
    the <code class="literal">osd pool default size</code> setting to 2 so that you only
    have two stored replicas (the original and one replica), in which case the
    cluster should achieve an <code class="literal">active+clean</code> state.
   </p><div id="id-1.5.7.4.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     You can make the changes at runtime. If you make the changes in your
     Ceph configuration file, you may need to restart your cluster.
    </p></div></section><section class="sect2" id="troubleshooting-pool-size" data-id-title="Forcing pool sizes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.3 </span><span class="title-name">Forcing pool sizes</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-pool-size">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you have the <code class="literal">osd pool default size</code> set to 1, you only
    have one copy of the object. OSDs rely on other OSDs to tell them which
    objects they should have. If an OSD has a copy of an object and there is no
    second copy, then no second OSD can tell the first OSD that it should have
    that copy. For each placement group mapped to the first OSD (see
    <code class="command">ceph pg dump</code>), you can force the first OSD to notice the
    placement groups it needs by running:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd force-create-pg &lt;pgid&gt;</pre></div></section><section class="sect2" id="troubleshooting-crush-map" data-id-title="Identifying CRUSH map errors"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.4 </span><span class="title-name">Identifying CRUSH map errors</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-crush-map">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Another candidate for placement groups remaining unclean involves errors in
    your CRUSH map.
   </p></section></section><section class="sect1" id="bp-troubleshooting-stuck-pgs" data-id-title="Stuck placement groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.3 </span><span class="title-name">Stuck placement groups</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-stuck-pgs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is normal for placement groups to enter states such as
   <code class="literal">degraded</code> or <code class="literal">peering</code> following a
   failure. These states indicate the normal progression through the failure
   recovery process. However, if a placement group stays in one of these states
   for a long time this may be an indication of a larger problem. For this
   reason, the monitor will warn when placement groups get stuck in a
   non-optimal state. Specifically, check for:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.7.5.3.1"><span class="term"><code class="literal">inactive</code></span></dt><dd><p>
      The placement group has not been active for too long. For example, it has
      not been able to service read/write requests.
     </p></dd><dt id="id-1.5.7.5.3.2"><span class="term"><code class="literal">unclean</code></span></dt><dd><p>
      The placement group has not been clean for too long. For exmaple, it has
      not been able to completely recover from a previous failure.
     </p></dd><dt id="id-1.5.7.5.3.3"><span class="term"><code class="literal">stale</code></span></dt><dd><p>
      The placement group status has not been updated by a
      <code class="literal">ceph-osd</code>, indicating that all nodes storing this
      placement group may be down.
     </p></dd></dl></div><p>
   You can explicitly list stuck placement groups with one of:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg dump_stuck stale
<code class="prompt user">cephuser@adm &gt; </code>ceph pg dump_stuck inactive
<code class="prompt user">cephuser@adm &gt; </code>ceph pg dump_stuck unclean</pre></div><p>
   For stuck stale placement groups, ensure you have the right
   <code class="literal">ceph-osd</code> daemons running again. For stuck inactive
   placement groups, it is can be a peering problem. For stuck unclean
   placement groups, there can be something preventing recovery from
   completing, like unfound objects.
  </p></section><section class="sect1" id="bp-troubleshooting-pgs-down" data-id-title="Peering failure of placement groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.4 </span><span class="title-name">Peering failure of placement groups</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-pgs-down">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In certain cases, the <code class="literal">ceph-osd</code> peering process can run
   into problems, preventing a PG from becoming active and usable. For example,
   <code class="command">ceph health</code> may report:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
  HEALTH_ERR 7 pgs degraded; 12 pgs down; 12 pgs peering; 1 pgs recovering;  \
  6 pgs stuck unclean; 114/3300 degraded (3.455%); 1/3 in osds are down
  ...
  pg 0.5 is down+peering
  pg 1.4 is down+peering
  ...
  osd.1 is down since epoch 69, last address 192.168.106.220:6801/8651</pre></div><p>
   Query the cluster to determine exactly why the PG is marked down by
   executing the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg 0.5 query
  { "state": "down+peering",
    ...
    "recovery_state": [
         { "name": "Started\/Primary\/Peering\/GetInfo",
           "enter_time": "2012-03-06 14:40:16.169679",
           "requested_info_from": []},
         { "name": "Started\/Primary\/Peering",
           "enter_time": "2012-03-06 14:40:16.169659",
           "probing_osds": [
                 0,
                 1],
           "blocked": "peering is blocked due to down osds",
           "down_osds_we_would_probe": [
                 1],
           "peering_blocked_by": [
                 { "osd": 1,
                   "current_lost_at": 0,
                   "comment": "starting or marking this osd lost may let us proceed"}]},
         { "name": "Started",
           "enter_time": "2012-03-06 14:40:16.169513"}
     ]
  }</pre></div><p>
   <code class="literal">recovery_state</code> section shows that peering is blocked due
   to down <code class="literal">ceph-osd</code> daemons, specifically
   <code class="literal">osd.1</code>. In this case, restart the
   <code class="literal">ceph-osd</code> to recover. Alternatively, if there is a
   catastrophic failure of <code class="literal">osd.1</code> such as a disk failure,
   tell the cluster that it is lost and to cope as best it can.
  </p><div id="id-1.5.7.6.7" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
    The cluster cannot guarantee that the other copies of the data are
    consistent and up to date.
   </p></div><p>
   To instruct Ceph to continue anyway:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd lost 1</pre></div><p>
   Recovery will proceed.
  </p></section><section class="sect1" id="bp-troubleshooting-unfound-objects" data-id-title="Failing unfound objects"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.5 </span><span class="title-name">Failing unfound objects</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-unfound-objects">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Under certain combinations of failures Ceph may complain about unfound
   objects:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
  HEALTH_WARN 1 pgs degraded; 78/3778 unfound (2.065%)
  pg 2.4 is active+degraded, 78 unfound</pre></div><p>
   This means that the storage cluster knows that some objects (or newer copies
   of existing objects) exist, but it has not found copies of them. One example
   of how this might come about for a PG whose data is on
   <code class="literal">ceph-osd</code>s 1 and 2:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     1 goes down
    </p></li><li class="listitem"><p>
     2 handles some writes, alone
    </p></li><li class="listitem"><p>
     1 comes up
    </p></li><li class="listitem"><p>
     1 and 2 repeer, and the objects missing on 1 are queued for recovery.
    </p></li><li class="listitem"><p>
     Before the new objects are copied, 2 goes down.
    </p></li></ul></div><p>
   In this example, 1 is aware that these object exist, but there is no live
   <code class="literal">ceph-osd</code> who has a copy. In this case, I/O to those
   objects blocks, and the cluster hopes that the failed node comes back soon.
   This is assumed to be preferable to returning an I/O error to the user.
  </p><p>
   Identify which objects are unfound by executing the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg 2.4 list_unfound [starting offset, in json]
  { "offset": { "oid": "",
       "key": "",
       "snapid": 0,
       "hash": 0,
       "max": 0},
   "num_missing": 0,
   "num_unfound": 0,
   "objects": [
      { "oid": "object 1",
        "key": "",
        "hash": 0,
        "max": 0 },
      ...
   ],
   "more": 0}</pre></div><p>
   If there are too many objects to list in a single result, the
   <code class="literal">more</code> field is true and you can query for more.
  </p><p>
   Identify which OSDs have been probed or might contain data:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg 2.4 query
  "recovery_state": [
       { "name": "Started\/Primary\/Active",
         "enter_time": "2012-03-06 15:15:46.713212",
         "might_have_unfound": [
               { "osd": 1,
                 "status": "osd is down"}]},</pre></div><p>
   In this case, for example, the cluster knows that <code class="literal">osd.1</code>
   might have data, but it is <code class="literal">down</code>. The full range of
   possible states include:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     already probed
    </p></li><li class="listitem"><p>
     querying
    </p></li><li class="listitem"><p>
     OSD is down
    </p></li><li class="listitem"><p>
     not queried (yet)
    </p></li></ul></div><p>
   Sometimes it takes some time for the cluster to query possible locations.
  </p><p>
   It is possible that there are other locations where the object can exist
   that are not listed. For example, if a <code class="literal">ceph-osd</code> is
   stopped and taken out of the cluster, the cluster fully recovers, and due to
   some future set of failures ends up with an unfound object, it will not
   consider the long-departed <code class="literal">ceph-osd</code> as a potential
   location to consider.
  </p><p>
   If all possible locations have been queried and objects are still lost, you
   may have to give up on the lost objects. This, again, is possible given
   unusual combinations of failures that allow the cluster to learn about
   writes that were performed before the writes themselves are recovered. To
   mark the unfound objects as <code class="option">lost</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg 2.5 mark_unfound_lost revert|delete</pre></div><p>
   This the final argument specifies how the cluster should deal with lost
   objects. The <code class="option">delete</code> option forgets about them entirely. The
   <code class="option">revert</code> option (not available for erasure coded pools)
   either rolls back to a previous version of the object or (if it was a new
   object) forgets about it entirely. Use this with caution, as it may confuse
   applications that expected the object to exist.
  </p></section><section class="sect1" id="bp-troubleshooting-homeless-pgs" data-id-title="Identifying homeless placement groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.6 </span><span class="title-name">Identifying homeless placement groups</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-homeless-pgs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is possible for all OSDs that had copies of a given placement groups to
   fail. If that is the case, that subset of the object store is unavailable,
   and the monitor receives no status updates for those placement groups. To
   detect this situation, the monitor marks any placement group whose primary
   OSD has failed as <code class="literal">stale</code>. For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health
  HEALTH_WARN 24 pgs stale; 3/300 in osds are down</pre></div><p>
   Identify which placement groups are <code class="literal">stale</code>, and what were
   the last OSDs to store them by executing the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
  HEALTH_WARN 24 pgs stale; 3/300 in osds are down
  ...
  pg 2.5 is stuck stale+active+remapped, last acting [2,0]
  ...
  osd.10 is down since epoch 23, last address 192.168.106.220:6800/11080
  osd.11 is down since epoch 13, last address 192.168.106.220:6803/11539
  osd.12 is down since epoch 24, last address 192.168.106.220:6806/11861</pre></div><p>
   For example, to get placement group 2.5 back online, this output shows that
   it was last managed by <code class="literal">osd.0</code> and
   <code class="literal">osd.2</code>. Restarting the <code class="literal">ceph-osd</code> daemons
   allows the cluster to recover that placement group.
  </p></section><section class="sect1" id="bp-troubleshooting-osds-data" data-id-title="Only a few OSDs receive data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.7 </span><span class="title-name">Only a few OSDs receive data</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-osds-data">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you have many nodes in your cluster and only a few of them receive data,
   check the number of placement groups in your pool. See
   <span class="intraxref">Book “Administration and Operations Guide”, Chapter 12 “Determine the cluster state”, Section 12.7 “Checking placement group states”</span> for more information. Since placement
   groups get mapped to OSDs, a small number of placement groups will not
   distribute across the cluster. Create a pool with a placement group count
   that is a multiple of the number of OSDs. See <span class="intraxref">Book “Administration and Operations Guide”, Chapter 17 “Stored data management”, Section 17.4 “Placement groups”</span> for
   details.
  </p></section><section class="sect1" id="bp-troubleshooting-cant-write" data-id-title="Unable to write data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.8 </span><span class="title-name">Unable to write data</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cant-write">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If your cluster is up but some OSDs are down and you cannot write data,
   check to ensure that you have the minimum number of OSDs running for the
   placement group. If you do not have the minimum number of OSDs running,
   Ceph will not allow you to write data because there is no guarantee that
   Ceph can replicate your data.
  </p></section><section class="sect1" id="bp-troubleshooting-pgs-inconsistent" data-id-title="Identifying inconsistent placement groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.9 </span><span class="title-name">Identifying inconsistent placement groups</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-pgs-inconsistent">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you receive an <code class="literal">active+clean+inconsistent</code> state, this
   may happen due to an error during scrubbing. Identify the inconsistent
   placement group(s) by executing the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
  HEALTH_ERR 1 pgs inconsistent; 2 scrub errors
  pg 0.6 is active+clean+inconsistent, acting [0,1,2]
  2 scrub errors</pre></div><p>
   Or:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados list-inconsistent-pg rbd
  ["0.6"]</pre></div><p>
   There is only one consistent state, but in the worst case, there could be
   different inconsistencies in multiple perspectives found in more than one
   objects. If an object named <code class="literal">foo</code> in PG
   <code class="literal">0.6</code> is truncated, the output is:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados list-inconsistent-obj 0.6 --format=json-pretty</pre></div><div class="verbatim-wrap"><pre class="screen">  {
      "epoch": 14,
      "inconsistents": [
          {
              "object": {
                  "name": "foo",
                  "nspace": "",
                  "locator": "",
                  "snap": "head",
                  "version": 1
              },
              "errors": [
                  "data_digest_mismatch",
                  "size_mismatch"
              ],
              "union_shard_errors": [
                  "data_digest_mismatch_info",
                  "size_mismatch_info"
              ],
              "selected_object_info": "0:602f83fe:::foo:head(16'1 client.4110.0:1 dirty|data_digest|omap_digest s 968 uv 1 dd e978e67f od ffffffff alloc_hint [0 0 0])",
              "shards": [
                  {
                      "osd": 0,
                      "errors": [],
                      "size": 968,
                      "omap_digest": "0xffffffff",
                      "data_digest": "0xe978e67f"
                  },
                  {
                      "osd": 1,
                      "errors": [],
                      "size": 968,
                      "omap_digest": "0xffffffff",
                      "data_digest": "0xe978e67f"
                  },
                  {
                      "osd": 2,
                      "errors": [
                          "data_digest_mismatch_info",
                          "size_mismatch_info"
                      ],
                      "size": 0,
                      "omap_digest": "0xffffffff",
                      "data_digest": "0xffffffff"
                  }
              ]
          }
      ]
  }</pre></div><p>
   In this case, we can learn from the output that the only inconsistent object
   is named <code class="literal">foo</code>, and it has inconsistencies. The
   inconsistencies fall into two categories:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.7.11.10.1"><span class="term"><code class="literal">errors</code></span></dt><dd><p>
      These errors indicate inconsistencies between <code class="literal">shards</code>
      without a determination of which shard(s) are bad. Check for the
      <code class="literal">errors</code> in the <code class="literal">shards</code> array, if
      available, to pinpoint the problem.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.7.11.10.1.2.2.1"><span class="term"><code class="literal">data_digest_mismatch</code></span></dt><dd><p>
         The digest of the replica read from OSD.2 is different from the ones
         of OSD.0 and OSD.1
        </p></dd><dt id="id-1.5.7.11.10.1.2.2.2"><span class="term"><code class="literal">size_mismatch</code></span></dt><dd><p>
         The size of the replica read from OSD.2 is 0, while the size reported
         by OSD.0 and OSD.1 is 968.
        </p></dd></dl></div></dd><dt id="id-1.5.7.11.10.2"><span class="term"><code class="literal">union_shard_errors</code></span></dt><dd><p>
      The union of all shard specific <code class="literal">errors</code> in
      <code class="literal">shards</code> array. The <code class="literal">errors</code> are set
      for the given shard that has the problem. They include errors like
      <code class="literal">read_error</code>. The <code class="literal">errors</code> ending in
      <code class="literal">oi</code> indicate a comparison with
      <code class="literal">selected_object_info</code>. Look at the
      <code class="literal">shards</code> array to determine which shard has which
      error(s).
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.7.11.10.2.2.2.1"><span class="term"><code class="literal">data_digest_mismatch_info</code></span></dt><dd><p>
         The digest stored in the object-info is not 0xffffffff, which is
         calculated from the shard read from OSD.2
        </p></dd><dt id="id-1.5.7.11.10.2.2.2.2"><span class="term"><code class="literal">size_mismatch_info</code></span></dt><dd><p>
         The size stored in the object-info is different from the one read from
         OSD.2. The latter is 0.
        </p></dd></dl></div></dd></dl></div><p>
   Repair the inconsistent placement group by executing:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg repair <em class="replaceable">placement-group-ID</em></pre></div><p>
   This command overwrites the bad copies with the authoritative ones. In most
   cases, Ceph is able to choose authoritative copies from all available
   replicas using some predefined criteria but this does not always work. For
   example, the stored data digest could be missing, and the calculated digest
   will be ignored when choosing the authoritative copies. Use the above
   command with caution.
  </p><p>
   If <code class="literal">read_error</code> is listed in the errors attribute of a
   shard, the inconsistency is likely due to disk errors. You might want to
   check your disk used by that OSD.
  </p><p>
   If you receive <code class="literal">active+clean+inconsistent</code> states
   periodically due to clock skew, you may consider configuring your NTP
   daemons on your monitor hosts to act as peers.
  </p></section><section class="sect1" id="bp-troubleshooting-erasure-codes" data-id-title="Identifying inactive erasure coded PGs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.10 </span><span class="title-name">Identifying inactive erasure coded PGs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-erasure-codes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When CRUSH fails to find enough OSDs to map to a PG, it will show as a
   2147483647 which is <code class="option">ITEM_NONE</code> or <code class="literal">no OSD
   found</code>. For instance:
  </p><div class="verbatim-wrap"><pre class="screen">[2,1,6,0,5,8,2147483647,7,4]</pre></div><section class="sect2" id="troubleshooting-not-enough-osds" data-id-title="Displaying not enough OSDs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.1 </span><span class="title-name">Displaying not enough OSDs</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-not-enough-osds">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the Ceph cluster only has 8 OSDs and the erasure coded pool needs 9,
    that is what it will show. You can either create another erasure coded pool
    that requires less OSDs:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd erasure-code-profile set myprofile k=5 m=3
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool create erasurepool erasure myprofile</pre></div><p>
    Or, add a new OSDs and the PG automatically uses them.
   </p></section><section class="sect2" id="troubleshooting-crush" data-id-title="Satisfying CRUSH constraints"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.2 </span><span class="title-name">Satisfying CRUSH constraints</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-crush">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the cluster has enough OSDs, it is possible that the CRUSH rule imposes
    constraints that cannot be satisfied. If there are 10 OSDs on two hosts and
    the CRUSH rule requires that no two OSDs from the same host are used in the
    same PG, the mapping may fail because only two OSDs will be found. You can
    check the constraint by displaying the rule:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush rule ls
  [
      "replicated_rule",
      "erasurepool"]
  $ ceph osd crush rule dump erasurepool
  { "rule_id": 1,
    "rule_name": "erasurepool",
    "ruleset": 1,
    "type": 3,
    "min_size": 3,
    "max_size": 20,
    "steps": [
          { "op": "take",
            "item": -1,
            "item_name": "default"},
          { "op": "chooseleaf_indep",
            "num": 0,
            "type": "host"},
          { "op": "emit"}]}</pre></div><p>
    Resolve the problem by creating a new pool in which PGs are allowed to have
    OSDs residing on the same host with:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd erasure-code-profile set myprofile crush-failure-domain=osd
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool create erasurepool erasure myprofile</pre></div></section><section class="sect2" id="troubleshooting-crush-give-up" data-id-title="Identifying when CRUSH gives up too soon"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.3 </span><span class="title-name">Identifying when CRUSH gives up too soon</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-crush-give-up">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_pgs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the Ceph cluster has just enough OSDs to map the PG (for instance a
    cluster with a total of 9 OSDs and an erasure coded pool that requires 9
    OSDs per PG), it is possible that CRUSH gives up before finding a mapping.
    It can be resolved by:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Lowering the erasure coded pool requirements to use less OSDs per PG
      (that requires the creation of another pool as erasure code profiles
      cannot be dynamically modified).
     </p></li><li class="listitem"><p>
      Adding more OSDs to the cluster (that does not require the erasure coded
      pool to be modified, it will become clean automatically)
     </p></li><li class="listitem"><p>
      Use a handmade CRUSH rule that tries more times to find a good mapping.
      This can be done by setting <code class="option">set_choose_tries</code> to a value
      greater than the default.
     </p></li></ul></div><p>
    Verify the problem with crushtool after extracting the crushmap from the
    cluster so your experiments do not modify the Ceph cluster and only work
    on a local files:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush rule dump erasurepool
  { "rule_name": "erasurepool",
    "ruleset": 1,
    "type": 3,
    "min_size": 3,
    "max_size": 20,
    "steps": [
          { "op": "take",
            "item": -1,
            "item_name": "default"},
          { "op": "chooseleaf_indep",
            "num": 0,
            "type": "host"},
          { "op": "emit"}]}
  $ ceph osd getcrushmap &gt; crush.map
  got crush map from osdmap epoch 13
  $ crushtool -i crush.map --test --show-bad-mappings \
     --rule 1 \
     --num-rep 9 \
     --min-x 1 --max-x $((1024 * 1024))
  bad mapping rule 8 x 43 num_rep 9 result [3,2,7,1,2147483647,8,5,6,0]
  bad mapping rule 8 x 79 num_rep 9 result [6,0,2,1,4,7,2147483647,5,8]
  bad mapping rule 8 x 173 num_rep 9 result [0,4,6,8,2,1,3,7,2147483647]</pre></div><p>
    Where <code class="option">--num-rep</code> is the number of OSDs the erasure code
    CRUSH rule needs, <code class="option">--rule</code> is the value of the ruleset field
    displayed by <code class="command">ceph osd crush rule dump</code>. The test tries to
    map one million values (i.e. the range defined by [--min-x,--max-x]) and
    must display at least one bad mapping. If it outputs nothing it means all
    mappings are successful and the problem is elsewhere.
   </p><p>
    The CRUSH rule can be edited by decompiling the crush map:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>crushtool --decompile crush.map &gt; crush.txt</pre></div><p>
    Add the following line to the rule:
   </p><div class="verbatim-wrap"><pre class="screen">step set_choose_tries 100</pre></div><p>
    The relevant part of of the <code class="filename">crush.txt</code> file should look
    something like:
   </p><div class="verbatim-wrap"><pre class="screen">  rule erasurepool {
          ruleset 1
          type erasure
          min_size 3
          max_size 20
          step set_chooseleaf_tries 5
          step set_choose_tries 100
          step take default
          step chooseleaf indep 0 type host
          step emit
  }</pre></div><p>
    It can then be compiled and tested again:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>crushtool --compile crush.txt -o better-crush.map</pre></div><p>
    When all mappings succeed, an histogram of the number of tries that were
    necessary to find all of them can be displayed with the
    <code class="option">--show-choose-tries</code> option of
    <code class="literal">crushtool</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>crushtool -i better-crush.map --test --show-bad-mappings \
     --show-choose-tries \
     --rule 1 \
     --num-rep 9 \
     --min-x 1 --max-x $((1024 * 1024))
  ...
  11:        42
  12:        44
  13:        54
  14:        45
  15:        35
  16:        34
  17:        30
  18:        25
  19:        19
  20:        22
  21:        20
  22:        17
  23:        13
  24:        16
  25:        13
  26:        11
  27:        11
  28:        13
  29:        11
  30:        10
  31:         6
  32:         5
  33:        10
  34:         3
  35:         7
  36:         5
  37:         2
  38:         5
  39:         5
  40:         2
  41:         5
  42:         4
  43:         1
  44:         2
  45:         2
  46:         3
  47:         1
  48:         0
  ...
  102:         0
  103:         1
  104:         0
  ...</pre></div><p>
    It takes 11 tries to map 42 PGs, 12 tries to map 44 PGs etc. The highest
    number of tries is the minimum value of <code class="option">set_choose_tries</code>
    that prevents bad mappings (i.e. 103 in the above output because it did not
    take more than 103 tries for any PG to be mapped).
   </p></section></section></section><section class="chapter" id="bp-troubleshooting-monitors" data-id-title="Troubleshooting Ceph Monitors and Ceph Managers"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Troubleshooting Ceph Monitors and Ceph Managers</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-monitors">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="mons-initial-troubleshooting" data-id-title="Initial troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Initial troubleshooting</span></span> <a title="Permalink" class="permalink" href="#mons-initial-troubleshooting">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><div class="qandaset" id="id-1.5.8.3.2"><div class="free-id" id="id-1.5.8.3.2.1"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.3.2.1.1"><strong>Q:</strong>
      Are the monitors running?
     </dt><dd class="answer" id="id-1.5.8.3.2.1.2"><p>
      Ensure the monitors are running, this is an important to check if you
      have performed an upgrade and not manually restarted the monitors.
     </p></dd></dl><div class="free-id" id="id-1.5.8.3.2.2"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.3.2.2.1"><strong>Q:</strong>
      Are you able to connect to the monitor’s servers?
     </dt><dd class="answer" id="id-1.5.8.3.2.2.2"><p>
      Occasionally, you can be running <code class="literal">iptable</code> rules that
      block access to monitor servers or monitor ports. This can often be the
      case from monitor stress-testing that was forgotten. We recommend trying
      to <code class="literal">ssh</code> into the server and, if that succeeds, try
      connecting to the monitor's port using your tool of choice (such as
      <code class="command">telnet</code> or <code class="command">netcat</code>).
     </p></dd></dl><div class="free-id" id="id-1.5.8.3.2.3"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.3.2.3.1"><strong>Q:</strong>
      Does <code class="command">ceph -s</code> run and obtain a reply from the cluster?
     </dt><dd class="answer" id="id-1.5.8.3.2.3.2"><p>
      If the answer is yes, then your cluster is up and running. The monitors
      will only answer to a status request if there is a formed quorum. If
      <code class="command">ceph -s</code> is blocked, without obtaining a reply from the
      cluster or showing a lot of fault messages, then it is possible that your
      monitors are either down completely or just a portion is up – a portion
      that is not enough to form a quorum (keep in mind that a quorum if formed
      by a majority of monitors).
     </p></dd></dl><div class="free-id" id="id-1.5.8.3.2.4"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.3.2.4.1"><strong>Q:</strong>
      What if <code class="command">ceph -s</code> does not finish?
     </dt><dd class="answer" id="id-1.5.8.3.2.4.2"><p>
      Contact each monitor individually for the status, regardless of a quorum
      being formed. This can be achieved using <code class="command">ceph tell mon.ID
      mon_status</code> with the ID being the monitor's identifier. Perform
      this for each monitor in the cluster. The section
      <a class="xref" href="#mons-understanding-mons-status" title="6.3. Understanding mons_status">Section 6.3, “Understanding <code class="literal">mons_status</code>”</a> explains how to
      interpret the output of this command.
     </p></dd></dl></div></section><section class="sect1" id="mons-admin-socket" data-id-title="Using the monitors admin socket"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Using the monitor's admin socket</span></span> <a title="Permalink" class="permalink" href="#mons-admin-socket">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The admin socket allows you to interact with a given daemon directly using a
   Unix socket file. This file can be found in your monitor's run directory. By
   default, the admin socket will be kept in
   <code class="filename">/var/run/ceph/ceph-mon.ID.asok</code> but this can vary if you
   defined it otherwise. If you are unable to find it there, check your
   <code class="filename">ceph.conf</code> for an alternative path or run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-conf --name mon.ID --show-config-value admin_socket</pre></div><p>
   Keep in mind that the admin socket is only available while the monitor is
   running. When the monitor is properly shutdown, the admin socket is removed.
   If however the monitor is not running and the admin socket still persists,
   it is likely that the monitor was improperly shutdown. Regardless, if the
   monitor is not running, you will not be able to use the admin socket, with
   ceph likely returning <code class="literal">Error 111: Connection Refused</code>. To
   accessing the admin socket run <code class="command">ceph tell</code> on the daemon
   you are interested in. For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell mon.<em class="replaceable">ID</em> mon_status</pre></div><p>
   This passes the command help to the running MON daemon
   <em class="replaceable">ID</em> via the admin socket, which is a file ending
   in <code class="filename">.asok</code> somewhere under
   <code class="filename">/var/run/ceph</code>. When you know the full path to the file,
   you can run the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph --admin-daemon <em class="replaceable">PATH_TO_FILE</em> <em class="replaceable">COMMAND</em></pre></div><p>
   Using help as the command to the <code class="command">ceph tool</code> shows the
   supported commands available through the admin socket. Take a look at
   <code class="option">config get</code>, <code class="option">config show</code>, <code class="option">mon
   stat</code> and <code class="option">quorum_status</code>, as those can be
   enlightening when troubleshooting a monitor.
  </p></section><section class="sect1" id="mons-understanding-mons-status" data-id-title="Understanding mons_status"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">Understanding <code class="literal">mons_status</code></span></span> <a title="Permalink" class="permalink" href="#mons-understanding-mons-status">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="literal">mon_status</code> can be obtained via the admin socket. This
   command outputs a multitude of information about the monitor including the
   same output you would get with <code class="option">quorum_status</code>. For example,
   the following example output of <code class="command">ceph tell mon.c
   mon_status</code>:
  </p><div class="verbatim-wrap"><pre class="screen">  { "name": "c",
  "rank": 2,
  "state": "peon",
  "election_epoch": 38,
  "quorum": [
        1,
        2],
  "outside_quorum": [],
  "extra_probe_peers": [],
  "sync_provider": [],
  "monmap": { "epoch": 3,
      "fsid": "5c4e9d53-e2e1-478a-8061-f543f8be4cf8",
      "modified": "2013-10-30 04:12:01.945629",
      "created": "2013-10-29 14:14:41.914786",
      "mons": [
            { "rank": 0,
              "name": "a",
              "addr": "127.0.0.1:6789\/0"},
            { "rank": 1,
              "name": "b",
              "addr": "127.0.0.1:6790\/0"},
            { "rank": 2,
              "name": "c",
              "addr": "127.0.0.1:6795\/0"}]}}</pre></div><p>
   This example shows that there are three montiors in the monmap
   (<code class="literal">a</code>, <code class="literal">b</code> and <code class="literal">c</code>), the
   quorum is formed by only two monitors, and <code class="literal">c</code> is in the
   quorum as a <code class="literal">peon</code>. This means that monitor
   <code class="literal">a</code> is out of quorum. This is because there are two
   monitors in this set: 1 and 2. These are not monitor names. These are
   monitor ranks, as established in the current monmap. It shows that the
   missing monitor is the one with a rank of 0, and according to the monmap
   that would be <code class="literal">mon.a</code>.
  </p><p>
   Ranks (re)calculated whenever you add or remove monitors and follow this
   rule: the greater the <code class="literal">IP:PORT</code> combination, the lower the
   rank is. In this case, considering that <code class="literal">127.0.0.1:6789</code> is
   lower than all the remaining <code class="literal">IP:PORT</code> combinations,
   <code class="literal">mon.a</code> has rank 0.
  </p></section><section class="sect1" id="mons-restoring-quorum" data-id-title="Restoring the MONs quorum"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">Restoring the MONs quorum</span></span> <a title="Permalink" class="permalink" href="#mons-restoring-quorum">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the Ceph Monitors cannot form a quorum, cephadm will not be able to manage the
   cluster until the quorum is restored. In order to restore the Ceph Monitor quorum,
   remove unhealthy Ceph Monitors form the monmap by following these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Stop all Ceph Monitors. Log in to each Ceph Monitor host via SSH and run the following
     command there:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm unit --name mon.`hostname` stop</pre></div></li><li class="step"><p>
     Identify a surviving monitor by logging in to that host via SSH and
     running:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm shell --name mon.`hostname`</pre></div></li><li class="step"><p>
     Extract a copy of the monmap to a file, for example
     <code class="filename">/tmp/monmap</code>. Note that
     <em class="replaceable">MON_ID</em> is usually identical to the string that
     the <code class="command">hostname</code> command returns:
    </p><div class="verbatim-wrap"><pre class="screen">ceph-mon -i <em class="replaceable">MON_ID</em> --extract-monmap <em class="replaceable">/tmp/monmap</em></pre></div></li><li class="step"><p>
     Remove the non-surviving or problematic monitors. For example, if you have
     three monitors, <code class="literal">mon.a</code>, <code class="literal">mon.b</code>, and
     <code class="literal">mon.c</code> where only <code class="literal">mon.a</code> is surviving,
     follow this example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>monmaptool /tmp/monmap --rm b
<code class="prompt user">cephuser@adm &gt; </code>monmaptool /tmp/monmap --rm c</pre></div></li><li class="step"><p>
     Inject the surviving map with the removed monitors into the surviving
     monitor(s). For example, to inject the map into the monitor
     <code class="literal">mon.a</code>, follow this example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-mon -i a --inject-monmap /tmp/monmap</pre></div></li><li class="step"><p>
     Start only the surviving monitors, and verify that the monitors form a
     quorum with the <code class="command">ceph -s</code> command.
    </p></li></ol></div></div><div id="id-1.5.8.6.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    You may wish to archive the removed monitors' data directories from
    <code class="filename">/var/lib/ceph/mon</code> in a safe location, or delete it if
    you are confident the remaining monitors are healthy and are sufficiently
    redundant.
   </p></div></section><section class="sect1" id="mons-common-issues" data-id-title="Most common monitor issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Most common monitor issues</span></span> <a title="Permalink" class="permalink" href="#mons-common-issues">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="monitor-down" data-id-title="Have quorum but at least one monitor is down"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.1 </span><span class="title-name">Have quorum but at least one monitor is down</span></span> <a title="Permalink" class="permalink" href="#monitor-down">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When this happens, depending on the version of Ceph you are running, you
    should be seeing something similar to:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail
[snip]
mon.a (rank 0) addr 127.0.0.1:6789/0 is down (out of quorum)</pre></div><p>
    To troubleshoot, make sure that <code class="literal">mon.a</code> is running. After
    that, make sure you are able to connect to <code class="literal">mon.a</code>'s
    server from the other monitors' servers. Check the ports as well. Check
    iptables on all your monitor nodes and make sure you are not dropping or
    rejecting connections. If this initial troubleshooting does not solve your
    problems, check the problematic monitor's <code class="literal">mon_status</code> via
    the admin socket. Considering the monitor is out of the quorum, its state
    should be one of <code class="literal">probing</code>, <code class="literal">electing</code> or
    <code class="literal">synchronizing</code>. If it happens to be either
    <code class="literal">leader</code> or <code class="literal">peon</code>, then the monitor
    believes itself to be in the quorum, while the remaining cluster is sure it
    is not; or maybe it got into the quorum while we were troubleshooting the
    monitor. Check using <code class="command">ceph -s</code> again, just to make sure.
    Continue if the monitor is not yet in quorum.
   </p><div class="qandaset" id="id-1.5.8.7.2.5"><div class="free-id" id="id-1.5.8.7.2.5.1"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.7.2.5.1.1"><strong>1.</strong>
       What if the state is <code class="literal">probing</code>?
      </dt><dd class="answer" id="id-1.5.8.7.2.5.1.2"><p>
       This means the monitor is still looking for the other monitors. Every
       time you start a monitor, the monitor stays in this state for some time
       while trying to find the rest of the monitors specified in the
       <code class="literal">monmap</code>. The time a monitor spends in this state can
       vary. For instance, when on a single-monitor cluster, the monitor passes
       through the probing state almost instantaneously, since there are no
       other monitors around. On a multi-monitor cluster, the monitors will
       stay in this state until they find enough monitors to form a quorum –
       this means that if you have 2 out of 3 monitors down, the one remaining
       monitor stays in this state indefinitely until one of the other monitors
       is brought up manually.
      </p><p>
       If there is a quorum, the monitor should be able to find the remaining
       monitors as long as they can be reached. If your monitor is stuck
       probing and you have gone through with all the communication
       troubleshooting, then there is a chance that the monitor is trying to
       reach the other monitors on a wrong address.
       <code class="literal">mon_status</code> outputs the <code class="literal">monmap</code>
       known to the monitor and checks if the other monitor’s locations match
       reality. If they do not, then it may be related to a broken mon map. If
       they do, then it may be related to severe clock skews amongst the
       monitor nodes and you should refer to <a class="xref" href="#clock-skews" title="6.5.2. Fixing clock skews">Section 6.5.2, “Fixing clock skews”</a>.
      </p></dd></dl><div class="free-id" id="id-1.5.8.7.2.5.2"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.7.2.5.2.1"><strong>2.</strong>
       What if the state is <code class="literal">electing</code>?
      </dt><dd class="answer" id="id-1.5.8.7.2.5.2.2"><p>
       This means the monitor is in the middle of an election. These should be
       fast to complete, but at times the monitors can get stuck electing. This
       is usually a sign of a clock skew among the monitor nodes. See
       <a class="xref" href="#clock-skews" title="6.5.2. Fixing clock skews">Section 6.5.2, “Fixing clock skews”</a> for more information. This is not a state
       that is likely to persist and aside from old bugs there is not an
       obvious reason besides clock skews on why this would happen.
      </p></dd></dl><div class="free-id" id="id-1.5.8.7.2.5.3"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.7.2.5.3.1"><strong>3.</strong>
       What if the state is <code class="literal">synchronizing</code>?
      </dt><dd class="answer" id="id-1.5.8.7.2.5.3.2"><p>
       This means the monitor is synchronizing with the rest of the cluster in
       order to join the quorum. However, if you notice that the monitor jumps
       from synchronizing to electing and then back to synchronizing, then it
       can mean that the cluster state is advancing (i.e., generating new maps)
       way too fast for the synchronization process to keep up.
      </p></dd></dl><div class="free-id" id="id-1.5.8.7.2.5.4"> </div><dl class="qandaentry"><dt class="question" id="id-1.5.8.7.2.5.4.1"><strong>4.</strong>
       What if the state is <code class="literal">leader</code> or
       <code class="literal">peon</code>?
      </dt><dd class="answer" id="id-1.5.8.7.2.5.4.2"><p>
       This should not happen. If this does happen, it is likely related to
       clock skews, see <a class="xref" href="#clock-skews" title="6.5.2. Fixing clock skews">Section 6.5.2, “Fixing clock skews”</a> for more information. If
       you see no issue with the clock skews, prepare your logs and reach out
       to your support representative.
      </p></dd></dl></div></section><section class="sect2" id="clock-skews" data-id-title="Fixing clock skews"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.2 </span><span class="title-name">Fixing clock skews</span></span> <a title="Permalink" class="permalink" href="#clock-skews">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Monitors can be severely affected by significant clock skews across the
    monitor nodes. This usually translates into weird behavior with no obvious
    cause. To avoid such issues, run a clock synchronization tool on your
    monitor nodes.
   </p><p>
    By default, the maximum tolerated clock skew allows clocks to drift up to
    0.05 seconds. This value is configurable via the
    <code class="option">mon-clock-drift-allowed</code> option, however we do not
    recommend doing this. The clock skew mechanism is in place because clock
    skewed monitor may not properly behave. Changing this value without testing
    it first may cause unforeseen effects on the stability of the monitors and
    overall cluster healthiness, although there is no risk of data loss.
   </p><p>
    The monitors will warn you if there is a clock skew by sending a
    <code class="literal">HEALTH_WARN</code> alert. Run the <code class="command">ceph health
    detail</code> command to determine what monitor is flagging a clock
    skew. For example:
   </p><div class="verbatim-wrap"><pre class="screen">mon.c addr 10.10.0.1:6789/0 clock skew 0.08235s &gt; max 0.05s (latency 0.0045s)</pre></div><p>
    If you have a clock skew, synchronize your clocks. Running an NTP client
    may help. If you are already using one and you hit this sort of issue,
    check if you are using an NTP server remote to your network and consider
    hosting your own NTP server on your network. This last option tends to
    reduce the amount of issues with monitor clock skews.
   </p></section><section class="sect2" id="client-connect-mount" data-id-title="Connecting and mounting to the client"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.3 </span><span class="title-name">Connecting and mounting to the client</span></span> <a title="Permalink" class="permalink" href="#client-connect-mount">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you cannot connect or mount to the client, check your iptables. Some OS
    install utilities add a <code class="option">REJECT</code> rule to iptables. The rule
    rejects all clients trying to connect to the host except for SSH. If your
    monitor host’s IP tables have a <code class="option">REJECT</code> rule in place,
    clients connecting from a separate node will fail to mount with a timeout
    error. You need to address iptables rules that reject clients trying to
    connect to Ceph daemons. For example, address rules that look like similar
    to this:
   </p><div class="verbatim-wrap"><pre class="screen">REJECT all -- anywhere anywhere reject-with icmp-host-prohibited</pre></div><p>
    You may also need to add rules to iptables on your Ceph hosts to ensure
    that clients can access the ports associated with your Ceph monitors (for
    example, port 6789 by default) and Ceph OSDs (for example, 6800 through
    7300 by default). For example:
   </p><div class="verbatim-wrap"><pre class="screen">iptables -A INPUT -m multiport -p tcp -s {ip-address}/{netmask} --dports 6789,6800:7300 -j ACCEPT</pre></div></section></section><section class="sect1" id="mons-store-failures" data-id-title="Monitor store failures"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.6 </span><span class="title-name">Monitor store failures</span></span> <a title="Permalink" class="permalink" href="#mons-store-failures">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="store-corruption" data-id-title="Identifying symptoms of store corruption"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.6.1 </span><span class="title-name">Identifying symptoms of store corruption</span></span> <a title="Permalink" class="permalink" href="#store-corruption">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Ceph monitor stores the cluster map in a key/value store such as LevelDB.
    If a monitor fails due to the key/value store corruption, following error
    messages might be found in the monitor log:
   </p><div class="verbatim-wrap"><pre class="screen">Corruption: error in middle of record</pre></div><p>
    Or:
   </p><div class="verbatim-wrap"><pre class="screen">Corruption: 1 missing files; e.g.: /var/lib/ceph/mon/mon.foo/store.db/1234567.ldb</pre></div></section><section class="sect2" id="healthy-monitor-recovery" data-id-title="Recovering using healthy monitors"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.6.2 </span><span class="title-name">Recovering using healthy monitors</span></span> <a title="Permalink" class="permalink" href="#healthy-monitor-recovery">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If there are any survivors, replace the corrupted one with a new one. After
    booting up, the new joiner will sync up with a healthy peer, and once it is
    fully synchronized, it will be able to serve the clients.
   </p></section><section class="sect2" id="recovery-using-osds" data-id-title="Recovering using OSDs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.6.3 </span><span class="title-name">Recovering using OSDs</span></span> <a title="Permalink" class="permalink" href="#recovery-using-osds">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    But what if all monitors fail at the same time? Since users are encouraged
    to deploy at least three (and preferably five) monitors in a Ceph cluster,
    the chance of simultaneous failure is rare. But unplanned power-downs in a
    data center with improperly configured disk/fs settings could fail the
    underlying file system, and hence kill all the monitors. In this case, we
    can recover the monitor store with the information stored in OSDs.
   </p><div class="verbatim-wrap"><pre class="screen">  ms=/root/mon-store
  mkdir $ms

  # collect the cluster map from stopped OSDs
  for host in $hosts; do
    rsync -avz $ms/. user@$host:$ms.remote
    rm -rf $ms
    ssh user@$host EOF
      for osd in /var/lib/ceph/osd/ceph-*; do
        ceph-objectstore-tool --data-path \$osd --no-mon-config --op update-mon-db --mon-store-path $ms.remote
      done
  EOF
    rsync -avz user@$host:$ms.remote/. $ms
  done

  # rebuild the monitor store from the collected map, if the cluster does not
  # use cephx authentication, we can skip the following steps to update the
  # keyring with the caps, and there is no need to pass the "--keyring" option.
  # i.e. just use "ceph-monstore-tool $ms rebuild" instead
  ceph-authtool /path/to/admin.keyring -n mon. \
    --cap mon 'allow *'
  ceph-authtool /path/to/admin.keyring -n client.admin \
    --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *'
  # add one or more ceph-mgr's key to the keyring. in this case, an encoded key
  # for mgr.x is added, you can find the encoded key in
  # /etc/ceph/${cluster}.${mgr_name}.keyring on the machine where ceph-mgr is
  # deployed
  ceph-authtool /path/to/admin.keyring --add-key 'AQDN8kBe9PLWARAAZwxXMr+n85SBYbSlLcZnMA==' -n mgr.x \
    --cap mon 'allow profile mgr' --cap osd 'allow *' --cap mds 'allow *'
  # if your monitors' ids are not single characters like 'a', 'b', 'c', please
  # specify them in the command line by passing them as arguments of the "--mon-ids"
  # option. if you are not sure, please check your ceph.conf to see if there is any
  # sections named like '[mon.foo]'. don't pass the "--mon-ids" option, if you are
  # using DNS SRV for looking up monitors.
  ceph-monstore-tool $ms rebuild -- --keyring /path/to/admin.keyring --mon-ids alpha beta gamma

  # make a backup of the corrupted store.db just in case!  repeat for
  # all monitors.
  mv /var/lib/ceph/mon/mon.foo/store.db /var/lib/ceph/mon/mon.foo/store.db.corrupted

  # move rebuild store.db into place.  repeat for all monitors.
  mv $ms/store.db /var/lib/ceph/mon/mon.foo/store.db
  chown -R ceph:ceph /var/lib/ceph/mon/mon.foo/store.db</pre></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Collect the map from all OSD hosts.
     </p></li><li class="step"><p>
      Rebuild the store.
     </p></li><li class="step"><p>
      Fill the entities in the keyring file with appropriate caps.
     </p></li><li class="step"><p>
      Replace the corrupted store on <code class="literal">mon.foo</code> with the
      recovered copy.
     </p></li></ol></div></div><section class="sect3" id="using-osds-known-limitations" data-id-title="Known limitations"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.6.3.1 </span><span class="title-name">Known limitations</span></span> <a title="Permalink" class="permalink" href="#using-osds-known-limitations">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following information is not recoverable using the steps above:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Some added keyrings: all the OSD keyrings added using the <code class="command">ceph
       auth add</code> command are recovered from the OSD’s copy. The
       <code class="literal">client.admin</code> keyring is imported using
       <code class="literal">ceph-monstore-tool</code>. The MDS keyrings and other
       keyrings are missing in the recovered monitor store. You may need to
       re-add them manually.
      </p></li><li class="listitem"><p>
       Creating pools: If any RADOS pools were in the process of being
       creating, that state is lost. The recovery tool assumes that all pools
       have been created. If there are PGs that are stuck in the
       <code class="literal">unknown</code> state after the recovery for a partially
       created pool, you can force creation of the empty PG with the
       <code class="command">ceph osd force-create-pg</code> command. This will create an
       empty PG, so only do this if you know the pool is empty.
      </p></li><li class="listitem"><p>
       MDS Maps: the MDS maps are lost.
      </p></li></ul></div></section></section></section><section class="sect1" id="next-steps" data-id-title="Next steps"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.7 </span><span class="title-name">Next steps</span></span> <a title="Permalink" class="permalink" href="#next-steps">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="preparing-logs-mons" data-id-title="Preparing your logs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.7.1 </span><span class="title-name">Preparing your logs</span></span> <a title="Permalink" class="permalink" href="#preparing-logs-mons">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Monitor logs are, by default, kept in
    <code class="filename">/var/log/ceph/ceph-mon.FOO.log*</code>. However, your logs
    may not have the necessary information. If you do not find your monitor
    logs at their default location, you can check where they are by running:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-conf --name mon.FOO --show-config-value log_file</pre></div><p>
    The amount of information in the logs are subject to the debug levels being
    enforced by your configuration files. If you have not enforced a specific
    debug level, then Ceph is using the default levels and your logs may not
    contain important information to track down you issue. A first step in
    getting relevant information into your logs will be to raise debug levels.
    Similarly to what happens on other components, different parts of the
    monitor will output their debug information on different subsystems. You
    will have to raise the debug levels of those subsystems more closely
    related to your issue. For most situations, setting the following options
    on your monitors will be enough to pinpoint a potential source of the
    issue:
   </p><div class="verbatim-wrap"><pre class="screen">debug mon = 10
debug ms = 1</pre></div></section><section class="sect2" id="restart-adjust-debug" data-id-title="Adjusting debug levels"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.7.2 </span><span class="title-name">Adjusting debug levels</span></span> <a title="Permalink" class="permalink" href="#restart-adjust-debug">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You do not need to restart a monitor to adjust debug legals. You may do it
    in one of two ways:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      If you have a quorum, either inject the debug option into the monitor you
      want to debug:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell mon.FOO config set debug_mon 10/10</pre></div><p>
      Or into all monitors at once:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell mon.* config set debug_mon 10/10</pre></div></li><li class="listitem"><p>
      If you have no quorum, use the monitor's admin socket and directly adjust
      the configuration options:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon mon.FOO config set debug_mon 10/10</pre></div></li></ul></div><p>
    Going back to default values is as easy as rerunning the above commands
    using the debug level 1/10 instead. You can check your current values using
    the admin socket and the following commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon mon.FOO config show</pre></div><p>
    Or:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon mon.FOO config get 'OPTION_NAME'</pre></div></section></section><section class="sect1" id="deploy-mgr-manually" data-id-title="Manually deploying a MGR daemon"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.8 </span><span class="title-name">Manually deploying a MGR daemon</span></span> <a title="Permalink" class="permalink" href="#deploy-mgr-manually">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_monitors.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   cephadm requires a MGR daemon in order to manage the cluster. If the last
   MGR of a cluster was removed, follow these steps to deploy an example MGR
   daemon named <code class="literal">mgr.hostname.smfvfd</code> on a random host of your
   cluster manually:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Disable the cephadm scheduler to prevent cephadm from removing the new
     MGR daemon:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config-key set mgr/cephadm/pause true</pre></div></li><li class="step"><p>
     Get or create the auth entry for the new MGR daemon:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph auth get-or-create <em class="replaceable">mgr.hostname.smfvfd</em> \
mon "profile mgr" osd "allow *" mds "allow *"</pre></div></li><li class="step"><p>
     Generate a minimal <code class="filename">ceph.conf</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config generate-minimal-conf</pre></div></li><li class="step"><p>
     Find the name of the container image:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config get "mgr.hostname.smfvfd" container_image</pre></div></li><li class="step"><p>
     Create a file <code class="filename">config-json.json</code> which contains the
     information necessary to deploy the daemon, for example:
    </p><div class="verbatim-wrap"><pre class="screen">{
  "config": "# minimal ceph.conf for 8255263a-a97e-4934-822c-00bfe029b28f\n[global]\n\tfsid = 8255263a-a97e-4934-822c-00bfe029b28f\n\tmon_host = [v2:192.168.0.1:40483/0,v1:192.168.0.1:40484/0]\n",
  "keyring": "[mgr.hostname.smfvfd]\n\tkey = V2VyIGRhcyBsaWVzdCBpc3QgZG9vZi4=\n"
}</pre></div></li><li class="step"><p>
     Deploy the daemon:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm --image <em class="replaceable">IMAGE_NAME</em> \
 deploy --fsid <em class="replaceable">CLUSTER_FSID</em> \
 --name mgr.hostname.smfvfd --config-json config-json.json</pre></div></li></ol></div></div></section></section><section class="chapter" id="bp-troubleshooting-networking" data-id-title="Troubleshooting networking"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">Troubleshooting networking</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-networking">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_networking.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="troubleshooting-network-issues" data-id-title="Identifying OSD networking issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.1 </span><span class="title-name">Identifying OSD networking issues</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-network-issues">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_networking.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Ceph is a distributed storage system that depends on networks to peer with
   OSDs, replicate objects, recover from faults and check heartbeats.
   Networking issues can cause OSD latency and flapping OSDs. See
   <a class="xref" href="#bp-troubleshooting-flapping-osds" title="4.8. Flapping OSDs">Section 4.8, “Flapping OSDs”</a> for details.
  </p><p>
   Ensure that Ceph processes and Ceph-dependent processes are connected
   and listening.
  </p><div class="verbatim-wrap"><pre class="screen"> ss -a | grep ceph
 ss -l | grep ceph
 sudo ss -p | grep ceph</pre></div><p>
   Check network statistics:
  </p><div class="verbatim-wrap"><pre class="screen">ss -s</pre></div></section></section><section class="chapter" id="bp-troubleshooting-nfs" data-id-title="Troubleshooting NFS Ganesha"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Troubleshooting NFS Ganesha</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-nfs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_nfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="bp-troubleshooting-debug-logging" data-id-title="Debugging NFS Ganesha logs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.1 </span><span class="title-name">Debugging NFS Ganesha logs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-debug-logging">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_nfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   NFS Ganesha has the following log levels: <code class="literal">NULL</code>,
   <code class="literal">FATAL</code>, <code class="literal">MAJ</code>, <code class="literal">CRIT</code>,
   <code class="literal">WARN</code>, <code class="literal">EVENT</code>, <code class="literal">INFO</code>,
   <code class="literal">DEBUG</code>, <code class="literal">MID_DEBUG</code>,
   <code class="literal">M_DBG</code>, <code class="literal">FULL_DEBUG</code> and
   <code class="literal">F_DBG</code>.
  </p><p>
   Find the logs by running the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm logs --name nfs.<em class="replaceable">SERVICE_ID</em>.<em class="replaceable">hostname</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen">  INFO:cephadm:Inferring fsid e4d48df0-fc2a-11ea-8734-525400e03ff1 ​
  -- Logs begin at Mon 2020-09-21 18:29:25 CEST. -- ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] nfs_rpc_process_request :DISP :F_DBG :About to authenticate Prog=100003, vers=4, proc=1, xid=770234021, SVCXPRT=0x7&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] nfs_rpc_process_request :DISP :F_DBG :Before SVCAUTH_CHECKSUM on SVCXPRT 0x7f081c0030c0 fd 53 ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] export_check_access :RW LOCK :F_DBG :Got read lock on 0x7f0872a64660 (&amp;export_opt_lock) at /home/abuild/rpmbuild/BU&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] export_check_access :EXPORT :M_DBG :EXPORT_DEFAULTS (options=03303002/00080000 , , , &gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] export_check_access :EXPORT :M_DBG :default options (options=03303002/ffffffff root_squash , ----, 34-, UDP, TCP,&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] export_check_access :EXPORT :M_DBG :Final options (options=03303002/ffffffff root_squash , ----, 34-, UDP, TCP,&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] export_check_access :RW LOCK :F_DBG :Unlocked 0x7f0872a64660 (&amp;export_opt_lock) at /home/abuild/rpmbuild/BUILD/nfs-&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] get_gsh_client :RW LOCK :F_DBG :Got read lock on 0x7f0872a5e5d0 (&amp;client_by_ip.lock) at /home/abuild/rpmbuild/BUILD&gt; ​
  Sep 22 04:59:08 node1 bash[29705]: 22/09/2020 02:59:08 : epoch 5f6960b1 : node1 : ganesha.nfsd-1[svc_6] get_gsh_client :HT CACHE :DEBUG :client_mgr cache hit slot 859</pre></div><section class="sect2" id="troubleshooting-set-log-level" data-id-title="Setting the default log level"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.1.1 </span><span class="title-name">Setting the default log level</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-set-log-level">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_nfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To change the default log level, you can use a RADOS object to add a
    <code class="literal">LOG</code> configuration block.
   </p><p>
    To enable debug logging, change the log level to
    <code class="literal">FULL_DEBUG</code> to increase the log verbosity. Keep in mind
    that this can produce a large amount of log data and adversely affect
    performance.
   </p><p>
    For example:
   </p><div class="verbatim-wrap"><pre class="screen">  LOG {
      # The components block contains one or more logging components
      # and the setting to be used.
      components {
          # The ALL component is special. When set it defines the level
          # for all components and overrides any other setting in this block.
          ALL = FULL_DEBUG; # this will likely kill performance
      }
  } ​</pre></div><p>
    Put the file into a RADOS configuration object. In this example, the
    object is named <code class="filename">debugconf-nfs.foo</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados --pool nfs-ganesha --namespace foo put debugconf-nfs.foo debugconf-nfs.foo​</pre></div><p>
    Add a reference to the debug configuration object in the RADOS common
    configuration file:
   </p><div class="verbatim-wrap"><pre class="screen">%url "rados://nfs-ganesha/foo/export-1" ​
%url "rados://nfs-ganesha/foo/userconf-nfs-foo" ​
%url "rados://nfs-ganesha/foo/debugconf-nfs.foo"​</pre></div><p>
    Put the updated common configuration file into the RADOS common
    configuration object. In this example, the common configuration object is
    named <code class="filename">conf-nfs.foo</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados --pool nfs-ganesha --namespace foo put conf-nfs.foo conf-nfs.foo​</pre></div><p>
    Once both configuration objects are placed into the RADOS recovery pool,
    notify the NFS Ganesha daemons of the change:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados --pool nfs-ganesha --namespace foo notify conf-nfs.foo conf-nfs.foo ​
reply client.35746 cookie 94143722285376 : 0 bytes ​
reply client.35749 cookie 94618743368000 : 0 bytes​</pre></div></section></section><section class="sect1" id="bp-troubleshooting-default-port" data-id-title="Changing the default port"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.2 </span><span class="title-name">Changing the default port</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-default-port">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_nfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To change the default port for NFS Ganesha you can use a user defined RADOS
   configuration object to add an <code class="literal">NFS_CORE_PARAM</code> block.
  </p><p>
   Set the <code class="literal">NFS_Port</code> configuration value to the port you want
   to change. This example uses port <code class="literal">12345</code>.
  </p><div class="verbatim-wrap"><pre class="screen">  NFS_CORE_PARAM { ​
       Enable_NLM = false; ​
       Enable_RQUOTA = false; ​
       Protocols = 4; ​
       NFS_Port = 12345; ​
  }​</pre></div><p>
   Put the file into a user defined RADOS configuration object. In this
   example, the object is named <code class="filename">userconf-nfs.foo</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados --pool nfs-ganesha --namespace foo put userconf-nfs.foo userconf-nfs.foo​</pre></div><p>
   Add a reference to the parameter in your RADOS common configuration file:
  </p><div class="verbatim-wrap"><pre class="screen">%url "rados://nfs-ganesha/foo/export-1" ​
%url "rados://nfs-ganesha/foo/userconf-nfs.foo" ​</pre></div><div id="id-1.5.10.4.9" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    This action is similar to how exports are included in the common
    configuration file.
   </p></div><p>
   Put the updated common configuration file into the RADOS common
   configuration object. In this example, the common configuration object is
   named <code class="filename">conf-nfs.foo</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados --pool nfs-ganesha --namespace foo put conf-nfs.foo conf-nfs.foo​</pre></div><p>
   Once both configuration objects are placed into the RADOS recovery pool,
   restart the NFS Ganesha daemons using the Ceph orchestrator:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch restart nfs.foo ​
restart nfs.foo.node1 from host 'node1' ​
restart nfs.foo.node3 from host 'node3'</pre></div></section></section><section class="chapter" id="bp-troubleshooting-status" data-id-title="Troubleshooting Ceph health status"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-status">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following section details the statues that have been triggered and
  actions to take when the status is displayed.
 </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">MONITOR </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.4.2"><span class="term"><code class="option">MON_DOWN</code></span></dt><dd><p>
     One or more monitor daemons are down. The cluster requires a majority of
     the monitors in order to function. When one or more monitors are down,
     clients will initially have difficulty connecting to the cluster.
    </p><p>
     Restart the monitor daemon that is down as soon as possible to reduce the
     risk of a subsequent monitor failure.
    </p></dd><dt id="id-1.5.11.4.3"><span class="term"><code class="option">MON_CLOCK_SKEW</code></span></dt><dd><p>
     The clocks on the hosts running the
     <code class="systemitem">ceph-mon</code> monitor daemons are not
     well synchronized. This health alert is raised if the cluster detects a
     clock skew greater than <code class="option">mon_clock_drift_allowed</code>. Resolve
     this by synchronizing the clocks using either <code class="literal">ntpd</code> or
     <code class="literal">chrony</code>. If it is impractical to keep the clocks closely
     synchronized, the <code class="option">mon_clock_drift_allowed</code> threshold can
     be increased, but this value must stay well below the
     <code class="option">mon_lease</code> interval in order for monitor cluster to
     function properly.
    </p></dd><dt id="id-1.5.11.4.4"><span class="term"><code class="option">MON_MSGR2_NOT_ENABLED</code></span></dt><dd><p>
     The <code class="option">ms_bind_msgr2</code> option is enabled but one or more
     monitors is not configured to bind to a v2 port in the cluster's monmap.
     This means that features specific to the msgr2 protocol (for example,
     encryption) are not available on some or all connections. In most cases
     this can be corrected by issuing the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph mon enable-msgr2</pre></div><p>
     This command changes any monitor configured for the old default port 6789
     to continue to listen for v1 connections on 6789 and also listen for v2
     connections on the new default 3300 port. If a monitor is configured to
     listen for v1 connections on a non-standard port (not 6789), then the
     monmap needs to be modified manually.
    </p></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">MANAGER </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.5.2"><span class="term"><code class="option">MGR_MODULE_DEPENDENCY</code></span></dt><dd><p>
     An enabled manager module is failing its dependency check. This health
     check should come with a message from the module about the problem. For
     example, a module might report that a required package is not installed.
     In which case, the message will read: "Install the required package and
     restart your manager daemons." This health check only applies to enabled
     modules. If a module is not enabled, you can see whether it is reporting
     dependency issues in the output of <code class="command">ceph module ls</code>.
    </p></dd><dt id="id-1.5.11.5.3"><span class="term"><code class="option">MGR_MODULE_ERROR</code></span></dt><dd><p>
     A manager module has experienced an unexpected error. Typically, this
     means an unhandled exception was raised from the module's
     <code class="literal">serve</code> function. The human-readable description of the
     error may be obscurely worded if the exception did not provide a useful
     description of itself. This health check may indicate a bug. Open a bug
     report if you think you have encountered a bug. If you believe the error
     is transient, you may restart your manager daemon(s), or use <code class="command">ceph
     mgr fail</code> on the active daemon to prompt a failover to another
     daemon.
    </p></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">OSDS </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.6.2"><span class="term"><code class="option">OSD_DOWN</code></span></dt><dd><p>
     One or more OSDs are marked down. The
     <code class="systemitem">ceph-osd</code> daemon may have been
     stopped, or peer OSDs may be unable to reach the OSD over the network.
     Common causes include a stopped or crashed daemon, a down host, or a
     network outage. Verify the host is healthy, the daemon is started, and
     network is functioning. If the daemon has crashed, the daemon log file
     (<code class="filename">/var/log/ceph/ceph-osd.*</code>) may contain debugging
     information.
    </p></dd><dt id="id-1.5.11.6.3"><span class="term"><code class="option">OSD_<em class="replaceable">CRUSH TYPE</em>_DOWN</code></span></dt><dd><p>
     For example, <code class="filename">OSD_HOST_DOWN</code> or
     <code class="filename">OSD_ROOT_DOWN</code>. All the OSDs within a particular CRUSH
     subtree are marked down, for example all OSDs on a host.
    </p></dd><dt id="id-1.5.11.6.4"><span class="term"><code class="option">OSD_ORPHAN</code></span></dt><dd><p>
     An OSD is referenced in the CRUSH Map hierarchy but does not exist. The
     OSD can be removed from the CRUSH hierarchy with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush rm osd.<em class="replaceable">ID</em></pre></div></dd><dt id="id-1.5.11.6.5"><span class="term"><code class="option">OSD_OUT_OF_ORDER_FULL</code></span></dt><dd><p>
     The utilization thresholds for <code class="literal">backfillfull</code>,
     <code class="literal">nearfull</code>, <code class="literal">full</code>, and
     <code class="option">failsafe_full</code> are not ascending. The thresholds can be
     adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-backfillfull-ratio <em class="replaceable">RATIO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-nearfull-ratio <em class="replaceable">RATIO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-full-ratio <em class="replaceable">RATIO</em></pre></div></dd><dt id="id-1.5.11.6.6"><span class="term"><code class="option">OSD_FULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">full</code> threshold and
     is preventing the cluster from servicing writes. Utilization by pool can
     be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div><p>
     The currently defined <code class="literal">full</code> ratio can be seen with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd dump | grep full_ratio</pre></div><p>
     A short-term workaround to restore write availability is to raise the full
     threshold by a small amount:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-full-ratio <em class="replaceable">RATIO</em></pre></div><p>
     New storage should be added to the cluster by deploying more OSDs or
     existing data should be deleted in order to free up space.
    </p></dd><dt id="id-1.5.11.6.7"><span class="term"><code class="option">OSD_BACKFILLFULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">backfillfull</code>
     threshold, preventing data from being allowed to rebalance to this device.
     This is an early warning that rebalancing may not be able to complete and
     that the cluster is approaching <code class="literal">full</code>. Utilization by
     pool can be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div></dd><dt id="id-1.5.11.6.8"><span class="term"><code class="option">OSD_NEARFULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">nearfull</code> threshold.
     This is an early warning that the cluster is approaching
     <code class="literal">full</code>. Utilization by pool can be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div></dd><dt id="id-1.5.11.6.9"><span class="term"><code class="option">OSDMAP_FLAGS</code></span></dt><dd><p>
     One or more cluster flags of interest has been set. These flags include:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.11.6.9.2.2.1"><span class="term">full</span></dt><dd><p>
        The cluster is flagged as <code class="literal">full</code> and cannot serve
        writes
       </p></dd><dt id="id-1.5.11.6.9.2.2.2"><span class="term">pauserd, pausewr</span></dt><dd><p>
        Paused reads or writes
       </p></dd><dt id="id-1.5.11.6.9.2.2.3"><span class="term">noup</span></dt><dd><p>
        OSDs are not allowed to start
       </p></dd><dt id="id-1.5.11.6.9.2.2.4"><span class="term">nodown</span></dt><dd><p>
        OSD failure reports are being ignored and the monitors are not marking
        OSDs down
       </p></dd><dt id="id-1.5.11.6.9.2.2.5"><span class="term">noin</span></dt><dd><p>
        OSDs that were previously marked out are not being marked back in when
        they start
       </p></dd><dt id="id-1.5.11.6.9.2.2.6"><span class="term">noout</span></dt><dd><p>
        Down OSDs are not automatically marked out after the configured
        interval
       </p></dd><dt id="id-1.5.11.6.9.2.2.7"><span class="term">nobackfill, norecover, norebalance</span></dt><dd><p>
        Recovery or data rebalancing is suspended
       </p></dd><dt id="id-1.5.11.6.9.2.2.8"><span class="term">noscrub, nodeep_scrub</span></dt><dd><p>
        Scrubbing is disabled
       </p></dd><dt id="id-1.5.11.6.9.2.2.9"><span class="term">notieragent</span></dt><dd><p>
        Cache tiering activity is suspended
       </p></dd></dl></div><p>
     With the exception of <code class="literal">full</code>, these flags can be set or
     cleared with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set <em class="replaceable">FLAG</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset <em class="replaceable">FLAG</em></pre></div></dd><dt id="id-1.5.11.6.10"><span class="term"><code class="option">OSD_FLAGS</code></span></dt><dd><p>
     One or more OSDs or CRUSH <code class="literal">{nodes,device classes}</code> has a
     flag of interest set. These flags include:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.11.6.10.2.2.1"><span class="term">noup</span></dt><dd><p>
        These OSDs are not allowed to start
       </p></dd><dt id="id-1.5.11.6.10.2.2.2"><span class="term">nodown</span></dt><dd><p>
        Failure reports for these OSDs are ignored
       </p></dd><dt id="id-1.5.11.6.10.2.2.3"><span class="term">noin</span></dt><dd><p>
        If these OSDs were previously marked out automatically after a failure,
        they are not to be marked in when they start
       </p></dd><dt id="id-1.5.11.6.10.2.2.4"><span class="term">noout</span></dt><dd><p>
        If these OSDs are down they are not automatically marked out after the
        configured interval
       </p></dd></dl></div><p>
     These flags can be set and cleared in batch with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group <em class="replaceable">FLAG</em> <em class="replaceable">WHO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group <em class="replaceable">FLAG</em> <em class="replaceable">WHO</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout osd.0 osd.1
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout osd.0 osd.1
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout host-foo
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout host-foo
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout class-hdd
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout class-hdd</pre></div></dd><dt id="id-1.5.11.6.11"><span class="term"><code class="option">OLD_CRUSH_TUNABLES</code></span></dt><dd><p>
     The CRUSH Map is using old settings and should be updated. The oldest
     tunables that can be used (for example, the oldest client version that can
     connect to the cluster) without triggering this health warning are
     determined by the <code class="option">mon_crush_min_required_version</code> config
     option.
    </p></dd><dt id="id-1.5.11.6.12"><span class="term"><code class="option">OLD_CRUSH_STRAW_CALC_VERSION</code></span></dt><dd><p>
     The CRUSH Map is using an older, sub-optimal method for calculating
     intermediate weight values for straw buckets. The CRUSH Map requires an
     update to use the newer method (<code class="literal">straw_calc_version=1</code>).
    </p></dd><dt id="id-1.5.11.6.13"><span class="term"><code class="option">CACHE_POOL_NO_HIT_SET</code></span></dt><dd><p>
     One or more cache pools are not configured with a hit set to track
     utilization. This prevents the tiering agent from identifying cold objects
     to flush and evict from the cache. Hit sets can be configured on the cache
     pool with the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_type <em class="replaceable">TYPE</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_period <em class="replaceable">PERIOD-IN-SECONDS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_count <em class="replaceable">NUMBER-OF-HITSETS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_fpp <em class="replaceable">TARGET-FALSE-POSITIVE-RATE</em></pre></div></dd><dt id="id-1.5.11.6.14"><span class="term"><code class="option">OSD_NO_SORTBITWISE</code></span></dt><dd><p>
     No SUSE Enterprise Storage 7 v12.y.z OSDs are running but the
     <code class="option">sortbitwise</code> flag has not been set. Set the
     <code class="option">sortbitwise</code> flag before v12.y.z or newer OSDs can start.
     You can safely set the flag with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set sortbitwise</pre></div></dd><dt id="id-1.5.11.6.15"><span class="term"><code class="option">POOL_FULL</code></span></dt><dd><p>
     One or more pools have reached the quota and are no longer allowing
     writes. Pool quotas and utilization can be seen with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df detail</pre></div><p>
     You can either raise the pool quota with the following commands:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOLNAME</em> max_objects <em class="replaceable">NUM-OBJECTS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOLNAME</em> max_bytes <em class="replaceable">NUM-BYTES</em></pre></div><p>
     Or, you can delete existing data to reduce utilization.
    </p></dd><dt id="id-1.5.11.6.16"><span class="term"><code class="option">BLUEFS_SPILLOVER</code></span></dt><dd><p>
     One or more OSDs that use the BlueStore backend have been allocated db
     partitions (storage space for metadata, normally on a faster device) but
     that space has filled, such that metadata has overflowed onto the normal
     slow device. This is not necessarily an error condition or even
     unexpected, but if the administrator's expectation was that all metadata
     would fit on the faster device, it indicates that not enough space was
     provided. This warning can be disabled on all OSDs with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd bluestore_warn_on_bluefs_spillover false</pre></div><p>
     Alternatively, it can be disabled on a specific OSD with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd.123 bluestore_warn_on_bluefs_spillover false</pre></div><p>
     To provide more metadata space, the OSD in question can be destroyed and
     reprovisioned. This involves data migration and recovery. It is possible
     to expand the LVM logical volume backing the db storage. If the underlying
     LV has been expanded, the OSD daemon needs to be stopped and BlueFS
     informed of the device size change with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool bluefs-bdev-expand --path /var/lib/ceph/osd/ceph-$ID</pre></div></dd><dt id="id-1.5.11.6.17"><span class="term"><code class="option">BLUEFS_AVAILABLE_SPACE</code></span></dt><dd><p>
     To check how much space is free for BlueFS, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore bluefs available</pre></div><p>
     This provides output for up to 3 values; <code class="literal">BDEV_DB free</code>,
     <code class="literal">BDEV_SLOW free</code> and
     <code class="option">available_from_bluestore</code>. <code class="literal">BDEV_DB</code> and
     <code class="literal">BDEV_SLOW</code> report the amount of space that has been
     acquired by BlueFS and is considered free. Value
     <code class="option">available_from_bluestore</code> denotes ability of BlueStore
     to leave more space to BlueFS. It is normal that this value is different
     from amount of BlueStore free space, as BlueFS allocation unit is
     typically larger than BlueStore allocation unit. This means that only
     part of BlueStore free space is acceptable for BlueFS.
    </p></dd><dt id="id-1.5.11.6.18"><span class="term"><code class="option">BLUEFS_LOW_SPACE</code></span></dt><dd><p>
     If BlueFS is running low on available free space and there is little
     <code class="option">available_from_bluestore</code>, consider reducing BlueFS'
     allocation unit size. To simulate available space when the allocation unit
     is different, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore bluefs available <em class="replaceable">ALLOC-UNIT-SIZE</em></pre></div></dd><dt id="id-1.5.11.6.19"><span class="term"><code class="option">BLUESTORE_FRAGMENTATION</code></span></dt><dd><p>
     As BlueStore works, free space on underlying storage becomes fragmented.
     This is normal and unavoidable, but excessive fragmentation can cause
     slowdown. To inspect BlueStore fragmentation, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore allocator score block</pre></div><p>
     Score is given in [0-1] range. [0.0 .. 0.4] tiny fragmentation [0.4 ..
     0.7] small, acceptable fragmentation [0.7 .. 0.9] considerable, but safe
     fragmentation [0.9 .. 1.0] severe fragmentation, can impact BlueFS'
     ability to get space from BlueStore. If detailed report of free
     fragments is required, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore allocator dump block</pre></div><p>
     If the OSD process does not perform fragmentation, inspect with
     <code class="command">ceph-bluestore-tool</code>. Get the fragmentation score:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool --path /var/lib/ceph/osd/ceph-123 --allocator block free-score</pre></div><p>
     Dump detailed free chunks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool --path /var/lib/ceph/osd/ceph-123 --allocator block free-dump</pre></div></dd><dt id="id-1.5.11.6.20"><span class="term"><code class="option">BLUESTORE_LEGACY_STATFS</code></span></dt><dd><p>
     As of SUSE Enterprise Storage 6, BlueStore tracks its internal usage statistics on
     a per-pool granular basis and one or more OSDs have BlueStore volumes
     that were created prior to SUSE Enterprise Storage 7.1. If all OSDs are
     older than SUSE Enterprise Storage 7.1, the per-pool metrics are not
     available. However, if there is a mix of pre-SUSE Enterprise Storage 7.1
     and post-SUSE Enterprise Storage 7.1 OSDs, the cluster usage statistics
     reported by <code class="command">ceph df</code> will not be accurate. The old OSDs
     can be updated to use the new usage tracking scheme by stopping each OSD,
     running a repair operation, and the restarting it. For example, if
     <code class="literal">osd.123</code> requires an update, run the following command.
     To identify the unique FSID of the cluster, run <code class="command">ceph
     fsid</code>. To identify the Object Gateway daemon name, run <code class="command">ceph orch
     ps ---hostname <em class="replaceable">HOSTNAME</em></code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl stop ceph-<em class="replaceable">FSID</em>@<em class="replaceable">osd.123</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool repair --path /var/lib/ceph/osd/ceph-123
<code class="prompt root"># </code>systemctl start ceph-osd@123</pre></div><p>
     This warning can be disabled with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set global bluestore_warn_on_legacy_statfs false</pre></div></dd><dt id="id-1.5.11.6.21"><span class="term"><code class="option">BLUESTORE_DISK_SIZE_MISMATCH</code></span></dt><dd><p>
     One or more OSDs using BlueStore has an internal inconsistency between
     the size of the physical device and the metadata tracking its size. This
     can lead to the OSD crashing in the future. The OSDs in question should be
     destroyed and re-deployed. To avoid putting any data at risk, re-deploy
     only one OSD at a time. For example, if <em class="replaceable">OSD_ID</em>
     has the error:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd out osd.<em class="replaceable">OSD_ID</em>
<code class="prompt user">cephuser@adm &gt; </code>while ! ceph osd safe-to-destroy osd.<em class="replaceable">OSD_ID</em> ; do sleep 1m ; done
<code class="prompt user">cephuser@adm &gt; </code>ceph osd destroy osd.<em class="replaceable">OSD_ID</em>
<code class="prompt user">cephuser@adm &gt; </code>cephadm ceph-volume lvm zap /path/to/device
<code class="prompt user">cephuser@adm &gt; </code>cephadm ceph-volume lvm create --osd-id  <em class="replaceable">OSD_ID</em>--data /path/to/device</pre></div></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">DEVICE HEALTH </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.7.2"><span class="term"><code class="option">DEVICE_HEALTH</code></span></dt><dd><p>
     One or more devices are expected to fail. The warning threshold is
     controlled by the <code class="literal">mgr/devicehealth/warn_threshold</code>
     configuration option. This warning only applies to OSDs that are currently
     marked <code class="option">in</code>. The expected response to this failure is to
     mark the device <code class="option">out</code>. The data is then migrated off of the
     device and the hardware is removed from the system. Marking out is
     normally done automatically if
     <code class="literal">mgr/devicehealth/self_heal</code> is enabled based on the
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>. Device health can
     be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device info <em class="replaceable">DEVICE-ID</em></pre></div><p>
     Device life expectancy is set by a prediction model run by the Ceph Manager or by
     an external tool via the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device set-life-expectancy <em class="replaceable">DEVICE-ID</em> <em class="replaceable">FROM</em> <em class="replaceable">TO</em></pre></div><p>
     You can change the stored life expectancy manually, but that usually does
     not persist—the tool that originally set it reset and changing the
     stored value does not affect the actual health of the hardware device.
    </p></dd><dt id="id-1.5.11.7.3"><span class="term"><code class="option">DEVICE_HEALTH_IN_USE</code></span></dt><dd><p>
     One or more devices are expected to fail and has been marked
     <code class="option">out</code> of the cluster based on
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, but the devices
     are still participating in one more PGs. This may be because it was only
     recently marked as <code class="option">out</code> and the data is still migrating,
     or because the data cannot be migrated off for some reason (for example,
     the cluster is nearly full, or the CRUSH hierarchy is such that there is
     not another suitable OSD to migrate the data to). This message can be
     silenced by disabling the self heal behavior (setting
     <code class="literal">mgr/devicehealth/self_heal</code> to false), by adjusting the
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, or by addressing
     what is preventing data from being migrated off of the ailing device.
    </p></dd><dt id="id-1.5.11.7.4"><span class="term"><code class="option">DEVICE_HEALTH_TOOMANY</code></span></dt><dd><p>
     Too many devices are expected to fail and the
     <code class="literal">mgr/devicehealth/self_heal</code> behavior is enabled, such
     that marking <code class="option">out</code> all of the ailing devices would exceed
     the clusters <code class="option">mon_osd_min_in_ratio</code> ratio that prevents too
     many OSDs from being automatically marked <code class="option">out</code>. This can
     indicates that too many devices in the cluster are expected to fail and
     action is required to add newer (healthier) devices before too many
     devices fail and data is lost. The health message can also be silenced by
     adjusting parameters like <code class="option">mon_osd_min_in_ratio</code> or
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, but be warned that
     this increases the likelihood of unrecoverable data loss in the cluster.
    </p></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">DATA HEALTH (POOLS AND PLACEMENT GROUPS) </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.8.2"><span class="term"><code class="option">PG_AVAILABILITY</code></span></dt><dd><p>
     Data availability is reduced and the cluster is unable to service
     potential read or write requests for some data in the cluster.
     Specifically, if one or more PGs are in a state that does not allow IO
     requests to be serviced. Problematic PG states include peering, stale,
     incomplete, and in-active (if those conditions do not clear quickly).
     Detailed information about which PGs are affected is available from:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail</pre></div><p>
     In most cases the root cause is that one or more OSDs are currently down;
     see the discussion for <code class="option">OSD_DOWN</code> above. The state of
     specific problematic PGs can be queried with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell <em class="replaceable">PG_ID</em> query</pre></div></dd><dt id="id-1.5.11.8.3"><span class="term"><code class="option">PG_DEGRADED</code></span></dt><dd><p>
     Data redundancy is reduced for some data, meaning the cluster does not
     have the desired number of replicas for all data (for replicated pools) or
     erasure code fragments (for erasure coded pools). Specifically, if one or
     more PGs:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       have a degraded or undersized flag set, meaning there are not enough
       instances of that placement group in the cluster;
      </p></li><li class="listitem"><p>
       have not had the clean flag set for some time.
      </p></li></ul></div></dd><dt id="id-1.5.11.8.4"><span class="term"><code class="option">PG_RECOVERY_FULL</code></span></dt><dd><p>
     Data redundancy can be reduced or at risk for some data due to a lack of
     free space in the cluster. Specifically, one or more PGs have the
     <code class="option">recovery_toofull</code> flag set, meaning that the cluster is
     unable to migrate or recover data because one or more OSDs are above the
     full threshold. See the discussion for <code class="option">OSD_FULL</code> above for
     steps to resolve this condition.
    </p></dd><dt id="id-1.5.11.8.5"><span class="term"><code class="option">PG_BACKFILL_FULL</code></span></dt><dd><p>
     Data redundancy can be reduced or at risk for some data due to a lack of
     free space in the cluster. Specifically, one or more PGs have the
     <code class="option">backfill_toofull</code> flag set, meaning that the cluster is
     unable to migrate or recover data because one or more OSDs are above the
     backfillfull threshold. See the discussion for
     <code class="option">OSD_BACKFILLFULL</code> above for steps to resolve this
     condition.
    </p></dd><dt id="id-1.5.11.8.6"><span class="term"><code class="option">PG_DAMAGED</code></span></dt><dd><p>
     Data scrubbing has discovered some problems with data consistency in the
     cluster. Specifically, one or more PGs have the inconsistent or
     <code class="option">snaptrim_error</code> flag is set, indicating an earlier scrub
     operation found a problem, or that the repair flag is set and a repair for
     such an inconsistency is currently in progress.
    </p></dd><dt id="id-1.5.11.8.7"><span class="term"><code class="option">OSD_SCRUB_ERRORS</code></span></dt><dd><p>
     Recent OSD scrubs have uncovered inconsistencies. This error is generally
     paired with <code class="option">PG_DAMAGED</code>.
    </p></dd><dt id="id-1.5.11.8.8"><span class="term"><code class="option">LARGE_OMAP_OBJECTS</code></span></dt><dd><p>
     One or more pools contain large omap objects as determined by
     <code class="option">osd_deep_scrub_large_omap_object_key_threshold</code> (threshold
     for number of keys to determine a large omap object) or
     <code class="option">osd_deep_scrub_large_omap_object_value_sum_threshold</code> (the
     threshold for summed size (bytes) of all key values to determine a large
     omap object) or both. More information on the object name, key count, and
     size in bytes can be found by searching the cluster log for ‘Large omap
     object found'. Large omap objects can be caused by RGW bucket index
     objects that do not have automatic resharding enabled. The thresholds can
     be adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_deep_scrub_large_omap_object_key_threshold <em class="replaceable">KEYS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_deep_scrub_large_omap_object_value_sum_threshold <em class="replaceable">BYTES</em></pre></div></dd><dt id="id-1.5.11.8.9"><span class="term"><code class="option">CACHE_POOL_NEAR_FULL</code></span></dt><dd><p>
     A cache tier pool is nearly full. Full is determined by the
     <code class="option">target_max_bytes</code> and <code class="option">target_max_objects</code>
     properties on the cache pool. Once the pool reaches the target threshold,
     write requests to the pool may block while data is flushed and evicted
     from the cache, a state that normally leads to very high latencies and
     poor performance. The cache pool target size can be adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">CACHE-POOL-NAME</em> target_max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">CACHE-POOL-NAME</em> target_max_objects <em class="replaceable">OBJECTS</em></pre></div><p>
     Normal cache flush and eviction activity can also be throttled due to
     reduced availability, performance of the base tier, or overall cluster
     load.
    </p></dd><dt id="id-1.5.11.8.10"><span class="term"><code class="option">POOL_TOO_FEW_PGS</code></span></dt><dd><p>
     One or more pools should probably have more PGs, based on the amount of
     data that is currently stored in the pool. This can lead to sub-optimal
     distribution and balance of data across the OSDs in the cluster, and
     similarly reduce overall performance. This warning is generated if the
     <code class="option">pg_autoscale_mode</code> property on the pool is set to warn. To
     disable the warning, you can disable auto-scaling of PGs for the pool
     entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> pg_autoscale_mode off</pre></div><p>
     To allow the cluster to automatically adjust the number of PGs:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> pg_autoscale_mode on</pre></div><p>
     You can also manually set the number of PGs for the pool to the
     recommended amount with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_num <em class="replaceable">NEW_PG_NUM</em></pre></div></dd><dt id="id-1.5.11.8.11"><span class="term"><code class="option">TOO_MANY_PGS</code></span></dt><dd><p>
     The number of PGs in use in the cluster is above the configurable
     threshold of <code class="option">mon_max_pg_per_osd</code> PGs per OSD. If this
     threshold is exceeded, the cluster does not allow new pools to be created,
     pool <code class="option">pg_num</code> to be increased, or pool replication to be
     increased (any of which would lead to more PGs in the cluster). A large
     number of PGs can lead to higher memory utilization for OSD daemons,
     slower peering after cluster state changes (like OSD restarts, additions,
     or removals), and higher load on the Ceph Manager and Ceph Monitor daemons. The simplest
     way to mitigate the problem is to increase the number of OSDs in the
     cluster by adding more hardware. The OSD count used for the purposes of
     this health check is the number of <code class="option">in</code> OSDs, marking
     <code class="option">out</code> OSDs <code class="option">in</code> (if there are any) can also
     help:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd in <em class="replaceable">OSD_IDs</em></pre></div></dd><dt id="id-1.5.11.8.12"><span class="term"><code class="option">POOL_TOO_MANY_PGS</code></span></dt><dd><p>
     One or more pools require more PGs based on the amount of data that is
     currently stored in the pool. This can lead to higher memory utilization
     for OSD daemons, slower peering after cluster state changes (like OSD
     restarts, additions, or removals), and higher load on the manager and
     monitor daemons. This warning is generated if the
     <code class="option">pg_autoscale_mode</code> property on the pool is set to warn. To
     disable the warning, you can disable auto-scaling of PGs for the pool
     entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_autoscale_mode off</pre></div><p>
     To allow the cluster to automatically adjust the number of PGs:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_autoscale_mode on</pre></div><p>
     You can also manually set the number of PGs for the pool to the
     recommended amount with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_num <em class="replaceable">NEW_PG_-NUM</em></pre></div></dd><dt id="id-1.5.11.8.13"><span class="term"><code class="option">POOL_TARGET_SIZE_RATIO_OVERCOMMITTED</code></span></dt><dd><p>
     One or more pools have a <code class="option">target_size_ratio</code> property set
     to estimate the expected size of the pool as a fraction of total storage,
     but the value(s) exceed the total available storage (either by themselves
     or in combination with other pools' actual usage). This can indicate that
     the <code class="option">target_size_ratio</code> value for the pool is too large,
     and should be reduced or set to zero with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> target_size_ratio 0</pre></div></dd><dt id="id-1.5.11.8.14"><span class="term"><code class="option">POOL_TARGET_SIZE_BYTES_OVERCOMMITTED</code></span></dt><dd><p>
     One or more pools have a <code class="option">target_size_bytes</code> property set
     to estimate the expected size of the pool, but the value(s) exceed the
     total available storage (either by themselves or in combination with other
     pools' actual usage). This indicates that the
     <code class="option">target_size_bytes</code> value for the pool is too large and
     should be reduced or set to zero with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> target_size_bytes 0</pre></div></dd><dt id="id-1.5.11.8.15"><span class="term"><code class="option">TOO_FEW_OSDS</code></span></dt><dd><p>
     The number of OSDs in the cluster is below the configurable threshold of
     <code class="option">osd_pool_default_size</code>.
    </p></dd><dt id="id-1.5.11.8.16"><span class="term"><code class="option">SMALLER_PGP_NUM</code></span></dt><dd><p>
     One or more pools have a <code class="option">pgp_num</code> value less than
     <code class="option">pg_num</code>, indicating that the PG count was increased
     without also increasing the placement behavior. To adjust the placement
     group number, adjust <code class="option">pgp_num</code> and <code class="option">pg_num</code>.
     Ensure that changing <code class="option">pgp_num</code> is performed first and does
     not trigger the rebalance. To resolve, set <code class="option">pgp_num</code> to
     match <code class="option">pg_num</code> and trigger the data migration with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL</em> pgp_num <em class="replaceable">PG_NUM_VALUE</em></pre></div></dd><dt id="id-1.5.11.8.17"><span class="term"><code class="option">MANY_OBJECTS_PER_PG</code></span></dt><dd><p>
     One or more pools has an average number of objects per PG that is
     significantly higher than the overall cluster average. The specific
     threshold is controlled by the
     <code class="option">mon_pg_warn_max_object_skew</code> configuration value. This
     indicates that the pool(s) containing most of the data in the cluster have
     too few PGs, or that other pools that do not contain as much data have too
     many PGs. The threshold can be raised to silence the health warning by
     adjusting the <code class="option">mon_pg_warn_max_object_skew</code> configuration
     option on the monitors.
    </p></dd><dt id="id-1.5.11.8.18"><span class="term"><code class="option">POOL_APP_NOT_ENABLED</code></span></dt><dd><p>
     A pool exists that contains one or more objects but has not been tagged
     for use by a particular application. Resolve this warning by labeling the
     pool for use by an application. For example, if the pool is used by RBD:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd pool init <em class="replaceable">POOLNAME</em></pre></div><p>
     If the pool is being used by a custom application
     <em class="replaceable">FOO</em>, you can also label via the low-level
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool application enable <em class="replaceable">FOO</em></pre></div></dd><dt id="id-1.5.11.8.19"><span class="term"><code class="option">POOL_FULL</code></span></dt><dd><p>
     One or more pools has reached (or is very close to reaching) its quota.
     The threshold to trigger this error condition is controlled by the
     <code class="option">mon_pool_quota_crit_threshold</code> configuration option. Pool
     quotas can be adjusted up or down (or removed) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_objects <em class="replaceable">OBJECTS</em></pre></div><p>
     Setting the quota value to 0 disables the quota.
    </p></dd><dt id="id-1.5.11.8.20"><span class="term"><code class="option">POOL_NEAR_FULL</code></span></dt><dd><p>
     One or more pools are approaching its quota. The threshold to trigger this
     warning condition is controlled by the
     <code class="option">mon_pool_quota_warn_threshold</code> configuration option. Pool
     quotas can be adjusted up or down (or removed) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_objects <em class="replaceable">OBJECTS</em></pre></div></dd><dt id="id-1.5.11.8.21"><span class="term"><code class="option">OBJECT_MISPLACED</code></span></dt><dd><p>
     One or more objects in the cluster is not stored on the node the cluster
     would like it to be stored on. This is an indication that data migration
     due to some recent cluster change has not yet completed. Misplaced data is
     not a dangerous condition in and of itself. Data consistency is not at
     risk and old copies of objects are not removed until the desired number of
     new copies (in the desired locations) are present.
    </p></dd><dt id="id-1.5.11.8.22"><span class="term"><code class="option">OBJECT_UNFOUND</code></span></dt><dd><p>
     One or more objects in the cluster cannot be found. Specifically, the OSDs
     know that a new or updated copy of an object should exist, but a copy of
     that version of the object has not been found on OSDs that are currently
     online. Read or write requests to unfound objects will block. Ideally, a
     down OSD can be brought back online that has the more recent copy of the
     unfound object. Candidate OSDs can be identified from the peering state
     for the PG(s) responsible for the unfound object:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell <em class="replaceable">PG_ID</em> query</pre></div><p>
     If the latest copy of the object is not available, the cluster can be told
     to roll back to a previous version of the object.
    </p></dd><dt id="id-1.5.11.8.23"><span class="term"><code class="option">SLOW_OPS</code></span></dt><dd><p>
     One or more OSD requests is taking a long time to process. This can be an
     indication of extreme load, a slow storage device, or a software bug. The
     request queue on the OSD(s) in question can be queried with the following
     command, executed from the OSD host:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.<em class="replaceable">ID</em> ops</pre></div><p>
     A summary of the slowest recent requests can be seen with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.<em class="replaceable">ID</em> dump_historic_ops</pre></div><p>
     The location of an OSD can be found with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd find osd.<em class="replaceable">ID</em></pre></div></dd><dt id="id-1.5.11.8.24"><span class="term"><code class="option">PG_NOT_SCRUBBED</code></span></dt><dd><p>
     One or more PGs have not been scrubbed recently. PGs are normally scrubbed
     every <code class="option">mon_scrub_interval</code> seconds and this warning
     triggers when <code class="option">mon_warn_pg_not_deep_scrubbed_ratio</code>
     percentage of interval has elapsed without a scrub since it was due. PGs
     do not scrub if they are not flagged as clean. This can happen if they are
     misplaced or degraded (see <code class="option">PG_AVAILABILITY</code> and
     <code class="option">PG_DEGRADED</code> above). You can manually initiate a scrub of
     a clean PG with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg scrub <em class="replaceable">PG_ID</em></pre></div></dd><dt id="id-1.5.11.8.25"><span class="term"><code class="option">PG_NOT_DEEP_SCRUBBED</code></span></dt><dd><p>
     One or more PGs have not been deep scrubbed recently. PGs are normally
     scrubbed every <code class="option">osd_deep_scrub_interval</code> seconds and this
     warning triggers when <code class="option">mon_warn_pg_not_deep_scrubbed_ratio</code>
     percentage of interval has elapsed without a scrub since it was due. PGs
     do not (deep) scrub if they are not flagged as clean. This can happen if
     they are misplaced or degraded (see <code class="option">PG_AVAILABILITY</code> and
     <code class="option">PG_DEGRADED</code> above). You can manually initiate a scrub of
     a clean PG with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg deep-scrub <em class="replaceable">PG_ID</em></pre></div></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">HEALTH CHECKS </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.9.2"><span class="term"><code class="option">CEPHADM_PAUSED</code></span></dt><dd><p>
     cephadm background work has been paused with <code class="command">ceph orch
     pause</code>. cephadm continues to perform passive monitoring
     activities (for example, checking host and daemon status), but it will not
     make any changes (for example, deploying or removing daemons).
    </p><p>
     Resume cephadm work with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch resume</pre></div></dd><dt id="id-1.5.11.9.3"><span class="term"><code class="option">CEPHADM_STRAY_HOST</code></span></dt><dd><p>
     One or more hosts have running Ceph daemons but are not registered as
     hosts managed by cephadm. This means that those services cannot
     currently be managed by cephadm. For example, restarted, upgraded,
     included in <code class="command">ceph orch ps</code>.
    </p><p>
     You can manage the host(s) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add <em class="replaceable">hostname</em></pre></div><div id="id-1.5.11.9.3.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      You may need to configure SSH access to the remote host before this will
      work.
     </p></div><p>
     Alternatively, you can manually connect to the host and ensure that
     services on that host are removed or migrated to a host that is managed by
     cephadm.
    </p><p>
     You can also disable this warning entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_stray_hosts false</pre></div></dd><dt id="id-1.5.11.9.4"><span class="term"><code class="option">CEPHADM_STRAY_DAEMON</code></span></dt><dd><p>
     One or more Ceph daemons are running but not are not managed by
     cephadm. This may be because they were deployed using a different tool,
     or because they were started manually. Those services cannot currently be
     managed by cephadm. For example, restarted, upgraded, or included in
     <code class="command">ceph orch ps</code>..
    </p><p>
     If the daemon is a stateful one (MON or OSD), it should be adopted by
     cephadm. For stateless daemons, it is usually easiest to provision a new
     daemon with the <code class="command">ceph orch apply</code> command and then stop
     the unmanaged daemon.
    </p><p>
     This warning can be disabled entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_stray_daemons false</pre></div></dd><dt id="id-1.5.11.9.5"><span class="term"><code class="option">CEPHADM_HOST_CHECK_FAILED</code></span></dt><dd><p>
     One or more hosts have failed the basic cephadm host check, which
     verifies that the host is reachable and <code class="command">cephadm</code> can be
     executed there, and that the host satisfies basic prerequisites, like a
     working container runtime (podman or docker) and working time
     synchronization. If this test fails, cephadm will not be able to manage
     services on that host.
    </p><p>
     You can manually run this check with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph cephadm check-host <em class="replaceable">hostname</em></pre></div><p>
     You can remove a broken host from management with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host rm <em class="replaceable">hostname</em></pre></div><p>
     You can disable this health warning with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_failed_host_check false</pre></div></dd></dl></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">MISCELLANEOUS </span></span><a title="Permalink" class="permalink" href="#id-1.5.11.10">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.5.11.10.2"><span class="term"><code class="option">RECENT_CRASH</code></span></dt><dd><p>
     One or more Ceph daemons have crashed recently, and the crash has not
     yet been archived or acknowledged by the administrator. This may indicate
     a software bug, a hardware problem (for example, a failing disk), or some
     other problem. New crashes can be listed with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash ls-new</pre></div><p>
     Information about a specific crash can be examined with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash info <em class="replaceable">CRASH-ID</em></pre></div><p>
     This warning can be silenced by archiving the crash (perhaps after being
     examined by an administrator) so that it does not generate this warning:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash archive <em class="replaceable">CRASH-ID</em></pre></div><p>
     Similarly, all new crashes can be archived with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash archive-all</pre></div><p>
     Archived crashes are still visible via <code class="command">ceph crash ls</code>
     but not <code class="command">ceph crash ls-new</code>. The time period for what
     recent means is controlled by the option
     <code class="literal">mgr/crash/warn_recent_interval</code> (default: two weeks).
     These warnings can be disabled entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr/crash/warn_recent_interval 0</pre></div></dd><dt id="id-1.5.11.10.3"><span class="term"><code class="option">TELEMETRY_CHANGED</code></span></dt><dd><p>
     Telemetry has been enabled but the contents of the telemetry report have
     changed since that time, so telemetry reports are not sent. The Ceph
     developers periodically revise the telemetry feature to include new and
     useful information, or to remove information found to be useless or
     sensitive. If any new information is included in the report, Ceph
     requires the administrator to re-enable telemetry to ensure they have an
     opportunity to (re)review what information is shared. To review the
     contents of the telemetry report:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry show</pre></div><p>
     The telemetry report consists of several optional channels that are
     independently enabled or disabled. To re-enable telemetry (and make this
     warning go away):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry on</pre></div><p>
     To disable telemetry (and make this warning go away):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry soff</pre></div></dd></dl></div><div class="verbatim-wrap"><pre class="screen"> groups:
  - name: cluster health
   rules:
    - alert: health error
     expr: ceph_health_status == 2
     for: 5m
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Ceph in error for &gt; 5m
    - alert: unhealthy
     expr: ceph_health_status != 0
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: Ceph not healthy for &gt; 5m
  - name: mon
   rules:
    - alert: low monitor quorum count
     expr: ceph_monitor_quorum_count &lt; 3
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Monitor count in quorum is low
  - name: osd
   rules:
    - alert: 10% OSDs down
     expr: sum(ceph_osd_down) / count(ceph_osd_in) &gt;= 0.1
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: More then 10% of OSDS are down
    - alert: OSD down
     expr: sum(ceph_osd_down) &gt; 1
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: One or more OSDS down for more then 15 minutes
    - alert: OSDs near full
     expr: (ceph_osd_utilization unless on(osd) ceph_osd_down) &gt; 80
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: OSD {{ $labels.osd }} is dangerously full, over 80%
    # alert on single OSDs flapping
    - alert: flap osd
     expr: rate(ceph_osd_up[5m])*60 &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
        OSD {{ $label.osd }} was marked down at back up at least once a
        minute for 5 minutes.
    # alert on high deviation from average PG count
    - alert: high pg count deviation
     expr: abs(((ceph_osd_pgs &gt; 0) - on (job) group_left avg(ceph_osd_pgs &gt; 0) by (job)) / on (job) group_left avg(ceph_osd_pgs &gt; 0) by (job)) &gt; 0.35
     for: 5m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
        OSD {{ $labels.osd }} deviates by more then 30% from
        average PG count
    # alert on high commit latency...but how high is too high
  - name: mds
   rules:
   # no mds metrics are exported yet
  - name: mgr
   rules:
   # no mgr metrics are exported yet
  - name: pgs
   rules:
    - alert: pgs inactive
     expr: ceph_total_pgs - ceph_active_pgs &gt; 0
     for: 5m
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: One or more PGs are inactive for more then 5 minutes.
    - alert: pgs unclean
     expr: ceph_total_pgs - ceph_clean_pgs &gt; 0
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: One or more PGs are not clean for more then 15 minutes.
  - name: nodes
   rules:
    - alert: root volume full
     expr: node_filesystem_avail{mountpoint="/"} / node_filesystem_size{mountpoint="/"} &lt; 0.1
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Root volume (OSD and MON store) is dangerously full (&lt; 10% free)
    # alert on nic packet errors and drops rates &gt; 1 packet/s
    - alert: network packets dropped
     expr: irate(node_network_receive_drop{device!="lo"}[5m]) + irate(node_network_transmit_drop{device!="lo"}[5m]) &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Node {{ $labels.instance }} experiences packet drop &gt; 1
       packet/s on interface {{ $lables.device }}
    - alert: network packet errors
     expr: irate(node_network_receive_errs{device!="lo"}[5m]) + irate(node_network_transmit_errs{device!="lo"}[5m]) &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Node {{ $labels.instance }} experiences packet errors &gt; 1
       packet/s on interface {{ $lables.device }}
    # predict fs fillup times
    - alert: storage filling
     expr: ((node_filesystem_free - node_filesystem_size) / deriv(node_filesystem_free[2d]) &lt;= 5) &gt; 0
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Mountpoint {{ $lables.mountpoint }} will be full in less then 5 days
       assuming the average fillup rate of the past 48 hours.
  - name: pools
   rules:
    - alert: pool full
     expr: ceph_pool_used_bytes / ceph_pool_available_bytes &gt; 0.9
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Pool {{ $labels.pool }} at 90% capacity or over
    - alert: pool filling up
     expr: (-ceph_pool_used_bytes / deriv(ceph_pool_available_bytes[2d]) &lt;= 5 ) &gt; 0
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Pool {{ $labels.pool }} will be full in less then 5 days
       assuming the average fillup rate of the past 48 hours.</pre></div></section><section class="chapter" id="bp-troubleshooting-dashboard" data-id-title="Troubleshooting the Ceph Dashboard"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">10 </span><span class="title-name">Troubleshooting the Ceph Dashboard</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-dashboard">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="bp-troubleshooting-locate-dashboard" data-id-title="Locating the Ceph Dashboard"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.1 </span><span class="title-name">Locating the Ceph Dashboard</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-locate-dashboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you are unsure of the location of the Ceph Dashboard, run the following
   command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph mgr services | grep dashboard
"dashboard": "https://<em class="replaceable">host</em>:<em class="replaceable">port</em>"</pre></div><p>
   The command returns the URL where the Ceph Dashboard is located:
   (https://<em class="replaceable">host</em>:<em class="replaceable">port</em>/)
  </p></section><section class="sect1" id="bp-troubleshooting-access-dashboard" data-id-title="Accessing the Ceph Dashboard"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.2 </span><span class="title-name">Accessing the Ceph Dashboard</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-access-dashboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you are unable to access the Ceph Dashboard, run through the following
   commands.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Verify the Ceph Dashboard module is enabled:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph mgr module ls</pre></div></li><li class="step"><p>
     Ensure the Ceph Dashboard module is listed in the
     <code class="literal">enabled_modules</code> section. Example snipped output from
     the <code class="command">ceph mgr module ls</code> command:
    </p><div class="verbatim-wrap"><pre class="screen">  {
      "always_on_modules": [
          "balancer",
          "crash",
          "devicehealth",
          "orchestrator",
          "osd_support",
          "pg_autoscaler",
          "progress",
          "rbd_support",
          "status",
          "telemetry",
          "volumes"
      ],
      "enabled_modules": [
          "dashboard",
          "iostat",
          "restful"
      ],
      "disabled_modules": [
          {
               ...
          }
      ]
  }</pre></div></li><li class="step"><p>
     If it is not listed, activate the module with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph mgr module enable dashboard</pre></div></li><li class="step"><p>
     Check the Ceph Manager log file for any errors. To do this, first you will need
     the name of the Ceph Manager daemon. Find this with the <code class="command"> cephadm
     ls</code> command. It will return output similar to the following
     snippet:
    </p><div class="verbatim-wrap"><pre class="screen">{ ... ,
  {
    "style": "cephadm:v1",
    "name": "mgr.master.jqxsqf",
    "fsid": "f09a96d0-2a55-11eb-a87b-525400c955e8",
    ...
  },
  ...
}</pre></div><p>
     You can then use the name given by the command above to view the log file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>cephadm logs --name mgr.master.jqxsqf -- -f</pre></div></li><li class="step"><p>
     Ensure the SSL/TSL support is configured properly:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config-key get mgr/dashboard/key
<code class="prompt user">cephuser@adm &gt; </code>ceph config-key get mgr/dashboard/crt</pre></div></li><li class="step"><p>
     Verify the self-signed certificate exists. If not, run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph dashboard create-self-signed-cert</pre></div><p>
     See <span class="intraxref">Book “Administration and Operations Guide”, Chapter 10 “Manual configuration”, Section 10.1.1 “Creating self-signed certificates”</span> for more information on
     self-signed certificates or <span class="intraxref">Book “Administration and Operations Guide”, Chapter 10 “Manual configuration”, Section 10.1.2 “Using certificates signed by CA”</span> for information
     on self-signed certificates by CA.
    </p></li></ol></div></div></section><section class="sect1" id="bp-troubleshooting-login-dashboard" data-id-title="Troubleshooting logging into the Ceph Dashboard"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.3 </span><span class="title-name">Troubleshooting logging into the Ceph Dashboard</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-login-dashboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you are unable to log into the Ceph Dashboard and you receive the following
   error, run through the procedural checks below:
  </p><div class="figure" id="dashboard-invalid-credentials"><div class="figure-contents"><div class="mediaobject"><a href="images/dashboard-invalid-credentials.png"><img src="images/dashboard-invalid-credentials.png" width="100%" alt="Failed to execute login" title="Failed to execute login"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 10.1: </span><span class="title-name">Failed to execute login </span></span><a title="Permalink" class="permalink" href="#dashboard-invalid-credentials">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Check that your user credentials are correct. If you are seeing the
     notification message above when trying to log into the Ceph Dashboard, it is
     likely you are using the wrong credentials. Double check your username and
     password, and ensure the caps lock key is not enabled by accident.
    </p></li><li class="step"><p>
     If your user credentials are correct, but you are experiencing the same
     error, check that the user account exists:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph dashboard ac-user-show <em class="replaceable">USERNAME</em></pre></div><p>
     This command returns your user data. If the user does not exist, it will
     print:
    </p><div class="verbatim-wrap"><pre class="screen">Error ENOENT: User <em class="replaceable">USERNAME</em> does not exist</pre></div><p>
     In this case, you will need to create the user. See
     <span class="intraxref">Book “Administration and Operations Guide”, Chapter 11 “Manage users and roles on the command line”, Section 11.2 “Managing user accounts”</span> for more information on user
     accounts.
    </p></li><li class="step"><p>
     Check if the user is enabled:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph dashboard ac-user-show <em class="replaceable">USERNAME</em> {..., "enabled": true, ..}</pre></div><p>
     Check if <code class="literal">enabled</code> is set to <code class="option">true</code> for
     your user. If not the user is not enabled, run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph dashboard ac-user-enable <em class="replaceable">USERNAME</em></pre></div></li></ol></div></div></section><section class="sect1" id="bp-troubleshooting-features-dashboard" data-id-title="Determining if a Ceph Dashboard feature is not working"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.4 </span><span class="title-name">Determining if a Ceph Dashboard feature is not working</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-features-dashboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When an error occurs on the backend, you will usually receive an error
   notification on the frontend. Run through the following scenarios to debug.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Check the Ceph Dashboard/mgr logfile(s) for any errors. These can be
     identified by searching for keywords, such as <span class="emphasis"><em>500 Internal
     Server Error</em></span>, followed by <code class="literal">traceback</code>. The end
     of a traceback contains more details about what exact error occurred.
    </p></li><li class="step"><p>
     Check your web browser's Javascript Console for any errors.
    </p></li></ol></div></div></section><section class="sect1" id="bp-troubleshooting-logging-dashboard" data-id-title="Ceph Dashboard logs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.5 </span><span class="title-name">Ceph Dashboard logs</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-logging-dashboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="debug-dashboard-flag" data-id-title="Debugging the Ceph Dashboard flag"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.1 </span><span class="title-name">Debugging the Ceph Dashboard flag</span></span> <a title="Permalink" class="permalink" href="#debug-dashboard-flag">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    With this flag enabled, traceback of errors are included in backend
    responses.
   </p><p>
    To enable this flag via the Ceph Dashboard, navigate from
    <span class="guimenu">Cluster</span> to <span class="guimenu">Manager modules</span>. Select
    <span class="guimenu">Dashboard module</span> and click the edit button. Click the
    <span class="guimenu">debug</span> checkbox and update.
   </p><p>
    To enable via the CLI, run the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph dashboard debug enable</pre></div><div id="id-1.5.12.7.2.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     Activating the debug flag temporarily causes a
     <code class="literal">HEALTH_WARN</code> cluster state.
    </p></div></section><section class="sect2" id="setting-log-level-dashboard-module" data-id-title="Setting logging level of Ceph Dashboard module"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.2 </span><span class="title-name">Setting logging level of Ceph Dashboard module</span></span> <a title="Permalink" class="permalink" href="#setting-log-level-dashboard-module">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Setting the logging level to debug makes the log more verbose and helpful
    for debugging.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Increase the logging level of manager daemons:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell mgr config set debug_mgr 20</pre></div></li><li class="step"><p>
      Adjust the logging level of the Ceph Dashboard module via the Ceph Dashboard or
      CLI:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        Navigate from <span class="guimenu">Cluster</span> to <span class="guimenu">Manager
        modules</span>. Select <span class="guimenu">Dashboard module</span> and click
        the edit button. Modify the <code class="literal">log_level</code> configuration.
       </p></li><li class="listitem"><p>
        To adjust via the CLI, run the following command:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>bin/ceph config set mgr mgr/dashboard/log_level debug</pre></div></li></ul></div></li></ol></div></div></section></section><section class="sect1" id="troubleshooting-dashboard-sslcert-exception" data-id-title="Adding exceptions for self-signed SSL certificates in the Ceph Dashboard"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.6 </span><span class="title-name">Adding exceptions for self-signed SSL certificates in the Ceph Dashboard</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-dashboard-sslcert-exception">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_dashboard.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Web browser shows an error page when accessing any embedded Grafana
   pages using self-signed SSL certificates. Most browsers do not display the
   button to add an exception for those pages.
  </p><p>
   Follow the next steps to add the exception.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Open the frame in a separate browser tab to add an exception.
    </p><p>
     For example, open the context menu by clicking the right mouse button and
     select the menu <span class="guimenu">This Frame</span> › <span class="guimenu">Open
     Frame in New Tab</span>.
    </p></li><li class="listitem"><p>
     In the new opened browser tab, press the <span class="guimenu">Advanced</span>
     button followed by the <span class="guimenu">Accept the risk and continue</span>
     button.
    </p></li><li class="listitem"><p>
     Finally, reload the Ceph Dashboard page to see the embedded Grafana pages.
    </p></li></ol></div></section></section><section class="chapter" id="bp-troubleshooting-objectgateway" data-id-title="Troubleshooting Object Gateway"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-objectgateway">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="troubleshooting-gateway-healthcheck" data-id-title="Running a basic health check"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.1 </span><span class="title-name">Running a basic health check</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-gateway-healthcheck">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most basic health check to test a running Object Gateway process is to simply
   point your browser or client at the Object Gateway endpoint. This should return an
   empty bucket results for the anonymous user:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>curl -I</pre></div><p>
   If the result returns a 405 status, this indicates
   <code class="literal">MethodNotAllowed</code>. The output will result in a
   <code class="literal">NoSuchBucket</code> XML file. If the result returns a 404
   status, this means the Object Gateway DNS name is misconfigured or the requests were
   not made at an endpoint resolving to Object Gateway DNS name.
  </p></section><section class="sect1" id="troubleshooting-gateway-notrunning" data-id-title="Identifying gateway issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.2 </span><span class="title-name">Identifying gateway issues</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-gateway-notrunning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the gateway is not running, usually restartinng the gateway (automatic
   under <code class="systemitem">systemd</code>) should restore the service. This can be achieved via:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch daemon restart <em class="replaceable">rgw-daemon-name</em></pre></div><p>
   For increasing the log level under the
   <code class="literal">client.<em class="replaceable">RGW_NAME</em></code> section, the
   Object Gateway configurable can be increased from 1 (default) up to 20 (very
   verbose). For the messages sent to the cluster itself the messenger debug
   levels can be raised (off by default). This is controlled via <code class="option">debug
   ms</code>. Usually a level of 1 is sufficient to gather enough
   information. For injecting arguments in a running process:
  </p><div id="id-1.5.13.4.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    This is a temporary change.
   </p></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-daemon <em class="replaceable">CLIENT_RGW_NAME</em> config set debug_rgw 20</pre></div><p>
   For persistent changes, or a non-running process, it is best to set these
   lines in the <code class="filename">ceph.conf</code> file under the
   <code class="literal">client.<em class="replaceable">rgw-name</em></code> section or,
   alternatively, using the Ceph CLI. In this case, the debug levels are
   extremely verbose, so it is best to do this only to capture error logs for a
   short time. To set the logs using the Ceph CLI, run:
  </p><div class="verbatim-wrap"><pre class="screen">   <code class="prompt user">cephuser@adm &gt; </code>ceph config set <em class="replaceable">CLIENT_RGW_NAME</em> debug_rgw 20</pre></div></section><section class="sect1" id="troubleshooting-gateway-crashed-rrgw" data-id-title="Diagnosing crashed Object Gateway process"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.3 </span><span class="title-name">Diagnosing crashed Object Gateway process</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-gateway-crashed-rrgw">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the Object Gateway process dies, you will normally see a connection refused at the
   client. In that situation, restarting Object Gateway will restore the service.
  </p><p>
   To diagnose the cause of the crash, check the log in
   <code class="filename">/var/log/ceph</code> or the core file (if one was generated).
  </p></section><section class="sect1" id="troubleshooting-gateway-blocked" data-id-title="Identifying blocked Object Gateway requests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.4 </span><span class="title-name">Identifying blocked Object Gateway requests</span></span> <a title="Permalink" class="permalink" href="#troubleshooting-gateway-blocked">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If some (or all) Object Gateway requests appear to be blocked, you can get some
   insight into the internal state of the Object Gateway daemon via its admin socket. By
   default, there will be a socket configured to reside in
   <code class="filename">/var/run/ceph</code>, and the daemon can be queried with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon /var/run/ceph/client.<em class="replaceable">rgw-name</em> help
  help                list available commands
  objecter_requests   show in-progress osd requests
  perfcounters_dump   dump perfcounters value
  perfcounters_schema dump perfcounters schema
  version             get protocol version</pre></div><p>
   Of particular interest:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon /var/run/ceph/client.rgw objecter_requests
...</pre></div><p>
   This will dump information about current in-progress requests with the
   RADOS cluster. This allows you to identify if any requests are blocked by
   a non-responsive OSD. For example, one might see:
  </p><div class="verbatim-wrap"><pre class="screen">{ "ops": [
      { "tid": 1858,
        "pg": "2.d2041a48",
        "osd": 1,
        "last_sent": "2012-03-08 14:56:37.949872",
        "attempts": 1,
        "object_id": "fatty_25647_object1857",
        "object_locator": "@2",
        "snapid": "head",
        "snap_context": "0=[]",
        "mtime": "2012-03-08 14:56:37.949813",
        "osd_ops": [
              "write 0~4096"]},
      { "tid": 1873,
        "pg": "2.695e9f8e",
        "osd": 1,
        "last_sent": "2012-03-08 14:56:37.970615",
        "attempts": 1,
        "object_id": "fatty_25647_object1872",
        "object_locator": "@2",
        "snapid": "head",
        "snap_context": "0=[]",
        "mtime": "2012-03-08 14:56:37.970555",
        "osd_ops": [
              "write 0~4096"]}],
"linger_ops": [],
"pool_ops": [],
"pool_stat_ops": [],
"statfs_ops": []}</pre></div><p>
   In this dump, two requests are in progress. The <code class="literal">last_sent</code>
   field is the time the RADOS request was sent. If this is a while ago, it
   suggests that the OSD is not responding. For example, for request 1858, you
   could check the OSD status with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg map 2.d2041a48
osdmap e9 pg 2.d2041a48 (2.0) -&gt; up [1,0] acting [1,0]</pre></div><p>
   This tells you to look at <code class="literal">osd.1</code>, the primary copy for
   this PG:
  </p><div class="verbatim-wrap"><pre class="screen">  ceph daemon osd.1 ops
  { "num_ops": 651,
   "ops": [
         { "description": "osd_op(client.4124.0:1858 fatty_25647_object1857 [write 0~4096] 2.d2041a48)",
           "received_at": "1331247573.344650",
           "age": "25.606449",
           "flag_point": "waiting for sub ops",
           "client_info": { "client": "client.4124",
               "tid": 1858}},
  ...</pre></div><p>
   The <code class="literal">flag_point</code> field indicates that the OSD is currently
   waiting for replicas to respond, in this case <code class="literal">osd.0</code>.
  </p></section><section class="sect1" id="large-omap-issues" data-id-title="Large OMAP issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.5 </span><span class="title-name">Large OMAP issues</span></span> <a title="Permalink" class="permalink" href="#large-omap-issues">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you receive a cluster warning for a large OMAP issue, it means that an
   object has exceeded one of the OSD deep scrub large OMAP object thresholds,
   usually set to 200,000 keys and 1 GiB of storage. The relevant pool or PG
   involved can be found by grepping for <span class="emphasis"><em>large OMAP
   object</em></span>, as mentioned in the warning message. Depending on the
   pool and the object key involved it might indicate one of the following:
  </p><section class="sect2" id="resharding-issues" data-id-title="Resharding issues"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.1 </span><span class="title-name">Resharding issues</span></span> <a title="Permalink" class="permalink" href="#resharding-issues">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the large OMAP object name happens to be in the
    <code class="literal"><em class="replaceable">zone</em>.rgw.buckets.index</code> pool,
    this means that a bucket has more than 200,000 keys. Dynamic resharding is
    set on by default in single site clusters which would automatically have
    resharded the bucket. For multi-site clusters, however, this is not
    supported and would have to be manually done
    <span class="intraxref">Book “Administration and Operations Guide”, Chapter 21 “Ceph Object Gateway”, Section 21.10.1 “Bucket index resharding”</span>. Looking at the bucket statistics
    reveals the total object count and the number of shards. This is helpful to
    understand if the bucket has already been resharded, in which case the
    warning is just because the deep scrub happened to run before the reshard
    process and would be cleared in the next deep scrub.
   </p></section><section class="sect2" id="usage-statistics" data-id-title="Reading usage statistics"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.2 </span><span class="title-name">Reading usage statistics</span></span> <a title="Permalink" class="permalink" href="#usage-statistics">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_objectgateway.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Usage statistics are also stored as OMAP keys in the
    <code class="literal"><em class="replaceable">zone</em>.rgw.log</code> pool. However,
    these are not automatically trimmed, therefore a manual trimming of usage
    statistics would have to be done. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>radosgw-admin usage trim [--uid=<em class="replaceable">user-id</em>] --start-date=2019-01-01 --end-date=2019-03-03</pre></div></section></section></section><section class="chapter" id="bp-troubleshooting-cephfs" data-id-title="Troubleshooting CephFS"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-cephfs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="bp-troubleshooting-slow-ops" data-id-title="Slow or stuck operations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.1 </span><span class="title-name">Slow or stuck operations</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-slow-ops">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you are experiencing apparent hung operations, the first task is to
   identify where the problem is occurring: in the client, the MDS, or the
   network connecting them. Start by looking to see if either side has stuck
   operations and narrow it down from there.
  </p></section><section class="sect1" id="bp-troubleshooting-rados-health" data-id-title="Checking RADOS health"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.2 </span><span class="title-name">Checking RADOS health</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-rados-health">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If part of the CephFS metadata or data pools is unavailable and CephFS
   is not responding, it is probably because RADOS itself is unhealthy.
  </p><p>
   Check the cluster's status with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph status</pre></div><p>
   Ceph will print the cluster status. Review
   <a class="xref" href="#bp-troubleshooting-logging" title="Chapter 2. Troubleshooting logging and debugging">Chapter 2, <em>Troubleshooting logging and debugging</em></a>,
   <a class="xref" href="#bp-troubleshooting-monitors" title="Chapter 6. Troubleshooting Ceph Monitors and Ceph Managers">Chapter 6, <em>Troubleshooting Ceph Monitors and Ceph Managers</em></a>,
   <a class="xref" href="#bp-troubleshooting-pgs" title="Chapter 5. Troubleshooting placement groups (PGs)">Chapter 5, <em>Troubleshooting placement groups (PGs)</em></a>, and
   <a class="xref" href="#bp-troubleshooting-osds" title="Chapter 4. Troubleshooting OSDs">Chapter 4, <em>Troubleshooting OSDs</em></a> for tips on what may be causing
   the issue.
  </p></section><section class="sect1" id="bp-troubleshooting-mds" data-id-title="MDS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.3 </span><span class="title-name">MDS</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-mds">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If an operation is hung inside the MDS, it will eventually show up in
   <code class="command">ceph health</code>, identifying “slow requests are blocked”. It
   may also identify clients as “failing to respond” or misbehaving in other
   ways. If the MDS identifies specific clients as misbehaving, we recommend
   investigating the root cause. Often it can be the result of the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Overloading the system
    </p></li><li class="listitem"><p>
     Running an older (misbehaving) client
    </p></li><li class="listitem"><p>
     Underlying RADOS issues
    </p></li></ul></div><section class="sect2" id="mds-slow-requests" data-id-title="Identifying MDS slow requests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.1 </span><span class="title-name">Identifying MDS slow requests</span></span> <a title="Permalink" class="permalink" href="#mds-slow-requests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can list current operations via the admin socket by running the
    following command from the MDS host:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon mds.<em class="replaceable">NAME</em> dump_ops_in_flight</pre></div><p>
    Identify the stuck commands and examine why they are stuck. Usually the
    last event will have been an attempt to gather locks, or sending the
    operation off to the MDS log. If it is waiting on the OSDs, fix them. If
    operations are stuck on a specific inode, you probably have a client
    holding caps which prevent others from using it. This can be because the
    client is trying to flush out dirty data or because you have encountered a
    bug in CephFS’ distributed file lock code (the file “capabilities”
    [“caps”] system).
   </p><p>
    If it is a result of a bug in the capabilities code, restarting the MDS is
    likely to resolve the problem.
   </p><p>
    If there are no slow requests reported on the MDS, and it is not reporting
    that clients are misbehaving, either the client has a problem or its
    requests are not reaching the MDS.
   </p></section></section><section class="sect1" id="bp-troubleshooting-kernelmount-debugging" data-id-title="Kernel mount debugging"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.4 </span><span class="title-name">Kernel mount debugging</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-kernelmount-debugging">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="kernel-mount-slow-requests" data-id-title="Slow requests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.4.1 </span><span class="title-name">Slow requests</span></span> <a title="Permalink" class="permalink" href="#kernel-mount-slow-requests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Unfortunately, the kernel client does not support the admin socket, but it
    has similar (if limited) interfaces if your kernel has
    <code class="option">debugfs</code> enabled. There will be a folder in
    <code class="filename">sys/kernel/debug/ceph/</code>, and that folder contains a
    variety of files that output interesting output when you cat them. These
    files are described below; the most interesting when debugging slow
    requests are probably the <code class="filename">mdsc</code> and
    <code class="filename">osdc</code> files.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.14.6.2.3.1"><span class="term">bdi</span></dt><dd><p>
       BDI info about the Ceph system (blocks dirtied, written, etc)
      </p></dd><dt id="id-1.5.14.6.2.3.2"><span class="term">caps</span></dt><dd><p>
       Counts of file caps structures in-memory and used
      </p></dd><dt id="id-1.5.14.6.2.3.3"><span class="term">client_options</span></dt><dd><p>
       Dumps the options provided to the CephFS mount
      </p></dd><dt id="id-1.5.14.6.2.3.4"><span class="term">dentry_Iru</span></dt><dd><p>
       Dumps the CephFS dentries currently in-memory
      </p></dd><dt id="id-1.5.14.6.2.3.5"><span class="term">mdsc</span></dt><dd><p>
       Dumps current requests to the MDS
      </p></dd><dt id="id-1.5.14.6.2.3.6"><span class="term">mdsmap</span></dt><dd><p>
       Dumps the current MDSMap epoch and MDSes
      </p></dd><dt id="id-1.5.14.6.2.3.7"><span class="term">mds_sessions</span></dt><dd><p>
       Dumps the current sessions to MDSes
      </p></dd><dt id="id-1.5.14.6.2.3.8"><span class="term">monc</span></dt><dd><p>
       Dumps the current maps from the monitor, and any subscriptions held
      </p></dd><dt id="id-1.5.14.6.2.3.9"><span class="term">monmap</span></dt><dd><p>
       Dumps the current monitor map epoch and monitors
      </p></dd><dt id="id-1.5.14.6.2.3.10"><span class="term">osdc</span></dt><dd><p>
       Dumps the current ops in-flight to OSDs (ie, file data IO)
      </p></dd><dt id="id-1.5.14.6.2.3.11"><span class="term">osdmap</span></dt><dd><p>
       Dumps the current OSDMap epoch, pools, and OSDs
      </p></dd></dl></div></section></section><section class="sect1" id="bp-troubleshooting-disconnected-remounted-fs" data-id-title="Disconnecting and remounting the file system"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.5 </span><span class="title-name">Disconnecting and remounting the file system</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-disconnected-remounted-fs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Because CephFS has a consistent cache, if your network connection is
   disrupted for a long enough time the client will be forcibly disconnected
   from the system. At this point, the kernel client is in a bind: it cannot
   safely write back dirty data, and many applications do not handle IO errors
   correctly on <code class="literal">close()</code>. At the moment, the kernel client
   will remount the FS, but outstanding filesystem IO may or may not be
   satisfied. In these cases, you may need to reboot your client system.
  </p><p>
   You can identify you are in this situation if
   <code class="filename">dmesg/kern.log</code> report something like:
  </p><div class="verbatim-wrap"><pre class="screen">  Jul 20 08:14:38 teuthology kernel: [3677601.123718] ceph: mds0 closed our session
  Jul 20 08:14:38 teuthology kernel: [3677601.128019] ceph: mds0 reconnect start
  Jul 20 08:14:39 teuthology kernel: [3677602.093378] ceph: mds0 reconnect denied
  Jul 20 08:14:39 teuthology kernel: [3677602.098525] ceph:  dropping dirty+flushing Fw state for ffff8802dc150518 1099935956631
  Jul 20 08:14:39 teuthology kernel: [3677602.107145] ceph:  dropping dirty+flushing Fw state for ffff8801008e8518 1099935946707
  Jul 20 08:14:39 teuthology kernel: [3677602.196747] libceph: mds0 172.21.5.114:6812 socket closed (con state OPEN)
  Jul 20 08:14:40 teuthology kernel: [3677603.126214] libceph: mds0 172.21.5.114:6812 connection reset
  Jul 20 08:14:40 teuthology kernel: [3677603.132176] libceph: reset on mds0</pre></div><p>
   This is an area of ongoing work to improve the behavior. Kernels will soon
   be reliably issuing error codes to in-progress IO, although your
   application(s) may not deal with them well. In the longer-term, we hope to
   allow reconnect and reclaim of data in cases where it will not violate POSIX
   semantics.
  </p></section><section class="sect1" id="bp-troubleshooting-mounting" data-id-title="Mounting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.6 </span><span class="title-name">Mounting</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-mounting">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="mount-5-error" data-id-title="Mount I/O error"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.6.1 </span><span class="title-name">Mount I/O error</span></span> <a title="Permalink" class="permalink" href="#mount-5-error">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A <code class="literal">mount 5</code> (EIO, I/O error) error typically occurs if a
    MDS server is laggy or if it crashed. Ensure at least one MDS is up and
    running, and the cluster is <code class="literal">active + healthy</code>.
   </p></section><section class="sect2" id="mount-12-error" data-id-title="Mount out of memory error"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.6.2 </span><span class="title-name">Mount out of memory error</span></span> <a title="Permalink" class="permalink" href="#mount-12-error">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A <code class="literal">mount 12</code> error (ENOMEM, out of memory) with
    <code class="literal">cannot allocate memory</code> usually occurs if you have a
    version mismatch between the Ceph Client version and the Ceph Storage
    Cluster version. Check the versions using:
   </p><div class="verbatim-wrap"><pre class="screen">ceph -v</pre></div><p>
    If the Ceph Client is behind the Ceph cluster, try to upgrade it:
   </p><div class="verbatim-wrap"><pre class="screen">sudo zypper up
sudo zypper in ceph-common</pre></div><p>
    You may need to uninstall, autoclean and autoremove
    <code class="command">ceph-common</code> and then reinstall it so that you have the
    latest version.
   </p></section></section><section class="sect1" id="bp-troubleshooting-old-clients-mount" data-id-title="Mounting CephFS using old kernel clients"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.7 </span><span class="title-name">Mounting CephFS using old kernel clients</span></span> <a title="Permalink" class="permalink" href="#bp-troubleshooting-old-clients-mount">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The kernel since SUSE Linux Enterprise Server 15 SP2 includes a CephFS client that is able to
   take full advantage of all the features available on an SES7 cluster. All
   relevant features and bug fixes are backported to this operating system.
  </p><p>
   However, it may be necessary to access CephFS from other systems that may
   provide an older CephFS client, which may not support all the features
   required by an SUSE Enterprise Storage 7.1 cluster. When this happens, the
   kernel client will fail to mount the file system and will emit messages
   similar to the one shown below:
  </p><div class="verbatim-wrap"><pre class="screen">[ 4187.023633] libceph: mon0 192.168.122.150:6789 feature set mismatch, my 107b84a842aca &lt; server's 40107b84a842aca, missing 400000000000000
[ 4187.023838] libceph: mon0 192.168.122.150:6789 missing required protocol features</pre></div><p>
   The message above means that the MON identified 0x400000000000000 as the
   missing feature in the client (the value 0x107b84a842aca represents all the
   features supported by the client, while 0x40107b84a842aca represents the
   minimum set of features required by the cluster). From the following table,
   which shows the complete list of feature bits, we can see that the missing
   feature bit 58 (2^58 = 0x400000000000000) is CRUSH_TUNABLES5,
   NEW_OSDOPREPLY_ENCODING, or FS_FILE_LAYOUT_V2 (all these three features
   share the same feature bit).
  </p><div class="table" id="id-1.5.14.9.6" data-id-title="Ceph features"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 12.1: </span><span class="title-name">Ceph features </span></span><a title="Permalink" class="permalink" href="#id-1.5.14.9.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col1"/><col style="text-align: right; " class="col2"/><col style="text-align: right; " class="col3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Feature</th><th style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">Bit</th><th style="text-align: right; border-bottom: 1px solid ; ">Value</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">UID</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">0</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NOSRCADDR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FLOCK</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">3</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SUBSCRIBE2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">4</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MONNAMES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RECONNECT_SEQ</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">6</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">DIRLAYOUTHASH</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">7</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OBJECTLOCATOR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">8</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">PGID64</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">9</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">INCSUBOSDMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">10</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">PGPOOL3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">11</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDREPLYMUX</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">12</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">13</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_KRAKEN</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">14</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MONENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">15</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">18</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_LUMINOUS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RESEND_ON_SPLIT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RADOS_BACKOFF</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDMAP_PG_UPMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_CHOOSE_ARGS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSG_AUTH</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">23</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">25</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CREATEPOOLID</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">26</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">REPLY_CREATE_INODE</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">27</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_M</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">28</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDSENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">29</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDHASHPSPOOL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">30</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_SINGLE_PAXOS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">31</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_CACHEPOOL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">35</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">36</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">EXPORT_PEER</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">37</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_ERASURE_CODES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">38</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_OSD_TMAP2OMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">38</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDMAP_ENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">39</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDS_INLINE_DATA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">40</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">41</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_PRIMARY_AFFINITY</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">41</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSGR_KEEPALIVE2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">42</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_POOLRESEND</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">43</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">ERASURE_CODE_PLUGINS_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">44</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_FADVISE_FLAGS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">46</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDS_QUOTA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">47</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V4</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">48</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_METADATA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">50</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_BITWISE_HOBJ_SORT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">51</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_PROXY_WRITE_FEATURES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">52</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">ERASURE_CODE_PLUGINS_V3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">53</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_HITSET_GMT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">54</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">HAMMER_0_94_4</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">55</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NEW_OSDOP_ENCODING</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">56</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_STATEFUL_SUB</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_ROUTE_OSDMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDSUBOP_NO_SNAPCONTEXT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_JEWEL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES5</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NEW_OSDOPREPLY_ENCODING</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_FILE_LAYOUT_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_BTIME</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_CHANGE_ATTR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSG_ADDR2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_RECOVERY_DELETES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">60</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CEPHX_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">61</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000000000000</td></tr><tr><td style="border-right: 1px solid ; ">RESERVED</td><td style="text-align: right; border-right: 1px solid ; ">62</td><td style="text-align: right; ">0x4000000000000000</td></tr></tbody></table></div></div><p>
   A possible solution to allow an old kernel client to mount a recent CephFS
   is to modify the cluster CRUSH profile. CRUSH profiles define a set of CRUSH
   tunables that are named after the Ceph versions in which they were
   introduced. For example, the <code class="literal">firefly</code> tunables are first
   supported in the Firefly release (0.80), and older clients will not be able
   to access the cluster. Thus, to fix the problem shown above, the following
   command can be used:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush tunables hammer</pre></div><p>
   This will adjust the CRUSH profile to the behaviour it had for the Hammer
   (0.94) release. Note however that this is not the optimal behaviour for the
   cluster. To change back to the optimal profile, run the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush tunables optimal</pre></div><p>
   The following table lists the available CRUSH profiles and which CRUSH
   tunables versions (the CRUSH_TUNABLE feature bits in the previous table)
   they correspond to. It also identifies the minimum kernel version required
   to use for each profile. Note however that Operating System vendors may
   choose to backport features to their kernels, so these kernel versions are
   valid for mainline kernels only. The kernel client included since SUSE Linux Enterprise Server 15
   SP2, for example, includes backports of features and bug fixes relevant for
   usage in SUSE Enterprise Storage 7.1 clusters.
  </p><div class="table" id="id-1.5.14.9.12" data-id-title="CRUSH profiles"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 12.2: </span><span class="title-name">CRUSH profiles </span></span><a title="Permalink" class="permalink" href="#id-1.5.14.9.12">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH Profile</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Ceph Release</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH Tunable</th><th style="border-bottom: 1px solid ; ">Minimum Kernel Version</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">argonaut</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.48</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES</td><td style="border-bottom: 1px solid ; ">3.6</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">bobtail</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.56</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES2</td><td style="border-bottom: 1px solid ; ">3.9</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">firefly</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.80</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES3</td><td style="border-bottom: 1px solid ; ">3.15</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">hammer</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.94</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V4</td><td style="border-bottom: 1px solid ; ">4.1</td></tr><tr><td style="border-right: 1px solid ; ">jewel</td><td style="border-right: 1px solid ; ">10.2.0</td><td style="border-right: 1px solid ; ">CRUSH_TUNABLES5</td><td>4.5</td></tr></tbody></table></div></div></section></section><section class="chapter" id="storage-tips" data-id-title="Hints and tips"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">13 </span><span class="title-name">Hints and tips</span></span> <a title="Permalink" class="permalink" href="#storage-tips">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The chapter provides information to help you enhance performance of your
  Ceph cluster and provides tips how to set the cluster up.
 </p><section class="sect1" id="tips-orphaned-volumes" data-id-title="Identifying orphaned volumes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.1 </span><span class="title-name">Identifying orphaned volumes</span></span> <a title="Permalink" class="permalink" href="#tips-orphaned-volumes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To identify possibly orphaned journal/WAL/DB volumes, follow these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Get a list of OSD IDs for which LVs exist, but not OSD daemon is running
     on the node.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@minion &gt; </code> comm -3 &lt;(ceph osd tree | grep up | awk '{print $4}') &lt;(cephadm ceph-volume lvm list 2&gt;/dev/null | grep ====== | awk '{print $2}')</pre></div></li><li class="step"><p>
     If the command outputs one or more OSDs (for example osd.33), take the IDs
     (33 in the prior example) and zap the associated volumes.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@minion &gt; </code> ceph-volume lvm zap --destroy --osd-id <em class="replaceable">ID</em>.</pre></div></li></ol></div></div></section><section class="sect1" id="tips-scrubbing" data-id-title="Adjusting scrubbing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.2 </span><span class="title-name">Adjusting scrubbing</span></span> <a title="Permalink" class="permalink" href="#tips-scrubbing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default, Ceph performs light scrubbing daily (find more details in
   <span class="intraxref">Book “Administration and Operations Guide”, Chapter 17 “Stored data management”, Section 17.6 “Scrubbing placement groups”</span>) and deep scrubbing weekly.
   <span class="emphasis"><em>Light</em></span> scrubbing checks object sizes and checksums to
   ensure that placement groups are storing the same object data.
   <span class="emphasis"><em>Deep</em></span> scrubbing checks an object’s content with that of
   its replicas to ensure that the actual contents are the same. The price for
   checking data integrity is increased I/O load on the cluster during the
   scrubbing procedure.
  </p><p>
   The default settings allow Ceph OSDs to initiate scrubbing at inappropriate
   times, such as during periods of heavy loads. Customers may experience
   latency and poor performance when scrubbing operations conflict with their
   operations. Ceph provides several scrubbing settings that can limit
   scrubbing to periods with lower loads or during off-peak hours.
  </p><p>
   If the cluster experiences high loads during the day and low loads late at
   night, consider restricting scrubbing to night time hours, such as 11pm till
   6am:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_scrub_begin_hour 23
<code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_scrub_end_hour 6</pre></div><p>
   If time restriction is not an effective method of determining a scrubbing
   schedule, consider using the <code class="option">osd_scrub_load_threshold</code>
   option. The default value is 0.5, but it could be modified for low load
   conditions:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_scrub_load_threshold 0.25</pre></div></section><section class="sect1" id="tips-stopping-osd-without-rebalancing" data-id-title="Stopping OSDs without rebalancing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.3 </span><span class="title-name">Stopping OSDs without rebalancing</span></span> <a title="Permalink" class="permalink" href="#tips-stopping-osd-without-rebalancing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You may need to stop OSDs for maintenance periodically. If you do not want
   CRUSH to automatically rebalance the cluster in order to avoid huge data
   transfers, set the cluster to <code class="literal">noout</code> first:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@minion &gt; </code>ceph osd set noout</pre></div><p>
   When the cluster is set to <code class="literal">noout</code>, you can begin stopping
   the OSDs within the failure domain that requires maintenance work. To
   identify the unique FSID of the cluster, run <code class="command">ceph fsid</code>.
   To identify the Object Gateway daemon name, run
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch ps ---hostname <em class="replaceable">HOSTNAME</em></pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl stop ceph-<em class="replaceable">FSID</em>@<em class="replaceable">DAEMON_NAME</em></pre></div><p>
   Find more information about operating Ceph services and identifying their
   names in <span class="intraxref">Book “Administration and Operations Guide”, Chapter 14 “Operation of Ceph services”</span>.
  </p><p>
   After you complete the maintenance, start OSDs again:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl start ceph-<em class="replaceable">FSID</em>@osd.<em class="replaceable">SERVICE_ID</em>.service</pre></div><p>
   After OSD services are started, unset the cluster from
   <code class="literal">noout</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd unset noout</pre></div></section><section class="sect1" id="storage-bp-cluster-mntc-unbalanced" data-id-title="Checking for unbalanced data writing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.4 </span><span class="title-name">Checking for unbalanced data writing</span></span> <a title="Permalink" class="permalink" href="#storage-bp-cluster-mntc-unbalanced">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When data is written to OSDs evenly, the cluster is considered balanced.
   Each OSD within a cluster is assigned its <span class="emphasis"><em>weight</em></span>. The
   weight is a relative number and tells Ceph how much of the data should be
   written to the related OSD. The higher the weight, the more data will be
   written. If an OSD has zero weight, no data will be written to it. If the
   weight of an OSD is relatively high compared to other OSDs, a large portion
   of the data will be written there, which makes the cluster unbalanced.
  </p><p>
   Unbalanced clusters have poor performance, and in the case that an OSD with
   a high weight suddenly crashes, a lot of data needs to be moved to other
   OSDs, which slows down the cluster as well.
  </p><p>
   To avoid this, you should regularly check OSDs for the amount of data
   writing. If the amount is between 30% and 50% of the capacity of a group of
   OSDs specified by a given ruleset, you need to reweight the OSDs. Check for
   individual disks and find out which of them fill up faster than the others
   (or are generally slower), and lower their weight. The same is valid for
   OSDs where not enough data is written—you can increase their weight to
   have Ceph write more data to them. In the following example, you will find
   out the weight of an OSD with ID 13, and reweight it from 3 to 3.05:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd tree | grep osd.13
 13  hdd 3                osd.13  up  1.00000  1.00000

 <code class="prompt user">cephuser@adm &gt; </code>ceph osd crush reweight osd.13 3.05
 reweighted item id 13 name 'osd.13' to 3.05 in crush map

<code class="prompt user">cephuser@adm &gt; </code>ceph osd tree | grep osd.13
 13  hdd 3.05                osd.13  up  1.00000  1.00000</pre></div><div id="id-1.5.15.7.7" data-id-title="OSD reweight by utilization" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: OSD reweight by utilization</div><p>
    The <code class="command">ceph osd reweight-by-utilization</code>
    <em class="replaceable">threshold</em> command automates the process of
    reducing the weight of OSDs which are heavily overused. By default it will
    adjust the weights downward on OSDs which reached 120% of the average
    usage, but if you include threshold it will use that percentage instead.
   </p></div></section><section class="sect1" id="storage-bp-srv-maint-fds-inc" data-id-title="Increasing file descriptors"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.5 </span><span class="title-name">Increasing file descriptors</span></span> <a title="Permalink" class="permalink" href="#storage-bp-srv-maint-fds-inc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For OSD daemons, the read/write operations are critical to keep the Ceph
   cluster balanced. They often need to have many files open for reading and
   writing at the same time. On the OS level, the maximum number of
   simultaneously open files is called 'maximum number of file descriptors'.
  </p><p>
   To prevent OSDs from running out of file descriptors, you can override the
   default and specify an appropriate value, for example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set global max_open_files 131072</pre></div><p>
   After you change <code class="option">max_open_files</code>, you need to restart the
   OSD service on the relevant Ceph node.
  </p></section><section class="sect1" id="storage-admin-integration" data-id-title="Integration with virtualization software"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.6 </span><span class="title-name">Integration with virtualization software</span></span> <a title="Permalink" class="permalink" href="#storage-admin-integration">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="storage-bp-integration-kvm" data-id-title="Storing KVM disks in Ceph cluster"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.6.1 </span><span class="title-name">Storing KVM disks in Ceph cluster</span></span> <a title="Permalink" class="permalink" href="#storage-bp-integration-kvm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can create a disk image for a KVM-driven virtual machine, store it in
    a Ceph pool, optionally convert the content of an existing image to it,
    and then run the virtual machine with <code class="command">qemu-kvm</code> making
    use of the disk image stored in the cluster. For more detailed information,
    see <span class="intraxref">Book “Administration and Operations Guide”, Chapter 27 “Ceph as a back-end for QEMU KVM instance”</span>.
   </p></section><section class="sect2" id="storage-bp-integration-libvirt" data-id-title="Storing libvirt disks in Ceph cluster"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.6.2 </span><span class="title-name">Storing <code class="systemitem">libvirt</code> disks in Ceph cluster</span></span> <a title="Permalink" class="permalink" href="#storage-bp-integration-libvirt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Similar to KVM (see <a class="xref" href="#storage-bp-integration-kvm" title="13.6.1. Storing KVM disks in Ceph cluster">Section 13.6.1, “Storing KVM disks in Ceph cluster”</a>), you
    can use Ceph to store virtual machines driven by <code class="systemitem">libvirt</code>. The advantage
    is that you can run any <code class="systemitem">libvirt</code>-supported virtualization solution, such
    as KVM, Xen, or LXC. For more information, see
    <span class="intraxref">Book “Administration and Operations Guide”, Chapter 26 “<code class="systemitem">libvirt</code> and Ceph”</span>.
   </p></section><section class="sect2" id="storage-bp-integration-xen" data-id-title="Storing Xen disks in Ceph cluster"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.6.3 </span><span class="title-name">Storing Xen disks in Ceph cluster</span></span> <a title="Permalink" class="permalink" href="#storage-bp-integration-xen">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    One way to use Ceph for storing Xen disks is to make use of <code class="systemitem">libvirt</code>
    as described in <span class="intraxref">Book “Administration and Operations Guide”, Chapter 26 “<code class="systemitem">libvirt</code> and Ceph”</span>.
   </p><p>
    Another option is to make Xen talk to the <code class="systemitem">rbd</code>
    block device driver directly:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      If you have no disk image prepared for Xen, create a new one:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd create myimage --size 8000 --pool mypool</pre></div></li><li class="step"><p>
      List images in the pool <code class="literal">mypool</code> and check if your new
      image is there:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd list mypool</pre></div></li><li class="step"><p>
      Create a new block device by mapping the <code class="literal">myimage</code> image
      to the <code class="systemitem">rbd</code> kernel module:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd map --pool mypool myimage</pre></div><div id="id-1.5.15.9.4.4.3.3" data-id-title="User name and authentication" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: User name and authentication</div><p>
       To specify a user name, use <code class="option">--id
       <em class="replaceable">user-name</em></code>. Moreover, if you use
       <code class="systemitem">cephx</code> authentication, you must also specify a
       secret. It may come from a keyring or a file containing the secret:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd map --pool rbd myimage --id admin --keyring /path/to/keyring</pre></div><p>
       or
      </p><div class="verbatim-wrap"><pre class="screen"><code class="systemitem">cephuser</code>rbd map --pool rbd myimage --id admin --keyfile /path/to/file</pre></div></div></li><li class="step"><p>
      List all mapped devices:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code><code class="command">rbd showmapped</code>
 id pool   image   snap device
 0  mypool myimage -    /dev/rbd0</pre></div></li><li class="step"><p>
      Now you can configure Xen to use this device as a disk for running a
      virtual machine. You can for example add the following line to the
      <code class="command">xl</code>-style domain configuration file:
     </p><div class="verbatim-wrap"><pre class="screen">disk = [ '/dev/rbd0,,sda', '/dev/cdrom,,sdc,cdrom' ]</pre></div></li></ol></div></div></section></section><section class="sect1" id="storage-bp-net-firewall" data-id-title="Firewall settings for Ceph"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.7 </span><span class="title-name">Firewall settings for Ceph</span></span> <a title="Permalink" class="permalink" href="#storage-bp-net-firewall">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   We recommend protecting the network cluster communication with SUSE
   Firewall. You can edit its configuration by selecting
   <span class="guimenu">YaST</span> › <span class="guimenu">Security and
   Users</span> › <span class="guimenu">Firewall</span> › <span class="guimenu">Allowed
   Services</span>.
  </p><p>
   Following is a list of Ceph-related services and numbers of the ports that
   they normally use:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.15.10.4.1"><span class="term">Ceph Dashboard</span></dt><dd><p>
      The Ceph Dashboard binds to a specific TCP/IP address and TCP port. By
      default, the currently active Ceph Manager that hosts the dashboard binds to TCP
      port 8443 (or 8080 when SSL is disabled).
     </p></dd><dt id="id-1.5.15.10.4.2"><span class="term">Ceph Monitor</span></dt><dd><p>
      Enable the <span class="guimenu">Ceph MON</span> service or ports 3300 and 6789 (TCP).
     </p></dd><dt id="id-1.5.15.10.4.3"><span class="term">Ceph OSD or Metadata Server</span></dt><dd><p>
      Enable the <span class="guimenu">Ceph OSD/MDS</span> service or ports 6800-7300
      (TCP).
     </p><p>
      This port range needs to be adjusted for dense nodes. See
      <span class="intraxref">Book “Deployment Guide”, Chapter 7 “Deploying the bootstrap cluster using <code class="systemitem">ceph-salt</code>”, Section 7.4 “Reviewing final steps”</span> for more information.
     </p></dd><dt id="id-1.5.15.10.4.4"><span class="term">iSCSI Gateway</span></dt><dd><p>
      Open port 3260 (TCP).
     </p></dd><dt id="id-1.5.15.10.4.5"><span class="term">Object Gateway</span></dt><dd><p>
      Open the port where Object Gateway communication occurs. To display it, run the
      following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config get client.rgw.<em class="replaceable">RGW_DAEMON_NAME</em> rgw_frontends</pre></div><p>
      Default is 80 for HTTP and 443 for HTTPS (TCP).
     </p></dd><dt id="id-1.5.15.10.4.6"><span class="term">NFS Ganesha</span></dt><dd><p>
      By default, NFS Ganesha uses ports 2049 (NFS service, TCP) and 875 (rquota
      support, TCP).
     </p></dd><dt id="id-1.5.15.10.4.7"><span class="term">SSH</span></dt><dd><p>
      Open port 22 (TCP).
     </p></dd><dt id="id-1.5.15.10.4.8"><span class="term">NTP</span></dt><dd><p>
      Open port 123 (UDP).
     </p></dd><dt id="id-1.5.15.10.4.9"><span class="term">Salt</span></dt><dd><p>
      Open ports 4505 and 4506 (TCP).
     </p></dd><dt id="id-1.5.15.10.4.10"><span class="term">Grafana</span></dt><dd><p>
      Open port 3000 (TCP).
     </p></dd><dt id="id-1.5.15.10.4.11"><span class="term">Prometheus</span></dt><dd><p>
      Open port 9095 (TCP).
     </p></dd></dl></div></section><section class="sect1" id="storage-bp-network-test" data-id-title="Testing network performance"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.8 </span><span class="title-name">Testing network performance</span></span> <a title="Permalink" class="permalink" href="#storage-bp-network-test">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Both intermittent and complete network failures will impact a Ceph
   cluster. These two utilities can help in tracking down the cause and
   verifying expectations.
  </p><div id="id-1.5.15.11.3" data-id-title="Sync Runners" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Sync Runners</div><p>
    Use the <code class="command">salt-run saltutil.sync_runners</code> command
    if the Salt runner is reported as <code class="literal">not available</code>.
   </p></div><section class="sect2" id="network-test-basic-diagnostics" data-id-title="Performing basic diagnostics"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.8.1 </span><span class="title-name">Performing basic diagnostics</span></span> <a title="Permalink" class="permalink" href="#network-test-basic-diagnostics">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Try the <code class="command">salt-run network.ping</code> command to ping between
    cluster nodes to see if an individual interface can reach to a specific
    interface and the average response time. Any specific response time much
    slower than average will also be reported. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.ping
Succeeded: 8 addresses from 7 minions average rtt 0.15 ms</pre></div><p>
    Or, for IPv6:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.ping6
Succeeded: 8 addresses from 7 minions average rtt 0.15 ms</pre></div><p>
    Try validating all interfaces with JumboFrame enabled:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.jumbo_ping
Succeeded: 8 addresses from 7 minions average rtt 0.26 ms</pre></div></section><section class="sect2" id="network-test-throughput-benchmark" data-id-title="Performing throughput benchmark"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.8.2 </span><span class="title-name">Performing throughput benchmark</span></span> <a title="Permalink" class="permalink" href="#network-test-throughput-benchmark">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Try the <code class="command">salt-run network.iperf</code> command to test network
    bandwidth between each pair of interfaces. On a given cluster node, a
    number of <code class="literal">iperf</code> processes (according to the number of
    CPU cores) are started as servers. The remaining cluster nodes will be used
    as clients to generate network traffic. The accumulated bandwidth of all
    per-node <code class="literal">iperf</code> processes is reported. This should
    reflect the maximum achievable network throughput on all cluster nodes. For
    example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.iperf
Fastest 2 hosts:
    |_
      - 192.168.31.25
      - 11443 Mbits/sec
    |_
      - 172.16.31.25
      - 10363 Mbits/sec

Slowest 2 hosts:
    |_
      - 172.16.32.14
      - 10217 Mbits/sec
    |_
      - 192.168.121.164
      - 10113 Mbits/sec</pre></div></section><section class="sect2" id="network-test-useful-options" data-id-title="Useful options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.8.3 </span><span class="title-name">Useful options</span></span> <a title="Permalink" class="permalink" href="#network-test-useful-options">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="option">output=full</code> option will list the results of each
    interface rather than the summary of the two slowest and fastest.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.iperf output=full
192.168.128.1:
    8644.0 Mbits/sec
192.168.128.2:
    10360.0 Mbits/sec
192.168.128.3:
    9336.0 Mbits/sec
192.168.128.4:
    9588.56 Mbits/sec
192.168.128.5:
    10187.0 Mbits/sec
192.168.128.6:
    10465.0 Mbits/sec</pre></div><p>
    The <code class="option">remove=network</code> where network is a comma delimited list
    of subnets that should not be included.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>salt-run network.ping remove="192.168.121.0/24,192.168.1.0/24"
Succeeded: 20 addresses from 10 minions average rtt 14.16 ms</pre></div></section></section><section class="sect1" id="bp-flash-led-lights" data-id-title="Locating physical disks using LED lights"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.9 </span><span class="title-name">Locating physical disks using LED lights</span></span> <a title="Permalink" class="permalink" href="#bp-flash-led-lights">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Ceph tracks which daemons manage which hardware storage devices (HDDs,
   SSDs), and collects health metrics about those devices in order to provide
   tools to predict and automatically respond to hardware failure.
  </p><p>
   You can blink the drive LEDs on hardware enclosures to make the replacement
   of failed disks easy and less error-prone. Use the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device light --enable=on --devid=string --light_type=ident --force</pre></div><p>
   The <code class="option">DEVID</code> parameter is the device identification. You can
   obtain it by running the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device ls</pre></div></section><section class="sect1" id="storage-bp-cluster-mntc-rados-striping" data-id-title="Sending large objects with rados fails with full OSD"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.10 </span><span class="title-name">Sending large objects with <code class="command">rados</code> fails with full OSD</span></span> <a title="Permalink" class="permalink" href="#storage-bp-cluster-mntc-rados-striping">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">rados</code> is a command line utility to manage RADOS object
   storage. For more information, see <code class="command">man 8 rados</code>.
  </p><p>
   If you send a large object to a Ceph cluster with the
   <code class="command">rados</code> utility, such as
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rados -p mypool put myobject /file/to/send</pre></div><p>
   it can fill up all the related OSD space and cause serious trouble to the
   cluster performance.
  </p></section><section class="sect1" id="storage-bp-recover-toomanypgs" data-id-title="Managing the Too Many PGs per OSD status message"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.11 </span><span class="title-name">Managing the 'Too Many PGs per OSD' status message</span></span> <a title="Permalink" class="permalink" href="#storage-bp-recover-toomanypgs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you receive a <code class="literal">Too Many PGs per OSD</code> message after
   running <code class="command">ceph status</code>, it means that the
   <code class="option">mon_pg_warn_max_per_osd</code> value (300 by default) was
   exceeded. This value is compared to the number of PGs per OSD ratio. This
   means that the cluster setup is not optimal.
  </p><p>
   The number of PGs cannot be reduced after the pool is created. Pools that do
   not yet contain any data can safely be deleted and then re-created with a
   lower number of PGs. Where pools already contain data, the only solution is
   to add OSDs to the cluster so that the ratio of PGs per OSD becomes lower.
  </p></section><section class="sect1" id="storage-bp-recover-stuckinactive" data-id-title="Managing the nn pg stuck inactive status message"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.12 </span><span class="title-name">Managing the '<span class="emphasis"><em>nn</em></span> pg stuck inactive' status message</span></span> <a title="Permalink" class="permalink" href="#storage-bp-recover-stuckinactive">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you receive a <code class="literal">stuck inactive</code> status message after
   running <code class="command">ceph status</code>, it means that Ceph does not know
   where to replicate the stored data to fulfill the replication rules. It can
   happen shortly after the initial Ceph setup and fix itself automatically.
   In other cases, this may require a manual interaction, such as bringing up a
   broken OSD, or adding a new OSD to the cluster. In very rare cases, reducing
   the replication level may help.
  </p><p>
   If the placement groups are stuck perpetually, you need to check the output
   of <code class="command">ceph osd tree</code>. The output should look tree-structured,
   similar to the example in <a class="xref" href="#storage-bp-recover-osddown" title="4.6. OSD is down">Section 4.6, “OSD is down”</a>.
  </p><p>
   If the output of <code class="command">ceph osd tree</code> is rather flat as in the
   following example
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd tree
ID  CLASS  WEIGHT   TYPE NAME              STATUS  REWEIGHT  PRI-AFF
-1         0.02939  root default
-3         0.00980      host doc-ses-node2
 0    hdd  0.00980          osd.0              up   1.00000  1.00000
-5         0.00980      host doc-ses-node3
 1    hdd  0.00980          osd.1              up   1.00000  1.00000
-7         0.00980      host doc-ses-node4
 2    hdd  0.00980          osd.2              up   1.00000  1.00000</pre></div><p>
   You should check that the related CRUSH map has a tree structure. If it is
   also flat, or with no hosts as in the above example, it may mean that host
   name resolution is not working correctly across the cluster.
  </p><p>
   If the hierarchy is incorrect—for example the root contains hosts, but
   the OSDs are at the top level and are not themselves assigned to
   hosts—you will need to move the OSDs to the correct place in the
   hierarchy. This can be done using the <code class="command">ceph osd crush move</code>
   and/or <code class="command">ceph osd crush set</code> commands. For further details
   see <span class="intraxref">Book “Administration and Operations Guide”, Chapter 17 “Stored data management”, Section 17.5 “CRUSH Map manipulation”</span>.
  </p></section><section class="sect1" id="storage-bp-recover-clockskew" data-id-title="Fixing clock skew warnings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.13 </span><span class="title-name">Fixing clock skew warnings</span></span> <a title="Permalink" class="permalink" href="#storage-bp-recover-clockskew">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   As a general rule, time synchronization must be configured and running on
   all nodes. Once time synchronization is set up, the clocks should not get
   skewed. However, if a clock skew is to occur, this is likely due to the
   <code class="systemitem">chronyd.service</code> not running on one
   or more hosts.
  </p><div id="id-1.5.15.16.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    It is also possible that the battery on the motherboard has died, and the
    clock skew will be more pronounced. If this is the case, be aware that it
    will take quite some time for
    <code class="systemitem">chronyd</code> to re-synchronize the
    clocks.
   </p></div><p>
   If you receive a clock skew warning, confirm that the
   <code class="systemitem">chronyd.service</code> daemon is running on
   all cluster nodes. If not, restart the service and wait for chronyd to
   re-sync the clock.
  </p><p>
   Find more information on setting up time synchronization in
   <a class="link" href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-ntp.html#sec-ntp-yast" target="_blank">https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-ntp.html#sec-ntp-yast</a>.
  </p></section><section class="sect1" id="storage-bp-performance-net-issues" data-id-title="Determining poor cluster performance caused by network problems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.14 </span><span class="title-name">Determining poor cluster performance caused by network problems</span></span> <a title="Permalink" class="permalink" href="#storage-bp-performance-net-issues">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There may be other reasons why cluster performance becomes weak, such as
   network problems. In such case, you may notice the cluster reaching quorum,
   OSD and monitor nodes going offline, data transfers taking a long time, or a
   lot of reconnect attempts.
  </p><p>
   To check whether cluster performance is degraded by network problems,
   inspect the Ceph log files under the <code class="filename">/var/log/ceph</code>
   directory.
  </p><p>
   To fix network issues on the cluster, focus on the following points:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Basic network diagnostics. Try running the <code class="literal">net.ping</code>
     diagnostics tool. This tool has cluster nodes send network pings from
     their network interfaces to the network interfaces of other cluster nodes,
     and measures the average response time. Any specific response time much
     slower then average will also be reported. See
     <a class="xref" href="#network-test-basic-diagnostics" title="13.8.1. Performing basic diagnostics">Section 13.8.1, “Performing basic diagnostics”</a> for more information.
    </p></li><li class="listitem"><p>
     Check firewall settings on cluster nodes. Make sure they do not block
     ports or protocols required by Ceph operation. See
     <a class="xref" href="#storage-bp-net-firewall" title="13.7. Firewall settings for Ceph">Section 13.7, “Firewall settings for Ceph”</a> for more information on
     firewall settings.
    </p></li><li class="listitem"><p>
     Check the networking hardware, such as network cards, cables, or switches,
     for proper operation.
    </p></li></ul></div><div id="id-1.5.15.17.6" data-id-title="Separate network" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Separate network</div><p>
    To ensure fast and safe network communication between cluster nodes, set up
    a separate network used exclusively by the cluster OSD and monitor nodes.
   </p></div></section><section class="sect1" id="trouble-jobcache" data-id-title="Managing /var running out of space"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.15 </span><span class="title-name">Managing <code class="filename">/var</code> running out of space</span></span> <a title="Permalink" class="permalink" href="#trouble-jobcache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_tips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default, the Salt Master saves every minion's result for every job in its
   <span class="emphasis"><em>job cache</em></span>. The cache can then be used later to look up
   results from previous jobs. The cache directory defaults to
   <code class="filename">/var/cache/salt/master/jobs/</code>.
  </p><p>
   Each job return from every minion is saved in a single file. Over time this
   directory can grow very large, depending on the number of published jobs and
   the value of the <code class="option">keep_jobs</code> option in the
   <code class="filename">/etc/salt/master</code> file. <code class="option">keep_jobs</code> sets
   the number of hours (24 by default) to keep information about past minion
   jobs.
  </p><div class="verbatim-wrap"><pre class="screen">keep_jobs: 24</pre></div><div id="id-1.5.15.18.5" data-id-title="Do not set keep_jobs: 0" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Do not set <code class="option">keep_jobs: 0</code></div><p>
    Setting <code class="option">keep_jobs</code> to '0' will cause the job cache cleaner
    to <span class="emphasis"><em>never</em></span> run, possibly resulting in a full partition.
   </p></div><p>
   If you want to disable the job cache, set <code class="option">job_cache</code> to
   'False':
  </p><div class="verbatim-wrap"><pre class="screen">job_cache: False</pre></div><div id="id-1.5.15.18.8" data-id-title="Restoring partition full because of job cache" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Restoring partition full because of job cache</div><p>
    When the partition with job cache files gets full because of wrong
    <code class="option">keep_jobs</code> setting, follow these steps to free disk space
    and improve the job cache settings:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Stop the Salt Master service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>systemctl stop salt-master</pre></div></li><li class="step"><p>
      Change the Salt Master configuration related to job cache by editing
      <code class="filename">/etc/salt/master</code>:
     </p><div class="verbatim-wrap"><pre class="screen">job_cache: False
keep_jobs: 1</pre></div></li><li class="step"><p>
      Clear the Salt Master job cache:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>rm -rfv /var/cache/salt/master/jobs/*</pre></div></li><li class="step"><p>
      Start the Salt Master service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root@master # </code>systemctl start salt-master</pre></div></li></ol></div></div></div></section></section><section class="chapter" id="storage-faqs" data-id-title="Frequently asked questions"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">14 </span><span class="title-name">Frequently asked questions</span></span> <a title="Permalink" class="permalink" href="#storage-faqs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="storage-bp-tuneups-pg-num" data-id-title="How does the number of placement groups affect the cluster performance?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.1 </span><span class="title-name">How does the number of placement groups affect the cluster performance?</span></span> <a title="Permalink" class="permalink" href="#storage-bp-tuneups-pg-num">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When your cluster is becoming 70% to 80% full, it is time to add more OSDs
   to it. When you increase the number of OSDs, you may consider increasing the
   number of placement groups as well.
  </p><div id="id-1.5.16.4.3" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>
    Changing the number of PGs causes a lot of data transfer within the
    cluster.
   </p></div><p>
   To calculate the optimal value for your newly-resized cluster is a complex
   task.
  </p><p>
   A high number of PGs creates small chunks of data. This speeds up recovery
   after an OSD failure, but puts a lot of load on the monitor nodes as they
   are responsible for calculating the data location.
  </p><p>
   On the other hand, a low number of PGs takes more time and data transfer to
   recover from an OSD failure, but does not impose that much load on monitor
   nodes as they need to calculate locations for less (but larger) data chunks.
  </p><p>
   Find more information on the optimal number of PGs for your cluster in
   <span class="intraxref">Book “Administration and Operations Guide”, Chapter 17 “Stored data management”, Section 17.4.2 “Determining the value of <em class="replaceable">PG_NUM</em>”</span>.
  </p></section><section class="sect1" id="storage-bp-tuneups-mix-ssd" data-id-title="Can I use SSDs and hard disks on the same cluster?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.2 </span><span class="title-name">Can I use SSDs and hard disks on the same cluster?</span></span> <a title="Permalink" class="permalink" href="#storage-bp-tuneups-mix-ssd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Solid-state drives (SSD) are generally faster than hard disks. If you mix
   the two types of disks for the same write operation, the data writing to the
   SSD disk will be slowed down by the hard disk performance. Thus, you should
   <span class="emphasis"><em>never mix SSDs and hard disks</em></span> for data writing
   following <span class="emphasis"><em>the same rule</em></span> (see
   <span class="intraxref">Book “Administration and Operations Guide”, Chapter 17 “Stored data management”, Section 17.3 “Rule sets”</span> for more information on rules for storing
   data).
  </p><p>
   There are generally 2 cases where using SSD and hard disk on the same
   cluster makes sense:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Use each disk type for writing data following different rules. Then you
     need to have a separate rule for the SSD disk, and another rule for the
     hard disk.
    </p></li><li class="listitem"><p>
     Use each disk type for a specific purpose. For example the SSD disk for
     journal, and the hard disk for storing data.
    </p></li></ol></div></section><section class="sect1" id="storage-bp-tuneups-ssd-tradeoffs" data-id-title="What are the trade-offs of ssing a journal on SSD?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.3 </span><span class="title-name">What are the trade-offs of ssing a journal on SSD?</span></span> <a title="Permalink" class="permalink" href="#storage-bp-tuneups-ssd-tradeoffs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Using SSDs for OSD journal(s) is better for performance as the journal is
   usually the bottleneck of hard disk-only OSDs. SSDs are often used to share
   journals of several OSDs.
  </p><p>
   Following is a list of potential disadvantages of using SSDs for OSD
   journal:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     SSD disks are more expensive than hard disks. But as one OSD journal
     requires up to 6GB of disk space only, the price may not be so crucial.
    </p></li><li class="listitem"><p>
     SSD disk consumes storage slots which can be otherwise used by a large
     hard disk to extend the cluster capacity.
    </p></li><li class="listitem"><p>
     SSD disks have reduced write cycles compared to hard disks, but modern
     technologies are beginning to eliminate the problem.
    </p></li><li class="listitem"><p>
     If you share more journals on the same SSD disk, you risk losing all the
     related OSDs after the SSD disk fails. This will require a lot of data to
     be moved to rebalance the cluster.
    </p></li><li class="listitem"><p>
     Hotplugging disks becomes more complex as the data mapping is not 1:1 the
     failed OSD and the journal disk.
    </p></li></ul></div></section><section class="sect1" id="storage-bp-monitoring-diskfails" data-id-title="What happens when a disk fails?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.4 </span><span class="title-name">What happens when a disk fails?</span></span> <a title="Permalink" class="permalink" href="#storage-bp-monitoring-diskfails">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When a disk with a stored cluster data has a hardware problem and fails to
   operate, here is what happens:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The related OSD crashed and is automatically removed from the cluster.
    </p></li><li class="listitem"><p>
     The failed disk's data is replicated to another OSD in the cluster from
     other copies of the same data stored in other OSDs.
    </p></li><li class="listitem"><p>
     Then you should remove the disk from the cluster CRUSH Map, and
     physically from the host hardware.
    </p></li></ul></div></section><section class="sect1" id="storage-bp-monitoring-journalfails" data-id-title="What happens when a journal disk fails?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.5 </span><span class="title-name">What happens when a journal disk fails?</span></span> <a title="Permalink" class="permalink" href="#storage-bp-monitoring-journalfails">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_faqs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Ceph can be configured to store journals or write ahead logs on devices
   separate from the OSDs. When a disk dedicated to a journal fails, the
   related OSD(s) fail as well (see
   <a class="xref" href="#storage-bp-monitoring-diskfails" title="14.4. What happens when a disk fails?">Section 14.4, “What happens when a disk fails?”</a>).
  </p><div id="id-1.5.16.8.3" data-id-title="Hosting multiple journals on one disk" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Hosting multiple journals on one disk</div><p>
    For performance boost, you can use a fast disk (such as SSD) to store
    journal partitions for several OSDs. We do not recommend to host journals
    for more than 4 OSDs on one disk, because in case of the journals' disk
    failure, you risk losing stored data for all the related OSDs' disks.
   </p></div></section></section><section class="appendix" id="id-1.5.17" data-id-title="Ceph maintenance updates based on upstream Pacific point releases"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Pacific' point releases</span></span> <a title="Permalink" class="permalink" href="#id-1.5.17">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/ceph_maintenance_updates.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Several key packages in SUSE Enterprise Storage 7.1 are based on the
  Pacific release series of Ceph. When the Ceph project
  (<a class="link" href="https://github.com/ceph/ceph" target="_blank">https://github.com/ceph/ceph</a>) publishes new point
  releases in the Pacific series, SUSE Enterprise Storage 7.1 is updated
  to ensure that the product benefits from the latest upstream bug fixes and
  feature backports.
 </p><p>
  This chapter contains summaries of notable changes contained in each upstream
  point release that has been—or is planned to be—included in the
  product.
 </p></section><section class="glossary"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">Glossary</span></span> <a title="Permalink" class="permalink" href="#id-1.5.18">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-ses/edit/main/xml/ses_glossary.xml" title="Edit source document"> </a></div></div></div></div></div><div class="line"/><div class="glossdiv" id="id-1.5.18.3" data-id-title="General"><h3 class="title">General</h3><dl><dt id="id-1.5.18.3.2"><span><span class="glossterm">Admin node</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.2">#</a></span></dt><dd class="glossdef"><p>
     The host from which you run the Ceph-related commands to administer
     cluster hosts.
    </p></dd><dt id="id-1.5.18.3.3"><span><span class="glossterm">Alertmanager</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.3">#</a></span></dt><dd class="glossdef"><p>
     A single binary which handles alerts sent by the Prometheus server and
     notifies the end user.
    </p></dd><dt id="id-1.5.18.3.4"><span><span class="glossterm">archive sync module</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.4">#</a></span></dt><dd class="glossdef"><p>
     Module that enables creating an Object Gateway zone for keeping the history of S3
     object versions.
    </p></dd><dt id="id-1.5.18.3.5"><span><span class="glossterm">Bucket</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.5">#</a></span></dt><dd class="glossdef"><p>
     A point that aggregates other nodes into a hierarchy of physical
     locations.
    </p></dd><dt id="id-1.5.18.3.9"><span><span class="glossterm">Ceph Client</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.9">#</a></span></dt><dd class="glossdef"><p>
     The collection of Ceph components which can access a Ceph Storage
     Cluster. These include the Object Gateway, the Ceph Block Device, the CephFS,
     and their corresponding libraries, kernel modules, and FUSE clients.
    </p></dd><dt id="id-1.5.18.3.14"><span><span class="glossterm">Ceph Dashboard</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.14">#</a></span></dt><dd class="glossdef"><p>
     A built-in Web-based Ceph management and monitoring application to
     administer various aspects and objects of the cluster. The dashboard is
     implemented as a Ceph Manager module.
    </p></dd><dt id="id-1.5.18.3.19"><span><span class="glossterm">Ceph Manager</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.19">#</a></span></dt><dd class="glossdef"><p>
     Ceph Manager or MGR is the Ceph manager software, which collects all the state
     from the whole cluster in one place.
    </p></dd><dt id="id-1.5.18.3.18"><span><span class="glossterm">Ceph Monitor</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.18">#</a></span></dt><dd class="glossdef"><p>
     Ceph Monitor or MON is the Ceph monitor software.
    </p></dd><dt id="id-1.5.18.3.24"><span><span class="glossterm">Ceph Object Storage</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.24">#</a></span></dt><dd class="glossdef"><p>
     The object storage "product", service or capabilities, which consists of a
     Ceph Storage Cluster and a Ceph Object Gateway.
    </p></dd><dt id="id-1.5.18.3.22"><span><span class="glossterm">Ceph OSD Daemon</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.22">#</a></span></dt><dd class="glossdef"><p>
     The <code class="command">ceph-osd</code> daemon is the component of Ceph that is
     responsible for storing objects on a local file system and providing
     access to them over the network.
    </p></dd><dt id="id-1.5.18.3.11"><span><span class="glossterm">Ceph Storage Cluster</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.11">#</a></span></dt><dd class="glossdef"><p>
     The core set of storage software which stores the user's data. Such a set
     consists of Ceph monitors and OSDs.
    </p></dd><dt id="id-1.5.18.3.10"><span><span class="glossterm"><code class="systemitem">ceph-salt</code></span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.10">#</a></span></dt><dd class="glossdef"><p>
     Provides tooling for deploying Ceph clusters managed by cephadm using
     Salt.
    </p></dd><dt id="id-1.5.18.3.6"><span><span class="glossterm">cephadm</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.6">#</a></span></dt><dd class="glossdef"><p>
     cephadm deploys and manages a Ceph cluster by connecting to hosts from
     the manager daemon via SSH to add, remove, or update Ceph daemon
     containers.
    </p></dd><dt id="id-1.5.18.3.7"><span><span class="glossterm">CephFS</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.7">#</a></span></dt><dd class="glossdef"><p>
     The Ceph file system.
    </p></dd><dt id="id-1.5.18.3.8"><span><span class="glossterm">CephX</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.8">#</a></span></dt><dd class="glossdef"><p>
     The Ceph authentication protocol. Cephx operates like Kerberos, but it
     has no single point of failure.
    </p></dd><dt id="id-1.5.18.3.13"><span><span class="glossterm">CRUSH rule</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.13">#</a></span></dt><dd class="glossdef"><p>
     The CRUSH data placement rule that applies to a particular pool or pools.
    </p></dd><dt id="id-1.5.18.3.12"><span><span class="glossterm">CRUSH, CRUSH Map</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.12">#</a></span></dt><dd class="glossdef"><p>
     <span class="emphasis"><em>Controlled Replication Under Scalable Hashing</em></span>: An
     algorithm that determines how to store and retrieve data by computing data
     storage locations. CRUSH requires a map of the cluster to pseudo-randomly
     store and retrieve data in OSDs with a uniform distribution of data across
     the cluster.
    </p></dd><dt id="id-1.5.18.3.15"><span><span class="glossterm">DriveGroups</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.15">#</a></span></dt><dd class="glossdef"><p>
     DriveGroups are a declaration of one or more OSD layouts that can be mapped
     to physical drives. An OSD layout defines how Ceph physically allocates
     OSD storage on the media matching the specified criteria.
    </p></dd><dt id="id-1.5.18.3.16"><span><span class="glossterm">Grafana</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.16">#</a></span></dt><dd class="glossdef"><p>
     Database analytics and monitoring solution.
    </p></dd><dt id="id-1.5.18.3.17"><span><span class="glossterm">Metadata Server</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.17">#</a></span></dt><dd class="glossdef"><p>
     Metadata Server or MDS is the Ceph metadata software.
    </p></dd><dt id="id-1.5.18.3.36"><span><span class="glossterm">Multi-zone</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.36">#</a></span></dt><dd class="glossdef"/><dt id="id-1.5.18.3.20"><span><span class="glossterm">Node</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.20">#</a></span></dt><dd class="glossdef"><p>
     Any single machine or server in a Ceph cluster.
    </p></dd><dt id="id-1.5.18.3.25"><span><span class="glossterm">Object Gateway</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.25">#</a></span></dt><dd class="glossdef"><p>
     The S3/Swift gateway component for Ceph Object Store. Also known as the
     RADOS Gateway (RGW).
    </p></dd><dt id="id-1.5.18.3.21"><span><span class="glossterm">OSD</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.21">#</a></span></dt><dd class="glossdef"><p>
     <span class="emphasis"><em>Object Storage Device</em></span>: A physical or logical storage
     unit.
    </p></dd><dt id="id-1.5.18.3.23"><span><span class="glossterm">OSD node</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.23">#</a></span></dt><dd class="glossdef"><p>
     A cluster node that stores data, handles data replication, recovery,
     backfilling, rebalancing, and provides some monitoring information to
     Ceph monitors by checking other Ceph OSD daemons.
    </p></dd><dt id="id-1.5.18.3.26"><span><span class="glossterm">PG</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.26">#</a></span></dt><dd class="glossdef"><p>
     Placement Group: a sub-division of a <span class="emphasis"><em>pool</em></span>, used for
     performance tuning.
    </p></dd><dt id="id-1.5.18.3.27"><span><span class="glossterm">Point Release</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.27">#</a></span></dt><dd class="glossdef"><p>
     Any ad-hoc release that includes only bug or security fixes.
    </p></dd><dt id="id-1.5.18.3.28"><span><span class="glossterm">Pool</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.28">#</a></span></dt><dd class="glossdef"><p>
     Logical partitions for storing objects such as disk images.
    </p></dd><dt id="id-1.5.18.3.29"><span><span class="glossterm">Prometheus</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.29">#</a></span></dt><dd class="glossdef"><p>
     Systems monitoring and alerting toolkit.
    </p></dd><dt id="id-1.5.18.3.31"><span><span class="glossterm">RADOS Block Device (RBD)</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.31">#</a></span></dt><dd class="glossdef"><p>
     The block storage component of Ceph. Also known as the Ceph block
     device.
    </p></dd><dt id="id-1.5.18.3.30"><span><span class="glossterm">Reliable Autonomic Distributed Object Store (RADOS)</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.30">#</a></span></dt><dd class="glossdef"><p>
     The core set of storage software which stores the user's data (MON+OSD).
    </p></dd><dt id="id-1.5.18.3.33"><span><span class="glossterm">Routing tree</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.33">#</a></span></dt><dd class="glossdef"><p>
     A term given to any diagram that shows the various routes a receiver can
     run.
    </p></dd><dt id="id-1.5.18.3.32"><span><span class="glossterm">Rule Set</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.32">#</a></span></dt><dd class="glossdef"><p>
     Rules to determine data placement for a pool.
    </p></dd><dt id="id-1.5.18.3.34"><span><span class="glossterm">Samba</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.34">#</a></span></dt><dd class="glossdef"><p>
     Windows integration software.
    </p></dd><dt id="id-1.5.18.3.35"><span><span class="glossterm">Samba Gateway</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.35">#</a></span></dt><dd class="glossdef"><p>
     The Samba Gateway joins the Active Directory in the Windows domain to authenticate
     and authorize users.
    </p></dd><dt id="id-1.5.18.3.37"><span><span class="glossterm">zonegroup</span> <a title="Permalink" class="permalink" href="#id-1.5.18.3.37">#</a></span></dt><dd class="glossdef"/></dl></div></section></section></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2023</span></div></div></footer></body></html>