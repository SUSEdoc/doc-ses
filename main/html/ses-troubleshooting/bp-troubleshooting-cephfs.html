<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>Troubleshooting CephFS | Troubleshooting Guide | SUSE Enterprise Storage 7.1</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Troubleshooting CephFS | SES 7.1"/>
<meta name="description" content="If you are experiencing apparent hung operations, the first task is to identify where the problem is occurring: in the client, the MDS, or the networ…"/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7.1"/>
<meta name="book-title" content="Troubleshooting Guide"/>
<meta name="chapter-title" content="Chapter 12. Troubleshooting CephFS"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Troubleshooting CephFS | SES 7.1"/>
<meta property="og:description" content="If you are experiencing apparent hung operations, the first task is to identify where the problem is occurring: in the client, the MDS, or the networ…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Troubleshooting CephFS | SES 7.1"/>
<meta name="twitter:description" content="If you are experiencing apparent hung operations, the first task is to identify where the problem is occurring: in the client, the MDS, or the networ…"/>
<link rel="prev" href="bp-troubleshooting-objectgateway.html" title="Chapter 11. Troubleshooting Object Gateway"/><link rel="next" href="storage-tips.html" title="Chapter 13. Hints and tips"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Troubleshooting Guide</a><span> / </span><a class="crumb" href="bp-troubleshooting-cephfs.html">Troubleshooting CephFS</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Troubleshooting Guide</div><ol><li><a href="preface-troubleshooting.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="report-software.html" class=" "><span class="title-number">1 </span><span class="title-name">Reporting software problems</span></a></li><li><a href="bp-troubleshooting-logging.html" class=" "><span class="title-number">2 </span><span class="title-name">Troubleshooting logging and debugging</span></a></li><li><a href="bp-troubleshooting-cephadm.html" class=" "><span class="title-number">3 </span><span class="title-name">Troubleshooting cephadm</span></a></li><li><a href="bp-troubleshooting-osds.html" class=" "><span class="title-number">4 </span><span class="title-name">Troubleshooting OSDs</span></a></li><li><a href="bp-troubleshooting-pgs.html" class=" "><span class="title-number">5 </span><span class="title-name">Troubleshooting placement groups (PGs)</span></a></li><li><a href="bp-troubleshooting-monitors.html" class=" "><span class="title-number">6 </span><span class="title-name">Troubleshooting Ceph Monitors and Ceph Managers</span></a></li><li><a href="bp-troubleshooting-networking.html" class=" "><span class="title-number">7 </span><span class="title-name">Troubleshooting networking</span></a></li><li><a href="bp-troubleshooting-nfs.html" class=" "><span class="title-number">8 </span><span class="title-name">Troubleshooting NFS Ganesha</span></a></li><li><a href="bp-troubleshooting-status.html" class=" "><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span></a></li><li><a href="bp-troubleshooting-dashboard.html" class=" "><span class="title-number">10 </span><span class="title-name">Troubleshooting the Ceph Dashboard</span></a></li><li><a href="bp-troubleshooting-objectgateway.html" class=" "><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></a></li><li><a href="bp-troubleshooting-cephfs.html" class=" you-are-here"><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span></a></li><li><a href="storage-tips.html" class=" "><span class="title-number">13 </span><span class="title-name">Hints and tips</span></a></li><li><a href="storage-faqs.html" class=" "><span class="title-number">14 </span><span class="title-name">Frequently asked questions</span></a></li><li><a href="bk03apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Pacific' point releases</span></a></li><li><a href="bk03go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="bp-troubleshooting-cephfs" data-id-title="Troubleshooting CephFS"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7.1</span></div><div><h1 class="title"><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#">#</a></h1></div></div></div><section class="sect1" id="bp-troubleshooting-slow-ops" data-id-title="Slow or stuck operations"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.1 </span><span class="title-name">Slow or stuck operations</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-slow-ops">#</a></h2></div></div></div><p>
   If you are experiencing apparent hung operations, the first task is to
   identify where the problem is occurring: in the client, the MDS, or the
   network connecting them. Start by looking to see if either side has stuck
   operations and narrow it down from there.
  </p></section><section class="sect1" id="bp-troubleshooting-rados-health" data-id-title="Checking RADOS health"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.2 </span><span class="title-name">Checking RADOS health</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-rados-health">#</a></h2></div></div></div><p>
   If part of the CephFS metadata or data pools is unavailable and CephFS
   is not responding, it is probably because RADOS itself is unhealthy.
  </p><p>
   Check the cluster's status with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph status</pre></div><p>
   Ceph will print the cluster status. Review
   <a class="xref" href="bp-troubleshooting-logging.html" title="Chapter 2. Troubleshooting logging and debugging">Chapter 2, <em>Troubleshooting logging and debugging</em></a>,
   <a class="xref" href="bp-troubleshooting-monitors.html" title="Chapter 6. Troubleshooting Ceph Monitors and Ceph Managers">Chapter 6, <em>Troubleshooting Ceph Monitors and Ceph Managers</em></a>,
   <a class="xref" href="bp-troubleshooting-pgs.html" title="Chapter 5. Troubleshooting placement groups (PGs)">Chapter 5, <em>Troubleshooting placement groups (PGs)</em></a>, and
   <a class="xref" href="bp-troubleshooting-osds.html" title="Chapter 4. Troubleshooting OSDs">Chapter 4, <em>Troubleshooting OSDs</em></a> for tips on what may be causing
   the issue.
  </p></section><section class="sect1" id="bp-troubleshooting-mds" data-id-title="MDS"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.3 </span><span class="title-name">MDS</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-mds">#</a></h2></div></div></div><p>
   If an operation is hung inside the MDS, it will eventually show up in
   <code class="command">ceph health</code>, identifying “slow requests are blocked”. It
   may also identify clients as “failing to respond” or misbehaving in other
   ways. If the MDS identifies specific clients as misbehaving, we recommend
   investigating the root cause. Often it can be the result of the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Overloading the system
    </p></li><li class="listitem"><p>
     Running an older (misbehaving) client
    </p></li><li class="listitem"><p>
     Underlying RADOS issues
    </p></li></ul></div><section class="sect2" id="mds-slow-requests" data-id-title="Identifying MDS slow requests"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">12.3.1 </span><span class="title-name">Identifying MDS slow requests</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#mds-slow-requests">#</a></h3></div></div></div><p>
    You can list current operations via the admin socket by running the
    following command from the MDS host:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon mds.<em class="replaceable">NAME</em> dump_ops_in_flight</pre></div><p>
    Identify the stuck commands and examine why they are stuck. Usually the
    last event will have been an attempt to gather locks, or sending the
    operation off to the MDS log. If it is waiting on the OSDs, fix them. If
    operations are stuck on a specific inode, you probably have a client
    holding caps which prevent others from using it. This can be because the
    client is trying to flush out dirty data or because you have encountered a
    bug in CephFS’ distributed file lock code (the file “capabilities”
    [“caps”] system).
   </p><p>
    If it is a result of a bug in the capabilities code, restarting the MDS is
    likely to resolve the problem.
   </p><p>
    If there are no slow requests reported on the MDS, and it is not reporting
    that clients are misbehaving, either the client has a problem or its
    requests are not reaching the MDS.
   </p></section></section><section class="sect1" id="bp-troubleshooting-kernelmount-debugging" data-id-title="Kernel mount debugging"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.4 </span><span class="title-name">Kernel mount debugging</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-kernelmount-debugging">#</a></h2></div></div></div><section class="sect2" id="kernel-mount-slow-requests" data-id-title="Slow requests"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">12.4.1 </span><span class="title-name">Slow requests</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#kernel-mount-slow-requests">#</a></h3></div></div></div><p>
    Unfortunately, the kernel client does not support the admin socket, but it
    has similar (if limited) interfaces if your kernel has
    <code class="option">debugfs</code> enabled. There will be a folder in
    <code class="filename">sys/kernel/debug/ceph/</code>, and that folder contains a
    variety of files that output interesting output when you cat them. These
    files are described below; the most interesting when debugging slow
    requests are probably the <code class="filename">mdsc</code> and
    <code class="filename">osdc</code> files.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.14.6.2.3.1"><span class="term">bdi</span></dt><dd><p>
       BDI info about the Ceph system (blocks dirtied, written, etc)
      </p></dd><dt id="id-1.5.14.6.2.3.2"><span class="term">caps</span></dt><dd><p>
       Counts of file caps structures in-memory and used
      </p></dd><dt id="id-1.5.14.6.2.3.3"><span class="term">client_options</span></dt><dd><p>
       Dumps the options provided to the CephFS mount
      </p></dd><dt id="id-1.5.14.6.2.3.4"><span class="term">dentry_Iru</span></dt><dd><p>
       Dumps the CephFS dentries currently in-memory
      </p></dd><dt id="id-1.5.14.6.2.3.5"><span class="term">mdsc</span></dt><dd><p>
       Dumps current requests to the MDS
      </p></dd><dt id="id-1.5.14.6.2.3.6"><span class="term">mdsmap</span></dt><dd><p>
       Dumps the current MDSMap epoch and MDSes
      </p></dd><dt id="id-1.5.14.6.2.3.7"><span class="term">mds_sessions</span></dt><dd><p>
       Dumps the current sessions to MDSes
      </p></dd><dt id="id-1.5.14.6.2.3.8"><span class="term">monc</span></dt><dd><p>
       Dumps the current maps from the monitor, and any subscriptions held
      </p></dd><dt id="id-1.5.14.6.2.3.9"><span class="term">monmap</span></dt><dd><p>
       Dumps the current monitor map epoch and monitors
      </p></dd><dt id="id-1.5.14.6.2.3.10"><span class="term">osdc</span></dt><dd><p>
       Dumps the current ops in-flight to OSDs (ie, file data IO)
      </p></dd><dt id="id-1.5.14.6.2.3.11"><span class="term">osdmap</span></dt><dd><p>
       Dumps the current OSDMap epoch, pools, and OSDs
      </p></dd></dl></div></section></section><section class="sect1" id="bp-troubleshooting-disconnected-remounted-fs" data-id-title="Disconnecting and remounting the file system"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.5 </span><span class="title-name">Disconnecting and remounting the file system</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-disconnected-remounted-fs">#</a></h2></div></div></div><p>
   Because CephFS has a consistent cache, if your network connection is
   disrupted for a long enough time the client will be forcibly disconnected
   from the system. At this point, the kernel client is in a bind: it cannot
   safely write back dirty data, and many applications do not handle IO errors
   correctly on <code class="literal">close()</code>. At the moment, the kernel client
   will remount the FS, but outstanding filesystem IO may or may not be
   satisfied. In these cases, you may need to reboot your client system.
  </p><p>
   You can identify you are in this situation if
   <code class="filename">dmesg/kern.log</code> report something like:
  </p><div class="verbatim-wrap"><pre class="screen">  Jul 20 08:14:38 teuthology kernel: [3677601.123718] ceph: mds0 closed our session
  Jul 20 08:14:38 teuthology kernel: [3677601.128019] ceph: mds0 reconnect start
  Jul 20 08:14:39 teuthology kernel: [3677602.093378] ceph: mds0 reconnect denied
  Jul 20 08:14:39 teuthology kernel: [3677602.098525] ceph:  dropping dirty+flushing Fw state for ffff8802dc150518 1099935956631
  Jul 20 08:14:39 teuthology kernel: [3677602.107145] ceph:  dropping dirty+flushing Fw state for ffff8801008e8518 1099935946707
  Jul 20 08:14:39 teuthology kernel: [3677602.196747] libceph: mds0 172.21.5.114:6812 socket closed (con state OPEN)
  Jul 20 08:14:40 teuthology kernel: [3677603.126214] libceph: mds0 172.21.5.114:6812 connection reset
  Jul 20 08:14:40 teuthology kernel: [3677603.132176] libceph: reset on mds0</pre></div><p>
   This is an area of ongoing work to improve the behavior. Kernels will soon
   be reliably issuing error codes to in-progress IO, although your
   application(s) may not deal with them well. In the longer-term, we hope to
   allow reconnect and reclaim of data in cases where it will not violate POSIX
   semantics.
  </p></section><section class="sect1" id="bp-troubleshooting-mounting" data-id-title="Mounting"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.6 </span><span class="title-name">Mounting</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-mounting">#</a></h2></div></div></div><section class="sect2" id="mount-5-error" data-id-title="Mount I/O error"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">12.6.1 </span><span class="title-name">Mount I/O error</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#mount-5-error">#</a></h3></div></div></div><p>
    A <code class="literal">mount 5</code> (EIO, I/O error) error typically occurs if a
    MDS server is laggy or if it crashed. Ensure at least one MDS is up and
    running, and the cluster is <code class="literal">active + healthy</code>.
   </p></section><section class="sect2" id="mount-12-error" data-id-title="Mount out of memory error"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">12.6.2 </span><span class="title-name">Mount out of memory error</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#mount-12-error">#</a></h3></div></div></div><p>
    A <code class="literal">mount 12</code> error (ENOMEM, out of memory) with
    <code class="literal">cannot allocate memory</code> usually occurs if you have a
    version mismatch between the Ceph Client version and the Ceph Storage
    Cluster version. Check the versions using:
   </p><div class="verbatim-wrap"><pre class="screen">ceph -v</pre></div><p>
    If the Ceph Client is behind the Ceph cluster, try to upgrade it:
   </p><div class="verbatim-wrap"><pre class="screen">sudo zypper up
sudo zypper in ceph-common</pre></div><p>
    You may need to uninstall, autoclean and autoremove
    <code class="command">ceph-common</code> and then reinstall it so that you have the
    latest version.
   </p></section></section><section class="sect1" id="bp-troubleshooting-old-clients-mount" data-id-title="Mounting CephFS using old kernel clients"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">12.7 </span><span class="title-name">Mounting CephFS using old kernel clients</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#bp-troubleshooting-old-clients-mount">#</a></h2></div></div></div><p>
   The kernel since SUSE Linux Enterprise Server 15 SP2 includes a CephFS client that is able to
   take full advantage of all the features available on an SES7 cluster. All
   relevant features and bug fixes are backported to this operating system.
  </p><p>
   However, it may be necessary to access CephFS from other systems that may
   provide an older CephFS client, which may not support all the features
   required by an SUSE Enterprise Storage 7.1 cluster. When this happens, the
   kernel client will fail to mount the file system and will emit messages
   similar to the one shown below:
  </p><div class="verbatim-wrap"><pre class="screen">[ 4187.023633] libceph: mon0 192.168.122.150:6789 feature set mismatch, my 107b84a842aca &lt; server's 40107b84a842aca, missing 400000000000000
[ 4187.023838] libceph: mon0 192.168.122.150:6789 missing required protocol features</pre></div><p>
   The message above means that the MON identified 0x400000000000000 as the
   missing feature in the client (the value 0x107b84a842aca represents all the
   features supported by the client, while 0x40107b84a842aca represents the
   minimum set of features required by the cluster). From the following table,
   which shows the complete list of feature bits, we can see that the missing
   feature bit 58 (2^58 = 0x400000000000000) is CRUSH_TUNABLES5,
   NEW_OSDOPREPLY_ENCODING, or FS_FILE_LAYOUT_V2 (all these three features
   share the same feature bit).
  </p><div class="table" id="id-1.5.14.9.6" data-id-title="Ceph features"><div class="table-title-wrap"><div class="table-title"><span class="title-number">Table 12.1: </span><span class="title-name">Ceph features </span><a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#id-1.5.14.9.6">#</a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col1"/><col style="text-align: right; " class="col2"/><col style="text-align: right; " class="col3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Feature</th><th style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">Bit</th><th style="text-align: right; border-bottom: 1px solid ; ">Value</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">UID</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">0</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NOSRCADDR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FLOCK</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">3</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SUBSCRIBE2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">4</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MONNAMES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RECONNECT_SEQ</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">6</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">DIRLAYOUTHASH</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">7</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OBJECTLOCATOR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">8</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">PGID64</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">9</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">INCSUBOSDMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">10</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">PGPOOL3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">11</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDREPLYMUX</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">12</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">13</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_KRAKEN</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">14</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MONENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">15</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">18</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_LUMINOUS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RESEND_ON_SPLIT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">RADOS_BACKOFF</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDMAP_PG_UPMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_CHOOSE_ARGS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">21</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSG_AUTH</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">23</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">25</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CREATEPOOLID</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">26</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">REPLY_CREATE_INODE</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">27</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_M</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">28</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDSENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">29</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDHASHPSPOOL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">30</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_SINGLE_PAXOS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">31</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_CACHEPOOL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">35</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">36</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">EXPORT_PEER</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">37</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_ERASURE_CODES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">38</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_OSD_TMAP2OMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">38</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDMAP_ENC</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">39</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDS_INLINE_DATA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">40</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">41</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_PRIMARY_AFFINITY</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">41</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSGR_KEEPALIVE2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">42</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_POOLRESEND</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">43</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">ERASURE_CODE_PLUGINS_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">44</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_FADVISE_FLAGS</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">46</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MDS_QUOTA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">47</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V4</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">48</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_METADATA</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">50</td><td style="text-align: right; border-bottom: 1px solid ; ">0x4000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_BITWISE_HOBJ_SORT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">51</td><td style="text-align: right; border-bottom: 1px solid ; ">0x8000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_PROXY_WRITE_FEATURES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">52</td><td style="text-align: right; border-bottom: 1px solid ; ">0x10000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">ERASURE_CODE_PLUGINS_V3</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">53</td><td style="text-align: right; border-bottom: 1px solid ; ">0x20000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_HITSET_GMT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">54</td><td style="text-align: right; border-bottom: 1px solid ; ">0x40000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">HAMMER_0_94_4</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">55</td><td style="text-align: right; border-bottom: 1px solid ; ">0x80000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NEW_OSDOP_ENCODING</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">56</td><td style="text-align: right; border-bottom: 1px solid ; ">0x100000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_STATEFUL_SUB</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MON_ROUTE_OSDMAP</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSDSUBOP_NO_SNAPCONTEXT</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SERVER_JEWEL</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">57</td><td style="text-align: right; border-bottom: 1px solid ; ">0x200000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES5</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">NEW_OSDOPREPLY_ENCODING</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_FILE_LAYOUT_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">58</td><td style="text-align: right; border-bottom: 1px solid ; ">0x400000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_BTIME</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">FS_CHANGE_ATTR</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MSG_ADDR2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">59</td><td style="text-align: right; border-bottom: 1px solid ; ">0x800000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OSD_RECOVERY_DELETES</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">60</td><td style="text-align: right; border-bottom: 1px solid ; ">0x1000000000000000</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CEPHX_V2</td><td style="text-align: right; border-right: 1px solid ; border-bottom: 1px solid ; ">61</td><td style="text-align: right; border-bottom: 1px solid ; ">0x2000000000000000</td></tr><tr><td style="border-right: 1px solid ; ">RESERVED</td><td style="text-align: right; border-right: 1px solid ; ">62</td><td style="text-align: right; ">0x4000000000000000</td></tr></tbody></table></div></div><p>
   A possible solution to allow an old kernel client to mount a recent CephFS
   is to modify the cluster CRUSH profile. CRUSH profiles define a set of CRUSH
   tunables that are named after the Ceph versions in which they were
   introduced. For example, the <code class="literal">firefly</code> tunables are first
   supported in the Firefly release (0.80), and older clients will not be able
   to access the cluster. Thus, to fix the problem shown above, the following
   command can be used:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush tunables hammer</pre></div><p>
   This will adjust the CRUSH profile to the behaviour it had for the Hammer
   (0.94) release. Note however that this is not the optimal behaviour for the
   cluster. To change back to the optimal profile, run the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush tunables optimal</pre></div><p>
   The following table lists the available CRUSH profiles and which CRUSH
   tunables versions (the CRUSH_TUNABLE feature bits in the previous table)
   they correspond to. It also identifies the minimum kernel version required
   to use for each profile. Note however that Operating System vendors may
   choose to backport features to their kernels, so these kernel versions are
   valid for mainline kernels only. The kernel client included since SUSE Linux Enterprise Server 15
   SP2, for example, includes backports of features and bug fixes relevant for
   usage in SUSE Enterprise Storage 7.1 clusters.
  </p><div class="table" id="id-1.5.14.9.12" data-id-title="CRUSH profiles"><div class="table-title-wrap"><div class="table-title"><span class="title-number">Table 12.2: </span><span class="title-name">CRUSH profiles </span><a title="Permalink" class="permalink" href="bp-troubleshooting-cephfs.html#id-1.5.14.9.12">#</a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH Profile</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Ceph Release</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH Tunable</th><th style="border-bottom: 1px solid ; ">Minimum Kernel Version</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">argonaut</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.48</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES</td><td style="border-bottom: 1px solid ; ">3.6</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">bobtail</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.56</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES2</td><td style="border-bottom: 1px solid ; ">3.9</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">firefly</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.80</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_TUNABLES3</td><td style="border-bottom: 1px solid ; ">3.15</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">hammer</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.94</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">CRUSH_V4</td><td style="border-bottom: 1px solid ; ">4.1</td></tr><tr><td style="border-right: 1px solid ; ">jewel</td><td style="border-right: 1px solid ; ">10.2.0</td><td style="border-right: 1px solid ; ">CRUSH_TUNABLES5</td><td>4.5</td></tr></tbody></table></div></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="bp-troubleshooting-objectgateway.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 11 </span>Troubleshooting Object Gateway</span></a> </div><div><a class="pagination-link next" href="storage-tips.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 13 </span>Hints and tips</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-slow-ops"><span class="title-number">12.1 </span><span class="title-name">Slow or stuck operations</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-rados-health"><span class="title-number">12.2 </span><span class="title-name">Checking RADOS health</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-mds"><span class="title-number">12.3 </span><span class="title-name">MDS</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-kernelmount-debugging"><span class="title-number">12.4 </span><span class="title-name">Kernel mount debugging</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-disconnected-remounted-fs"><span class="title-number">12.5 </span><span class="title-name">Disconnecting and remounting the file system</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-mounting"><span class="title-number">12.6 </span><span class="title-name">Mounting</span></a></span></li><li><span class="sect1"><a href="bp-troubleshooting-cephfs.html#bp-troubleshooting-old-clients-mount"><span class="title-number">12.7 </span><span class="title-name">Mounting CephFS using old kernel clients</span></a></span></li></ul></div><div class="side-title">Give feedback</div><ul class="feedback" id="_give-feedback"><li><a id="_feedback-editurl" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_cephfs.xml" rel="nofollow" target="_blank">Edit source document</a></li></ul><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>