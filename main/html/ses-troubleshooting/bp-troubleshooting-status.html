<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>Troubleshooting Ceph health status | Troubleshooting Guide | SUSE Enterprise Storage 7.1</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Troubleshooting Ceph health status | SES 7.1"/>
<meta name="description" content="The following section details the statues that have been triggered and actions to take when the status is displayed."/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7.1"/>
<meta name="book-title" content="Troubleshooting Guide"/>
<meta name="chapter-title" content="Chapter 9. Troubleshooting Ceph health status"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Troubleshooting Ceph health status | SES 7.1"/>
<meta property="og:description" content="The following section details the statues that have been triggered and actions to take when the status is displayed."/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Troubleshooting Ceph health status | SES 7.1"/>
<meta name="twitter:description" content="The following section details the statues that have been triggered and actions to take when the status is displayed."/>
<link rel="prev" href="bp-troubleshooting-nfs.html" title="Chapter 8. Troubleshooting NFS Ganesha"/><link rel="next" href="bp-troubleshooting-dashboard.html" title="Chapter 10. Troubleshooting the Ceph Dashboard"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Troubleshooting Guide</a><span> / </span><a class="crumb" href="bp-troubleshooting-status.html">Troubleshooting Ceph health status</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Troubleshooting Guide</div><ol><li><a href="preface-troubleshooting.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="report-software.html" class=" "><span class="title-number">1 </span><span class="title-name">Reporting software problems</span></a></li><li><a href="bp-troubleshooting-logging.html" class=" "><span class="title-number">2 </span><span class="title-name">Troubleshooting logging and debugging</span></a></li><li><a href="bp-troubleshooting-cephadm.html" class=" "><span class="title-number">3 </span><span class="title-name">Troubleshooting cephadm</span></a></li><li><a href="bp-troubleshooting-osds.html" class=" "><span class="title-number">4 </span><span class="title-name">Troubleshooting OSDs</span></a></li><li><a href="bp-troubleshooting-pgs.html" class=" "><span class="title-number">5 </span><span class="title-name">Troubleshooting placement groups (PGs)</span></a></li><li><a href="bp-troubleshooting-monitors.html" class=" "><span class="title-number">6 </span><span class="title-name">Troubleshooting Ceph Monitors and Ceph Managers</span></a></li><li><a href="bp-troubleshooting-networking.html" class=" "><span class="title-number">7 </span><span class="title-name">Troubleshooting networking</span></a></li><li><a href="bp-troubleshooting-nfs.html" class=" "><span class="title-number">8 </span><span class="title-name">Troubleshooting NFS Ganesha</span></a></li><li><a href="bp-troubleshooting-status.html" class=" you-are-here"><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span></a></li><li><a href="bp-troubleshooting-dashboard.html" class=" "><span class="title-number">10 </span><span class="title-name">Troubleshooting the Ceph Dashboard</span></a></li><li><a href="bp-troubleshooting-objectgateway.html" class=" "><span class="title-number">11 </span><span class="title-name">Troubleshooting Object Gateway</span></a></li><li><a href="bp-troubleshooting-cephfs.html" class=" "><span class="title-number">12 </span><span class="title-name">Troubleshooting CephFS</span></a></li><li><a href="storage-tips.html" class=" "><span class="title-number">13 </span><span class="title-name">Hints and tips</span></a></li><li><a href="storage-faqs.html" class=" "><span class="title-number">14 </span><span class="title-name">Frequently asked questions</span></a></li><li><a href="bk03apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Pacific' point releases</span></a></li><li><a href="bk03go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="bp-troubleshooting-status" data-id-title="Troubleshooting Ceph health status"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7.1</span></div><div><h1 class="title"><span class="title-number">9 </span><span class="title-name">Troubleshooting Ceph health status</span> <a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#">#</a></h1></div></div></div><p>
  The following section details the statues that have been triggered and
  actions to take when the status is displayed.
 </p><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">MONITOR </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.4">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.4.2"><span class="term"><code class="option">MON_DOWN</code></span></dt><dd><p>
     One or more monitor daemons are down. The cluster requires a majority of
     the monitors in order to function. When one or more monitors are down,
     clients will initially have difficulty connecting to the cluster.
    </p><p>
     Restart the monitor daemon that is down as soon as possible to reduce the
     risk of a subsequent monitor failure.
    </p></dd><dt id="id-1.5.11.4.3"><span class="term"><code class="option">MON_CLOCK_SKEW</code></span></dt><dd><p>
     The clocks on the hosts running the
     <code class="systemitem">ceph-mon</code> monitor daemons are not
     well synchronized. This health alert is raised if the cluster detects a
     clock skew greater than <code class="option">mon_clock_drift_allowed</code>. Resolve
     this by synchronizing the clocks using either <code class="literal">ntpd</code> or
     <code class="literal">chrony</code>. If it is impractical to keep the clocks closely
     synchronized, the <code class="option">mon_clock_drift_allowed</code> threshold can
     be increased, but this value must stay well below the
     <code class="option">mon_lease</code> interval in order for monitor cluster to
     function properly.
    </p></dd><dt id="id-1.5.11.4.4"><span class="term"><code class="option">MON_MSGR2_NOT_ENABLED</code></span></dt><dd><p>
     The <code class="option">ms_bind_msgr2</code> option is enabled but one or more
     monitors is not configured to bind to a v2 port in the cluster's monmap.
     This means that features specific to the msgr2 protocol (for example,
     encryption) are not available on some or all connections. In most cases
     this can be corrected by issuing the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph mon enable-msgr2</pre></div><p>
     This command changes any monitor configured for the old default port 6789
     to continue to listen for v1 connections on 6789 and also listen for v2
     connections on the new default 3300 port. If a monitor is configured to
     listen for v1 connections on a non-standard port (not 6789), then the
     monmap needs to be modified manually.
    </p></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">MANAGER </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.5">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.5.2"><span class="term"><code class="option">MGR_MODULE_DEPENDENCY</code></span></dt><dd><p>
     An enabled manager module is failing its dependency check. This health
     check should come with a message from the module about the problem. For
     example, a module might report that a required package is not installed.
     In which case, the message will read: "Install the required package and
     restart your manager daemons." This health check only applies to enabled
     modules. If a module is not enabled, you can see whether it is reporting
     dependency issues in the output of <code class="command">ceph module ls</code>.
    </p></dd><dt id="id-1.5.11.5.3"><span class="term"><code class="option">MGR_MODULE_ERROR</code></span></dt><dd><p>
     A manager module has experienced an unexpected error. Typically, this
     means an unhandled exception was raised from the module's
     <code class="literal">serve</code> function. The human-readable description of the
     error may be obscurely worded if the exception did not provide a useful
     description of itself. This health check may indicate a bug. Open a bug
     report if you think you have encountered a bug. If you believe the error
     is transient, you may restart your manager daemon(s), or use <code class="command">ceph
     mgr fail</code> on the active daemon to prompt a failover to another
     daemon.
    </p></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">OSDS </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.6">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.6.2"><span class="term"><code class="option">OSD_DOWN</code></span></dt><dd><p>
     One or more OSDs are marked down. The
     <code class="systemitem">ceph-osd</code> daemon may have been
     stopped, or peer OSDs may be unable to reach the OSD over the network.
     Common causes include a stopped or crashed daemon, a down host, or a
     network outage. Verify the host is healthy, the daemon is started, and
     network is functioning. If the daemon has crashed, the daemon log file
     (<code class="filename">/var/log/ceph/ceph-osd.*</code>) may contain debugging
     information.
    </p></dd><dt id="id-1.5.11.6.3"><span class="term"><code class="option">OSD_<em class="replaceable">CRUSH TYPE</em>_DOWN</code></span></dt><dd><p>
     For example, <code class="filename">OSD_HOST_DOWN</code> or
     <code class="filename">OSD_ROOT_DOWN</code>. All the OSDs within a particular CRUSH
     subtree are marked down, for example all OSDs on a host.
    </p></dd><dt id="id-1.5.11.6.4"><span class="term"><code class="option">OSD_ORPHAN</code></span></dt><dd><p>
     An OSD is referenced in the CRUSH Map hierarchy but does not exist. The
     OSD can be removed from the CRUSH hierarchy with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd crush rm osd.<em class="replaceable">ID</em></pre></div></dd><dt id="id-1.5.11.6.5"><span class="term"><code class="option">OSD_OUT_OF_ORDER_FULL</code></span></dt><dd><p>
     The utilization thresholds for <code class="literal">backfillfull</code>,
     <code class="literal">nearfull</code>, <code class="literal">full</code>, and
     <code class="option">failsafe_full</code> are not ascending. The thresholds can be
     adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-backfillfull-ratio <em class="replaceable">RATIO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-nearfull-ratio <em class="replaceable">RATIO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-full-ratio <em class="replaceable">RATIO</em></pre></div></dd><dt id="id-1.5.11.6.6"><span class="term"><code class="option">OSD_FULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">full</code> threshold and
     is preventing the cluster from servicing writes. Utilization by pool can
     be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div><p>
     The currently defined <code class="literal">full</code> ratio can be seen with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd dump | grep full_ratio</pre></div><p>
     A short-term workaround to restore write availability is to raise the full
     threshold by a small amount:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-full-ratio <em class="replaceable">RATIO</em></pre></div><p>
     New storage should be added to the cluster by deploying more OSDs or
     existing data should be deleted in order to free up space.
    </p></dd><dt id="id-1.5.11.6.7"><span class="term"><code class="option">OSD_BACKFILLFULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">backfillfull</code>
     threshold, preventing data from being allowed to rebalance to this device.
     This is an early warning that rebalancing may not be able to complete and
     that the cluster is approaching <code class="literal">full</code>. Utilization by
     pool can be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div></dd><dt id="id-1.5.11.6.8"><span class="term"><code class="option">OSD_NEARFULL</code></span></dt><dd><p>
     One or more OSDs have exceeded the <code class="literal">nearfull</code> threshold.
     This is an early warning that the cluster is approaching
     <code class="literal">full</code>. Utilization by pool can be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df</pre></div></dd><dt id="id-1.5.11.6.9"><span class="term"><code class="option">OSDMAP_FLAGS</code></span></dt><dd><p>
     One or more cluster flags of interest has been set. These flags include:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.11.6.9.2.2.1"><span class="term">full</span></dt><dd><p>
        The cluster is flagged as <code class="literal">full</code> and cannot serve
        writes
       </p></dd><dt id="id-1.5.11.6.9.2.2.2"><span class="term">pauserd, pausewr</span></dt><dd><p>
        Paused reads or writes
       </p></dd><dt id="id-1.5.11.6.9.2.2.3"><span class="term">noup</span></dt><dd><p>
        OSDs are not allowed to start
       </p></dd><dt id="id-1.5.11.6.9.2.2.4"><span class="term">nodown</span></dt><dd><p>
        OSD failure reports are being ignored and the monitors are not marking
        OSDs down
       </p></dd><dt id="id-1.5.11.6.9.2.2.5"><span class="term">noin</span></dt><dd><p>
        OSDs that were previously marked out are not being marked back in when
        they start
       </p></dd><dt id="id-1.5.11.6.9.2.2.6"><span class="term">noout</span></dt><dd><p>
        Down OSDs are not automatically marked out after the configured
        interval
       </p></dd><dt id="id-1.5.11.6.9.2.2.7"><span class="term">nobackfill, norecover, norebalance</span></dt><dd><p>
        Recovery or data rebalancing is suspended
       </p></dd><dt id="id-1.5.11.6.9.2.2.8"><span class="term">noscrub, nodeep_scrub</span></dt><dd><p>
        Scrubbing is disabled
       </p></dd><dt id="id-1.5.11.6.9.2.2.9"><span class="term">notieragent</span></dt><dd><p>
        Cache tiering activity is suspended
       </p></dd></dl></div><p>
     With the exception of <code class="literal">full</code>, these flags can be set or
     cleared with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set <em class="replaceable">FLAG</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset <em class="replaceable">FLAG</em></pre></div></dd><dt id="id-1.5.11.6.10"><span class="term"><code class="option">OSD_FLAGS</code></span></dt><dd><p>
     One or more OSDs or CRUSH <code class="literal">{nodes,device classes}</code> has a
     flag of interest set. These flags include:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.5.11.6.10.2.2.1"><span class="term">noup</span></dt><dd><p>
        These OSDs are not allowed to start
       </p></dd><dt id="id-1.5.11.6.10.2.2.2"><span class="term">nodown</span></dt><dd><p>
        Failure reports for these OSDs are ignored
       </p></dd><dt id="id-1.5.11.6.10.2.2.3"><span class="term">noin</span></dt><dd><p>
        If these OSDs were previously marked out automatically after a failure,
        they are not to be marked in when they start
       </p></dd><dt id="id-1.5.11.6.10.2.2.4"><span class="term">noout</span></dt><dd><p>
        If these OSDs are down they are not automatically marked out after the
        configured interval
       </p></dd></dl></div><p>
     These flags can be set and cleared in batch with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group <em class="replaceable">FLAG</em> <em class="replaceable">WHO</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group <em class="replaceable">FLAG</em> <em class="replaceable">WHO</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout osd.0 osd.1
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout osd.0 osd.1
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout host-foo
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout host-foo
<code class="prompt user">cephuser@adm &gt; </code>ceph osd set-group noup,noout class-hdd
<code class="prompt user">cephuser@adm &gt; </code>ceph osd unset-group noup,noout class-hdd</pre></div></dd><dt id="id-1.5.11.6.11"><span class="term"><code class="option">OLD_CRUSH_TUNABLES</code></span></dt><dd><p>
     The CRUSH Map is using old settings and should be updated. The oldest
     tunables that can be used (for example, the oldest client version that can
     connect to the cluster) without triggering this health warning are
     determined by the <code class="option">mon_crush_min_required_version</code> config
     option.
    </p></dd><dt id="id-1.5.11.6.12"><span class="term"><code class="option">OLD_CRUSH_STRAW_CALC_VERSION</code></span></dt><dd><p>
     The CRUSH Map is using an older, sub-optimal method for calculating
     intermediate weight values for straw buckets. The CRUSH Map requires an
     update to use the newer method (<code class="literal">straw_calc_version=1</code>).
    </p></dd><dt id="id-1.5.11.6.13"><span class="term"><code class="option">CACHE_POOL_NO_HIT_SET</code></span></dt><dd><p>
     One or more cache pools are not configured with a hit set to track
     utilization. This prevents the tiering agent from identifying cold objects
     to flush and evict from the cache. Hit sets can be configured on the cache
     pool with the following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_type <em class="replaceable">TYPE</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_period <em class="replaceable">PERIOD-IN-SECONDS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_count <em class="replaceable">NUMBER-OF-HITSETS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOLNAME</em> hit_set_fpp <em class="replaceable">TARGET-FALSE-POSITIVE-RATE</em></pre></div></dd><dt id="id-1.5.11.6.14"><span class="term"><code class="option">OSD_NO_SORTBITWISE</code></span></dt><dd><p>
     No SUSE Enterprise Storage 7 v12.y.z OSDs are running but the
     <code class="option">sortbitwise</code> flag has not been set. Set the
     <code class="option">sortbitwise</code> flag before v12.y.z or newer OSDs can start.
     You can safely set the flag with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd set sortbitwise</pre></div></dd><dt id="id-1.5.11.6.15"><span class="term"><code class="option">POOL_FULL</code></span></dt><dd><p>
     One or more pools have reached the quota and are no longer allowing
     writes. Pool quotas and utilization can be seen with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph df detail</pre></div><p>
     You can either raise the pool quota with the following commands:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOLNAME</em> max_objects <em class="replaceable">NUM-OBJECTS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOLNAME</em> max_bytes <em class="replaceable">NUM-BYTES</em></pre></div><p>
     Or, you can delete existing data to reduce utilization.
    </p></dd><dt id="id-1.5.11.6.16"><span class="term"><code class="option">BLUEFS_SPILLOVER</code></span></dt><dd><p>
     One or more OSDs that use the BlueStore backend have been allocated db
     partitions (storage space for metadata, normally on a faster device) but
     that space has filled, such that metadata has overflowed onto the normal
     slow device. This is not necessarily an error condition or even
     unexpected, but if the administrator's expectation was that all metadata
     would fit on the faster device, it indicates that not enough space was
     provided. This warning can be disabled on all OSDs with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd bluestore_warn_on_bluefs_spillover false</pre></div><p>
     Alternatively, it can be disabled on a specific OSD with the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd.123 bluestore_warn_on_bluefs_spillover false</pre></div><p>
     To provide more metadata space, the OSD in question can be destroyed and
     reprovisioned. This involves data migration and recovery. It is possible
     to expand the LVM logical volume backing the db storage. If the underlying
     LV has been expanded, the OSD daemon needs to be stopped and BlueFS
     informed of the device size change with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool bluefs-bdev-expand --path /var/lib/ceph/osd/ceph-$ID</pre></div></dd><dt id="id-1.5.11.6.17"><span class="term"><code class="option">BLUEFS_AVAILABLE_SPACE</code></span></dt><dd><p>
     To check how much space is free for BlueFS, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore bluefs available</pre></div><p>
     This provides output for up to 3 values; <code class="literal">BDEV_DB free</code>,
     <code class="literal">BDEV_SLOW free</code> and
     <code class="option">available_from_bluestore</code>. <code class="literal">BDEV_DB</code> and
     <code class="literal">BDEV_SLOW</code> report the amount of space that has been
     acquired by BlueFS and is considered free. Value
     <code class="option">available_from_bluestore</code> denotes ability of BlueStore
     to leave more space to BlueFS. It is normal that this value is different
     from amount of BlueStore free space, as BlueFS allocation unit is
     typically larger than BlueStore allocation unit. This means that only
     part of BlueStore free space is acceptable for BlueFS.
    </p></dd><dt id="id-1.5.11.6.18"><span class="term"><code class="option">BLUEFS_LOW_SPACE</code></span></dt><dd><p>
     If BlueFS is running low on available free space and there is little
     <code class="option">available_from_bluestore</code>, consider reducing BlueFS'
     allocation unit size. To simulate available space when the allocation unit
     is different, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore bluefs available <em class="replaceable">ALLOC-UNIT-SIZE</em></pre></div></dd><dt id="id-1.5.11.6.19"><span class="term"><code class="option">BLUESTORE_FRAGMENTATION</code></span></dt><dd><p>
     As BlueStore works, free space on underlying storage becomes fragmented.
     This is normal and unavoidable, but excessive fragmentation can cause
     slowdown. To inspect BlueStore fragmentation, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore allocator score block</pre></div><p>
     Score is given in [0-1] range. [0.0 .. 0.4] tiny fragmentation [0.4 ..
     0.7] small, acceptable fragmentation [0.7 .. 0.9] considerable, but safe
     fragmentation [0.9 .. 1.0] severe fragmentation, can impact BlueFS'
     ability to get space from BlueStore. If detailed report of free
     fragments is required, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.123 bluestore allocator dump block</pre></div><p>
     If the OSD process does not perform fragmentation, inspect with
     <code class="command">ceph-bluestore-tool</code>. Get the fragmentation score:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool --path /var/lib/ceph/osd/ceph-123 --allocator block free-score</pre></div><p>
     Dump detailed free chunks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool --path /var/lib/ceph/osd/ceph-123 --allocator block free-dump</pre></div></dd><dt id="id-1.5.11.6.20"><span class="term"><code class="option">BLUESTORE_LEGACY_STATFS</code></span></dt><dd><p>
     As of SUSE Enterprise Storage 6, BlueStore tracks its internal usage statistics on
     a per-pool granular basis and one or more OSDs have BlueStore volumes
     that were created prior to SUSE Enterprise Storage 7.1. If all OSDs are
     older than SUSE Enterprise Storage 7.1, the per-pool metrics are not
     available. However, if there is a mix of pre-SUSE Enterprise Storage 7.1
     and post-SUSE Enterprise Storage 7.1 OSDs, the cluster usage statistics
     reported by <code class="command">ceph df</code> will not be accurate. The old OSDs
     can be updated to use the new usage tracking scheme by stopping each OSD,
     running a repair operation, and the restarting it. For example, if
     <code class="literal">osd.123</code> requires an update, run the following command.
     To identify the unique FSID of the cluster, run <code class="command">ceph
     fsid</code>. To identify the Object Gateway daemon name, run <code class="command">ceph orch
     ps ---hostname <em class="replaceable">HOSTNAME</em></code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl stop ceph-<em class="replaceable">FSID</em>@<em class="replaceable">osd.123</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph-bluestore-tool repair --path /var/lib/ceph/osd/ceph-123
<code class="prompt root"># </code>systemctl start ceph-osd@123</pre></div><p>
     This warning can be disabled with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set global bluestore_warn_on_legacy_statfs false</pre></div></dd><dt id="id-1.5.11.6.21"><span class="term"><code class="option">BLUESTORE_DISK_SIZE_MISMATCH</code></span></dt><dd><p>
     One or more OSDs using BlueStore has an internal inconsistency between
     the size of the physical device and the metadata tracking its size. This
     can lead to the OSD crashing in the future. The OSDs in question should be
     destroyed and re-deployed. To avoid putting any data at risk, re-deploy
     only one OSD at a time. For example, if <em class="replaceable">OSD_ID</em>
     has the error:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd out osd.<em class="replaceable">OSD_ID</em>
<code class="prompt user">cephuser@adm &gt; </code>while ! ceph osd safe-to-destroy osd.<em class="replaceable">OSD_ID</em> ; do sleep 1m ; done
<code class="prompt user">cephuser@adm &gt; </code>ceph osd destroy osd.<em class="replaceable">OSD_ID</em>
<code class="prompt user">cephuser@adm &gt; </code>cephadm ceph-volume lvm zap /path/to/device
<code class="prompt user">cephuser@adm &gt; </code>cephadm ceph-volume lvm create --osd-id  <em class="replaceable">OSD_ID</em>--data /path/to/device</pre></div></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">DEVICE HEALTH </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.7">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.7.2"><span class="term"><code class="option">DEVICE_HEALTH</code></span></dt><dd><p>
     One or more devices are expected to fail. The warning threshold is
     controlled by the <code class="literal">mgr/devicehealth/warn_threshold</code>
     configuration option. This warning only applies to OSDs that are currently
     marked <code class="option">in</code>. The expected response to this failure is to
     mark the device <code class="option">out</code>. The data is then migrated off of the
     device and the hardware is removed from the system. Marking out is
     normally done automatically if
     <code class="literal">mgr/devicehealth/self_heal</code> is enabled based on the
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>. Device health can
     be checked with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device info <em class="replaceable">DEVICE-ID</em></pre></div><p>
     Device life expectancy is set by a prediction model run by the Ceph Manager or by
     an external tool via the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph device set-life-expectancy <em class="replaceable">DEVICE-ID</em> <em class="replaceable">FROM</em> <em class="replaceable">TO</em></pre></div><p>
     You can change the stored life expectancy manually, but that usually does
     not persist—the tool that originally set it reset and changing the
     stored value does not affect the actual health of the hardware device.
    </p></dd><dt id="id-1.5.11.7.3"><span class="term"><code class="option">DEVICE_HEALTH_IN_USE</code></span></dt><dd><p>
     One or more devices are expected to fail and has been marked
     <code class="option">out</code> of the cluster based on
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, but the devices
     are still participating in one more PGs. This may be because it was only
     recently marked as <code class="option">out</code> and the data is still migrating,
     or because the data cannot be migrated off for some reason (for example,
     the cluster is nearly full, or the CRUSH hierarchy is such that there is
     not another suitable OSD to migrate the data to). This message can be
     silenced by disabling the self heal behavior (setting
     <code class="literal">mgr/devicehealth/self_heal</code> to false), by adjusting the
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, or by addressing
     what is preventing data from being migrated off of the ailing device.
    </p></dd><dt id="id-1.5.11.7.4"><span class="term"><code class="option">DEVICE_HEALTH_TOOMANY</code></span></dt><dd><p>
     Too many devices are expected to fail and the
     <code class="literal">mgr/devicehealth/self_heal</code> behavior is enabled, such
     that marking <code class="option">out</code> all of the ailing devices would exceed
     the clusters <code class="option">mon_osd_min_in_ratio</code> ratio that prevents too
     many OSDs from being automatically marked <code class="option">out</code>. This can
     indicates that too many devices in the cluster are expected to fail and
     action is required to add newer (healthier) devices before too many
     devices fail and data is lost. The health message can also be silenced by
     adjusting parameters like <code class="option">mon_osd_min_in_ratio</code> or
     <code class="literal">mgr/devicehealth/mark_out_threshold</code>, but be warned that
     this increases the likelihood of unrecoverable data loss in the cluster.
    </p></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">DATA HEALTH (POOLS AND PLACEMENT GROUPS) </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.8">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.8.2"><span class="term"><code class="option">PG_AVAILABILITY</code></span></dt><dd><p>
     Data availability is reduced and the cluster is unable to service
     potential read or write requests for some data in the cluster.
     Specifically, if one or more PGs are in a state that does not allow IO
     requests to be serviced. Problematic PG states include peering, stale,
     incomplete, and in-active (if those conditions do not clear quickly).
     Detailed information about which PGs are affected is available from:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph health detail</pre></div><p>
     In most cases the root cause is that one or more OSDs are currently down;
     see the discussion for <code class="option">OSD_DOWN</code> above. The state of
     specific problematic PGs can be queried with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell <em class="replaceable">PG_ID</em> query</pre></div></dd><dt id="id-1.5.11.8.3"><span class="term"><code class="option">PG_DEGRADED</code></span></dt><dd><p>
     Data redundancy is reduced for some data, meaning the cluster does not
     have the desired number of replicas for all data (for replicated pools) or
     erasure code fragments (for erasure coded pools). Specifically, if one or
     more PGs:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       have a degraded or undersized flag set, meaning there are not enough
       instances of that placement group in the cluster;
      </p></li><li class="listitem"><p>
       have not had the clean flag set for some time.
      </p></li></ul></div></dd><dt id="id-1.5.11.8.4"><span class="term"><code class="option">PG_RECOVERY_FULL</code></span></dt><dd><p>
     Data redundancy can be reduced or at risk for some data due to a lack of
     free space in the cluster. Specifically, one or more PGs have the
     <code class="option">recovery_toofull</code> flag set, meaning that the cluster is
     unable to migrate or recover data because one or more OSDs are above the
     full threshold. See the discussion for <code class="option">OSD_FULL</code> above for
     steps to resolve this condition.
    </p></dd><dt id="id-1.5.11.8.5"><span class="term"><code class="option">PG_BACKFILL_FULL</code></span></dt><dd><p>
     Data redundancy can be reduced or at risk for some data due to a lack of
     free space in the cluster. Specifically, one or more PGs have the
     <code class="option">backfill_toofull</code> flag set, meaning that the cluster is
     unable to migrate or recover data because one or more OSDs are above the
     backfillfull threshold. See the discussion for
     <code class="option">OSD_BACKFILLFULL</code> above for steps to resolve this
     condition.
    </p></dd><dt id="id-1.5.11.8.6"><span class="term"><code class="option">PG_DAMAGED</code></span></dt><dd><p>
     Data scrubbing has discovered some problems with data consistency in the
     cluster. Specifically, one or more PGs have the inconsistent or
     <code class="option">snaptrim_error</code> flag is set, indicating an earlier scrub
     operation found a problem, or that the repair flag is set and a repair for
     such an inconsistency is currently in progress.
    </p></dd><dt id="id-1.5.11.8.7"><span class="term"><code class="option">OSD_SCRUB_ERRORS</code></span></dt><dd><p>
     Recent OSD scrubs have uncovered inconsistencies. This error is generally
     paired with <code class="option">PG_DAMAGED</code>.
    </p></dd><dt id="id-1.5.11.8.8"><span class="term"><code class="option">LARGE_OMAP_OBJECTS</code></span></dt><dd><p>
     One or more pools contain large omap objects as determined by
     <code class="option">osd_deep_scrub_large_omap_object_key_threshold</code> (threshold
     for number of keys to determine a large omap object) or
     <code class="option">osd_deep_scrub_large_omap_object_value_sum_threshold</code> (the
     threshold for summed size (bytes) of all key values to determine a large
     omap object) or both. More information on the object name, key count, and
     size in bytes can be found by searching the cluster log for ‘Large omap
     object found'. Large omap objects can be caused by RGW bucket index
     objects that do not have automatic resharding enabled. The thresholds can
     be adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_deep_scrub_large_omap_object_key_threshold <em class="replaceable">KEYS</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph config set osd osd_deep_scrub_large_omap_object_value_sum_threshold <em class="replaceable">BYTES</em></pre></div></dd><dt id="id-1.5.11.8.9"><span class="term"><code class="option">CACHE_POOL_NEAR_FULL</code></span></dt><dd><p>
     A cache tier pool is nearly full. Full is determined by the
     <code class="option">target_max_bytes</code> and <code class="option">target_max_objects</code>
     properties on the cache pool. Once the pool reaches the target threshold,
     write requests to the pool may block while data is flushed and evicted
     from the cache, a state that normally leads to very high latencies and
     poor performance. The cache pool target size can be adjusted with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">CACHE-POOL-NAME</em> target_max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">CACHE-POOL-NAME</em> target_max_objects <em class="replaceable">OBJECTS</em></pre></div><p>
     Normal cache flush and eviction activity can also be throttled due to
     reduced availability, performance of the base tier, or overall cluster
     load.
    </p></dd><dt id="id-1.5.11.8.10"><span class="term"><code class="option">POOL_TOO_FEW_PGS</code></span></dt><dd><p>
     One or more pools should probably have more PGs, based on the amount of
     data that is currently stored in the pool. This can lead to sub-optimal
     distribution and balance of data across the OSDs in the cluster, and
     similarly reduce overall performance. This warning is generated if the
     <code class="option">pg_autoscale_mode</code> property on the pool is set to warn. To
     disable the warning, you can disable auto-scaling of PGs for the pool
     entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> pg_autoscale_mode off</pre></div><p>
     To allow the cluster to automatically adjust the number of PGs:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> pg_autoscale_mode on</pre></div><p>
     You can also manually set the number of PGs for the pool to the
     recommended amount with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_num <em class="replaceable">NEW_PG_NUM</em></pre></div></dd><dt id="id-1.5.11.8.11"><span class="term"><code class="option">TOO_MANY_PGS</code></span></dt><dd><p>
     The number of PGs in use in the cluster is above the configurable
     threshold of <code class="option">mon_max_pg_per_osd</code> PGs per OSD. If this
     threshold is exceeded, the cluster does not allow new pools to be created,
     pool <code class="option">pg_num</code> to be increased, or pool replication to be
     increased (any of which would lead to more PGs in the cluster). A large
     number of PGs can lead to higher memory utilization for OSD daemons,
     slower peering after cluster state changes (like OSD restarts, additions,
     or removals), and higher load on the Ceph Manager and Ceph Monitor daemons. The simplest
     way to mitigate the problem is to increase the number of OSDs in the
     cluster by adding more hardware. The OSD count used for the purposes of
     this health check is the number of <code class="option">in</code> OSDs, marking
     <code class="option">out</code> OSDs <code class="option">in</code> (if there are any) can also
     help:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd in <em class="replaceable">OSD_IDs</em></pre></div></dd><dt id="id-1.5.11.8.12"><span class="term"><code class="option">POOL_TOO_MANY_PGS</code></span></dt><dd><p>
     One or more pools require more PGs based on the amount of data that is
     currently stored in the pool. This can lead to higher memory utilization
     for OSD daemons, slower peering after cluster state changes (like OSD
     restarts, additions, or removals), and higher load on the manager and
     monitor daemons. This warning is generated if the
     <code class="option">pg_autoscale_mode</code> property on the pool is set to warn. To
     disable the warning, you can disable auto-scaling of PGs for the pool
     entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_autoscale_mode off</pre></div><p>
     To allow the cluster to automatically adjust the number of PGs:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_autoscale_mode on</pre></div><p>
     You can also manually set the number of PGs for the pool to the
     recommended amount with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL_NAME</em> pg_num <em class="replaceable">NEW_PG_-NUM</em></pre></div></dd><dt id="id-1.5.11.8.13"><span class="term"><code class="option">POOL_TARGET_SIZE_RATIO_OVERCOMMITTED</code></span></dt><dd><p>
     One or more pools have a <code class="option">target_size_ratio</code> property set
     to estimate the expected size of the pool as a fraction of total storage,
     but the value(s) exceed the total available storage (either by themselves
     or in combination with other pools' actual usage). This can indicate that
     the <code class="option">target_size_ratio</code> value for the pool is too large,
     and should be reduced or set to zero with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> target_size_ratio 0</pre></div></dd><dt id="id-1.5.11.8.14"><span class="term"><code class="option">POOL_TARGET_SIZE_BYTES_OVERCOMMITTED</code></span></dt><dd><p>
     One or more pools have a <code class="option">target_size_bytes</code> property set
     to estimate the expected size of the pool, but the value(s) exceed the
     total available storage (either by themselves or in combination with other
     pools' actual usage). This indicates that the
     <code class="option">target_size_bytes</code> value for the pool is too large and
     should be reduced or set to zero with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL-NAME</em> target_size_bytes 0</pre></div></dd><dt id="id-1.5.11.8.15"><span class="term"><code class="option">TOO_FEW_OSDS</code></span></dt><dd><p>
     The number of OSDs in the cluster is below the configurable threshold of
     <code class="option">osd_pool_default_size</code>.
    </p></dd><dt id="id-1.5.11.8.16"><span class="term"><code class="option">SMALLER_PGP_NUM</code></span></dt><dd><p>
     One or more pools have a <code class="option">pgp_num</code> value less than
     <code class="option">pg_num</code>, indicating that the PG count was increased
     without also increasing the placement behavior. To adjust the placement
     group number, adjust <code class="option">pgp_num</code> and <code class="option">pg_num</code>.
     Ensure that changing <code class="option">pgp_num</code> is performed first and does
     not trigger the rebalance. To resolve, set <code class="option">pgp_num</code> to
     match <code class="option">pg_num</code> and trigger the data migration with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set <em class="replaceable">POOL</em> pgp_num <em class="replaceable">PG_NUM_VALUE</em></pre></div></dd><dt id="id-1.5.11.8.17"><span class="term"><code class="option">MANY_OBJECTS_PER_PG</code></span></dt><dd><p>
     One or more pools has an average number of objects per PG that is
     significantly higher than the overall cluster average. The specific
     threshold is controlled by the
     <code class="option">mon_pg_warn_max_object_skew</code> configuration value. This
     indicates that the pool(s) containing most of the data in the cluster have
     too few PGs, or that other pools that do not contain as much data have too
     many PGs. The threshold can be raised to silence the health warning by
     adjusting the <code class="option">mon_pg_warn_max_object_skew</code> configuration
     option on the monitors.
    </p></dd><dt id="id-1.5.11.8.18"><span class="term"><code class="option">POOL_APP_NOT_ENABLED</code></span></dt><dd><p>
     A pool exists that contains one or more objects but has not been tagged
     for use by a particular application. Resolve this warning by labeling the
     pool for use by an application. For example, if the pool is used by RBD:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>rbd pool init <em class="replaceable">POOLNAME</em></pre></div><p>
     If the pool is being used by a custom application
     <em class="replaceable">FOO</em>, you can also label via the low-level
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool application enable <em class="replaceable">FOO</em></pre></div></dd><dt id="id-1.5.11.8.19"><span class="term"><code class="option">POOL_FULL</code></span></dt><dd><p>
     One or more pools has reached (or is very close to reaching) its quota.
     The threshold to trigger this error condition is controlled by the
     <code class="option">mon_pool_quota_crit_threshold</code> configuration option. Pool
     quotas can be adjusted up or down (or removed) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_objects <em class="replaceable">OBJECTS</em></pre></div><p>
     Setting the quota value to 0 disables the quota.
    </p></dd><dt id="id-1.5.11.8.20"><span class="term"><code class="option">POOL_NEAR_FULL</code></span></dt><dd><p>
     One or more pools are approaching its quota. The threshold to trigger this
     warning condition is controlled by the
     <code class="option">mon_pool_quota_warn_threshold</code> configuration option. Pool
     quotas can be adjusted up or down (or removed) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_bytes <em class="replaceable">BYTES</em>
<code class="prompt user">cephuser@adm &gt; </code>ceph osd pool set-quota <em class="replaceable">POOL</em> max_objects <em class="replaceable">OBJECTS</em></pre></div></dd><dt id="id-1.5.11.8.21"><span class="term"><code class="option">OBJECT_MISPLACED</code></span></dt><dd><p>
     One or more objects in the cluster is not stored on the node the cluster
     would like it to be stored on. This is an indication that data migration
     due to some recent cluster change has not yet completed. Misplaced data is
     not a dangerous condition in and of itself. Data consistency is not at
     risk and old copies of objects are not removed until the desired number of
     new copies (in the desired locations) are present.
    </p></dd><dt id="id-1.5.11.8.22"><span class="term"><code class="option">OBJECT_UNFOUND</code></span></dt><dd><p>
     One or more objects in the cluster cannot be found. Specifically, the OSDs
     know that a new or updated copy of an object should exist, but a copy of
     that version of the object has not been found on OSDs that are currently
     online. Read or write requests to unfound objects will block. Ideally, a
     down OSD can be brought back online that has the more recent copy of the
     unfound object. Candidate OSDs can be identified from the peering state
     for the PG(s) responsible for the unfound object:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph tell <em class="replaceable">PG_ID</em> query</pre></div><p>
     If the latest copy of the object is not available, the cluster can be told
     to roll back to a previous version of the object.
    </p></dd><dt id="id-1.5.11.8.23"><span class="term"><code class="option">SLOW_OPS</code></span></dt><dd><p>
     One or more OSD requests is taking a long time to process. This can be an
     indication of extreme load, a slow storage device, or a software bug. The
     request queue on the OSD(s) in question can be queried with the following
     command, executed from the OSD host:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.<em class="replaceable">ID</em> ops</pre></div><p>
     A summary of the slowest recent requests can be seen with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph daemon osd.<em class="replaceable">ID</em> dump_historic_ops</pre></div><p>
     The location of an OSD can be found with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph osd find osd.<em class="replaceable">ID</em></pre></div></dd><dt id="id-1.5.11.8.24"><span class="term"><code class="option">PG_NOT_SCRUBBED</code></span></dt><dd><p>
     One or more PGs have not been scrubbed recently. PGs are normally scrubbed
     every <code class="option">mon_scrub_interval</code> seconds and this warning
     triggers when <code class="option">mon_warn_pg_not_deep_scrubbed_ratio</code>
     percentage of interval has elapsed without a scrub since it was due. PGs
     do not scrub if they are not flagged as clean. This can happen if they are
     misplaced or degraded (see <code class="option">PG_AVAILABILITY</code> and
     <code class="option">PG_DEGRADED</code> above). You can manually initiate a scrub of
     a clean PG with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg scrub <em class="replaceable">PG_ID</em></pre></div></dd><dt id="id-1.5.11.8.25"><span class="term"><code class="option">PG_NOT_DEEP_SCRUBBED</code></span></dt><dd><p>
     One or more PGs have not been deep scrubbed recently. PGs are normally
     scrubbed every <code class="option">osd_deep_scrub_interval</code> seconds and this
     warning triggers when <code class="option">mon_warn_pg_not_deep_scrubbed_ratio</code>
     percentage of interval has elapsed without a scrub since it was due. PGs
     do not (deep) scrub if they are not flagged as clean. This can happen if
     they are misplaced or degraded (see <code class="option">PG_AVAILABILITY</code> and
     <code class="option">PG_DEGRADED</code> above). You can manually initiate a scrub of
     a clean PG with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph pg deep-scrub <em class="replaceable">PG_ID</em></pre></div></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">HEALTH CHECKS </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.9">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.9.2"><span class="term"><code class="option">CEPHADM_PAUSED</code></span></dt><dd><p>
     cephadm background work has been paused with <code class="command">ceph orch
     pause</code>. cephadm continues to perform passive monitoring
     activities (for example, checking host and daemon status), but it will not
     make any changes (for example, deploying or removing daemons).
    </p><p>
     Resume cephadm work with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch resume</pre></div></dd><dt id="id-1.5.11.9.3"><span class="term"><code class="option">CEPHADM_STRAY_HOST</code></span></dt><dd><p>
     One or more hosts have running Ceph daemons but are not registered as
     hosts managed by cephadm. This means that those services cannot
     currently be managed by cephadm. For example, restarted, upgraded,
     included in <code class="command">ceph orch ps</code>.
    </p><p>
     You can manage the host(s) with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host add <em class="replaceable">hostname</em></pre></div><div id="id-1.5.11.9.3.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note</h6><p>
      You may need to configure SSH access to the remote host before this will
      work.
     </p></div><p>
     Alternatively, you can manually connect to the host and ensure that
     services on that host are removed or migrated to a host that is managed by
     cephadm.
    </p><p>
     You can also disable this warning entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_stray_hosts false</pre></div></dd><dt id="id-1.5.11.9.4"><span class="term"><code class="option">CEPHADM_STRAY_DAEMON</code></span></dt><dd><p>
     One or more Ceph daemons are running but not are not managed by
     cephadm. This may be because they were deployed using a different tool,
     or because they were started manually. Those services cannot currently be
     managed by cephadm. For example, restarted, upgraded, or included in
     <code class="command">ceph orch ps</code>..
    </p><p>
     If the daemon is a stateful one (MON or OSD), it should be adopted by
     cephadm. For stateless daemons, it is usually easiest to provision a new
     daemon with the <code class="command">ceph orch apply</code> command and then stop
     the unmanaged daemon.
    </p><p>
     This warning can be disabled entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_stray_daemons false</pre></div></dd><dt id="id-1.5.11.9.5"><span class="term"><code class="option">CEPHADM_HOST_CHECK_FAILED</code></span></dt><dd><p>
     One or more hosts have failed the basic cephadm host check, which
     verifies that the host is reachable and <code class="command">cephadm</code> can be
     executed there, and that the host satisfies basic prerequisites, like a
     working container runtime (podman or docker) and working time
     synchronization. If this test fails, cephadm will not be able to manage
     services on that host.
    </p><p>
     You can manually run this check with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph cephadm check-host <em class="replaceable">hostname</em></pre></div><p>
     You can remove a broken host from management with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph orch host rm <em class="replaceable">hostname</em></pre></div><p>
     You can disable this health warning with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr mgr/cephadm/warn_on_failed_host_check false</pre></div></dd></dl></div><div class="variablelist"><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="title-name">MISCELLANEOUS </span><a title="Permalink" class="permalink" href="bp-troubleshooting-status.html#id-1.5.11.10">#</a></h6></div><dl class="variablelist"><dt id="id-1.5.11.10.2"><span class="term"><code class="option">RECENT_CRASH</code></span></dt><dd><p>
     One or more Ceph daemons have crashed recently, and the crash has not
     yet been archived or acknowledged by the administrator. This may indicate
     a software bug, a hardware problem (for example, a failing disk), or some
     other problem. New crashes can be listed with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash ls-new</pre></div><p>
     Information about a specific crash can be examined with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash info <em class="replaceable">CRASH-ID</em></pre></div><p>
     This warning can be silenced by archiving the crash (perhaps after being
     examined by an administrator) so that it does not generate this warning:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash archive <em class="replaceable">CRASH-ID</em></pre></div><p>
     Similarly, all new crashes can be archived with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph crash archive-all</pre></div><p>
     Archived crashes are still visible via <code class="command">ceph crash ls</code>
     but not <code class="command">ceph crash ls-new</code>. The time period for what
     recent means is controlled by the option
     <code class="literal">mgr/crash/warn_recent_interval</code> (default: two weeks).
     These warnings can be disabled entirely with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph config set mgr/crash/warn_recent_interval 0</pre></div></dd><dt id="id-1.5.11.10.3"><span class="term"><code class="option">TELEMETRY_CHANGED</code></span></dt><dd><p>
     Telemetry has been enabled but the contents of the telemetry report have
     changed since that time, so telemetry reports are not sent. The Ceph
     developers periodically revise the telemetry feature to include new and
     useful information, or to remove information found to be useless or
     sensitive. If any new information is included in the report, Ceph
     requires the administrator to re-enable telemetry to ensure they have an
     opportunity to (re)review what information is shared. To review the
     contents of the telemetry report:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry show</pre></div><p>
     The telemetry report consists of several optional channels that are
     independently enabled or disabled. To re-enable telemetry (and make this
     warning go away):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry on</pre></div><p>
     To disable telemetry (and make this warning go away):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">cephuser@adm &gt; </code>ceph telemetry soff</pre></div></dd></dl></div><div class="verbatim-wrap"><pre class="screen"> groups:
  - name: cluster health
   rules:
    - alert: health error
     expr: ceph_health_status == 2
     for: 5m
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Ceph in error for &gt; 5m
    - alert: unhealthy
     expr: ceph_health_status != 0
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: Ceph not healthy for &gt; 5m
  - name: mon
   rules:
    - alert: low monitor quorum count
     expr: ceph_monitor_quorum_count &lt; 3
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Monitor count in quorum is low
  - name: osd
   rules:
    - alert: 10% OSDs down
     expr: sum(ceph_osd_down) / count(ceph_osd_in) &gt;= 0.1
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: More then 10% of OSDS are down
    - alert: OSD down
     expr: sum(ceph_osd_down) &gt; 1
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: One or more OSDS down for more then 15 minutes
    - alert: OSDs near full
     expr: (ceph_osd_utilization unless on(osd) ceph_osd_down) &gt; 80
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: OSD {{ $labels.osd }} is dangerously full, over 80%
    # alert on single OSDs flapping
    - alert: flap osd
     expr: rate(ceph_osd_up[5m])*60 &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
        OSD {{ $label.osd }} was marked down at back up at least once a
        minute for 5 minutes.
    # alert on high deviation from average PG count
    - alert: high pg count deviation
     expr: abs(((ceph_osd_pgs &gt; 0) - on (job) group_left avg(ceph_osd_pgs &gt; 0) by (job)) / on (job) group_left avg(ceph_osd_pgs &gt; 0) by (job)) &gt; 0.35
     for: 5m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
        OSD {{ $labels.osd }} deviates by more then 30% from
        average PG count
    # alert on high commit latency...but how high is too high
  - name: mds
   rules:
   # no mds metrics are exported yet
  - name: mgr
   rules:
   # no mgr metrics are exported yet
  - name: pgs
   rules:
    - alert: pgs inactive
     expr: ceph_total_pgs - ceph_active_pgs &gt; 0
     for: 5m
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: One or more PGs are inactive for more then 5 minutes.
    - alert: pgs unclean
     expr: ceph_total_pgs - ceph_clean_pgs &gt; 0
     for: 15m
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: One or more PGs are not clean for more then 15 minutes.
  - name: nodes
   rules:
    - alert: root volume full
     expr: node_filesystem_avail{mountpoint="/"} / node_filesystem_size{mountpoint="/"} &lt; 0.1
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Root volume (OSD and MON store) is dangerously full (&lt; 10% free)
    # alert on nic packet errors and drops rates &gt; 1 packet/s
    - alert: network packets dropped
     expr: irate(node_network_receive_drop{device!="lo"}[5m]) + irate(node_network_transmit_drop{device!="lo"}[5m]) &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Node {{ $labels.instance }} experiences packet drop &gt; 1
       packet/s on interface {{ $lables.device }}
    - alert: network packet errors
     expr: irate(node_network_receive_errs{device!="lo"}[5m]) + irate(node_network_transmit_errs{device!="lo"}[5m]) &gt; 1
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Node {{ $labels.instance }} experiences packet errors &gt; 1
       packet/s on interface {{ $lables.device }}
    # predict fs fillup times
    - alert: storage filling
     expr: ((node_filesystem_free - node_filesystem_size) / deriv(node_filesystem_free[2d]) &lt;= 5) &gt; 0
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Mountpoint {{ $lables.mountpoint }} will be full in less then 5 days
       assuming the average fillup rate of the past 48 hours.
  - name: pools
   rules:
    - alert: pool full
     expr: ceph_pool_used_bytes / ceph_pool_available_bytes &gt; 0.9
     labels:
      severity: critical
      type: ses_default
     annotations:
      description: Pool {{ $labels.pool }} at 90% capacity or over
    - alert: pool filling up
     expr: (-ceph_pool_used_bytes / deriv(ceph_pool_available_bytes[2d]) &lt;= 5 ) &gt; 0
     labels:
      severity: warning
      type: ses_default
     annotations:
      description: &gt;
       Pool {{ $labels.pool }} will be full in less then 5 days
       assuming the average fillup rate of the past 48 hours.</pre></div></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="bp-troubleshooting-nfs.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 8 </span>Troubleshooting NFS Ganesha</span></a> </div><div><a class="pagination-link next" href="bp-troubleshooting-dashboard.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 10 </span>Troubleshooting the Ceph Dashboard</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Give feedback</div><ul class="feedback" id="_give-feedback"><li><a id="_feedback-editurl" href="https://github.com/SUSE/doc-ses/edit/main/xml/bp_troubleshooting_status.xml" rel="nofollow" target="_blank">Edit source document</a></li></ul><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>