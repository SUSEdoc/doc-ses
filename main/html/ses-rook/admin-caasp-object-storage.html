<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>Object Storage | Deploying and Administering SUSE Enterprise Storage with Rook | SUSE Enterprise Storage 7.1</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Object Storage | SES 7.1"/>
<meta name="description" content="Object Storage exposes an S3 API to the storage cluster for applications to put and get data."/>
<meta name="product-name" content="SUSE Enterprise Storage"/>
<meta name="product-number" content="7.1"/>
<meta name="book-title" content="Deploying and Administering SUSE Enterprise Storage with Rook"/>
<meta name="chapter-title" content="Chapter 13. Object Storage"/>
<meta name="tracker-url" content="https://github.com/SUSE/doc-ses/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="tracker-gh-assignee" content="tbazant"/>
<meta name="tracker-gh-template" content="&#10;     ### Type of report&#10;   - [ ] bug&#10;   - [ ] feature request&#10;&#10;### Source Document&#10;@@source@@&#10;&#10;### Summary&#10;&lt;!-- A clear and concise description of what the bug/feature request is. --&gt;&#10;&#10;### Steps To Reproduce&#10;&lt;!-- Steps to reproduce the behavior if you ran through steps in the document. --&gt;&#10;&#10;### Expected Results&#10;&lt;!-- A clear and concise description of what you expected to happen. --&gt;&#10;&#10;### Actual Results&#10;&lt;!-- Explain what actually happened if steps were executed, and if applicable, add screenshots to help explain your problem. --&gt;&#10;&#10;### Notes&#10;&lt;!-- Add any other context about the problem here. --&gt;&#10;&#10;    "/>
<meta name="tracker-gh-labels" content="bug,question,feature request"/>
<meta property="og:title" content="Object Storage | SES 7.1"/>
<meta property="og:description" content="Object Storage exposes an S3 API to the storage cluster for applications to put and get data."/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Object Storage | SES 7.1"/>
<meta name="twitter:description" content="Object Storage exposes an S3 API to the storage cluster for applications to put and get data."/>
<link rel="prev" href="admin-caasp-advanced-config.html" title="Chapter 12. Advanced configuration"/><link rel="next" href="admin-caasp-dashboard.html" title="Chapter 14. Ceph Dashboard"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Deploying and Administering SUSE Enterprise Storage with Rook</a><span> / </span><a class="crumb" href="rook-ses-admin.html">Administrating Ceph on SUSE CaaS Platform</a><span> / </span><a class="crumb" href="admin-caasp-object-storage.html">Object Storage</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Deploying and Administering SUSE Enterprise Storage with Rook</div><ol><li><a href="preface-rook.html" class=" "><span class="title-number"> </span><span class="title-name">About this guide</span></a></li><li><a href="rook-ses-deployment.html" class="has-children "><span class="title-number">I </span><span class="title-name">Quick Start: Deploying and Upgrading Ceph on SUSE CaaS Platform</span></a><ol><li><a href="deploy-rook.html" class=" "><span class="title-number">1 </span><span class="title-name">Quick start</span></a></li><li><a href="update-rook.html" class=" "><span class="title-number">2 </span><span class="title-name">Updating Rook</span></a></li></ol></li><li class="active"><a href="rook-ses-admin.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Administrating Ceph on SUSE CaaS Platform</span></a><ol><li><a href="admin-intro-caasp.html" class=" "><span class="title-number">3 </span><span class="title-name">Rook-Ceph administration</span></a></li><li><a href="admin-caasp-cluster.html" class=" "><span class="title-number">4 </span><span class="title-name">Ceph cluster administration</span></a></li><li><a href="admin-caasp-block-storage.html" class=" "><span class="title-number">5 </span><span class="title-name">Block Storage</span></a></li><li><a href="admin-caasp-cephfs.html" class=" "><span class="title-number">6 </span><span class="title-name">CephFS</span></a></li><li><a href="admin-caasp-crd.html" class=" "><span class="title-number">7 </span><span class="title-name">Ceph cluster custom resource definitions</span></a></li><li><a href="admin-caasp-cephconfig.html" class=" "><span class="title-number">8 </span><span class="title-name">Configuration</span></a></li><li><a href="admin-caasp-cephtoolbox.html" class=" "><span class="title-number">9 </span><span class="title-name">Toolboxes</span></a></li><li><a href="admin-caasp-cephosd.html" class=" "><span class="title-number">10 </span><span class="title-name">Ceph OSD management</span></a></li><li><a href="admin-caasp-ceph-examples.html" class=" "><span class="title-number">11 </span><span class="title-name">Ceph examples</span></a></li><li><a href="admin-caasp-advanced-config.html" class=" "><span class="title-number">12 </span><span class="title-name">Advanced configuration</span></a></li><li><a href="admin-caasp-object-storage.html" class=" you-are-here"><span class="title-number">13 </span><span class="title-name">Object Storage</span></a></li><li><a href="admin-caasp-dashboard.html" class=" "><span class="title-number">14 </span><span class="title-name">Ceph Dashboard</span></a></li></ol></li><li><a href="rook-ses-troubleshooting.html" class="has-children "><span class="title-number">III </span><span class="title-name">Troubleshooting Ceph on SUSE CaaS Platform</span></a><ol><li><a href="atroubleshooting-caasp-debugging-rook.html" class=" "><span class="title-number">15 </span><span class="title-name">Troubleshooting</span></a></li><li><a href="admin-caasp-ceph-common-issues.html" class=" "><span class="title-number">16 </span><span class="title-name">Common issues</span></a></li></ol></li><li><a href="bk05apa.html" class=" "><span class="title-number">A </span><span class="title-name">Ceph maintenance updates based on upstream 'Pacific' point releases</span></a></li><li><a href="bk05go01.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="admin-caasp-object-storage" data-id-title="Object Storage"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Enterprise Storage</span> <span class="productnumber">7.1</span></div><div><h1 class="title"><span class="title-number">13 </span><span class="title-name">Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#">#</a></h1></div></div></div><section class="sect1" id="rook-object-storage" data-id-title="Object Storage"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">13.1 </span><span class="title-name">Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#rook-object-storage">#</a></h2></div></div></div><p>
   Object Storage exposes an S3 API to the storage cluster for applications to
   <code class="literal">put</code> and <code class="literal">get</code> data.
  </p><section class="sect2" id="configure-an-object-store" data-id-title="Configuring the Object Storage"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.1.1 </span><span class="title-name">Configuring the Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#configure-an-object-store">#</a></h3></div></div></div><p>
    Rook has the ability to either deploy an Object Storage in Kubernetes or to
    connect to an external Object Gateway service. Most commonly, the Object Storage will be
    configured locally by Rook.
   </p><section class="sect3" id="create-a-local-object-store" data-id-title="Creating a local Object Storage"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.1.1 </span><span class="title-name">Creating a local Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#create-a-local-object-store">#</a></h4></div></div></div><p>
     The below sample will create a <code class="literal">CephObjectStore</code> that
     starts the Object Gateway service in the cluster with an S3 API.
    </p><div id="id-1.7.4.12.3.3.3.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note</h6><p>
      This sample requires at least three BlueStore OSDs, with each OSD
      located on a different node.
     </p></div><p>
     The OSDs must be located on different nodes, because the
     <code class="literal">failureDomain</code> is set to <code class="literal">host</code> and the
     <code class="literal">erasureCoded</code> chunk settings require at least three
     different OSDs (two <code class="literal">dataChunks</code> + one
     <code class="literal">codingChunks</code>).
    </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: ceph.rook.io/v1
  kind: CephObjectStore
  metadata:
    name: my-store
    namespace: rook-ceph
  spec:
    metadataPool:
      failureDomain: host
      replicated:
        size: 3
    dataPool:
      failureDomain: host
      erasureCoded:
        dataChunks: 2
        codingChunks: 1
    preservePoolsOnDelete: true
    gateway:
      type: s3
      sslCertificateRef:
      port: 80
      securePort:
      instances: 1
    healthCheck:
      bucket:
        disabled: false
        interval: 60s</pre></div><p>
     After the <code class="literal">CephObjectStore</code> is created, the Rook
     Operator will then create all the pools and other resources necessary to
     start the service. This may take a minute to complete.
    </p><p>
     Create the object store:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl create -f object.yaml</pre></div><p>
     To confirm the object store is configured, wait for the rgw pod to start:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get pod -l app=rook-ceph-rgw</pre></div></section><section class="sect3" id="connect-external-object-store" data-id-title="Connecting to an external Object Storage"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.1.2 </span><span class="title-name">Connecting to an external Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#connect-external-object-store">#</a></h4></div></div></div><p>
     Rook can connect to existing Object Gateway gateways to work in conjunction with
     the external mode of the CephCluster CRD. If you have an external
     CephCluster CR, you can instruct Rook to consume external gateways with
     the following:
    </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: ceph.rook.io/v1
  kind: CephObjectStore
  metadata:
    name: external-store
    namespace: rook-ceph
  spec:
    gateway:
      port: 8080
      externalRgwEndpoints:
        - ip: 192.168.39.182
    healthCheck:
      bucket:
        enabled: true
        interval: 60s</pre></div><p>
     You can use the existing <code class="filename">object-external.yaml</code> file.
     When ready the <code class="literal">ceph-object-controller</code> will output a
     message in the Operator log similar to this one:
    </p><div class="verbatim-wrap"><pre class="screen">ceph-object-controller: ceph object store gateway service running at 10.100.28.138:8080</pre></div><p>
     You can now get and access the store via:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get svc -l app=rook-ceph-rgw
NAME                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
rook-ceph-rgw-my-store   ClusterIP   10.100.28.138     none        8080/TCP   6h59m</pre></div><p>
     Any pod from your cluster can now access this endpoint:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>curl 10.100.28.138:8080</pre></div><p>
     It is also possible to use the internally registered DNS name:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>curl rook-ceph-rgw-my-store.rook-ceph:8080</pre></div><p>
     The DNS name is created with the following schema:
     <code class="literal">rook-ceph-rgw-$STORE_NAME.$NAMESPACE</code>.
    </p></section></section><section class="sect2" id="create-a-bucket" data-id-title="Creating a bucket"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.1.2 </span><span class="title-name">Creating a bucket</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#create-a-bucket">#</a></h3></div></div></div><p>
    Now that the object store is configured, next we need to create a bucket
    where a client can read and write objects. A bucket can be created by
    defining a storage class, similar to the pattern used by block and file
    storage. First, define the storage class that will allow object clients to
    create a bucket. The storage class defines the object storage system, the
    bucket retention policy, and other properties required by the
    administrator. Save the following as
    <code class="literal">storageclass-bucket-delete.yaml</code> (the example is named as
    such due to the <code class="literal">Delete</code> reclaim policy).
   </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: storage.k8s.io/v1
  kind: StorageClass
  metadata:
     name: rook-ceph-bucket
  provisioner: rook-ceph.ceph.rook.io/bucket
  reclaimPolicy: Delete
  parameters:
    objectStoreName: my-store
    objectStoreNamespace: rook-ceph
    region: us-east-1</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl create -f storageclass-bucket-delete.yaml</pre></div><p>
    Based on this storage class, an object client can now request a bucket by
    creating an Object Bucket Claim (OBC). When the OBC is created, the
    Rook-Ceph bucket provisioner will create a new bucket. Notice that the OBC
    references the storage class that was created above. Save the following as
    <code class="literal">object-bucket-claim-delete.yaml</code> (the example is named as
    such due to the <code class="literal">Delete</code> reclaim policy):
   </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: objectbucket.io/v1alpha1
  kind: ObjectBucketClaim
  metadata:
    name: ceph-bucket
  spec:
    generateBucketName: ceph-bkt
    storageClassName: rook-ceph-bucket</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl create -f object-bucket-claim-delete.yaml</pre></div><p>
    Now that the claim is created, the operator will create the bucket as well
    as generate other artifacts to enable access to the bucket. A secret and
    ConfigMap are created with the same name as the OBC and in the same
    namespace. The secret contains credentials used by the application pod to
    access the bucket. The ConfigMap contains bucket endpoint information and
    is also consumed by the pod.
   </p><section class="sect3" id="client-connections" data-id-title="Client connections"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.2.1 </span><span class="title-name">Client connections</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#client-connections">#</a></h4></div></div></div><p>
     The following commands extract key pieces of information from the secret
     and configmap:
    </p><div class="verbatim-wrap"><pre class="screen">#config-map, secret, OBC will part of default if no specific name space mentioned
export AWS_HOST=$(kubectl -n default get cm ceph-bucket -o yaml | grep BUCKET_HOST | awk '{print $2}')
export AWS_ACCESS_KEY_ID=$(kubectl -n default get secret ceph-bucket -o yaml | grep AWS_ACCESS_KEY_ID | awk '{print $2}' | base64 --decode)
export AWS_SECRET_ACCESS_KEY=$(kubectl -n default get secret ceph-bucket -o yaml | grep AWS_SECRET_ACCESS_KEY | awk '{print $2}' | base64 --decode)</pre></div></section></section><section class="sect2" id="consume-the-object-storage" data-id-title="Consuming the Object Storage"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.1.3 </span><span class="title-name">Consuming the Object Storage</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#consume-the-object-storage">#</a></h3></div></div></div><p>
    Now that you have the Object Storage configured and a bucket created, you can
    consume the object storage from an S3 client.
   </p><p>
    This section will guide you through testing the connection to the
    <code class="literal">CephObjectStore</code> and uploading and downloading from it.
    Run the following commands after you have connected to the Rook toolbox.
   </p><section class="sect3" id="connection-environment-variables" data-id-title="Setting environment variables"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.3.1 </span><span class="title-name">Setting environment variables</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#connection-environment-variables">#</a></h4></div></div></div><p>
     To simplify the S3 client commands, you will want to set the four
     environment variables for use by your client (for example, inside the
     toolbox). See above for retrieving the variables for a bucket created by
     an <code class="literal">ObjectBucketClaim</code>.
    </p><div class="verbatim-wrap"><pre class="screen">export AWS_HOST=<em class="replaceable">HOST</em>
export AWS_ENDPOINT=<em class="replaceable">ENDPOINT</em>
export AWS_ACCESS_KEY_ID=<em class="replaceable">ACCESS_KEY</em>
export AWS_SECRET_ACCESS_KEY=<em class="replaceable">SECRET_KEY</em></pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">Host</code>: The DNS host name where the Object Gateway service is
       found in the cluster. Assuming you are using the default
       <code class="literal">rook-ceph</code> cluster, it will be
       <code class="literal">rook-ceph-rgw-my-store.rook-ceph</code>.
      </p></li><li class="listitem"><p>
       <code class="literal">Endpoint</code>: The endpoint where the Object Gateway service is
       listening. Run the following command and then combine the clusterIP and
       the port.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get svc rook-ceph-rgw-my-store</pre></div></li><li class="listitem"><p>
       <code class="literal">Access key</code>: The user’s <code class="literal">access_key</code>
       as printed above
      </p></li><li class="listitem"><p>
       <code class="literal">Secret key</code>: The user’s <code class="literal">secret_key</code>
       as printed above
      </p></li></ul></div><p>
     The variables for the user generated in this example might be:
    </p><div class="verbatim-wrap"><pre class="screen">export AWS_HOST=rook-ceph-rgw-my-store.rook-ceph
export AWS_ENDPOINT=10.104.35.31:80
export AWS_ACCESS_KEY_ID=XEZDB3UJ6X7HVBE7X7MA
export AWS_SECRET_ACCESS_KEY=7yGIZON7EhFORz0I40BFniML36D2rl8CQQ5kXU6l</pre></div><p>
     The access key and secret key can be retrieved as described in the section
     above on <a class="xref" href="admin-caasp-object-storage.html#client-connections" title="13.1.2.1. Client connections">Section 13.1.2.1, “Client connections”</a> or below in the section
     <a class="xref" href="admin-caasp-object-storage.html#create-a-user" title="13.1.5. Creating a user">Section 13.1.5, “Creating a user”</a> if you are not creating the buckets with
     an <code class="literal">ObjectBucketClaim</code>.
    </p></section><section class="sect3" id="install-s3cmd" data-id-title="Installing the s3cmd package"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.3.2 </span><span class="title-name">Installing the <span class="package">s3cmd</span> package</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#install-s3cmd">#</a></h4></div></div></div><p>
     To test the <code class="literal">CephObjectStore</code> we will install the
     <code class="literal">s3cmd</code> tool into the toolbox pod.
    </p><div class="verbatim-wrap"><pre class="screen">zypper --assumeyes install s3cmd</pre></div></section><section class="sect3" id="put-or-get-an-object" data-id-title="PUT or GET an object"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.1.3.3 </span><span class="title-name">PUT or GET an object</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#put-or-get-an-object">#</a></h4></div></div></div><p>
     Upload a file to the newly created bucket:
    </p><div class="verbatim-wrap"><pre class="screen">echo "Hello Rook" &gt; /tmp/rookObj
s3cmd put /tmp/rookObj --no-ssl --host=${AWS_HOST} --host-bucket=  s3://rookbucket</pre></div><p>
     Download and verify the file from the bucket:
    </p><div class="verbatim-wrap"><pre class="screen">s3cmd get s3://rookbucket/rookObj /tmp/rookObj-download --no-ssl --host=${AWS_HOST} --host-bucket=
cat /tmp/rookObj-download</pre></div></section></section><section class="sect2" id="access-external-cluster" data-id-title="Setting up external access to the cluster"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.1.4 </span><span class="title-name">Setting up external access to the cluster</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#access-external-cluster">#</a></h3></div></div></div><p>
    Rook sets up the object storage so pods will have access internal to the
    cluster. If your applications are running outside the cluster, you will
    need to setup an external service through a <code class="literal">NodePort</code>.
   </p><p>
    First, note the service that exposes RGW internal to the cluster. We will
    leave this service intact and create a new service for external access.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get service rook-ceph-rgw-my-store
NAME                     CLUSTER-IP   EXTERNAL-IP   PORT(S)     AGE
rook-ceph-rgw-my-store   10.3.0.177   none        80/TCP      2m</pre></div><p>
    Save the external service as <code class="filename">rgw-external.yaml</code>:
   </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: v1
  kind: Service
  metadata:
    name: rook-ceph-rgw-my-store-external
    namespace: rook-ceph
    labels:
      app: rook-ceph-rgw
      rook_cluster: rook-ceph
      rook_object_store: my-store
  spec:
    ports:
    - name: rgw
      port: 80
      protocol: TCP
      targetPort: 80
    selector:
      app: rook-ceph-rgw
      rook_cluster: rook-ceph
      rook_object_store: my-store
    sessionAffinity: None
    type: NodePort</pre></div><p>
    Now, create the external service:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl create -f rgw-external.yaml</pre></div><p>
    See both Object Gateway services running and notice what port the external service
    is running on:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get service rook-ceph-rgw-my-store rook-ceph-rgw-my-store-external
NAME                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
rook-ceph-rgw-my-store            ClusterIP   10.104.82.228    none          80/TCP         4m
rook-ceph-rgw-my-store-external   NodePort    10.111.113.237   none          80:31536/TCP   39s</pre></div><p>
    Internally the Object Gateway service is running on port 80. The external port in
    this case is 31536.
   </p></section><section class="sect2" id="create-a-user" data-id-title="Creating a user"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.1.5 </span><span class="title-name">Creating a user</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#create-a-user">#</a></h3></div></div></div><p>
    If you need to create an independent set of user credentials to access the
    S3 endpoint, create a <code class="literal">CephObjectStoreUser</code>. The user will
    be used to connect to the Object Gateway service in the cluster using the S3 API.
    The user will be independent of any object bucket claims that you might
    have created in the earlier instructions in this document.
   </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: ceph.rook.io/v1
  kind: CephObjectStoreUser
  metadata:
    name: my-user
    namespace: rook-ceph
  spec:
    store: my-store
    displayName: "my display name"</pre></div><p>
    When the <code class="literal">CephObjectStoreUser</code> is created, the Rook
    operator will then create the RGW user on the specified
    <code class="literal">CephObjectStore</code> and store the Access Key and Secret Key
    in a kubernetes secret in the same namespace as the
    <code class="literal">CephObjectStoreUser</code>.
   </p><p>
    Create the object store user:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl create -f object-user.yaml</pre></div><p>
    To confirm the object store user is configured, describe the secret:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph describe secret rook-ceph-object-user-my-store-my-user
  Name:		rook-ceph-object-user-my-store-my-user
  Namespace:	rook-ceph
  Labels:			app=rook-ceph-rgw
  			      rook_cluster=rook-ceph
  			      rook_object_store=my-store
  Annotations:	none

  Type:	kubernetes.io/rook

  Data
  ====
  AccessKey:	20 bytes
  SecretKey:	40 bytes</pre></div><p>
    The <code class="literal">AccessKey</code> and <code class="literal">SecretKey</code> data
    fields can be mounted in a pod as an environment variable.
   </p><p>
    To directly retrieve the secrets:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get secret rook-ceph-object-user-my-store-my-user -o yaml \
 | grep AccessKey | awk '{print $2}' | base64 --decode
<code class="prompt user">kubectl@adm &gt; </code>kubectl -n rook-ceph get secret rook-ceph-object-user-my-store-my-user -o yaml \
 | grep SecretKey | awk '{print $2}' | base64 --decode</pre></div></section></section><section class="sect1" id="ceph-object-store-crd" data-id-title="Ceph Object Storage CRD"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">13.2 </span><span class="title-name">Ceph Object Storage CRD</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#ceph-object-store-crd">#</a></h2></div></div></div><p>
   Rook allows creation and customization of object stores through the custom
   resource definitions (CRDs). The following settings are available for Ceph
   Object Storage.
  </p><section class="sect2" id="rook-objectstore-crd-sample" data-id-title="Sample"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.1 </span><span class="title-name">Sample</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#rook-objectstore-crd-sample">#</a></h3></div></div></div><section class="sect3" id="rook-objectstore-crd-erasure-coded" data-id-title="Erasure code"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.2.1.1 </span><span class="title-name">Erasure code</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#rook-objectstore-crd-erasure-coded">#</a></h4></div></div></div><p>
     Erasure coded pools require the OSDs to use <code class="literal">bluestore</code>
     for the configured <code class="literal">storeType</code>. Additionally, erasure
     coded pools can only be used with <code class="literal">dataPools</code>. The
     <code class="literal">metadataPool</code> must use a replicated pool.
    </p><div id="id-1.7.4.12.4.3.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><h6>Note</h6><p>
      This sample requires at least three BlueStore OSDs, with each OSD
      located on a different node.
     </p></div><p>
     The OSDs must be located on different nodes, because the
     <code class="literal">failureDomain</code> is set to <code class="literal">host</code> and the
     <code class="literal">erasureCoded</code> chunk settings require at least three
     different OSDs (two <code class="literal">dataChunks</code> + one
     <code class="literal">codingChunks</code>).
    </p><div class="verbatim-wrap"><pre class="screen">  apiVersion: ceph.rook.io/v1
  kind: CephObjectStore
  metadata:
    name: my-store
    namespace: rook-ceph
  spec:
    metadataPool:
      failureDomain: host
      replicated:
        size: 3
    dataPool:
      failureDomain: host
      erasureCoded:
        dataChunks: 2
        codingChunks: 1
    preservePoolsOnDelete: true
    gateway:
      type: s3
      sslCertificateRef:
      port: 80
      securePort:
      instances: 1
      # A key/value list of annotations
      annotations:
      #  key: value
      placement:
      #  nodeAffinity:
      #    requiredDuringSchedulingIgnoredDuringExecution:
      #      nodeSelectorTerms:
      #      - matchExpressions:
      #        - key: role
      #          operator: In
      #          values:
      #          - rgw-node
      #  tolerations:
      #  - key: rgw-node
      #    operator: Exists
      #  podAffinity:
      #  podAntiAffinity:
      #  topologySpreadConstraints:
      resources:
      #  limits:
      #    cpu: "500m"
      #    memory: "1024Mi"
      #  requests:
      #    cpu: "500m"
      #    memory: "1024Mi"
    #zone:
      #name: zone-a</pre></div></section></section><section class="sect2" id="object-store-settings" data-id-title="Object store settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.2 </span><span class="title-name">Object store settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#object-store-settings">#</a></h3></div></div></div><section class="sect3" id="objectstore-settings-metadata" data-id-title="Metadata"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.2.2.1 </span><span class="title-name">Metadata</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#objectstore-settings-metadata">#</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">name</code>: The name of the object store to create, which
       will be reflected in the pool and other resource names.
      </p></li><li class="listitem"><p>
       <code class="literal">namespace</code>: The namespace of the Rook cluster where
       the object store is created.
      </p></li></ul></div></section><section class="sect3" id="pools" data-id-title="Pools"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.2.2.2 </span><span class="title-name">Pools</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#pools">#</a></h4></div></div></div><p>
     The pools allow all of the settings defined in the pool CRD specification.
     In the example above, there must be at least three hosts (size 3) and at
     least three devices (two data + one coding chunks) in the cluster.
    </p><p>
     When the <code class="literal">zone</code> section is set, pools with the object
     store's name will not be created, since the object-store will the using
     the pools created by the ceph-object-zone.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">metadataPool</code>: The settings used to create all of the
       object store metadata pools. Must use replication.
      </p></li><li class="listitem"><p>
       <code class="literal">dataPool</code>: The settings to create the object store
       data pool. Can use replication or erasure coding.
      </p></li><li class="listitem"><p>
       <code class="literal">preservePoolsOnDelete</code>: If it is set to
       <span class="quote">“<span class="quote">true</span>”</span>, the pools used to support the object store will
       remain when the object store will be deleted. This is a security measure
       to avoid accidental loss of data. It is set to <span class="quote">“<span class="quote">false</span>”</span> by
       default. If it is not specified, this is also deemed as
       <span class="quote">“<span class="quote">false</span>”</span>.
      </p></li></ul></div></section></section><section class="sect2" id="gateway-settings" data-id-title="Creating gateway settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.3 </span><span class="title-name">Creating gateway settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#gateway-settings">#</a></h3></div></div></div><p>
    The gateway settings correspond to the Object Gateway daemon settings.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">type</code>: <code class="literal">S3</code> is supported
     </p></li><li class="listitem"><p>
      <code class="literal">sslCertificateRef</code>: If the certificate is not
      specified, SSL will not be configured. If specified, this is the name of
      the Kubernetes secret that contains the SSL certificate to be used for secure
      connections to the object store. Rook will look in the secret provided
      at the <code class="literal">cert</code> key name. The value of the
      <code class="literal">cert</code> key must be in the format expected by the Object Gateway
      service: <span class="quote">“<span class="quote">The server key, server certificate, and any other CA or
      intermediate certificates be supplied in one file. Each of these items
      must be in pem form.</span>”</span>
     </p></li><li class="listitem"><p>
      <code class="literal">port</code>: The port on which the Object service will be
      reachable. If host networking is enabled, the Object Gateway daemons will also
      listen on that port. If running on SDN, the Object Gateway daemon listening port
      will be 8080 internally.
     </p></li><li class="listitem"><p>
      <code class="literal">securePort</code>: The secure port on which Object Gateway pods will
      be listening. An SSL certificate must be specified.
     </p></li><li class="listitem"><p>
      <code class="literal">instances</code>: The number of pods that will be started to
      load-balance this object store.
     </p></li><li class="listitem"><p>
      <code class="literal">externalRgwEndpoints</code>: A list of IP addresses to
      connect to external existing Object Gateways (works with external mode). This
      setting will be ignored if the <code class="literal">CephCluster</code> does not
      have <code class="literal">external</code> spec enabled.
     </p></li><li class="listitem"><p>
      <code class="literal">annotations</code>: Key-value pair list of annotations to
      add.
     </p></li><li class="listitem"><p>
      <code class="literal">labels</code>: Key-value pair list of labels to add.
     </p></li><li class="listitem"><p>
      <code class="literal">placement</code>: The Kubernetes placement settings to determine
      where the Object Gateway pods should be started in the cluster.
     </p></li><li class="listitem"><p>
      <code class="literal">resources</code>: Set resource requests/limits for the
      Gateway Pod(s).
     </p></li><li class="listitem"><p>
      <code class="literal">priorityClassName</code>: Set priority class name for the
      Gateway Pod(s).
     </p></li></ul></div><p>
    Example of external Object Gateway endpoints to connect to:
   </p><div class="verbatim-wrap"><pre class="screen">  gateway:
    port: 80
    externalRgwEndpoints:
      - ip: 192.168.39.182</pre></div><p>
    This will create a service with the endpoint
    <code class="literal">192.168.39.182</code> on port <code class="literal">80</code>, pointing
    to the Ceph object external gateway. All the other settings from the
    gateway section will be ignored, except for <code class="literal">securePort</code>.
   </p></section><section class="sect2" id="zone-settings" data-id-title="Zone settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.4 </span><span class="title-name">Zone settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#zone-settings">#</a></h3></div></div></div><p>
    The
    <a class="link" href="https://github.com/rook/rook/blob/master/Documentation/ceph-object-multisite.md" target="_blank">zone</a>
    settings allow the object store to join custom created
    <a class="link" href="https://github.com/rook/rook/blob/master/Documentation/ceph-object-multisite-crd.md" target="_blank">ceph-object-zone</a>.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">name</code>: the name of the
      <code class="literal">ceph-object-zone</code> the object store will be in.
     </p></li></ul></div></section><section class="sect2" id="runtime-settings" data-id-title="Runtime settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.5 </span><span class="title-name">Runtime settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#runtime-settings">#</a></h3></div></div></div><section class="sect3" id="mime-types" data-id-title="MIME types"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.2.5.1 </span><span class="title-name">MIME types</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#mime-types">#</a></h4></div></div></div><p>
     Rook provides a default <code class="filename">mime.types</code> file for each
     Ceph Object Storage. This file is stored in a Kubernetes ConfigMap with the name
     <code class="literal">rook-ceph-rgw-&lt;STORE-NAME&gt;-mime-types</code>. For most
     users, the default file should suffice, however, the option is available
     to users to edit the <code class="filename">mime.types</code> file in the ConfigMap
     as they desire. Users may have their own special file types, and
     particularly security conscious users may wish to pare down the file to
     reduce the possibility of a file type execution attack.
    </p><p>
     Rook will not overwrite an existing <code class="filename">mime.types</code>
     ConfigMap so that user modifications will not be destroyed. If the object
     store is destroyed and re-created, the ConfigMap will also be destroyed
     and re-created.
    </p></section></section><section class="sect2" id="health-settings" data-id-title="Health settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.2.6 </span><span class="title-name">Health settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#health-settings">#</a></h3></div></div></div><p>
    Rook-Ceph will be default monitor the state of the object store endpoints.
    The following CRD settings are available:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">healthCheck</code>: main object store health monitoring
      section
     </p></li></ul></div><p>
    For example:
   </p><div class="verbatim-wrap"><pre class="screen">  healthCheck:
    bucket:
      disabled: false
      interval: 60s</pre></div><p>
    The endpoint health check procedure is the following:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      Create an S3 user.
     </p></li><li class="listitem"><p>
      Create a bucket with that user.
     </p></li><li class="listitem"><p>
      PUT the file in the object store.
     </p></li><li class="listitem"><p>
      GET the file from the object store.
     </p></li><li class="listitem"><p>
      Verify object consistency.
     </p></li><li class="listitem"><p>
      Update CR health status check.
     </p></li></ol></div><p>
    Rook-Ceph always keeps the bucket and the user for the health check; it
    just does a PUT and GET of an S3 object, since creating a bucket is an
    expensive operation.
   </p></section></section><section class="sect1" id="ceph-object-bucket-claim" data-id-title="Ceph object bucket claim"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">13.3 </span><span class="title-name">Ceph object bucket claim</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#ceph-object-bucket-claim">#</a></h2></div></div></div><p>
   Rook supports the creation of new buckets and access to existing buckets via
   two custom resources:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     An <code class="literal">Object Bucket Claim (OBC)</code> is custom resource which
     requests a bucket (new or existing) and is described by a Custom Resource
     Definition (CRD) shown below.
    </p></li><li class="listitem"><p>
     An <code class="literal">Object Bucket (OB)</code> is a custom resource
     automatically generated when a bucket is provisioned. It is a global
     resource, typically not visible to non-admin users, and contains
     information specific to the bucket. It is described by an OB CRD, also
     shown below.
    </p></li></ul></div><p>
   An OBC references a storage class which is created by an administrator. The
   storage class defines whether the bucket requested is a new bucket or an
   existing bucket. It also defines the bucket retention policy. Users request
   a new or existing bucket by creating an OBC which is shown below. The ceph
   provisioner detects the OBC and creates a new bucket or grants access to an
   existing bucket, depending the the storage class referenced in the OBC. It
   also generates a Secret which provides credentials to access the bucket, and
   a ConfigMap which contains the bucket’s endpoint. Application pods consume
   the information in the Secret and ConfigMap to access the bucket. Please
   note that to make provisioner watch the cluster namespace only you need to
   set <code class="literal">ROOK_OBC_WATCH_OPERATOR_NAMESPACE</code> to
   <code class="literal">true</code> in the operator manifest, otherwise it watches all
   namespaces.
  </p><section class="sect2" id="rook-objectstore-bucket-sample" data-id-title="Sample"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.3.1 </span><span class="title-name">Sample</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#rook-objectstore-bucket-sample">#</a></h3></div></div></div><section class="sect3" id="obc-custom-resource" data-id-title="OBC custom resource"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.3.1.1 </span><span class="title-name">OBC custom resource</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#obc-custom-resource">#</a></h4></div></div></div><div class="verbatim-wrap"><pre class="screen">  apiVersion: objectbucket.io/v1alpha1
  kind: ObjectBucketClaim
  metadata:
    name: ceph-bucket [1]
    namespace: rook-ceph [2]
  spec:
    bucketName: [3]
    generateBucketName: photo-booth [4]
    storageClassName: rook-ceph-bucket [4]
    additionalConfig: [5]
      maxObjects: "1000"
      maxSize: "2G"</pre></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       <code class="literal">name</code> of the <code class="literal">ObjectBucketClaim</code>.
       This name becomes the name of the Secret and ConfigMap.
      </p></li><li class="listitem"><p>
       <code class="literal">namespace</code>(optional) of the
       <code class="literal">ObjectBucketClaim</code>, which is also the namespace of the
       ConfigMap and Secret.
      </p></li><li class="listitem"><p>
       <code class="literal">bucketName</code> name of the <code class="literal">bucket</code>.
       <span class="strong"><strong>Not</strong></span> recommended for new buckets,
       since names must be unique within an entire object store.
      </p></li><li class="listitem"><p>
       <code class="literal">generateBucketName</code> value becomes the prefix for a
       randomly-generated name; if supplied, then <code class="literal">bucketName</code>
       must be empty. If both <code class="literal">bucketName</code> and
       <code class="literal">generateBucketName</code> are supplied, then
       <code class="literal">BucketName</code> has precedence and
       <code class="literal">GenerateBucketName</code> is ignored. If both
       <code class="literal">bucketName</code> and <code class="literal">generateBucketName</code>
       are blank or omitted, then the storage class is expected to contain the
       name of an <span class="emphasis"><em>existing</em></span> bucket. It is an error if all
       three bucket-related names are blank or omitted.
      </p></li><li class="listitem"><p>
       <code class="literal">storageClassName</code> which defines the StorageClass which
       contains the names of the bucket provisioner, the object store, and
       specifies the bucket-retention policy.
      </p></li><li class="listitem"><p>
       <code class="literal">additionalConfig</code> is an optional list of key-value
       pairs used to define attributes specific to the bucket being provisioned
       by this OBC. This information is typically tuned to a particular bucket
       provisioner, and may limit application portability. Options supported:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <code class="literal">maxObjects</code>: The maximum number of objects in the
         bucket
        </p></li><li class="listitem"><p>
         <code class="literal">maxSize</code>: The maximum size of the bucket, please
         note minimum recommended value is 4K.
        </p></li></ul></div></li></ol></div></section><section class="sect3" id="obc-custom-resource-after-bucket-provisioning" data-id-title="OBC custom resource after bucket provisioning"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.3.1.2 </span><span class="title-name">OBC custom resource after bucket provisioning</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#obc-custom-resource-after-bucket-provisioning">#</a></h4></div></div></div><div class="verbatim-wrap"><pre class="screen">  apiVersion: objectbucket.io/v1alpha1
  kind: ObjectBucketClaim
  metadata:
    creationTimestamp: "2019-10-18T09:54:01Z"
    generation: 2
    name: ceph-bucket
    namespace: default [1]
    resourceVersion: "559491"
  spec:
    ObjectBucketName: obc-default-ceph-bucket [2]
    additionalConfig: null
    bucketName: photo-booth-c1178d61-1517-431f-8408-ec4c9fa50bee [3]
    cannedBucketAcl: ""
    ssl: false
    storageClassName: rook-ceph-bucket [4]
    versioned: false
  status:
    Phase: bound [5]</pre></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       <code class="literal">namespace</code> where OBC got created.
      </p></li><li class="listitem"><p>
       <code class="literal">ObjectBucketName</code> generated OB name created using name
       space and OBC name.
      </p></li><li class="listitem"><p>
       The generated (in this case), unique <code class="literal">bucket name</code> for
       the new bucket.
      </p></li><li class="listitem"><p>
       Name of the storage class from OBC got created.
      </p></li><li class="listitem"><p>
       Phases of bucket creation:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="emphasis"><em>Pending</em></span>: the operator is processing the request.
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Bound</em></span>: the operator finished processing the
         request and linked the OBC and OB
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Released</em></span>: the OB has been deleted, leaving the
         OBC unclaimed but unavailable.
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Failed</em></span>: not currently set.
        </p></li></ul></div></li></ol></div></section><section class="sect3" id="app-pod" data-id-title="App pod"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.3.1.3 </span><span class="title-name">App pod</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#app-pod">#</a></h4></div></div></div><div class="verbatim-wrap"><pre class="screen">  apiVersion: v1
  kind: Pod
  metadata:
    name: app-pod
    namespace: dev-user
  spec:
    containers:
    - name: mycontainer
      image: redis
      envFrom: [1]
      - configMapRef:
          name: ceph-bucket [2]
      - secretRef:
          name: ceph-bucket [3]</pre></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Use <code class="literal">env:</code> if mapping of the defined key names to the
       environment-variable names used by the app is needed.
      </p></li><li class="listitem"><p>
       Makes available to the pod as environment variables:
       <code class="literal">BUCKET_HOST</code>, <code class="literal">BUCKET_PORT</code>,
       <code class="literal">BUCKET_NAME</code>
      </p></li><li class="listitem"><p>
       makes available to the pod as environment variables:
       <code class="literal">AWS_ACCESS_KEY_ID</code>,
       <code class="literal">AWS_SECRET_ACCESS_KEY</code>
      </p></li></ol></div></section><section class="sect3" id="storageclass" data-id-title="StorageClass"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.3.1.4 </span><span class="title-name"><code class="literal">StorageClass</code></span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#storageclass">#</a></h4></div></div></div><div class="verbatim-wrap"><pre class="screen">  apiVersion: storage.k8s.io/v1
  kind: StorageClass
  metadata:
    name: rook-ceph-bucket
    labels:
      aws-s3/object [1]
  provisioner: rook-ceph.ceph.rook.io/bucket [2]
  parameters: [3]
    objectStoreName: my-store
    objectStoreNamespace: rook-ceph
    region: us-west-1
    bucketName: ceph-bucket [4]
  reclaimPolicy: Delete [5]</pre></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       <code class="literal">label</code>(optional) here associates this
       <code class="literal">StorageClass</code> to a specific provisioner.
      </p></li><li class="listitem"><p>
       <code class="literal">provisioner</code> responsible for handling
       <code class="literal">OBCs</code> referencing this
       <code class="literal">StorageClass</code>.
      </p></li><li class="listitem"><p>
       <span class="strong"><strong>all</strong></span> <code class="literal">parameter</code>
       required.
      </p></li><li class="listitem"><p>
       <code class="literal">bucketName</code> is required for access to existing buckets
       but is omitted when provisioning new buckets. Unlike greenfield
       provisioning, the brownfield bucket name appears in the
       <code class="literal">StorageClass</code>, not the <code class="literal">OBC</code>.
      </p></li><li class="listitem"><p>
       Rook-Ceph provisioner decides how to treat the
       <code class="literal">reclaimPolicy</code> when an <code class="literal">OBC</code> is
       deleted for the bucket.
      </p></li></ol></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <span class="emphasis"><em>Delete</em></span> = physically delete the bucket.
      </p></li><li class="listitem"><p>
       <span class="emphasis"><em>Retain</em></span> = do not physically delete the bucket.
      </p></li></ul></div></section></section></section><section class="sect1" id="ceph-object-store-user-crd" data-id-title="Ceph Object Storage user custom resource definitions (CRD)"><div class="titlepage"><div><div><h2 class="title"><span class="title-number">13.4 </span><span class="title-name">Ceph Object Storage user custom resource definitions (CRD)</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#ceph-object-store-user-crd">#</a></h2></div></div></div><p>
   Rook allows creation and customization of object store users through the
   custom resource definitions (CRDs). The following settings are available for
   Ceph object store users.
  </p><section class="sect2" id="rook-objectstore-user-crd-sample" data-id-title="Sample"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.4.1 </span><span class="title-name">Sample</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#rook-objectstore-user-crd-sample">#</a></h3></div></div></div><div class="verbatim-wrap"><pre class="screen">  apiVersion: ceph.rook.io/v1
  kind: CephObjectStoreUser
  metadata:
    name: my-user
    namespace: rook-ceph
  spec:
    store: my-store
    displayName: my-display-name</pre></div></section><section class="sect2" id="object-store-user-settings" data-id-title="Object Storage user settings"><div class="titlepage"><div><div><h3 class="title"><span class="title-number">13.4.2 </span><span class="title-name">Object Storage user settings</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#object-store-user-settings">#</a></h3></div></div></div><section class="sect3" id="objectstore-user-settings-metadata" data-id-title="Metadata"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.4.2.1 </span><span class="title-name">Metadata</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#objectstore-user-settings-metadata">#</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">name</code>: The name of the object store user to create,
       which will be reflected in the secret and other resource names.
      </p></li><li class="listitem"><p>
       <code class="literal">namespace</code>: The namespace of the Rook cluster where
       the object store user is created.
      </p></li></ul></div></section><section class="sect3" id="spec" data-id-title="Specification"><div class="titlepage"><div><div><h4 class="title"><span class="title-number">13.4.2.2 </span><span class="title-name">Specification</span> <a title="Permalink" class="permalink" href="admin-caasp-object-storage.html#spec">#</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">store</code>: The object store in which the user will be
       created. This matches the name of the Object Storage CRD.
      </p></li><li class="listitem"><p>
       <code class="literal">displayName</code>: The display name which will be passed to
       the <code class="literal">radosgw-admin user create</code> command.
      </p></li></ul></div></section></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="admin-caasp-advanced-config.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 12 </span>Advanced configuration</span></a> </div><div><a class="pagination-link next" href="admin-caasp-dashboard.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 14 </span>Ceph Dashboard</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="admin-caasp-object-storage.html#rook-object-storage"><span class="title-number">13.1 </span><span class="title-name">Object Storage</span></a></span></li><li><span class="sect1"><a href="admin-caasp-object-storage.html#ceph-object-store-crd"><span class="title-number">13.2 </span><span class="title-name">Ceph Object Storage CRD</span></a></span></li><li><span class="sect1"><a href="admin-caasp-object-storage.html#ceph-object-bucket-claim"><span class="title-number">13.3 </span><span class="title-name">Ceph object bucket claim</span></a></span></li><li><span class="sect1"><a href="admin-caasp-object-storage.html#ceph-object-store-user-crd"><span class="title-number">13.4 </span><span class="title-name">Ceph Object Storage user custom resource definitions (CRD)</span></a></span></li></ul></div><div class="side-title">Give feedback</div><ul class="feedback" id="_give-feedback"><li><a id="_feedback-editurl" href="https://github.com/SUSE/doc-ses/edit/main/xml/admin_caasp_object_storage.xml" rel="nofollow" target="_blank">Edit source document</a></li></ul><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>